<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- –û—Ç–∫–ª—é—á–∞–µ–º –∫–µ—à, —á—Ç–æ–±—ã –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ä–∞–∑—É –ø–æ–¥—Ç—è–≥–∏–≤–∞–ª–∏—Å—å -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>üöÄ v2.0 –ú–£–õ–¨–¢–ò-SVG PRO [–î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á—ë—Ç]</title>
    
    <!-- –õ–ï–ù–ò–í–ê–Ø –ó–ê–ì–†–£–ó–ö–ê Three.js (–ü–†–ê–í–ò–õ–¨–ù–´–ô –ü–û–î–•–û–î) -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.125.2/build/three.min.js" defer crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.125.2/examples/js/controls/OrbitControls.js" defer crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.125.2/examples/js/loaders/SVGLoader.js" defer crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js" defer crossorigin="anonymous"></script>
    
    <!-- –ü–†–ê–ô–°-–õ–ò–°–¢ –í–°–¢–†–û–ï–ù (–¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏—â–∏ PRICES_DATA –Ω–∏–∂–µ –≤ –∫–æ–¥–µ) -->
    <script>
        // –ü—Ä–∞–π—Å-–ª–∏—Å—Ç –≤—Å—Ç—Ä–æ–µ–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã —á–µ—Ä–µ–∑ file://
        // –î–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: –Ω–∞–π–¥–∏ PRICES_DATA –≤ —ç—Ç–æ–º –∂–µ —Ñ–∞–π–ª–µ (Ctrl+F "PRICES_DATA")
        
const PRICES_DATA = {
    
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // üîπ –ú–ê–¢–ï–†–ò–ê–õ–´ –õ–ò–¶–ê (–æ—Å–Ω–æ–≤–∞ –≤—ã–≤–µ—Å–∫–∏)
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    materials: {
        "pvc-3": {
            name: "–ü–í–• –±–µ–ª—ã–π 3–º–º",
            price: 1100,
            unit: "–º¬≤",
            note: "–¢–æ–Ω–∫–∏–π –ª–∏—Å—Ç–æ–≤–æ–π",
            sheet_width: 2050,
            sheet_height: 3050,
            cuttable_width: 2000,
            cuttable_height: 3000,
            waste_margin: 50
        },
        "pvc-4": {
            name: "–ü–í–• –±–µ–ª—ã–π 4–º–º",
            price: 1200,
            unit: "–º¬≤",
            note: "–°—Ç–∞–Ω–¥–∞—Ä—Ç –¥–ª—è –ø–ª–æ—Å–∫–∏—Ö –±—É–∫–≤",
            sheet_width: 2050,
            sheet_height: 3050,
            cuttable_width: 2000,
            cuttable_height: 3000,
            waste_margin: 50
        },
        "pvc-6": {
            name: "–ü–í–• –±–µ–ª—ã–π 6–º–º",
            price: 1400,
            unit: "–º¬≤",
            note: "–£—Å–∏–ª–µ–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç",
            sheet_width: 2050,
            sheet_height: 3050,
            cuttable_width: 2000,
            cuttable_height: 3000,
            waste_margin: 50
        },
        "pvc-8": {
            name: "–ü–í–• –±–µ–ª—ã–π 8–º–º",
            price: 1500,
            unit: "–º¬≤",
            note: "–î–ª—è –±–æ–ª—å—à–∏—Ö –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–π",
            sheet_width: 2050,
            sheet_height: 3050,
            cuttable_width: 2000,
            cuttable_height: 3000,
            waste_margin: 50
        },
        "acrylic-3-milk": {
            name: "–ê–∫—Ä–∏–ª –º–æ–ª–æ—á–Ω—ã–π 3–º–º",
            price: 2500,
            unit: "–º¬≤",
            note: "–°–≤–µ—Ç–æ–≤—ã–µ –±—É–∫–≤—ã, —Ç—Ä–µ–±—É–µ—Ç –ø–ª—ë–Ω–∫—É",
            sheet_width: 2050,
            sheet_height: 3050,
            cuttable_width: 2000,
            cuttable_height: 3000,
            waste_margin: 50
        },
        "acrylic-3-red": {
            name: "–ê–∫—Ä–∏–ª –∫—Ä–∞—Å–Ω—ã–π 3–º–º",
            price: 2500,
            unit: "–º¬≤",
            note: "–¶–≤–µ—Ç–Ω–æ–π –∞–∫—Ä–∏–ª",
            sheet_width: 2050,
            sheet_height: 3050,
            cuttable_width: 2000,
            cuttable_height: 3000,
            waste_margin: 50
        },
        "acrylic-3-yellow": {
            name: "–ê–∫—Ä–∏–ª –∂—ë–ª—Ç—ã–π 3–º–º",
            price: 2500,
            unit: "–º¬≤",
            note: "–¶–≤–µ—Ç–Ω–æ–π –∞–∫—Ä–∏–ª",
            sheet_width: 2050,
            sheet_height: 3050,
            cuttable_width: 2000,
            cuttable_height: 3000,
            waste_margin: 50
        },
        "acrylic-3-blue": {
            name: "–ê–∫—Ä–∏–ª —Å–∏–Ω–∏–π 3–º–º",
            price: 2500,
            unit: "–º¬≤",
            note: "–¶–≤–µ—Ç–Ω–æ–π –∞–∫—Ä–∏–ª",
            sheet_width: 2050,
            sheet_height: 3050,
            cuttable_width: 2000,
            cuttable_height: 3000,
            waste_margin: 50
        },
        "acrylic-3-green": {
            name: "–ê–∫—Ä–∏–ª –∑–µ–ª—ë–Ω—ã–π 3–º–º",
            price: 2500,
            unit: "–º¬≤",
            note: "–¶–≤–µ—Ç–Ω–æ–π –∞–∫—Ä–∏–ª",
            sheet_width: 2050,
            sheet_height: 3050,
            cuttable_width: 2000,
            cuttable_height: 3000,
            waste_margin: 50
        },
        "acrylic-3-orange": {
            name: "–ê–∫—Ä–∏–ª –æ—Ä–∞–Ω–∂–µ–≤—ã–π 3–º–º",
            price: 2500,
            unit: "–º¬≤",
            note: "–¶–≤–µ—Ç–Ω–æ–π –∞–∫—Ä–∏–ª",
            sheet_width: 2050,
            sheet_height: 3050,
            cuttable_width: 2000,
            cuttable_height: 3000,
            waste_margin: 50
        },
        "acrylic-3-black": {
            name: "–ê–∫—Ä–∏–ª —á—ë—Ä–Ω—ã–π 3–º–º",
            price: 2500,
            unit: "–º¬≤",
            note: "–¶–≤–µ—Ç–Ω–æ–π –∞–∫—Ä–∏–ª",
            sheet_width: 2050,
            sheet_height: 3050,
            cuttable_width: 2000,
            cuttable_height: 3000,
            waste_margin: 50
        },
        "composite-3-1220": {
            name: "–ê–ª—é–º–æ–∫–æ–º–ø–æ–∑–∏—Ç 3–º–º (1220√ó4000–º–º)",
            price: 2000,
            unit: "–º¬≤",
            note: "–ê–ª—é–º–∏–Ω–∏–µ–≤—ã–π –∫–æ–º–ø–æ–∑–∏—Ç",
            sheet_width: 1220,
            sheet_height: 4000,
            cuttable_width: 1220,
            cuttable_height: 4000,
            waste_margin: 0
        },
        "composite-3-1500": {
            name: "–ê–ª—é–º–æ–∫–æ–º–ø–æ–∑–∏—Ç 3–º–º (1500√ó4000–º–º)",
            price: 2000,
            unit: "–º¬≤",
            note: "–ê–ª—é–º–∏–Ω–∏–µ–≤—ã–π –∫–æ–º–ø–æ–∑–∏—Ç",
            sheet_width: 1500,
            sheet_height: 4000,
            cuttable_width: 1500,
            cuttable_height: 4000,
            waste_margin: 0
        },
        "polycarbonate-4": {
            name: "–°–æ—Ç–æ–≤—ã–π –ø–æ–ª–∏–∫–∞—Ä–±–æ–Ω–∞—Ç 4–º–º",
            price: 450,
            unit: "–º¬≤",
            note: "–õ–∏—Å—Ç 2100√ó12000–º–º",
            sheet_width: 2100,
            sheet_height: 12000,
            cuttable_width: 2100,
            cuttable_height: 12000,
            waste_margin: 0
        },
        "polycarbonate-6": {
            name: "–°–æ—Ç–æ–≤—ã–π –ø–æ–ª–∏–∫–∞—Ä–±–æ–Ω–∞—Ç 6–º–º",
            price: 650,
            unit: "–º¬≤",
            note: "–õ–∏—Å—Ç 2100√ó12000–º–º",
            sheet_width: 2100,
            sheet_height: 12000,
            cuttable_width: 2100,
            cuttable_height: 12000,
            waste_margin: 0
        },
        "pvc-8-back": {
            name: "–ü–í–• 8–º–º (–¥–ª—è –∑–∞–¥–Ω–∏–∫–æ–≤)",
            price: 1200,
            unit: "–º¬≤",
            note: "–ó–∞–¥–Ω—è—è —Å—Ç–µ–Ω–∫–∞ –æ–±—ä—ë–º–Ω—ã—Ö –±—É–∫–≤",
            sheet_width: 2050,
            sheet_height: 3050,
            cuttable_width: 2000,
            cuttable_height: 3000,
            waste_margin: 50
        },
        "acrylic-clear-3": {
            name: "–ê–∫—Ä–∏–ª –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π 3–º–º",
            price: 2300,
            unit: "–º¬≤",
            note: "–î–ª—è –∫–æ–Ω—Ç—Ä–∞–∂—É—Ä–∞",
            sheet_width: 2050,
            sheet_height: 3050,
            cuttable_width: 2000,
            cuttable_height: 3000,
            waste_margin: 50
        }
    },
    
    films: {
        "oracal-641": {
            name: "–ü–ª—ë–Ω–∫–∞ Oracal 641",
            price: 800,
            unit: "–º¬≤",
            note: "–ù–µ—Å–≤–µ—Ç–æ–≤–∞—è, –º–∞—Ç–æ–≤–∞—è",
            roll_width: 1260,
            cuttable_width: 1220,
            min_length: 500,
            waste_margin: 30
        },
        "oracal-8500": {
            name: "–ü–ª—ë–Ω–∫–∞ Oracal 8500",
            price: 1000,
            unit: "–º¬≤",
            note: "–¢—Ä–∞–Ω—Å–ª—é—Ü–µ–Ω—Ç–Ω–∞—è –¥–ª—è –ø–æ–¥—Å–≤–µ—Ç–∫–∏",
            roll_width: 1260,
            cuttable_width: 1220,
            min_length: 500,
            waste_margin: 30
        }
    },
    
    profiles: {
        "pvc-3": {
            name: "–ë–æ—Ä—Ç –ü–í–• 3–º–º",
            price: 180,
            unit: "–º.–ø.",
            note: "–¢–æ–Ω–∫–∏–π –ø—Ä–æ—Ñ–∏–ª—å",
            height: 30
        },
        "pvc-4": {
            name: "–ë–æ—Ä—Ç –ü–í–• 4–º–º",
            price: 220,
            unit: "–º.–ø.",
            note: "–°—Ç–∞–Ω–¥–∞—Ä—Ç –¥–ª—è –æ–±—ä—ë–º–Ω—ã—Ö –±—É–∫–≤",
            height: 40
        },
        "pvc-6": {
            name: "–ë–æ—Ä—Ç –ü–í–• 6–º–º",
            price: 240,
            unit: "–º.–ø.",
            note: "–°—Ä–µ–¥–Ω–∏–π –ø—Ä–æ—Ñ–∏–ª—å",
            height: 60
        },
        "pvc-8": {
            name: "–ë–æ—Ä—Ç –ü–í–• 8–º–º",
            price: 250,
            unit: "–º.–ø.",
            note: "–£—Å–∏–ª–µ–Ω–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å",
            height: 80
        },
        "aluminum-4": {
            name: "–ë–æ—Ä—Ç –ê–ª—é–º–∏–Ω–∏–µ–≤—ã–π 40–º–º",
            price: 140,
            unit: "–º.–ø.",
            note: "–° —É–ø–ª–æ—Ç–Ω–∏—Ç–µ–ª–µ–º",
            height: 40
        },
        "aluminum-6": {
            name: "–ë–æ—Ä—Ç –ê–ª—é–º–∏–Ω–∏–µ–≤—ã–π 60–º–º",
            price: 160,
            unit: "–º.–ø.",
            note: "–° —É–ø–ª–æ—Ç–Ω–∏—Ç–µ–ª–µ–º",
            height: 60
        },
        "aluminum-8": {
            name: "–ë–æ—Ä—Ç –ê–ª—é–º–∏–Ω–∏–µ–≤—ã–π 80–º–º",
            price: 190,
            unit: "–º.–ø.",
            note: "–° —É–ø–ª–æ—Ç–Ω–∏—Ç–µ–ª–µ–º",
            height: 80
        },
        "aluminum-10": {
            name: "–ë–æ—Ä—Ç –ê–ª—é–º–∏–Ω–∏–µ–≤—ã–π 100–º–º",
            price: 220,
            unit: "–º.–ø.",
            note: "–° —É–ø–ª–æ—Ç–Ω–∏—Ç–µ–ª–µ–º",
            height: 100
        }
    },
    
    lighting: {
        "led-0.7w": {
            name: "3smd 0.7–í—Ç",
            price: 15,
            unit: "—à—Ç",
            power_w: 0.7,
            spacing_mm: 65,
            margin_mm: 5
        },
        
        "led-1.0w": {
            name: "3smd 1.0–í—Ç",
            price: 18,
            unit: "—à—Ç",
            power_w: 1.0,
            spacing_mm: 65,
            margin_mm: 5
        },
        
        "led-1.2w": {
            name: "3smd 1.2–í—Ç",
            price: 20,
            unit: "—à—Ç",
            power_w: 1.2,
            spacing_mm: 65,
            margin_mm: 5
        },
        
        "led-1.5w": {
            name: "3smd 1.5–í—Ç",
            price: 25,
            unit: "—à—Ç",
            power_w: 1.5,
            spacing_mm: 65,
            margin_mm: 5
        },
        "power-supply-60w": {
            name: "–ë–ª–æ–∫ –ø–∏—Ç–∞–Ω–∏—è 60–í—Ç",
            price: 800,
            unit: "—à—Ç",
            power_w: 60
        },
        "power-supply-100w": {
            name: "–ë–ª–æ–∫ –ø–∏—Ç–∞–Ω–∏—è 100–í—Ç",
            price: 1100,
            unit: "—à—Ç",
            power_w: 100
        },
        "power-supply-150w": {
            name: "–ë–ª–æ–∫ –ø–∏—Ç–∞–Ω–∏—è 150–í—Ç",
            price: 1500,
            unit: "—à—Ç",
            power_w: 150
        },
        "power-supply-200w": {
            name: "–ë–ª–æ–∫ –ø–∏—Ç–∞–Ω–∏—è 200–í—Ç",
            price: 2000,
            unit: "—à—Ç",
            power_w: 200
        },
        "power-supply-400w": {
            name: "–ë–ª–æ–∫ –ø–∏—Ç–∞–Ω–∏—è 400–í—Ç",
            price: 3500,
            unit: "—à—Ç",
            power_w: 400
        }
    },
    
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // üîπ –ö–ê–†–ö–ê–° (–ø—Ä–æ—Ñ–∏–ª—å–Ω—ã–µ —Ç—Ä—É–±—ã –∏ –∞–ª—é–º–∏–Ω–∏–µ–≤—ã–µ –ø—Ä–æ—Ñ–∏–ª–∏)
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    frame: {
        "steel-15x15": {
            name: "–ü—Ä–æ—Ñ —Ç—Ä—É–±–∞ 15√ó15–º–º",
            price: 78,
            unit: "–º.–ø.",
            length: 6000,
            painting: 12,
            note: "–°—Ç–∞–ª—å–Ω–∞—è –ø—Ä–æ—Ñ–∏–ª—å–Ω–∞—è —Ç—Ä—É–±–∞ (400‚ÇΩ/—à—Ç + 70‚ÇΩ –ø–æ–∫—Ä–∞—Å–∫–∞)"
        },
        "steel-20x20": {
            name: "–ü—Ä–æ—Ñ —Ç—Ä—É–±–∞ 20√ó20–º–º",
            price: 96,
            unit: "–º.–ø.",
            length: 6000,
            painting: 13,
            note: "–°—Ç–∞–ª—å–Ω–∞—è –ø—Ä–æ—Ñ–∏–ª—å–Ω–∞—è —Ç—Ä—É–±–∞ (500‚ÇΩ/—à—Ç + 80‚ÇΩ –ø–æ–∫—Ä–∞—Å–∫–∞)"
        },
        "steel-25x25": {
            name: "–ü—Ä–æ—Ñ —Ç—Ä—É–±–∞ 25√ó25–º–º",
            price: 115,
            unit: "–º.–ø.",
            length: 6000,
            painting: 15,
            note: "–°—Ç–∞–ª—å–Ω–∞—è –ø—Ä–æ—Ñ–∏–ª—å–Ω–∞—è —Ç—Ä—É–±–∞ (600‚ÇΩ/—à—Ç + 90‚ÇΩ –ø–æ–∫—Ä–∞—Å–∫–∞)"
        },
        "steel-30x30": {
            name: "–ü—Ä–æ—Ñ —Ç—Ä—É–±–∞ 30√ó30–º–º",
            price: 133,
            unit: "–º.–ø.",
            length: 6000,
            painting: 17,
            note: "–°—Ç–∞–ª—å–Ω–∞—è –ø—Ä–æ—Ñ–∏–ª—å–Ω–∞—è —Ç—Ä—É–±–∞ (700‚ÇΩ/—à—Ç + 100‚ÇΩ –ø–æ–∫—Ä–∞—Å–∫–∞)"
        },
        "steel-40x20": {
            name: "–ü—Ä–æ—Ñ —Ç—Ä—É–±–∞ 40√ó20–º–º",
            price: 177,
            unit: "–º.–ø.",
            length: 6000,
            painting: 18,
            note: "–°—Ç–∞–ª—å–Ω–∞—è –ø—Ä–æ—Ñ–∏–ª—å–Ω–∞—è —Ç—Ä—É–±–∞ (950‚ÇΩ/—à—Ç + 110‚ÇΩ –ø–æ–∫—Ä–∞—Å–∫–∞)"
        },
        "alu-15x15-2m": {
            name: "–ê–ª—é–º–∏–Ω–∏–µ–≤—ã–π –ø—Ä–æ—Ñ–∏–ª—å 15√ó15–º–º (2–º)",
            price: 210,
            unit: "–º.–ø.",
            length: 2000,
            painting: 35,
            note: "–ê–ª—é–º–∏–Ω–∏–µ–≤—ã–π –ø—Ä–æ—Ñ–∏–ª—å (350‚ÇΩ/—à—Ç + 70‚ÇΩ –ø–æ–∫—Ä–∞—Å–∫–∞)"
        },
        "alu-15x15-3m": {
            name: "–ê–ª—é–º–∏–Ω–∏–µ–≤—ã–π –ø—Ä–æ—Ñ–∏–ª—å 15√ó15–º–º (3–º)",
            price: 192,
            unit: "–º.–ø.",
            length: 3000,
            painting: 25,
            note: "–ê–ª—é–º–∏–Ω–∏–µ–≤—ã–π –ø—Ä–æ—Ñ–∏–ª—å (500‚ÇΩ/—à—Ç + 75‚ÇΩ –ø–æ–∫—Ä–∞—Å–∫–∞)"
        },
        "alu-20x20-2m": {
            name: "–ê–ª—é–º–∏–Ω–∏–µ–≤—ã–π –ø—Ä–æ—Ñ–∏–ª—å 20√ó20–º–º (2–º)",
            price: 318,
            unit: "–º.–ø.",
            length: 2000,
            painting: 43,
            note: "–ê–ª—é–º–∏–Ω–∏–µ–≤—ã–π –ø—Ä–æ—Ñ–∏–ª—å (550‚ÇΩ/—à—Ç + 85‚ÇΩ –ø–æ–∫—Ä–∞—Å–∫–∞)"
        },
        "alu-20x20-3m": {
            name: "–ê–ª—é–º–∏–Ω–∏–µ–≤—ã–π –ø—Ä–æ—Ñ–∏–ª—å 20√ó20–º–º (3–º)",
            price: 248,
            unit: "–º.–ø.",
            length: 3000,
            painting: 32,
            note: "–ê–ª—é–º–∏–Ω–∏–µ–≤—ã–π –ø—Ä–æ—Ñ–∏–ª—å (650‚ÇΩ/—à—Ç + 95‚ÇΩ –ø–æ–∫—Ä–∞—Å–∫–∞)"
        }
    },
    
    hardware: {
        "spacers": {
            name: "–î–∏—Å—Ç–∞–Ω—Ü–∏–æ–Ω–Ω—ã–µ –¥–µ—Ä–∂–∞—Ç–µ–ª–∏",
            price: 50,
            unit: "—à—Ç",
            note: "–î–ª—è –æ—Ç—Å—Ç—É–ø–∞ –æ—Ç —Å—Ç–µ–Ω—ã"
        },
        "mounting-plate": {
            name: "–ú–æ–Ω—Ç–∞–∂–Ω–∞—è –ø–ª–∞—Å—Ç–∏–Ω–∞",
            price: 300,
            unit: "—à—Ç",
            note: "–î–ª—è –∫—Ä–µ–ø–ª–µ–Ω–∏—è –±—É–∫–≤"
        },
        "corner-plastic": {
            name: "–£–≥–æ–ª–æ–∫ –ø–ª–∞—Å—Ç–∏–∫–æ–≤—ã–π 30√ó30–º–º",
            price: 100,
            unit: "–º.–ø.",
            length: 3000,
            note: "–û–±—Ä–∞–º–ª–µ–Ω–∏–µ –æ—Å–Ω–æ–≤—ã"
        },
        "corner-metal": {
            name: "–£–≥–æ–ª–æ–∫ –∂–µ—Å—Ç—è–Ω–æ–π 30√ó30–º–º",
            price: 300,
            unit: "–º.–ø.",
            length: 2000,
            note: "–û–±—Ä–∞–º–ª–µ–Ω–∏–µ –æ—Å–Ω–æ–≤—ã"
        },
        "paint-spray": {
            name: "–ö—Ä–∞—Å–∫–∞ –≤ –±–∞–ª–ª–æ–Ω–µ",
            price: 400,
            unit: "—à—Ç",
            coverage: 6000, // –•–≤–∞—Ç–∞–µ—Ç –Ω–∞ 6 –º–µ—Ç—Ä–æ–≤ –ø—Ä–æ—Ñ–∏–ª—è (3 –ø–∞–ª–∫–∏ –ø–æ 2–º)
            note: "–ü–æ–∫—Ä–∞—Å–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è"
        }
    },
    
    work: {
        "assembly-volumetric": {
            name: "–°–±–æ—Ä–∫–∞ –æ–±—ä—ë–º–Ω—ã—Ö –±—É–∫–≤",
            hours_per_m2: 4,
            rate_per_hour: 500,
            unit: "–º¬≤",
            note: "–§—Ä–µ–∑–µ—Ä–æ–≤–∫–∞ + —Å–±–æ—Ä–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è"
        },
        "side-gluing": {
            name: "–ü—Ä–∏–∫–ª–µ–π–∫–∞ –±–æ—Ä—Ç–∞",
            hours_per_m: 0.1,
            rate_per_hour: 500,
            unit: "–º.–ø.",
            note: "–ü—Ä–∏–∫–ª–µ–∏–≤–∞–Ω–∏–µ –±–æ—Ä—Ç–∞ –∫ –ª–∏—Ü—É"
        },
        "led-installation": {
            name: "–ú–æ–Ω—Ç–∞–∂ LED –¥–∏–æ–¥–æ–≤",
            hours_per_m2: 1.5,
            rate_per_hour: 500,
            unit: "–º¬≤",
            note: "–†–∞—Å–∫–ª–∞–¥–∫–∞ + –ø–∞–π–∫–∞"
        },
        "frame-assembly": {
            name: "–ò–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ –∫–∞—Ä–∫–∞—Å–∞",
            hours_per_m: 0.3,
            rate_per_hour: 500,
            unit: "–º.–ø.",
            note: "–°–≤–∞—Ä–∫–∞/—Å–±–æ—Ä–∫–∞ –∫–∞—Ä–∫–∞—Å–∞"
        },
        "composite-folding": {
            name: "–ü–æ–¥–≤–æ—Ä–æ—Ç –∫–æ–º–ø–æ–∑–∏—Ç–∞",
            hours_per_m: 0.5,
            rate_per_hour: 500,
            unit: "–º.–ø.",
            note: "–ó–∞–≥–∏–±–∫–∞ –∫—Ä–∞—ë–≤"
        },
        "corner-installation": {
            name: "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —É–≥–æ–ª–∫–∞",
            hours_per_m: 0.2,
            rate_per_hour: 500,
            unit: "–º.–ø.",
            note: "–û–±—Ä–∞–º–ª–µ–Ω–∏–µ –æ—Å–Ω–æ–≤—ã"
        },
        "base-assembly": {
            name: "–°–±–æ—Ä–∫–∞ –æ—Å–Ω–æ–≤—ã/–ø–æ–¥–ª–æ–∂–∫–∏",
            hours_per_m2: 0.3,
            rate_per_hour: 500,
            unit: "–º¬≤",
            note: "–ö–∞—Ä–∫–∞—Å + –∑–∞–¥–Ω—è—è —Å—Ç–µ–Ω–∫–∞"
        },
        "film-application": {
            name: "–ü–æ–∫–ª–µ–π–∫–∞ –ø–ª—ë–Ω–∫–∏",
            hours_per_m2: 1.5,
            rate_per_hour: 500,
            unit: "–º¬≤",
            note: "–û–±–µ–∑–∂–∏—Ä–∏–≤–∞–Ω–∏–µ + –∞–ø–ø–ª–∏–∫–∞—Ü–∏—è"
        },
        "installation": {
            name: "–ú–æ–Ω—Ç–∞–∂ –Ω–∞ –æ–±—ä–µ–∫—Ç–µ",
            rate_per_hour: 500,
            unit: "—á–∞—Å",
            note: "–í—ã–µ–∑–¥ + —É—Å—Ç–∞–Ω–æ–≤–∫–∞"
        }
    },
    
    equipment: {
        "cnc-router": {
            name: "–ß–ü–£ —Ñ—Ä–µ–∑–µ—Ä",
            work_area_width: 2000,
            work_area_height: 3000,
            safe_margin: 50,
            note: "–î–ª—è —Ä–µ–∑–∫–∏ –ü–í–•/–∞–∫—Ä–∏–ª–∞/–∫–æ–º–ø–æ–∑–∏—Ç–∞"
        },
        "plotter": {
            name: "–ü–ª–æ—Ç—Ç–µ—Ä —Ä–µ–∑–∫–∏ –ø–ª—ë–Ω–∫–∏",
            work_area_width: 1220,
            safe_margin: 20,
            note: "–î–ª—è —Ä–µ–∑–∫–∏ Oracal"
        }
    },
    
    modifiers: {
        "margin-standard": {
            name: "–ú–∞—Ä–∂–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è",
            value: 30,
            unit: "%",
            note: "–ù–∞—Ü–µ–Ω–∫–∞ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞"
        },
        "margin-urgent": {
            name: "–ú–∞—Ä–∂–∞ —Å—Ä–æ—á–Ω—ã–π –∑–∞–∫–∞–∑",
            value: 50,
            unit: "%",
            note: "–ó–∞ —Å—Ä–æ—á–Ω–æ—Å—Ç—å < 3 –¥–Ω–µ–π"
        },
        "discount-bulk": {
            name: "–°–∫–∏–¥–∫–∞ –æ–ø—Ç–æ–≤–∞—è",
            value: 15,
            unit: "%",
            note: "–û—Ç 10 –±—É–∫–≤"
        },
        "complexity-coefficient": {
            name: "–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç–∏",
            value: 1.2,
            unit: "–º–Ω–æ–∂–∏—Ç–µ–ª—å",
            note: "–î–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Ñ–æ—Ä–º (—É–º–Ω–æ–∂–∞—Ç—å –Ω–∞ —Å—Ç–æ–∏–º–æ—Å—Ç—å)"
        }
    }
};
    </script>
    
    <style>
        :root {
            --panel-bg: rgba(10, 15, 25, 0.75);
            --accent-color: #FFD100;
            --border-color: rgba(255, 209, 0, 0.3);
            --text-main: #ffffff;
            --text-dim: rgba(255, 255, 255, 0.6);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: #05080a;
            color: var(--text-main);
            height: 100vh;
            overflow: hidden;
        }
        
        /* –ü–û–õ–ù–û–≠–ö–†–ê–ù–ù–ê–Ø –°–¶–ï–ù–ê */
        .game-viewport {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: flex;
        }

        #canvas-3d {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        /* –õ–ï–í–ê–Ø –ü–ê–ù–ï–õ–¨ (–ü–ê–†–ò–¢) */
        .overlay-left {
            position: relative;
            z-index: 10;
            width: calc(100vw - 420px);
            height: 100vh;
            padding: 30px;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            background: none; /* –£–ë–†–ê–õ–ò –ü–ï–õ–ï–ù–£ */
            pointer-events: none;
        }
        
        .overlay-left > * { pointer-events: auto; }
        
        .bottom-container {
            display: flex;
            flex-wrap: wrap;
            align-items: flex-end;
            gap: 8px;
            max-width: 300px;
            background: rgba(0,0,0,0.4); /* –ù–µ–±–æ–ª—å—à–∞—è –ø–æ–¥–ª–æ–∂–∫–∞ —Ç–æ–ª—å–∫–æ –ø–æ–¥ –∫–Ω–æ–ø–∫–∞–º–∏ */
            padding: 12px;
            border-radius: 12px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.05);
            height: 134px;
        }

        .svg-upload-zone {
            border: 1px dashed var(--border-color);
            padding: 10px;
            text-align: center;
            cursor: pointer;
            background: rgba(255,209,0,0.03);
            transition: 0.3s;
            border-radius: 8px;
            position: relative;
            width: 110px; /* –ï—â–µ –∫–æ–º–ø–∞–∫—Ç–Ω–µ–µ */
            flex-shrink: 0;
        }

        /* –ü–†–ê–í–ê–Ø –ü–ê–ù–ï–õ–¨ (–ü–ê–†–ò–¢) */
        .overlay-right {
            position: absolute;
            right: 0;
            top: 0;
            z-index: 10;
            width: 360px;
            height: 100vh;
            background: var(--panel-bg);
            backdrop-filter: blur(20px);
            border-left: 1px solid var(--border-color);
            padding: 20px 18px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 12px;
            box-shadow: -15px 0 40px rgba(0,0,0,0.6);
            transition: transform 0.3s ease;
        }
        
        .overlay-right.collapsed {
            transform: translateX(100%);
        }
        
        /* –ö–Ω–æ–ø–∫–∞ —Å–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏—è –ø–∞–Ω–µ–ª–∏ */
        .panel-toggle {
            position: fixed;
            right: 360px;
            top: 50%;
            transform: translateY(-50%);
            width: 28px;
            height: 50px;
            background: var(--panel-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border-color);
            border-right: none;
            border-radius: 6px 0 0 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: right 0.3s ease, background 0.2s ease;
            z-index: 11;
            box-shadow: -3px 0 10px rgba(0,0,0,0.3);
        }
        
        .panel-toggle:hover {
            background: rgba(102, 126, 234, 0.15);
        }
        
        .panel-toggle svg {
            transition: transform 0.3s ease;
            opacity: 0.7;
        }
        
        .panel-toggle:hover svg {
            opacity: 1;
        }
        
        .panel-toggle.collapsed {
            right: 0px;
        }
        
        .panel-toggle.collapsed svg {
            transform: rotate(180deg);
        }

        /* –°–ö–†–û–õ–õ–ë–ê–† */
        .overlay-right::-webkit-scrollbar { width: 4px; }
        .overlay-right::-webkit-scrollbar-track { background: rgba(0,0,0,0.1); }
        .overlay-right::-webkit-scrollbar-thumb { background: var(--accent-color); }

        h1 {
            font-size: 24px;
            text-transform: uppercase;
            letter-spacing: 3px;
            color: var(--accent-color);
            margin-bottom: 5px;
            text-shadow: 0 0 20px rgba(255,209,0,0.4);
        }

        .section-title {
            font-size: 10px;
            font-weight: 800;
            text-transform: uppercase;
            color: var(--accent-color);
            letter-spacing: 1.5px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .section-title::after {
            content: '';
            flex: 1;
            height: 1px;
            background: var(--border-color);
        }

        select, input[type="number"] {
            width: 100%;
            background: rgba(255,255,255,0.06);
            border: 1px solid rgba(255,255,255,0.15);
            padding: 14px;
            color: #fff;
            border-radius: 8px;
            outline: none;
            transition: all 0.3s;
            font-size: 14px;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            cursor: pointer;
        }

        select:focus, input:focus {
            border-color: var(--accent-color);
            background: rgba(255,255,255,0.12);
            box-shadow: 0 0 15px rgba(255,209,0,0.1);
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –≤—ã–ø–∞–¥–∞—é—â–∏—Ö –æ–ø—Ü–∏–π */
        select option {
            background: #1a1f2e !important;
            background-color: #1a1f2e !important;
            color: #fff !important;
            padding: 10px 14px !important;
            font-size: 14px !important;
        }
        
        /* –£–±–∏—Ä–∞–µ–º –±–µ–ª—ã–µ –ø–æ–ª–æ—Å—ã —É –≥—Ä—É–ø–ø */
        select optgroup {
            background: #1a1f2e !important;
            background-color: #1a1f2e !important;
            color: rgba(255,209,0,0.8) !important;
            font-weight: 600 !important;
            font-size: 11px !important;
            padding: 8px 10px !important;
            font-style: normal !important;
        }
        
        select option:hover,
        select option:focus {
            background: rgba(255,209,0,0.3) !important;
            background-color: rgba(255,209,0,0.3) !important;
            color: #fff !important;
        }
        
        select option:checked {
            background: var(--accent-color) !important;
            background-color: var(--accent-color) !important;
            color: #000 !important;
            font-weight: 700 !important;
        }
        
        /* === –°–ü–ò–°–û–ö SVG –û–ë–™–ï–ö–¢–û–í === */
        .svg-list {
            max-height: 120px;
            overflow-y: auto;
        }
        
        .svg-list-item {
            display: flex !important;
            justify-content: space-between;
            align-items: center;
            padding: 3px 0;
            margin-bottom: 2px;
            background: transparent !important;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .svg-list-item:hover {
            transform: translateX(2px);
        }
        
        .svg-list-item.active .svg-item-name {
            color: var(--accent-color) !important;
            font-weight: 700;
        }
        
        .svg-item-name {
            display: block !important;
            font-size: 14px !important;
            color: #fff !important;
            flex: 1;
            font-weight: 400 !important;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            opacity: 1 !important;
            pointer-events: all;
        }
        
        .svg-item-actions {
            display: flex !important;
            gap: 6px;
            opacity: 1 !important;
            pointer-events: all;
        }
        
        .btn-small {
            display: inline-block !important;
            width: 26px;
            height: 26px;
            padding: 0;
            font-size: 14px !important;
            background: rgba(255,255,255,0.15) !important;
            border: 1px solid rgba(255,255,255,0.3) !important;
            border-radius: 4px;
            color: #fff !important;
            cursor: pointer;
            transition: all 0.2s;
            line-height: 24px;
            text-align: center;
            opacity: 1 !important;
            pointer-events: all;
        }
        
        .btn-small:hover {
            background: var(--accent-color) !important;
            color: #000 !important;
            transform: scale(1.15);
            border-color: var(--accent-color) !important;
        }
        
        .btn-small svg {
            display: inline-block;
            vertical-align: middle;
            margin-top: -2px;
        }
        
        /* === –ö–û–ù–¢–ï–ô–ù–ï–† –°–ü–ò–°–ö–ê SVG === */
        .svg-list {
            min-height: 100px;
            max-height: 400px;
            overflow-y: auto;
            overflow-x: hidden;
            margin-bottom: 20px;
            padding: 8px;
        }
        
        .svg-list::-webkit-scrollbar {
            width: 6px;
        }
        
        .svg-list::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.05);
            border-radius: 3px;
        }
        
        .svg-list::-webkit-scrollbar-thumb {
            background: var(--accent-color);
            border-radius: 3px;
        }
        
        /* === –ó–ê–ì–û–õ–û–í–ö–ò –°–ï–ö–¶–ò–ô === */
        .section-title {
            font-size: 14px;
            font-weight: 700;
            color: var(--accent-color);
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .field-group { margin-bottom: 15px; }
        .field-label {
            font-size: 11px;
            text-transform: uppercase;
            color: var(--text-dim);
            margin-bottom: 10px;
            display: block;
            letter-spacing: 1px;
        }
        
        /* –î—É–±–ª–∏—Ä—É—é—â–∏–π –±–ª–æ–∫ —É–¥–∞–ª—ë–Ω - –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∏–ª–∏ –≤—ã—à–µ */
        
        /* –ö–ù–û–ü–ö–ò –ü–ï–†–ï–ú–ï–©–ï–ù–ò–Ø */
        /* === –ö–û–ú–ü–ê–ö–¢–ù–ê–Ø –ù–ê–í–ò–ì–ê–¶–ò–Ø === */
        .compact-nav {
            display: flex;
            flex-direction: column;
            gap: 4px;
            align-items: center;
            margin-bottom: 20px;
            padding: 8px;
            background: rgba(255,255,255,0.03);
            border-radius: 8px;
        }
        
        .nav-row {
            display: flex;
            gap: 4px;
            justify-content: center;
        }
        
        .nav-group {
            display: flex;
            gap: 4px;
        }
        
        .btn-nav {
            background: rgba(255,255,255,0.08);
            border: 1px solid rgba(255,255,255,0.2);
            color: var(--accent-color);
            padding: 0;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .btn-nav:hover {
            background: var(--accent-color);
            color: #000;
            border-color: var(--accent-color);
            transform: scale(1.15);
            box-shadow: 0 0 20px rgba(255,209,0,0.5), 0 4px 8px rgba(0,0,0,0.3);
        }
        
        .btn-nav:active {
            transform: scale(0.95);
        }
        
        .btn-add {
            background: rgba(255,255,255,0.08);
            border: 1px solid rgba(255,255,255,0.2);
            color: white;
            padding: 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.2s;
            width: 100%;
        }
        
        .btn-add:hover {
            background: rgba(255,193,7,0.15);
            border-color: rgba(255,193,7,0.5);
            transform: translateY(-1px);
        }
        
        .btn-add:active {
            transform: translateY(0);
        }
        
        .btn-nav-tall {
            height: 68px !important;
        }

        .radio-group {
            display: flex;
            gap: 2px;
            background: rgba(255,255,255,0.1);
            padding: 2px;
            border-radius: 8px;
        }

        .radio-button { flex: 1; }
        .radio-button input { display: none; }
        .radio-button label {
            display: block;
            padding: 14px;
            text-align: center;
            font-size: 13px;
            font-weight: 700;
            cursor: pointer;
            transition: 0.3s;
            background: rgba(0,0,0,0.4);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .radio-button input:checked + label {
            background: var(--accent-color);
            color: #000;
        }

        .checkbox-group { display: flex; flex-direction: column; gap: 12px; }
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            padding: 12px 15px;
            background: rgba(255,255,255,0.04);
            border-radius: 8px;
            transition: 0.2s;
            border: 1px solid transparent;
        }

        .checkbox-item:hover {
            background: rgba(255,255,255,0.08);
            border-color: rgba(255,255,255,0.1);
        }

        .checkbox-item input {
            width: 20px;
            height: 20px;
            accent-color: var(--accent-color);
            cursor: pointer;
        }

        .svg-upload-zone {
            padding: 0;
            text-align: center;
            cursor: pointer;
            background: rgba(255,209,0,0.15);
            border: 1px solid var(--accent-color);
            color: var(--accent-color);
            transition: 0.3s;
            border-radius: 6px;
            position: relative;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .svg-upload-zone:hover {
            background: var(--accent-color);
            color: #000;
            box-shadow: 0 0 15px rgba(255,209,0,0.3);
        }
        
        .svg-upload-zone input[type="file"] {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            cursor: pointer;
        }

        .status-dot {
            padding: 8px 15px;
            background: rgba(0,0,0,0.6);
            border-radius: 4px;
            border-left: 3px solid #444;
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            font-weight: 700;
        }
        .status-dot.success { border-left-color: #4CAF50; color: #4CAF50; }
        .status-dot.pending { border-left-color: #FFD100; color: #FFD100; }

        .btn-toggle-wall {
            padding: 12px 20px;
            background: rgba(255,209,0,0.15);
            border: 1px solid var(--accent-color);
            color: var(--accent-color);
            cursor: pointer;
            font-weight: 700;
            text-transform: uppercase;
            font-size: 11px;
            letter-spacing: 1.5px;
            transition: 0.3s;
            border-radius: 6px;
            white-space: nowrap;
        }
        
        .btn-toggle-wall.active {
            background: var(--accent-color);
            color: #000;
        }
        
        .btn-toggle-wall:hover {
            box-shadow: 0 0 15px rgba(255,209,0,0.3);
        }
        
        .btn-save-scene:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }
        
        .btn-save-scene:active {
            transform: translateY(0);
        }
        
        .btn-share:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(17, 153, 142, 0.4);
        }
        
        .btn-share:active {
            transform: translateY(0);
        }
        
        #share-modal button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        
        #share-modal button:active {
            transform: translateY(0);
        }

        .btn-test {
            width: 100%;
            padding: 16px;
            background: rgba(255,209,0,0.1);
            border: 1px solid var(--accent-color);
            color: var(--accent-color);
            cursor: pointer;
            font-weight: 800;
            text-transform: uppercase;
            font-size: 11px;
            letter-spacing: 2px;
            transition: 0.3s;
            border-radius: 8px;
            margin-top: 10px;
        }
        .btn-test:hover {
            background: var(--accent-color);
            color: #000;
            box-shadow: 0 0 20px rgba(255,209,0,0.3);
        }
        
        /* === –ö–û–ú–ü–ê–ö–¢–ù–´–ï –ò–ö–û–ù–û–ß–ù–´–ï –ö–ù–û–ü–ö–ò === */
        .icon-button-group {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }
        
        .icon-btn {
            flex: 1;
            min-width: 48px;
            height: 48px;
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 4px;
            cursor: pointer;
            transition: all 0.2s;
            padding: 6px;
        }
        
        .icon-btn:hover {
            background: rgba(255,255,255,0.08);
            border-color: rgba(255,209,0,0.3);
        }
        
        .icon-btn.active {
            background: rgba(255,209,0,0.15);
            border-color: var(--accent-color);
        }
        
        .icon-btn svg {
            width: 20px;
            height: 20px;
            fill: var(--text-dim);
            transition: fill 0.2s;
        }
        
        .icon-btn.active svg {
            fill: var(--accent-color);
        }
        
        .icon-btn-label {
            font-size: 8px;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
            text-align: center;
            line-height: 1.1;
        }
        
        .icon-btn.active .icon-btn-label {
            color: var(--accent-color);
        }
        
        /* === –ö–û–ú–ü–ê–ö–¢–ù–´–ï –ü–û–õ–Ø === */
        .field-group {
            margin-bottom: 6px;
        }
        
        .field-label {
            font-size: 11px;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 3px;
            display: block;
        }
        
        select, input[type="number"] {
            width: 100%;
            padding: 6px 8px;
            background: rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.1);
            color: var(--text-primary);
            border-radius: 4px;
            font-size: 12px;
        }
        
        /* –£–±–∏—Ä–∞–µ–º —Å—Ç—Ä–µ–ª–∫–∏ —É input number */
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        
        input[type="number"] {
            -moz-appearance: textfield;
        }
        
        /* === –ö–ù–û–ü–ö–ò –ò–ó–ú–ï–ù–ï–ù–ò–Ø –ó–ù–ê–ß–ï–ù–ò–ô === */
        .value-btn {
            flex: 1;
            padding: 8px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            color: var(--accent-color);
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 700;
            transition: all 0.2s;
        }
        
        .value-btn:hover {
            background: rgba(255,209,0,0.15);
            border-color: var(--accent-color);
        }
        
        .value-btn:active {
            transform: scale(0.95);
        }
        
        /* === –ö–ê–õ–¨–ö–£–õ–Ø–¢–û–† –°–í–û–†–ê–ß–ò–í–ê–ï–ú–´–ô === */
        .calc-toggle {
            cursor: pointer;
            user-select: none;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        /* –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –ª–∏–Ω–∏—é –∫–∞–∫ —É –¥—Ä—É–≥–∏—Ö —Å–µ–∫—Ü–∏–π */
        
        /* –ö–æ–Ω—Ç–µ–Ω—Ç —Å–≤–æ—Ä–∞—á–∏–≤–∞–µ–º—ã—Ö —Å–µ–∫—Ü–∏–π (–æ–±—â–∏–π –∫–ª–∞—Å—Å) */
        .section-content,
        .calc-content {
            overflow: visible;
            display: block;
        }
        
        .section-content.collapsed,
        .calc-content.collapsed {
            display: none;
        }
        
        /* –°—Ç—Ä–µ–ª–æ—á–∫–∞ –¥–ª—è —Å–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏—è (–æ–±—â–∏–π –∫–ª–∞—Å—Å) */
        .section-arrow,
        .calc-arrow {
            margin-left: auto;
            transition: transform 0.3s;
            font-size: 10px;
            color: var(--accent-color);
        }
        
        .section-toggle.collapsed .section-arrow,
        .calc-toggle.collapsed .calc-arrow {
            transform: rotate(-90deg);
        }
        
        /* –ö—É—Ä—Å–æ—Ä pointer –¥–ª—è –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã—Ö —Å–µ–∫—Ü–∏–π */
        .section-toggle,
        .calc-toggle {
            cursor: pointer;
            user-select: none;
        }
        
        .section-toggle:hover,
        .calc-toggle:hover {
            background: rgba(255,209,0,0.08);
        }
        
        /* –ö–∞—Å—Ç–æ–º–Ω—ã–π select —Å —Ü–≤–µ—Ç–Ω—ã–º–∏ –∫–≤–∞–¥—Ä–∞—Ç–∏–∫–∞–º–∏ */
        .custom-select {
            position: relative;
            cursor: pointer;
            user-select: none;
        }
        
        .custom-select-trigger {
            background: #1a1a2e;
            border: 1px solid #444;
            border-radius: 4px;
            padding: 6px 10px;
            padding-right: 28px;
            color: #fff;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 6px;
            position: relative;
        }
        
        .custom-select-trigger::after {
            content: '‚ñº';
            font-size: 10px;
            opacity: 0.6;
            position: absolute;
            right: 10px;
        }
        
        .custom-select.open .custom-select-trigger::after {
            content: '‚ñ≤';
        }
        
        .custom-options {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: #1a1a2e;
            border: 1px solid #444;
            border-radius: 4px;
            max-height: 300px;
            overflow-y: auto;
            z-index: 1000;
            margin-top: 2px;
            display: none;
        }
        
        .custom-select.open .custom-options {
            display: block;
        }
        
        .custom-option {
            padding: 6px 10px;
            color: #fff;
            font-size: 13px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background 0.2s;
        }
        
        .custom-option:hover {
            background: #252540;
        }
        
        .custom-option.selected {
            background: #333350;
            color: var(--accent-color);
        }
        
        .custom-optgroup-label {
            padding: 6px 10px;
            font-size: 11px;
            color: #888;
            font-weight: bold;
            text-transform: uppercase;
            background: #0f0f1a;
        }
        
        .color-square {
            width: 16px;
            height: 16px;
            border-radius: 2px;
            flex-shrink: 0;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–∫—Ä–æ–ª–ª–±–∞—Ä–∞ –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ dropdown */
        .custom-options::-webkit-scrollbar {
            width: 6px;
        }
        
        .custom-options::-webkit-scrollbar-track {
            background: #1a1a2e;
        }
        
        .custom-options::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 3px;
        }
        
        .custom-options::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        
        /* –ü–õ–ê–í–ê–Æ–©–ê–Ø –ü–ê–ù–ï–õ–¨ –£–ü–†–ê–í–õ–ï–ù–ò–Ø –í –°–¶–ï–ù–ï */
        .scene-controls-overlay {
            position: absolute;
            bottom: 30px;
            left: 340px;
            background: rgba(20, 20, 30, 0.85);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 12px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
            border: 1px solid rgba(255,255,255,0.1);
            z-index: 50;
            height: 134px;
        }
        
        .scene-controls-row {
            display: flex;
            gap: 6px;
            justify-content: center;
        }
        
        .scene-control-btn {
            width: 40px;
            height: 40px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 6px;
            color: #fff;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            user-select: none;
        }
        
        .scene-control-btn:hover {
            background: rgba(255,193,7,0.3);
            border-color: rgba(255,193,7,0.5);
            transform: scale(1.05);
        }
        
        .scene-control-btn:active {
            transform: scale(0.95);
        }
        
        /* –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π layout –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ */
        .scene-controls-main {
            display: flex;
            gap: 12px;
            align-items: center;
        }
        
        .scene-controls-left {
            display: flex;
            gap: 6px;
            align-items: center;
        }
        
        .scene-controls-middle {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        
        .scene-controls-right {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        
        /* –ë–æ–ª—å—à–∏–µ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ ‚Üê –∏ ‚Üí */
        .scene-control-tall {
            height: 86px;
        }
        
        /* –ú–∞–ª–µ–Ω—å–∫–∏–µ –∫–Ω–æ–ø–∫–∏ */
        .scene-control-small {
            height: 40px;
        }
        
        .scene-controls-label {
            text-align: center;
            font-size: 10px;
            color: rgba(255,255,255,0.5);
            margin-top: 4px;
        }
    </style>
</head>
<body>
    <div class="game-viewport">
        <!-- 3D –°–¶–ï–ù–ê –ù–ê –í–ï–°–¨ –≠–ö–†–ê–ù -->
        <canvas id="canvas-3d"></canvas>
        
        <!-- –ü–õ–ê–í–ê–Æ–©–ê–Ø –ü–ê–ù–ï–õ–¨ –£–ü–†–ê–í–õ–ï–ù–ò–Ø -->
        <div class="scene-controls-overlay" id="scene-controls">
            <div class="scene-controls-main">
                <div class="scene-controls-left">
                    <div class="scene-control-btn scene-control-tall" onmousedown="handleSceneControlMouseDown('left')" onmouseup="handleSceneControlMouseUp()" onmouseleave="handleSceneControlMouseUp()">‚Üê</div>
                    <div class="scene-controls-middle">
                        <div class="scene-control-btn scene-control-small" onmousedown="handleSceneControlMouseDown('up')" onmouseup="handleSceneControlMouseUp()" onmouseleave="handleSceneControlMouseUp()">‚Üë</div>
                        <div class="scene-control-btn scene-control-small" onmousedown="handleSceneControlMouseDown('down')" onmouseup="handleSceneControlMouseUp()" onmouseleave="handleSceneControlMouseUp()">‚Üì</div>
                    </div>
                    <div class="scene-control-btn scene-control-tall" onmousedown="handleSceneControlMouseDown('right')" onmouseup="handleSceneControlMouseUp()" onmouseleave="handleSceneControlMouseUp()">‚Üí</div>
                </div>
                <div class="scene-controls-right">
                    <div class="scene-control-btn scene-control-small" onmousedown="handleSceneControlMouseDown('backward')" onmouseup="handleSceneControlMouseUp()" onmouseleave="handleSceneControlMouseUp()">‚á¶</div>
                    <div class="scene-control-btn scene-control-small" onmousedown="handleSceneControlMouseDown('forward')" onmouseup="handleSceneControlMouseUp()" onmouseleave="handleSceneControlMouseUp()">‚á®</div>
                </div>
            </div>
            <div class="scene-controls-label">–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ç—Ä–µ–ª–∫–∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã</div>
        </div>

        <!-- –õ–ï–í–ê–Ø –ü–ê–ù–ï–õ–¨ (–ò–ù–§–û –ò –ó–ê–ì–†–£–ó–ö–ê) -->
        <div class="overlay-left">
            <div class="bottom-container">
                <!-- –õ–ï–í–ê–Ø –ö–û–õ–û–ù–ö–ê –° –ö–ù–û–ü–ö–ê–ú–ò-–ò–ö–û–ù–ö–ê–ú–ò -->
                <div style="display: flex; gap: 8px; flex-shrink: 0;">
                    <!-- 1. –ö–ù–û–ü–ö–ê –í–´–ë–û–†–ê –§–ê–ô–õ–ê -->
                    <div class="svg-upload-zone" id="upload-zone" style="width: 44px; height: 44px; display: flex; align-items: center; justify-content: center; padding: 0;">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                            <polyline points="14 2 14 8 20 8"></polyline>
                            <line x1="12" y1="18" x2="12" y2="12"></line>
                            <line x1="9" y1="15" x2="15" y2="15"></line>
                        </svg>
                        <input type="file" id="svg-upload" accept=".svg">
                    </div>
                    
                    <!-- 2. –ö–ù–û–ü–ö–ê –°–û–•–†–ê–ù–ï–ù–ò–Ø -->
                    <button class="btn-save-scene" id="save-scene" style="width: 44px; height: 44px; padding: 0; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 6px; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center;" title="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                            <polyline points="17 21 17 13 7 13 7 21"></polyline>
                            <polyline points="7 3 7 8 15 8"></polyline>
                        </svg>
                    </button>
                    
                    <!-- 4. –ö–ù–û–ü–ö–ê –ü–û–î–ï–õ–ò–¢–¨–°–Ø -->
                    <button class="btn-share" id="share-scene" style="width: 44px; height: 44px; padding: 0; background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); color: white; border: none; border-radius: 6px; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center;" title="–ü–æ–¥–µ–ª–∏—Ç—å—Å—è">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="18" cy="5" r="3"></circle>
                            <circle cx="6" cy="12" r="3"></circle>
                            <circle cx="18" cy="19" r="3"></circle>
                            <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
                            <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
                        </svg>
                    </button>
                </div>
                
                <!-- –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –í–´–ë–û–†–ê –ú–ï–°–°–ï–ù–î–ñ–ï–†–ê -->
                <div id="share-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 10000; align-items: center; justify-content: center; cursor: pointer;">
                    <div id="share-modal-content" style="background: #1a1a2e; border-radius: 12px; padding: 16px 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.5); cursor: default;">
                        <div style="margin: 0 0 12px 0; color: rgba(255,255,255,0.7); font-size: 11px; text-align: center; line-height: 1.4;">–î–ª—è –≤—Å—Ç–∞–≤–∫–∏ –≤ —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–∞–∂–º–∏—Ç–µ Ctrl+V</div>
                        <div style="display: flex; gap: 12px; align-items: center; justify-content: center;">
                            <button id="share-max" title="MAX" style="width: 48px; height: 48px; padding: 0; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 50%; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center;">
                                <svg width="28" height="28" viewBox="0 0 28 28" fill="none">
                                    <circle cx="14" cy="14" r="11" stroke="white" stroke-width="2" fill="none"/>
                                    <text x="14" y="18" font-size="14" font-weight="bold" text-anchor="middle" fill="white" font-family="Arial, sans-serif">M</text>
                                </svg>
                            </button>
                            <button id="share-whatsapp" title="WhatsApp" style="width: 48px; height: 48px; padding: 0; background: linear-gradient(135deg, #25D366 0%, #128C7E 100%); color: white; border: none; border-radius: 50%; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center;">
                                <svg width="26" height="26" viewBox="0 0 24 24" fill="white">
                                    <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/>
                                </svg>
                            </button>
                            <button id="share-telegram" title="Telegram" style="width: 48px; height: 48px; padding: 0; background: linear-gradient(135deg, #0088cc 0%, #229ED9 100%); color: white; border: none; border-radius: 50%; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center;">
                                <svg width="26" height="26" viewBox="0 0 24 24" fill="white">
                                    <path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –í–´–ë–û–†–ê –§–û–†–ú–ê–¢–ê –°–û–•–†–ê–ù–ï–ù–ò–Ø -->
                <div id="save-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 10000; align-items: center; justify-content: center; cursor: pointer;">
                    <div id="save-modal-content" style="background: #1a1a2e; border-radius: 12px; padding: 16px 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.5); cursor: default;">
                        <div style="margin: 0 0 12px 0; color: rgba(255,255,255,0.9); font-size: 13px; text-align: center; line-height: 1.4; font-weight: 600;">–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ä–º–∞—Ç</div>
                        <div style="display: flex; gap: 12px; align-items: center; justify-content: center;">
                            <button id="save-jpg" title="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–∫ JPG" style="width: 48px; height: 48px; padding: 0; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 50%; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center;">
                                <svg width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                                    <polyline points="17 21 17 13 7 13 7 21"></polyline>
                                    <polyline points="7 3 7 8 15 8"></polyline>
                                </svg>
                            </button>
                            <button id="save-pdf" title="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–∫ PDF" style="width: 48px; height: 48px; padding: 0; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; border: none; border-radius: 50%; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center;">
                                <svg width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                    <polyline points="14 2 14 8 20 8"></polyline>
                                    <line x1="16" y1="13" x2="8" y2="13"></line>
                                    <line x1="16" y1="17" x2="8" y2="17"></line>
                                </svg>
                            </button>
                            <button id="save-svg" title="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–∫ SVG (–≤–µ–∫—Ç–æ—Ä–Ω—ã–π)" style="width: 48px; height: 48px; padding: 0; background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); color: white; border: none; border-radius: 50%; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center;">
                                <svg width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <polygon points="12 2 2 7 12 12 22 7 12 2"></polygon>
                                    <polyline points="2 17 12 22 22 17"></polyline>
                                    <polyline points="2 12 12 17 22 12"></polyline>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- 4. –¶–í–ï–¢ –§–û–ù–ê (–ü–û–î –ò–ö–û–ù–ö–ê–ú–ò) -->
                <div style="display: flex; gap: 8px; width: 100%; align-items: flex-start;">
                    <!-- –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ñ–æ–Ω–∞ -->
                    <button class="btn-toggle-wall active" id="toggle-wall" style="width: 44px; height: 44px; padding: 0; display: flex; align-items: center; justify-content: center; flex-shrink: 0;" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ñ–æ–Ω">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                            <circle cx="8.5" cy="8.5" r="1.5"></circle>
                            <polyline points="21 15 16 10 5 21"></polyline>
                        </svg>
                    </button>
                    <!-- –¶–≤–µ—Ç–∞ –≤ –¥–≤–∞ —Ä—è–¥–∞ -->
                    <div style="display: flex; flex-direction: column; gap: 3px; flex: 1;">
                        <div id="wall-colors-row-1" style="display: flex; gap: 3px;">
                            <!-- –ü–µ—Ä–≤–∞—è –ø–æ–ª–æ–≤–∏–Ω–∞ —Ü–≤–µ—Ç–æ–≤ -->
                        </div>
                        <div id="wall-colors-row-2" style="display: flex; gap: 3px;">
                            <!-- –í—Ç–æ—Ä–∞—è –ø–æ–ª–æ–≤–∏–Ω–∞ —Ü–≤–µ—Ç–æ–≤ -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∞–∫—Ç–∏–≤–Ω–æ–π —Å–µ–∫—Ü–∏–∏ (–∂—ë–ª—Ç–∞—è –ø–æ–ª–æ—Å–∫–∞) -->
        <div id="section-indicator" style="
            position: fixed;
            right: 364px;
            width: 3px;
            height: 40px;
            background: var(--accent-color);
            border-radius: 2px;
            transition: top 0.3s ease, right 0.3s ease, opacity 0.3s ease;
            z-index: 99;
            pointer-events: none;
        "></div>
        
        <!-- –ö–Ω–æ–ø–∫–∞ —Å–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏—è –ø–∞–Ω–µ–ª–∏ (–≤–Ω–µ .overlay-right —á—Ç–æ–±—ã –Ω–µ –æ–±—Ä–µ–∑–∞–ª–∞—Å—å) -->
        <div class="panel-toggle" id="panel-toggle" title="–°–≤–µ—Ä–Ω—É—Ç—å/–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –ø–∞–Ω–µ–ª—å">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
        </div>
        
        <!-- –ü–†–ê–í–ê–Ø –ü–ê–ù–ï–õ–¨ (–ù–ê–°–¢–†–û–ô–ö–ò) -->
        <div class="overlay-right">
            <!-- –£–ü–†–ê–í–õ–ï–ù–ò–ï –û–ë–™–ï–ö–¢–ê–ú–ò -->
            <div class="section-title">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: middle; margin-right: 6px; margin-top: -2px;">
                    <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                    <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
                    <line x1="12" y1="22.08" x2="12" y2="12"></line>
                </svg>
                –û–±—ä–µ–∫—Ç—ã –≤ —Å—Ü–µ–Ω–µ
            </div>
            <div id="svg-list" class="svg-list"></div>
            
            <!-- –ù–ê–í–ò–ì–ê–¶–ò–Ø –ò –ú–ê–°–®–¢–ê–ë–ò–†–û–í–ê–ù–ò–ï -->
            <div style="padding: 8px; background: rgba(255,255,255,0.03); border-radius: 8px; border: 1px solid rgba(255,255,255,0.05);">
                <!-- –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ -->
                <div style="display: flex; gap: 6px; align-items: flex-start;">
                    <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –∫–æ–Ω—Ç—Ä–æ–ª—ã —à–∏—Ä–∏–Ω—ã –∏ –≤—ã—Å–æ—Ç—ã -->
                    <div style="display: flex; flex-direction: column; gap: 4px; flex: 1;">
                        <!-- –®–∏—Ä–∏–Ω–∞ -->
                        <div style="display: flex; align-items: center; gap: 3px;">
                            <button onclick="scaleObject('width', -10)" class="btn-nav" style="width: 24px; height: 32px; font-size: 18px; padding: 0; line-height: 1;">‚àí</button>
                            <div style="display: flex; flex-direction: column; align-items: center; flex: 1; min-width: 0;">
                                <div style="font-size: 11px; color: rgba(255,255,255,0.5); line-height: 1; margin-bottom: 2px;">—à–∏—Ä–∏–Ω–∞</div>
                                <input type="number" id="scale-width" value="0" step="1" min="1" style="width: 100%; height: 22px; background: rgba(0,0,0,0.4); border: 1px solid rgba(255,255,255,0.15); border-radius: 4px; color: white; text-align: center; font-size: 11px; padding: 0 4px;" onchange="onScaleInput('width')" onkeydown="onScaleKeypress(event, 'width')">
                            </div>
                            <button onclick="scaleObject('width', 10)" class="btn-nav" style="width: 24px; height: 32px; font-size: 18px; padding: 0; line-height: 1;">+</button>
                        </div>
                        
                        <!-- –í—ã—Å–æ—Ç–∞ -->
                        <div style="display: flex; align-items: center; gap: 3px;">
                            <button onclick="scaleObject('height', -10)" class="btn-nav" style="width: 24px; height: 32px; font-size: 18px; padding: 0; line-height: 1;">‚àí</button>
                            <div style="display: flex; flex-direction: column; align-items: center; flex: 1; min-width: 0;">
                                <div style="font-size: 11px; color: rgba(255,255,255,0.5); line-height: 1; margin-bottom: 2px;">–≤—ã—Å–æ—Ç–∞</div>
                                <input type="number" id="scale-height" value="0" step="1" min="1" style="width: 100%; height: 22px; background: rgba(0,0,0,0.4); border: 1px solid rgba(255,255,255,0.15); border-radius: 4px; color: white; text-align: center; font-size: 11px; padding: 0 4px;" onchange="onScaleInput('height')" onkeydown="onScaleKeypress(event, 'height')">
                            </div>
                            <button onclick="scaleObject('height', 10)" class="btn-nav" style="width: 24px; height: 32px; font-size: 18px; padding: 0; line-height: 1;">+</button>
                        </div>
                    </div>
                    
                    <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –∫–Ω–æ–ø–∫–∏ lock –∏ reset -->
                    <div style="display: flex; flex-direction: column; gap: 4px;">
                        <!-- –ó–∞–º–æ—á–µ–∫ -->
                        <button id="lock-proportions" onclick="toggleProportions()" style="width: 32px; height: 32px; padding: 4px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.15); border-radius: 4px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s; flex-shrink: 0;" title="–ü—Ä–æ–ø–æ—Ä—Ü–∏–∏">
                            <svg id="lock-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="rgba(255,255,255,0.8)" stroke-width="2.5">
                                <rect x="5" y="11" width="14" height="10" rx="2" ry="2"></rect>
                                <path id="lock-shackle" d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                            </svg>
                        </button>
                        
                        <!-- –ö–Ω–æ–ø–∫–∞ —Å–±—Ä–æ—Å–∞ –º–∞—Å—à—Ç–∞–±–∞ -->
                        <button onclick="resetScale()" style="width: 32px; height: 32px; padding: 4px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.15); border-radius: 4px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s; flex-shrink: 0;" title="–°–±—Ä–æ—Å–∏—Ç—å –º–∞—Å—à—Ç–∞–±">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="rgba(255,255,255,0.8)" stroke-width="2.5">
                                <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"></path>
                                <path d="M3 3v5h5"></path>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="section-title">–¢–∏–ø –∏ –æ–ø—Ü–∏–∏</div>
            <div class="icon-button-group">
                <!-- –ü–ª–æ—Å–∫–∏–π -->
                <div class="icon-btn active" id="btn-flat" onclick="toggleConstruction('flat')">
                    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <rect x="4" y="4" width="16" height="16" rx="2" fill="none" stroke="currentColor" stroke-width="2"/>
                        <line x1="4" y1="8" x2="20" y2="8" stroke="currentColor" stroke-width="1" opacity="0.5"/>
                    </svg>
                    <span class="icon-btn-label">–ü–õ–û–°–ö.</span>
                </div>
                
                <!-- –û–±—ä—ë–º–Ω—ã–π -->
                <div class="icon-btn" id="btn-volumetric" onclick="toggleConstruction('volumetric')">
                    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 2L2 7v10l10 5 10-5V7L12 2zm0 2.18l7.5 3.75v7.57L12 19.25 4.5 15.5V7.93L12 4.18z"/>
                        <path d="M12 7L7 9.5v5l5 2.5 5-2.5v-5L12 7zm0 2l2.5 1.25v2.5L12 14l-2.5-1.25v-2.5L12 9z"/>
                    </svg>
                    <span class="icon-btn-label">–ë–û–†–¢</span>
                </div>
                
                <!-- –ü–æ–¥—Å–≤–µ—Ç–∫–∞ -->
                <div class="icon-btn" id="btn-backlight" onclick="toggleOption('backlight')">
                    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="12" cy="10" r="3" fill="none" stroke="currentColor" stroke-width="2"/>
                        <path d="M12 3v2M12 15v2M5.64 5.64l1.41 1.41M16.95 16.95l1.41 1.41M3 12h2M17 12h2M5.64 18.36l1.41-1.41M16.95 7.05l1.41-1.41" stroke="currentColor" stroke-width="1.5"/>
                        <path d="M9 19h6v2H9z"/>
                    </svg>
                    <span class="icon-btn-label">–°–≤–µ—Ç</span>
                </div>
                
                <!-- –ö–æ–Ω—Ç—Ä–∞–∂—É—Ä -->
                <div class="icon-btn" id="btn-contour" onclick="toggleOption('contour')">
                    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <rect x="6" y="6" width="12" height="12" fill="none" stroke="currentColor" stroke-width="2"/>
                        <rect x="4" y="4" width="16" height="16" fill="none" stroke="currentColor" stroke-width="1" opacity="0.4" stroke-dasharray="2,2"/>
                        <circle cx="6" cy="6" r="1" fill="currentColor" opacity="0.6"/>
                        <circle cx="18" cy="6" r="1" fill="currentColor" opacity="0.6"/>
                        <circle cx="18" cy="18" r="1" fill="currentColor" opacity="0.6"/>
                        <circle cx="6" cy="18" r="1" fill="currentColor" opacity="0.6"/>
                    </svg>
                    <span class="icon-btn-label">–ö–æ–Ω—Ç—É—Ä</span>
                </div>
                
                <!-- –î–∏—Å—Ç–∞–Ω—Ü–∏–æ–Ω–Ω—ã–µ –¥–µ—Ä–∂–∞—Ç–µ–ª–∏ -->
                <div class="icon-btn" id="btn-spacers" onclick="toggleOption('spacers')">
                    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <rect x="8" y="4" width="8" height="16" rx="1" fill="none" stroke="currentColor" stroke-width="2"/>
                        <circle cx="12" cy="8" r="1.5" fill="currentColor"/>
                        <circle cx="12" cy="12" r="1.5" fill="currentColor"/>
                        <circle cx="12" cy="16" r="1.5" fill="currentColor"/>
                        <line x1="4" y1="12" x2="8" y2="12" stroke="currentColor" stroke-width="1.5"/>
                        <line x1="16" y1="12" x2="20" y2="12" stroke="currentColor" stroke-width="1.5"/>
                    </svg>
                    <span class="icon-btn-label">–î–µ—Ä–∂.</span>
                </div>
            </div>
            
            <!-- –°–∫—Ä—ã—Ç—ã–µ input –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ -->
            <input type="radio" name="construction" id="construction-volumetric" value="volumetric" style="display: none;">
            <input type="radio" name="construction" id="construction-flat" value="flat" checked style="display: none;">
            <input type="checkbox" id="option-side" style="display: none;">
            <input type="checkbox" id="option-backlight" style="display: none;">
            <input type="checkbox" id="option-contour" style="display: none;">
            <input type="checkbox" id="option-spacers" style="display: none;">

            <!-- –ë–û–†–¢ -->
            <div class="section-title section-toggle collapsed" data-section="side-content" onclick="toggleSection('side-content')">
                –ë–æ—Ä—Ç
                <span class="section-arrow">‚ñº</span>
            </div>
            <div id="side-content" class="section-content collapsed">
            <div id="side-section">
                <div class="field-group">
                    <label class="field-label">–ë–æ—Ä—Ç</label>
                    <select id="side-material-type" style="background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.2); padding: 8px 12px; font-size: 13px; font-weight: 500; color: #fff;">
                        <optgroup label="–ü–í–• –ø—Ä–æ—Ñ–∏–ª—å">
                            <option value="pvc-3">–ü–í–• 3–º–º</option>
                            <option value="pvc-4" selected>–ü–í–• 4–º–º</option>
                            <option value="pvc-6">–ü–í–• 6–º–º</option>
                            <option value="pvc-8">–ü–í–• 8–º–º</option>
                        </optgroup>
                        <optgroup label="–ê–ª—é–º–∏–Ω–∏–µ–≤—ã–π –ø—Ä–æ—Ñ–∏–ª—å">
                            <option value="aluminum-4">–ê–ª—é–º–∏–Ω–∏–π 40–º–º</option>
                            <option value="aluminum-6">–ê–ª—é–º–∏–Ω–∏–π 60–º–º</option>
                            <option value="aluminum-8">–ê–ª—é–º–∏–Ω–∏–π 80–º–º</option>
                            <option value="aluminum-10">–ê–ª—é–º–∏–Ω–∏–π 100–º–º</option>
                        </optgroup>
                    </select>
                </div>
                <div class="field-group">
                    <label class="field-label">–¶–≤–µ—Ç –±–æ—Ä—Ç–∞</label>
                    <!-- –ö–∞—Å—Ç–æ–º–Ω—ã–π dropdown —Å —Ü–≤–µ—Ç–Ω—ã–º–∏ –∫–≤–∞–¥—Ä–∞—Ç–∏–∫–∞–º–∏ -->
                    <div class="custom-select" id="side-color-custom">
                        <div class="custom-select-trigger">010 - –ë–µ–ª—ã–π</div>
                        <div class="custom-options">
                            <div class="custom-optgroup">
                                <div class="custom-optgroup-label">Oracal 641</div>
                                <div class="custom-option" data-value="#FFFFFF" data-color="#FFFFFF"><span class="color-square" style="background: #FFFFFF; border: 1px solid #555;"></span>010 - –ë–µ–ª—ã–π</div>
                                <div class="custom-option" data-value="#FFD700" data-color="#FFD700"><span class="color-square" style="background: #FFD700;"></span>020 - –ó–æ–ª–æ—Ç–æ–π –∂–µ–ª—Ç—ã–π</div>
                                <div class="custom-option" data-value="#FFD100" data-color="#FFD100"><span class="color-square" style="background: #FFD100;"></span>021 - –ñ–µ–ª—Ç—ã–π</div>
                                <div class="custom-option" data-value="#FF6B00" data-color="#FF6B00"><span class="color-square" style="background: #FF6B00;"></span>034 - –û—Ä–∞–Ω–∂–µ–≤—ã–π</div>
                                <div class="custom-option" data-value="#E3000F" data-color="#E3000F"><span class="color-square" style="background: #E3000F;"></span>031 - –ö—Ä–∞—Å–Ω—ã–π</div>
                                <div class="custom-option" data-value="#DC143C" data-color="#DC143C"><span class="color-square" style="background: #DC143C;"></span>032 - –¢–µ–º–Ω–æ-–∫—Ä–∞—Å–Ω—ã–π</div>
                                <div class="custom-option" data-value="#800020" data-color="#800020"><span class="color-square" style="background: #800020;"></span>338 - –ë–æ—Ä–¥–æ–≤—ã–π</div>
                                <div class="custom-option" data-value="#FF1493" data-color="#FF1493"><span class="color-square" style="background: #FF1493;"></span>043 - –†–æ–∑–æ–≤—ã–π</div>
                                <div class="custom-option" data-value="#8B4513" data-color="#8B4513"><span class="color-square" style="background: #8B4513;"></span>080 - –ö–æ—Ä–∏—á–Ω–µ–≤—ã–π</div>
                                <div class="custom-option" data-value="#4B0082" data-color="#4B0082"><span class="color-square" style="background: #4B0082;"></span>055 - –§–∏–æ–ª–µ—Ç–æ–≤—ã–π</div>
                                <div class="custom-option" data-value="#003893" data-color="#003893"><span class="color-square" style="background: #003893;"></span>052 - –°–∏–Ω–∏–π</div>
                                <div class="custom-option" data-value="#00BFFF" data-color="#00BFFF"><span class="color-square" style="background: #00BFFF;"></span>053 - –ì–æ–ª—É–±–æ–π</div>
                                <div class="custom-option" data-value="#32CD32" data-color="#32CD32"><span class="color-square" style="background: #32CD32;"></span>060 - –°–≤–µ—Ç–ª–æ-–∑–µ–ª–µ–Ω—ã–π</div>
                                <div class="custom-option" data-value="#006400" data-color="#006400"><span class="color-square" style="background: #006400;"></span>061 - –¢–µ–º–Ω–æ-–∑–µ–ª–µ–Ω—ã–π</div>
                                <div class="custom-option" data-value="#9ACD32" data-color="#9ACD32"><span class="color-square" style="background: #9ACD32;"></span>063 - –ó–µ–ª–µ–Ω–æ–µ —è–±–ª–æ–∫–æ</div>
                                <div class="custom-option" data-value="#000000" data-color="#000000"><span class="color-square" style="background: #000000;"></span>070 - –ß–µ—Ä–Ω—ã–π</div>
                                <div class="custom-option" data-value="#808080" data-color="#808080"><span class="color-square" style="background: #808080;"></span>071 - –°–µ—Ä—ã–π</div>
                                <div class="custom-option" data-value="#C0C0C0" data-color="#C0C0C0"><span class="color-square" style="background: #C0C0C0;"></span>090 - –°–≤–µ—Ç–ª–æ-—Å–µ—Ä—ã–π</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="field-group">
                    <div style="display: flex; flex-direction: column; align-items: center; gap: 3px;">
                        <label style="font-size: 11px; color: rgba(255,255,255,0.5); text-align: center; margin-bottom: 2px;">—Ç–æ–ª—â–∏–Ω–∞ –±–æ—Ä—Ç–∞</label>
                        <div style="display: flex; gap: 3px; align-items: center; width: 100%;">
                            <button onclick="changeBortHeight(-5)" class="btn-nav" style="width: 24px; height: 32px; font-size: 18px; padding: 0; line-height: 1;">‚àí</button>
                            <input type="number" id="bort-height-display" value="60" style="flex: 1; height: 22px; background: rgba(0,0,0,0.4); border: 1px solid rgba(255,255,255,0.15); border-radius: 4px; color: white; text-align: center; font-size: 11px; padding: 0 4px;">
                            <button onclick="changeBortHeight(5)" class="btn-nav" style="width: 24px; height: 32px; font-size: 18px; padding: 0; line-height: 1;">+</button>
                        </div>
                    </div>
                    <input type="hidden" id="bort-height" value="60">
                </div>
            </div>
            </div><!-- /side-content -->

            <!-- –õ–ò–¶–ï–í–ê–Ø –ü–ê–ù–ï–õ–¨ -->
            <div class="section-title section-toggle collapsed" data-section="face-content" onclick="toggleSection('face-content')">
                –õ–∏—Ü–æ
                <span class="section-arrow">‚ñº</span>
            </div>
            <div id="face-content" class="section-content collapsed">
            <div id="face-section">
                <div class="field-group">
                    <label class="field-label">–ú–∞—Ç–µ—Ä–∏–∞–ª</label>
                    <select id="face-material-type" style="background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.2); padding: 8px 12px; font-size: 13px; font-weight: 500; color: #fff;">
                        <option value="acrylic-3-milk">–ê–∫—Ä–∏–ª –º–æ–ª–æ—á–Ω—ã–π 3–º–º</option>
                        <option value="acrylic-3-red">–ê–∫—Ä–∏–ª –∫—Ä–∞—Å–Ω—ã–π 3–º–º</option>
                        <option value="acrylic-3-yellow">–ê–∫—Ä–∏–ª –∂—ë–ª—Ç—ã–π 3–º–º</option>
                        <option value="acrylic-3-blue">–ê–∫—Ä–∏–ª —Å–∏–Ω–∏–π 3–º–º</option>
                        <option value="acrylic-3-green">–ê–∫—Ä–∏–ª –∑–µ–ª—ë–Ω—ã–π 3–º–º</option>
                        <option value="acrylic-3-orange">–ê–∫—Ä–∏–ª –æ—Ä–∞–Ω–∂–µ–≤—ã–π 3–º–º</option>
                        <option value="acrylic-3-black">–ê–∫—Ä–∏–ª —á—ë—Ä–Ω—ã–π 3–º–º</option>
                        <option value="pvc-4" selected>–ü–í–• 4–º–º</option>
                        <option value="pvc-6">–ü–í–• 6–º–º</option>
                        <option value="pvc-8">–ü–í–• 8–º–º</option>
                        <option value="composite-3">–ö–æ–º–ø–æ–∑–∏—Ç 3–º–º</option>
                    </select>
                </div>
                
                <!-- –¢–∏–ø LED –¥–∏–æ–¥–æ–≤ (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –≤–∫–ª—é—á—ë–Ω–Ω–æ–π –ø–æ–¥—Å–≤–µ—Ç–∫–µ) -->
                <div class="field-group" id="led-type-group" style="display: none;">
                    <label class="field-label">–¢–∏–ø LED –¥–∏–æ–¥–æ–≤</label>
                    <select id="led-type-select" onchange="window.changeLedType(this.value)" style="background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.2); padding: 8px 12px; font-size: 13px; font-weight: 500; color: #fff;">
                        <option value="led-0.7w">3smd 0.7–í—Ç (15‚ÇΩ/—à—Ç)</option>
                        <option value="led-1.0w">3smd 1.0–í—Ç (18‚ÇΩ/—à—Ç)</option>
                        <option value="led-1.2w" selected>3smd 1.2–í—Ç (20‚ÇΩ/—à—Ç)</option>
                        <option value="led-1.5w">3smd 1.5–í—Ç (25‚ÇΩ/—à—Ç)</option>
                    </select>
                </div>
                <div class="field-group">
                    <label class="field-label" id="color-label">–¶–≤–µ—Ç (–ø–ª–µ–Ω–∫–∞ Oracal 641)</label>
                    <!-- –ö–∞—Å—Ç–æ–º–Ω—ã–π dropdown —Å —Ü–≤–µ—Ç–Ω—ã–º–∏ –∫–≤–∞–¥—Ä–∞—Ç–∏–∫–∞–º–∏ -->
                    <div class="custom-select" id="face-color-custom">
                        <div class="custom-select-trigger">–í—ã–±–µ—Ä–∏—Ç–µ</div>
                        <div class="custom-options">
                            <div class="custom-option" data-value="original">–û—Ä–∏–≥–∏–Ω–∞–ª –∏–∑ SVG</div>
                            <!-- Oracal 641 —Å–µ—Ä–∏—è (–¥–ª—è –ü–í–•/–ö–æ–º–ø–æ–∑–∏—Ç) -->
                            <div class="custom-optgroup" id="oracal-641-group">
                                <div class="custom-optgroup-label">Oracal 641</div>
                                <div class="custom-option" data-value="#FFFFFF" data-color="#FFFFFF"><span class="color-square" style="background: #FFFFFF; border: 1px solid #555;"></span>010 - –ë–µ–ª—ã–π</div>
                                <div class="custom-option" data-value="#FFD700" data-color="#FFD700"><span class="color-square" style="background: #FFD700;"></span>020 - –ó–æ–ª–æ—Ç–æ–π –∂–µ–ª—Ç—ã–π</div>
                                <div class="custom-option" data-value="#FFD100" data-color="#FFD100"><span class="color-square" style="background: #FFD100;"></span>021 - –ñ–µ–ª—Ç—ã–π</div>
                                <div class="custom-option" data-value="#FF6B00" data-color="#FF6B00"><span class="color-square" style="background: #FF6B00;"></span>034 - –û—Ä–∞–Ω–∂–µ–≤—ã–π</div>
                                <div class="custom-option" data-value="#E3000F" data-color="#E3000F"><span class="color-square" style="background: #E3000F;"></span>031 - –ö—Ä–∞—Å–Ω—ã–π</div>
                                <div class="custom-option" data-value="#DC143C" data-color="#DC143C"><span class="color-square" style="background: #DC143C;"></span>032 - –¢–µ–º–Ω–æ-–∫—Ä–∞—Å–Ω—ã–π</div>
                                <div class="custom-option" data-value="#800020" data-color="#800020"><span class="color-square" style="background: #800020;"></span>338 - –ë–æ—Ä–¥–æ–≤—ã–π</div>
                                <div class="custom-option" data-value="#FF1493" data-color="#FF1493"><span class="color-square" style="background: #FF1493;"></span>043 - –†–æ–∑–æ–≤—ã–π</div>
                                <div class="custom-option" data-value="#8B4513" data-color="#8B4513"><span class="color-square" style="background: #8B4513;"></span>080 - –ö–æ—Ä–∏—á–Ω–µ–≤—ã–π</div>
                                <div class="custom-option" data-value="#4B0082" data-color="#4B0082"><span class="color-square" style="background: #4B0082;"></span>055 - –§–∏–æ–ª–µ—Ç–æ–≤—ã–π</div>
                                <div class="custom-option" data-value="#003893" data-color="#003893"><span class="color-square" style="background: #003893;"></span>052 - –°–∏–Ω–∏–π</div>
                                <div class="custom-option" data-value="#00BFFF" data-color="#00BFFF"><span class="color-square" style="background: #00BFFF;"></span>053 - –ì–æ–ª—É–±–æ–π</div>
                                <div class="custom-option" data-value="#32CD32" data-color="#32CD32"><span class="color-square" style="background: #32CD32;"></span>060 - –°–≤–µ—Ç–ª–æ-–∑–µ–ª–µ–Ω—ã–π</div>
                                <div class="custom-option" data-value="#006400" data-color="#006400"><span class="color-square" style="background: #006400;"></span>061 - –¢–µ–º–Ω–æ-–∑–µ–ª–µ–Ω—ã–π</div>
                                <div class="custom-option" data-value="#9ACD32" data-color="#9ACD32"><span class="color-square" style="background: #9ACD32;"></span>063 - –ó–µ–ª–µ–Ω–æ–µ —è–±–ª–æ–∫–æ</div>
                                <div class="custom-option" data-value="#000000" data-color="#000000"><span class="color-square" style="background: #000000;"></span>070 - –ß–µ—Ä–Ω—ã–π</div>
                                <div class="custom-option" data-value="#808080" data-color="#808080"><span class="color-square" style="background: #808080;"></span>071 - –°–µ—Ä—ã–π</div>
                                <div class="custom-option" data-value="#C0C0C0" data-color="#C0C0C0"><span class="color-square" style="background: #C0C0C0;"></span>090 - –°–≤–µ—Ç–ª–æ-—Å–µ—Ä—ã–π</div>
                            </div>
                            <!-- Oracal 8500 —Å–µ—Ä–∏—è (—Ç—Ä–∞–Ω—Å–ª—é—Ü–µ–Ω—Ç–Ω–∞—è –¥–ª—è –º–æ–ª–æ—á–Ω–æ–≥–æ –∞–∫—Ä–∏–ª–∞) -->
                            <div class="custom-optgroup" id="oracal-850-group" style="display: none;">
                                <div class="custom-optgroup-label">Oracal 8500 (–¢—Ä–∞–Ω—Å–ª—é—Ü–µ–Ω—Ç–Ω–∞—è)</div>
                                <div class="custom-option" data-value="#FFFFFF" data-color="#FFFFFF"><span class="color-square" style="background: #FFFFFF; border: 1px solid #555;"></span>010 - –ë–µ–ª—ã–π</div>
                                <div class="custom-option" data-value="#FFEB3B" data-color="#FFEB3B"><span class="color-square" style="background: #FFEB3B;"></span>020 - –Ø—Ä–∫–æ-–∂–µ–ª—Ç—ã–π</div>
                                <div class="custom-option" data-value="#FFD700" data-color="#FFD700"><span class="color-square" style="background: #FFD700;"></span>021 - –ó–æ–ª–æ—Ç–∏—Å—Ç–æ-–∂–µ–ª—Ç—ã–π</div>
                                <div class="custom-option" data-value="#FDD835" data-color="#FDD835"><span class="color-square" style="background: #FDD835;"></span>022 - –°–≤–µ—Ç–ª–æ-–∂–µ–ª—Ç—ã–π</div>
                                <div class="custom-option" data-value="#FFCA28" data-color="#FFCA28"><span class="color-square" style="background: #FFCA28;"></span>026 - –õ—é–º–∏–Ω–µ—Å—Ü–µ–Ω—Ç–Ω—ã–π –∂–µ–ª—Ç—ã–π</div>
                                <div class="custom-option" data-value="#FF6F00" data-color="#FF6F00"><span class="color-square" style="background: #FF6F00;"></span>030 - –¢–µ–º–Ω–æ-–æ—Ä–∞–Ω–∂–µ–≤—ã–π</div>
                                <div class="custom-option" data-value="#FF9800" data-color="#FF9800"><span class="color-square" style="background: #FF9800;"></span>034 - –û—Ä–∞–Ω–∂–µ–≤—ã–π</div>
                                <div class="custom-option" data-value="#C62828" data-color="#C62828"><span class="color-square" style="background: #C62828;"></span>031 - –ö—Ä–∞—Å–Ω—ã–π</div>
                                <div class="custom-option" data-value="#D32F2F" data-color="#D32F2F"><span class="color-square" style="background: #D32F2F;"></span>032 - –°–≤–µ—Ç–ª–æ-–∫—Ä–∞—Å–Ω—ã–π</div>
                                <div class="custom-option" data-value="#7B1FA2" data-color="#7B1FA2"><span class="color-square" style="background: #7B1FA2;"></span>040 - –§–∏–æ–ª–µ—Ç–æ–≤—ã–π</div>
                                <div class="custom-option" data-value="#E91E63" data-color="#E91E63"><span class="color-square" style="background: #E91E63;"></span>043 - –†–æ–∑–æ–≤—ã–π</div>
                                <div class="custom-option" data-value="#F06292" data-color="#F06292"><span class="color-square" style="background: #F06292;"></span>044 - –Ø—Ä–∫–æ-—Ä–æ–∑–æ–≤—ã–π</div>
                                <div class="custom-option" data-value="#1565C0" data-color="#1565C0"><span class="color-square" style="background: #1565C0;"></span>050 - –¢–µ–º–Ω–æ-—Å–∏–Ω–∏–π</div>
                                <div class="custom-option" data-value="#1976D2" data-color="#1976D2"><span class="color-square" style="background: #1976D2;"></span>052 - –°–∏–Ω–∏–π</div>
                                <div class="custom-option" data-value="#42A5F5" data-color="#42A5F5"><span class="color-square" style="background: #42A5F5;"></span>053 - –ì–æ–ª—É–±–æ–π</div>
                                <div class="custom-option" data-value="#0097A7" data-color="#0097A7"><span class="color-square" style="background: #0097A7;"></span>054 - –ë–∏—Ä—é–∑–æ–≤—ã–π</div>
                                <div class="custom-option" data-value="#2E7D32" data-color="#2E7D32"><span class="color-square" style="background: #2E7D32;"></span>060 - –¢–µ–º–Ω–æ-–∑–µ–ª–µ–Ω—ã–π</div>
                                <div class="custom-option" data-value="#43A047" data-color="#43A047"><span class="color-square" style="background: #43A047;"></span>061 - –°—Ä–µ–¥–Ω–∏–π –∑–µ–ª–µ–Ω—ã–π</div>
                                <div class="custom-option" data-value="#66BB6A" data-color="#66BB6A"><span class="color-square" style="background: #66BB6A;"></span>063 - –°–≤–µ—Ç–ª–æ-–∑–µ–ª–µ–Ω—ã–π</div>
                                <div class="custom-option" data-value="#9CCC65" data-color="#9CCC65"><span class="color-square" style="background: #9CCC65;"></span>064 - –ñ–µ–ª—Ç–æ-–∑–µ–ª–µ–Ω—ã–π</div>
                                <div class="custom-option" data-value="#424242" data-color="#424242"><span class="color-square" style="background: #424242;"></span>070 - –ß–µ—Ä–Ω—ã–π</div>
                                <div class="custom-option" data-value="#616161" data-color="#616161"><span class="color-square" style="background: #616161;"></span>071 - –°–µ—Ä—ã–π</div>
                                <div class="custom-option" data-value="#757575" data-color="#757575"><span class="color-square" style="background: #757575;"></span>073 - –°–µ—Ä—ã–π –≥—Ä–∞—Ñ–∏—Ç</div>
                                <div class="custom-option" data-value="#6D4C41" data-color="#6D4C41"><span class="color-square" style="background: #6D4C41;"></span>080 - –ö–æ—Ä–∏—á–Ω–µ–≤—ã–π</div>
                                <div class="custom-option" data-value="#5D4037" data-color="#5D4037"><span class="color-square" style="background: #5D4037;"></span>083 - –¢–µ–º–Ω–æ-–∫–æ—Ä–∏—á–Ω–µ–≤—ã–π</div>
                                <div class="custom-option" data-value="#BDBDBD" data-color="#BDBDBD"><span class="color-square" style="background: #BDBDBD;"></span>090 - –°–≤–µ—Ç–ª–æ-—Å–µ—Ä—ã–π</div>
                                <div class="custom-option" data-value="#E0E0E0" data-color="#E0E0E0"><span class="color-square" style="background: #E0E0E0;"></span>091 - –°–µ—Ä–µ–±—Ä–∏—Å—Ç—ã–π</div>
                            </div>
                            <!-- –¶–≤–µ—Ç–Ω–æ–π –∞–∫—Ä–∏–ª (–±–µ–∑ –ø–ª–µ–Ω–∫–∏) -->
                            <div class="custom-optgroup" id="colored-acrylic-group" style="display: none;">
                                <div class="custom-optgroup-label">–¶–≤–µ—Ç–Ω–æ–π –∞–∫—Ä–∏–ª</div>
                                <div class="custom-option" data-value="#FFD100" data-color="#FFD100"><span class="color-square" style="background: #FFD100;"></span>–ê–∫—Ä–∏–ª –ñ–µ–ª—Ç—ã–π</div>
                                <div class="custom-option" data-value="#E3000F" data-color="#E3000F"><span class="color-square" style="background: #E3000F;"></span>–ê–∫—Ä–∏–ª –ö—Ä–∞—Å–Ω—ã–π</div>
                                <div class="custom-option" data-value="#003893" data-color="#003893"><span class="color-square" style="background: #003893;"></span>–ê–∫—Ä–∏–ª –°–∏–Ω–∏–π</div>
                                <div class="custom-option" data-value="#32CD32" data-color="#32CD32"><span class="color-square" style="background: #32CD32;"></span>–ê–∫—Ä–∏–ª –ó–µ–ª–µ–Ω—ã–π</div>
                                <div class="custom-option" data-value="#FF6B00" data-color="#FF6B00"><span class="color-square" style="background: #FF6B00;"></span>–ê–∫—Ä–∏–ª –û—Ä–∞–Ω–∂–µ–≤—ã–π</div>
                                <div class="custom-option" data-value="#000000" data-color="#000000"><span class="color-square" style="background: #000000;"></span>–ê–∫—Ä–∏–ª –ß–µ—Ä–Ω—ã–π</div>
                            </div>
                        </div>
                    </div>
                    <!-- –°–∫—Ä—ã—Ç—ã–π input –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è -->
                    <input type="hidden" id="face-color" value="original">
                </div>
            </div>
            </div><!-- /face-content -->

            <!-- –ö–ê–†–ö–ê–° -->
            <div class="section-title section-toggle collapsed" data-section="frame-content" onclick="toggleSection('frame-content')">
                –ö–∞—Ä–∫–∞—Å
                <span class="section-arrow">‚ñº</span>
            </div>
            <div id="frame-content" class="section-content collapsed">
            <div class="options-grid">
                <div class="field-group">
                    <label class="field-label">–¢–∏–ø –∫–∞—Ä–∫–∞—Å–∞</label>
                    <select id="frame-type" style="background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.2); padding: 8px 12px; font-size: 13px; font-weight: 500; color: #fff;">
                        <option value="none">–ë–µ–∑ –∫–∞—Ä–∫–∞—Å–∞</option>
                        <optgroup label="–°—Ç–∞–ª—å–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª—å–Ω—ã–µ —Ç—Ä—É–±—ã (6–º)">
                            <option value="steel-15x15">–ü—Ä–æ—Ñ —Ç—Ä—É–±–∞ 15√ó15–º–º (78‚ÇΩ/–º.–ø.)</option>
                            <option value="steel-20x20">–ü—Ä–æ—Ñ —Ç—Ä—É–±–∞ 20√ó20–º–º (96‚ÇΩ/–º.–ø.)</option>
                            <option value="steel-25x25">–ü—Ä–æ—Ñ —Ç—Ä—É–±–∞ 25√ó25–º–º (115‚ÇΩ/–º.–ø.)</option>
                            <option value="steel-30x30">–ü—Ä–æ—Ñ —Ç—Ä—É–±–∞ 30√ó30–º–º (133‚ÇΩ/–º.–ø.)</option>
                            <option value="steel-40x20">–ü—Ä–æ—Ñ —Ç—Ä—É–±–∞ 40√ó20–º–º (177‚ÇΩ/–º.–ø.)</option>
                        </optgroup>
                        <optgroup label="–ê–ª—é–º–∏–Ω–∏–µ–≤—ã–µ –ø—Ä–æ—Ñ–∏–ª–∏">
                            <option value="alu-15x15-2m">–ê–ª—é–º–∏–Ω–∏–π 15√ó15–º–º - 2–º (210‚ÇΩ/–º.–ø.)</option>
                            <option value="alu-15x15-3m">–ê–ª—é–º–∏–Ω–∏–π 15√ó15–º–º - 3–º (192‚ÇΩ/–º.–ø.)</option>
                            <option value="alu-20x20-2m">–ê–ª—é–º–∏–Ω–∏–π 20√ó20–º–º - 2–º (318‚ÇΩ/–º.–ø.)</option>
                            <option value="alu-20x20-3m">–ê–ª—é–º–∏–Ω–∏–π 20√ó20–º–º - 3–º (248‚ÇΩ/–º.–ø.)</option>
                        </optgroup>
                    </select>
                </div>
                
                <!-- –¶–≤–µ—Ç –∫–∞—Ä–∫–∞—Å–∞ (Oracal 641) -->
                <div class="field-group" id="frame-color-group" style="display: none;">
                    <label class="field-label">–¶–≤–µ—Ç –∫–∞—Ä–∫–∞—Å–∞ (Oracal 641)</label>
                    <div style="display: flex; gap: 3px; flex-wrap: wrap;">
                        <button onclick="setFrameColor('#FFFFFF')" title="010 - –ë–µ–ª—ã–π" style="width: 20px; height: 20px; background: #FFFFFF; border: 1px solid rgba(255,255,255,0.5); border-radius: 3px; cursor: pointer;"></button>
                        <button onclick="setFrameColor('#FFD700')" title="020 - –ó–æ–ª–æ—Ç–æ–π –∂–µ–ª—Ç—ã–π" style="width: 20px; height: 20px; background: #FFD700; border: 1px solid rgba(255,255,255,0.3); border-radius: 3px; cursor: pointer;"></button>
                        <button onclick="setFrameColor('#FFFF00')" title="021 - –ñ–µ–ª—Ç—ã–π" style="width: 20px; height: 20px; background: #FFFF00; border: 1px solid rgba(255,255,255,0.3); border-radius: 3px; cursor: pointer;"></button>
                        <button onclick="setFrameColor('#FFA500')" title="034 - –û—Ä–∞–Ω–∂–µ–≤—ã–π" style="width: 20px; height: 20px; background: #FFA500; border: 1px solid rgba(255,255,255,0.3); border-radius: 3px; cursor: pointer;"></button>
                        <button onclick="setFrameColor('#FF0000')" title="031 - –ö—Ä–∞—Å–Ω—ã–π" style="width: 20px; height: 20px; background: #FF0000; border: 1px solid rgba(255,255,255,0.3); border-radius: 3px; cursor: pointer;"></button>
                        <button onclick="setFrameColor('#8B0000')" title="032 - –¢–µ–º–Ω–æ-–∫—Ä–∞—Å–Ω—ã–π" style="width: 20px; height: 20px; background: #8B0000; border: 1px solid rgba(255,255,255,0.3); border-radius: 3px; cursor: pointer;"></button>
                        <button onclick="setFrameColor('#800020')" title="338 - –ë–æ—Ä–¥–æ–≤—ã–π" style="width: 20px; height: 20px; background: #800020; border: 1px solid rgba(255,255,255,0.3); border-radius: 3px; cursor: pointer;"></button>
                        <button onclick="setFrameColor('#FFC0CB')" title="043 - –†–æ–∑–æ–≤—ã–π" style="width: 20px; height: 20px; background: #FFC0CB; border: 1px solid rgba(255,255,255,0.3); border-radius: 3px; cursor: pointer;"></button>
                        <button onclick="setFrameColor('#8B4513')" title="080 - –ö–æ—Ä–∏—á–Ω–µ–≤—ã–π" style="width: 20px; height: 20px; background: #8B4513; border: 1px solid rgba(255,255,255,0.3); border-radius: 3px; cursor: pointer;"></button>
                        <button onclick="setFrameColor('#800080')" title="055 - –§–∏–æ–ª–µ—Ç–æ–≤—ã–π" style="width: 20px; height: 20px; background: #800080; border: 1px solid rgba(255,255,255,0.3); border-radius: 3px; cursor: pointer;"></button>
                        <button onclick="setFrameColor('#0000FF')" title="052 - –°–∏–Ω–∏–π" style="width: 20px; height: 20px; background: #0000FF; border: 1px solid rgba(255,255,255,0.3); border-radius: 3px; cursor: pointer;"></button>
                        <button onclick="setFrameColor('#87CEEB')" title="053 - –ì–æ–ª—É–±–æ–π" style="width: 20px; height: 20px; background: #87CEEB; border: 1px solid rgba(255,255,255,0.3); border-radius: 3px; cursor: pointer;"></button>
                        <button onclick="setFrameColor('#90EE90')" title="060 - –°–≤–µ—Ç–ª–æ-–∑–µ–ª–µ–Ω—ã–π" style="width: 20px; height: 20px; background: #90EE90; border: 1px solid rgba(255,255,255,0.3); border-radius: 3px; cursor: pointer;"></button>
                        <button onclick="setFrameColor('#006400')" title="061 - –¢–µ–º–Ω–æ-–∑–µ–ª–µ–Ω—ã–π" style="width: 20px; height: 20px; background: #006400; border: 1px solid rgba(255,255,255,0.3); border-radius: 3px; cursor: pointer;"></button>
                        <button onclick="setFrameColor('#9ACD32')" title="063 - –ó–µ–ª–µ–Ω–æ–µ —è–±–ª–æ–∫–æ" style="width: 20px; height: 20px; background: #9ACD32; border: 1px solid rgba(255,255,255,0.3); border-radius: 3px; cursor: pointer;"></button>
                        <button onclick="setFrameColor('#000000')" title="070 - –ß–µ—Ä–Ω—ã–π" style="width: 20px; height: 20px; background: #000000; border: 1px solid rgba(255,255,255,0.3); border-radius: 3px; cursor: pointer;"></button>
                        <button onclick="setFrameColor('#808080')" title="071 - –°–µ—Ä—ã–π" style="width: 20px; height: 20px; background: #808080; border: 1px solid rgba(255,255,255,0.3); border-radius: 3px; cursor: pointer;"></button>
                        <button onclick="setFrameColor('#C0C0C0')" title="090 - –°–≤–µ—Ç–ª–æ-—Å–µ—Ä—ã–π" style="width: 20px; height: 20px; background: #C0C0C0; border: 1px solid rgba(255,255,255,0.3); border-radius: 3px; cursor: pointer;"></button>
                    </div>
                </div>
                
                <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è–º–∏ –≤ 3D -->
                <div class="field-group" id="frame-3d-group" style="display: none;">
                    <button onclick="addFrameProfile()" class="btn-add" style="margin-bottom: 8px;">
                        ‚ûï –î–æ–±–∞–≤–∏—Ç—å –≤ 3D —Å—Ü–µ–Ω—É
                    </button>
                    
                    <div id="profiles-3d-list" style="max-height: 150px; overflow-y: auto; background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1); border-radius: 4px; padding: 5px;">
                        <div style="opacity: 0.5; font-size: 11px; padding: 8px; text-align: center;">–ü—Ä–æ—Ñ–∏–ª–∏ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã</div>
                    </div>
                    
                    <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω—ã–º –ø—Ä–æ—Ñ–∏–ª–µ–º -->
                    <div id="profile-controls" style="display: none; margin-top: 8px; padding: 8px; background: #2a2a2a; border-radius: 4px;">
                        <div style="display: flex; flex-direction: column; align-items: center; gap: 3px; margin-bottom: 8px;">
                            <label style="font-size: 11px; color: rgba(255,255,255,0.5); text-align: center; margin-bottom: 2px;">–¥–ª–∏–Ω–∞ (–º–º)</label>
                            <div style="display: flex; align-items: center; gap: 3px; width: 100%;">
                                <button onclick="changeProfileLength(-10)" class="btn-nav" style="width: 24px; height: 32px; font-size: 18px; padding: 0; line-height: 1;">‚àí</button>
                                <input type="number" id="profile-length-input" min="10" max="10000" step="10" 
                                       oninput="updateProfileLength(this.value)" 
                                       style="flex: 1; height: 22px; background: rgba(0,0,0,0.4); border: 1px solid rgba(255,255,255,0.15); border-radius: 4px; color: white; text-align: center; font-size: 11px; padding: 0 4px;">
                                <button onclick="changeProfileLength(10)" class="btn-nav" style="width: 24px; height: 32px; font-size: 18px; padding: 0; line-height: 1;">+</button>
                            </div>
                        </div>
                        
                        <!-- –ö–Ω–æ–ø–∫–∏ –ø–æ–≤–æ—Ä–æ—Ç–∞ –ø—Ä–æ—Ñ–∏–ª—è -->
                        <div style="display: flex; flex-direction: column; align-items: center; gap: 3px; margin-bottom: 8px;">
                            <label style="font-size: 11px; color: rgba(255,255,255,0.5); text-align: center; margin-bottom: 2px;">–ø–æ–≤–æ—Ä–æ—Ç (¬∞)</label>
                            <div style="display: flex; gap: 3px; align-items: center; width: 100%;">
                                <button onmousedown="startProfileMove('rotateLeft')" onmouseup="stopProfileMove()" onmouseleave="stopProfileMove()" class="btn-nav" style="width: 24px; height: 32px; font-size: 16px; padding: 0; line-height: 1;">‚Ü∫</button>
                                <input type="number" id="profile-rotation-input" min="-360" max="360" step="1" 
                                       oninput="updateProfileRotation(this.value)" 
                                       style="flex: 1; height: 22px; background: rgba(0,0,0,0.4); border: 1px solid rgba(255,255,255,0.15); border-radius: 4px; color: white; text-align: center; font-size: 11px; padding: 0 4px;">
                                <button onmousedown="startProfileMove('rotateRight')" onmouseup="stopProfileMove()" onmouseleave="stopProfileMove()" class="btn-nav" style="width: 24px; height: 32px; font-size: 16px; padding: 0; line-height: 1;">‚Üª</button>
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 5px;">
                            <button onclick="duplicateProfile()" style="flex: 1; padding: 6px; background: rgba(255,255,255,0.08); color: white; border: 1px solid rgba(255,255,255,0.2); border-radius: 4px; font-size: 11px; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center; gap: 4px;">
                                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                                </svg>
                                –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
                            </button>
                            <button onclick="deleteActiveProfile()" style="flex: 1; padding: 6px; background: rgba(244,67,54,0.2); color: white; border: 1px solid rgba(244,67,54,0.4); border-radius: 4px; font-size: 11px; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center; gap: 4px;">
                                ‚úï –£–¥–∞–ª–∏—Ç—å
                            </button>
                        </div>
                    </div>
                </div>
                
            </div>
            </div><!-- /frame-content -->

            <!-- –û–°–ù–û–í–ê -->
            <div class="section-title section-toggle collapsed" data-section="base-content" onclick="toggleSection('base-content')">
                –û—Å–Ω–æ–≤–∞
                <span class="section-arrow">‚ñº</span>
            </div>
            <div id="base-content" class="section-content collapsed">
            <div class="options-grid">
                <div class="field-group">
                    <label class="field-label">–ú–∞—Ç–µ—Ä–∏–∞–ª –æ—Å–Ω–æ–≤—ã</label>
                    <select id="base-material-type" style="background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.2); padding: 8px 12px; font-size: 13px; font-weight: 500; color: #fff;">
                        <option value="none">–ë–µ–∑ –æ—Å–Ω–æ–≤—ã</option>
                        <optgroup label="–ê–ª—é–º–æ–∫–æ–º–ø–æ–∑–∏—Ç">
                            <option value="composite-3-1220">–ê–ª—é–º–æ–∫–æ–º–ø–æ–∑–∏—Ç 3–º–º (2000‚ÇΩ/–º¬≤) ‚Äî 1220√ó4000–º–º</option>
                            <option value="composite-3-1500">–ê–ª—é–º–æ–∫–æ–º–ø–æ–∑–∏—Ç 3–º–º (2000‚ÇΩ/–º¬≤) ‚Äî 1500√ó4000–º–º</option>
                        </optgroup>
                        <optgroup label="–ü–í–•">
                            <option value="pvc-3">–ü–í–• 3–º–º (1100‚ÇΩ/–º¬≤) ‚Äî 2000√ó3000–º–º</option>
                            <option value="pvc-4">–ü–í–• 4–º–º (1200‚ÇΩ/–º¬≤) ‚Äî 2000√ó3000–º–º</option>
                            <option value="pvc-6">–ü–í–• 6–º–º (1400‚ÇΩ/–º¬≤) ‚Äî 2000√ó3000–º–º</option>
                            <option value="pvc-8">–ü–í–• 8–º–º (1500‚ÇΩ/–º¬≤) ‚Äî 2000√ó3000–º–º</option>
                        </optgroup>
                        <optgroup label="–ü–æ–ª–∏–∫–∞—Ä–±–æ–Ω–∞—Ç">
                            <option value="polycarbonate-4">–°–æ—Ç–æ–≤—ã–π –ø–æ–ª–∏–∫–∞—Ä–±–æ–Ω–∞—Ç 4–º–º (450‚ÇΩ/–º¬≤) ‚Äî 2100√ó12000–º–º</option>
                            <option value="polycarbonate-6">–°–æ—Ç–æ–≤—ã–π –ø–æ–ª–∏–∫–∞—Ä–±–æ–Ω–∞—Ç 6–º–º (650‚ÇΩ/–º¬≤) ‚Äî 2100√ó12000–º–º</option>
                        </optgroup>
                    </select>
                </div>
                
                <!-- –†–∞–∑–º–µ—Ä—ã –∏ —Ü–≤–µ—Ç –æ—Å–Ω–æ–≤—ã –≤ –¥–≤–µ –∫–æ–ª–æ–Ω–∫–∏ -->
                <div style="display: flex; gap: 10px;" id="base-size-color-wrapper">
                    <!-- –†–∞–∑–º–µ—Ä—ã –æ—Å–Ω–æ–≤—ã -->
                    <div class="field-group" id="base-size-group" style="display: none; flex: 1; margin: 0;">
                        <div style="display: flex; flex-direction: column; align-items: center; gap: 3px; margin-bottom: 8px;">
                            <label style="font-size: 11px; color: rgba(255,255,255,0.5); text-align: center; margin-bottom: 2px;">—à–∏—Ä–∏–Ω–∞</label>
                            <div style="display: flex; align-items: center; gap: 3px; width: 100%;">
                                <button onclick="changeBaseWidth(-10)" class="btn-nav" style="width: 24px; height: 32px; font-size: 18px; padding: 0; line-height: 1;">‚àí</button>
                                <input type="number" id="base-width" min="100" max="10000" step="10" value="1000" 
                                       oninput="updateBaseSizeInputs()" 
                                       style="flex: 1; height: 22px; background: rgba(0,0,0,0.4); border: 1px solid rgba(255,255,255,0.15); border-radius: 4px; color: white; text-align: center; font-size: 11px; padding: 0 4px;">
                                <button onclick="changeBaseWidth(10)" class="btn-nav" style="width: 24px; height: 32px; font-size: 18px; padding: 0; line-height: 1;">+</button>
                            </div>
                        </div>
                        
                        <div style="display: flex; flex-direction: column; align-items: center; gap: 3px;">
                            <label style="font-size: 11px; color: rgba(255,255,255,0.5); text-align: center; margin-bottom: 2px;">–≤—ã—Å–æ—Ç–∞</label>
                            <div style="display: flex; align-items: center; gap: 3px; width: 100%;">
                                <button onclick="changeBaseHeight(-10)" class="btn-nav" style="width: 24px; height: 32px; font-size: 18px; padding: 0; line-height: 1;">‚àí</button>
                                <input type="number" id="base-height" min="100" max="10000" step="10" value="1000" 
                                       oninput="updateBaseSizeInputs()" 
                                       style="flex: 1; height: 22px; background: rgba(0,0,0,0.4); border: 1px solid rgba(255,255,255,0.15); border-radius: 4px; color: white; text-align: center; font-size: 11px; padding: 0 4px;">
                                <button onclick="changeBaseHeight(10)" class="btn-nav" style="width: 24px; height: 32px; font-size: 18px; padding: 0; line-height: 1;">+</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- –¶–≤–µ—Ç –æ—Å–Ω–æ–≤—ã (Oracal 641) -->
                    <div class="field-group" id="base-color-group" style="display: none; flex: 1; margin: 0;">
                    <label class="field-label">–¶–≤–µ—Ç (Oracal 641)</label>
                    <div style="display: flex; gap: 3px; flex-wrap: wrap;">
                        <button onclick="setBaseColor('#FFFFFF')" title="010 - –ë–µ–ª—ã–π" style="width: 20px; height: 20px; background: #FFFFFF; border: 1px solid rgba(255,255,255,0.5); border-radius: 3px; cursor: pointer;"></button>
                        <button onclick="setBaseColor('#FFD700')" title="020 - –ó–æ–ª–æ—Ç–æ–π –∂–µ–ª—Ç—ã–π" style="width: 20px; height: 20px; background: #FFD700; border: 1px solid rgba(255,255,255,0.3); border-radius: 3px; cursor: pointer;"></button>
                        <button onclick="setBaseColor('#FFFF00')" title="021 - –ñ–µ–ª—Ç—ã–π" style="width: 20px; height: 20px; background: #FFFF00; border: 1px solid rgba(255,255,255,0.3); border-radius: 3px; cursor: pointer;"></button>
                        <button onclick="setBaseColor('#FFA500')" title="034 - –û—Ä–∞–Ω–∂–µ–≤—ã–π" style="width: 20px; height: 20px; background: #FFA500; border: 1px solid rgba(255,255,255,0.3); border-radius: 3px; cursor: pointer;"></button>
                        <button onclick="setBaseColor('#FF0000')" title="031 - –ö—Ä–∞—Å–Ω—ã–π" style="width: 20px; height: 20px; background: #FF0000; border: 1px solid rgba(255,255,255,0.3); border-radius: 3px; cursor: pointer;"></button>
                        <button onclick="setBaseColor('#8B0000')" title="032 - –¢–µ–º–Ω–æ-–∫—Ä–∞—Å–Ω—ã–π" style="width: 20px; height: 20px; background: #8B0000; border: 1px solid rgba(255,255,255,0.3); border-radius: 3px; cursor: pointer;"></button>
                        <button onclick="setBaseColor('#800020')" title="338 - –ë–æ—Ä–¥–æ–≤—ã–π" style="width: 20px; height: 20px; background: #800020; border: 1px solid rgba(255,255,255,0.3); border-radius: 3px; cursor: pointer;"></button>
                        <button onclick="setBaseColor('#FFC0CB')" title="043 - –†–æ–∑–æ–≤—ã–π" style="width: 20px; height: 20px; background: #FFC0CB; border: 1px solid rgba(255,255,255,0.3); border-radius: 3px; cursor: pointer;"></button>
                        <button onclick="setBaseColor('#8B4513')" title="080 - –ö–æ—Ä–∏—á–Ω–µ–≤—ã–π" style="width: 20px; height: 20px; background: #8B4513; border: 1px solid rgba(255,255,255,0.3); border-radius: 3px; cursor: pointer;"></button>
                        <button onclick="setBaseColor('#800080')" title="055 - –§–∏–æ–ª–µ—Ç–æ–≤—ã–π" style="width: 20px; height: 20px; background: #800080; border: 1px solid rgba(255,255,255,0.3); border-radius: 3px; cursor: pointer;"></button>
                        <button onclick="setBaseColor('#0000FF')" title="052 - –°–∏–Ω–∏–π" style="width: 20px; height: 20px; background: #0000FF; border: 1px solid rgba(255,255,255,0.3); border-radius: 3px; cursor: pointer;"></button>
                        <button onclick="setBaseColor('#87CEEB')" title="053 - –ì–æ–ª—É–±–æ–π" style="width: 20px; height: 20px; background: #87CEEB; border: 1px solid rgba(255,255,255,0.3); border-radius: 3px; cursor: pointer;"></button>
                        <button onclick="setBaseColor('#90EE90')" title="060 - –°–≤–µ—Ç–ª–æ-–∑–µ–ª–µ–Ω—ã–π" style="width: 20px; height: 20px; background: #90EE90; border: 1px solid rgba(255,255,255,0.3); border-radius: 3px; cursor: pointer;"></button>
                        <button onclick="setBaseColor('#006400')" title="061 - –¢–µ–º–Ω–æ-–∑–µ–ª–µ–Ω—ã–π" style="width: 20px; height: 20px; background: #006400; border: 1px solid rgba(255,255,255,0.3); border-radius: 3px; cursor: pointer;"></button>
                        <button onclick="setBaseColor('#9ACD32')" title="063 - –ó–µ–ª–µ–Ω–æ–µ —è–±–ª–æ–∫–æ" style="width: 20px; height: 20px; background: #9ACD32; border: 1px solid rgba(255,255,255,0.3); border-radius: 3px; cursor: pointer;"></button>
                        <button onclick="setBaseColor('#000000')" title="070 - –ß–µ—Ä–Ω—ã–π" style="width: 20px; height: 20px; background: #000000; border: 1px solid rgba(255,255,255,0.3); border-radius: 3px; cursor: pointer;"></button>
                        <button onclick="setBaseColor('#808080')" title="071 - –°–µ—Ä—ã–π" style="width: 20px; height: 20px; background: #808080; border: 1px solid rgba(255,255,255,0.3); border-radius: 3px; cursor: pointer;"></button>
                        <button onclick="setBaseColor('#C0C0C0')" title="090 - –°–≤–µ—Ç–ª–æ-—Å–µ—Ä—ã–π" style="width: 20px; height: 20px; background: #C0C0C0; border: 1px solid rgba(255,255,255,0.3); border-radius: 3px; cursor: pointer;"></button>
                    </div>
                    </div>
                </div>
                
                <!-- –ö–∞—Ä–∫–∞—Å –¥–ª—è –æ—Å–Ω–æ–≤—ã -->
                <div class="field-group" id="base-frame-group" style="display: none;">
                    <label class="field-label" style="display: flex; align-items: center; gap: 8px; cursor: pointer; background: rgba(255,193,7,0.08); padding: 8px; border-radius: 4px; border: 1px solid rgba(255,193,7,0.2);">
                        <input type="checkbox" id="base-frame-checkbox" onchange="toggleBaseFrame()" style="cursor: pointer;">
                        <span style="font-size: 12px; font-weight: 600; color: #ffd54f;">–ö–∞—Ä–∫–∞—Å –¥–ª—è –æ—Å–Ω–æ–≤—ã</span>
                    </label>
                    
                    <div id="base-frame-options" style="display: none; margin-top: 10px;">
                        <!-- –ü—Ä–æ—Ñ–∏–ª—å –∫–∞—Ä–∫–∞—Å–∞ -->
                        <label style="font-size: 11px; opacity: 0.8; display: block; margin-bottom: 5px;">–ü—Ä–æ—Ñ–∏–ª—å:</label>
                        <select id="base-frame-profile" onchange="updateBaseFrameProfile()" style="width: 100%; background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.2); padding: 8px 12px; font-size: 13px; font-weight: 500; color: #fff; border-radius: 4px; margin-bottom: 10px;">
                            <option value="15x15">15√ó15 –º–º</option>
                            <option value="20x20" selected>20√ó20 –º–º</option>
                            <option value="30x30">30√ó30 –º–º</option>
                            <option value="40x20">40√ó20 –º–º</option>
                        </select>
                        
                        <!-- –¶–≤–µ—Ç –∫–∞—Ä–∫–∞—Å–∞ -->
                        <label class="field-label">–¶–≤–µ—Ç –∫–∞—Ä–∫–∞—Å–∞ (Oracal 641)</label>
                        <div style="display: flex; gap: 3px; flex-wrap: wrap;">
                            <button onclick="setBaseFrameColor('#808080')" title="071 - –°–µ—Ä—ã–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)" style="width: 20px; height: 20px; background: #808080; border: 2px solid #00FF00; border-radius: 3px; cursor: pointer;"></button>
                            <button onclick="setBaseFrameColor('#FFFFFF')" title="010 - –ë–µ–ª—ã–π" style="width: 20px; height: 20px; background: #FFFFFF; border: 1px solid rgba(255,255,255,0.5); border-radius: 3px; cursor: pointer;"></button>
                            <button onclick="setBaseFrameColor('#FFD700')" title="020 - –ó–æ–ª–æ—Ç–æ–π –∂–µ–ª—Ç—ã–π" style="width: 20px; height: 20px; background: #FFD700; border: 1px solid rgba(255,255,255,0.3); border-radius: 3px; cursor: pointer;"></button>
                            <button onclick="setBaseFrameColor('#FFFF00')" title="021 - –ñ–µ–ª—Ç—ã–π" style="width: 20px; height: 20px; background: #FFFF00; border: 1px solid rgba(255,255,255,0.3); border-radius: 3px; cursor: pointer;"></button>
                            <button onclick="setBaseFrameColor('#FFA500')" title="034 - –û—Ä–∞–Ω–∂–µ–≤—ã–π" style="width: 20px; height: 20px; background: #FFA500; border: 1px solid rgba(255,255,255,0.3); border-radius: 3px; cursor: pointer;"></button>
                            <button onclick="setBaseFrameColor('#FF0000')" title="031 - –ö—Ä–∞—Å–Ω—ã–π" style="width: 20px; height: 20px; background: #FF0000; border: 1px solid rgba(255,255,255,0.3); border-radius: 3px; cursor: pointer;"></button>
                            <button onclick="setBaseFrameColor('#8B0000')" title="032 - –¢–µ–º–Ω–æ-–∫—Ä–∞—Å–Ω—ã–π" style="width: 20px; height: 20px; background: #8B0000; border: 1px solid rgba(255,255,255,0.3); border-radius: 3px; cursor: pointer;"></button>
                            <button onclick="setBaseFrameColor('#800020')" title="338 - –ë–æ—Ä–¥–æ–≤—ã–π" style="width: 20px; height: 20px; background: #800020; border: 1px solid rgba(255,255,255,0.3); border-radius: 3px; cursor: pointer;"></button>
                            <button onclick="setBaseFrameColor('#FFC0CB')" title="043 - –†–æ–∑–æ–≤—ã–π" style="width: 20px; height: 20px; background: #FFC0CB; border: 1px solid rgba(255,255,255,0.3); border-radius: 3px; cursor: pointer;"></button>
                            <button onclick="setBaseFrameColor('#8B4513')" title="080 - –ö–æ—Ä–∏—á–Ω–µ–≤—ã–π" style="width: 20px; height: 20px; background: #8B4513; border: 1px solid rgba(255,255,255,0.3); border-radius: 3px; cursor: pointer;"></button>
                            <button onclick="setBaseFrameColor('#800080')" title="055 - –§–∏–æ–ª–µ—Ç–æ–≤—ã–π" style="width: 20px; height: 20px; background: #800080; border: 1px solid rgba(255,255,255,0.3); border-radius: 3px; cursor: pointer;"></button>
                            <button onclick="setBaseFrameColor('#0000FF')" title="052 - –°–∏–Ω–∏–π" style="width: 20px; height: 20px; background: #0000FF; border: 1px solid rgba(255,255,255,0.3); border-radius: 3px; cursor: pointer;"></button>
                            <button onclick="setBaseFrameColor('#87CEEB')" title="053 - –ì–æ–ª—É–±–æ–π" style="width: 20px; height: 20px; background: #87CEEB; border: 1px solid rgba(255,255,255,0.3); border-radius: 3px; cursor: pointer;"></button>
                            <button onclick="setBaseFrameColor('#90EE90')" title="060 - –°–≤–µ—Ç–ª–æ-–∑–µ–ª–µ–Ω—ã–π" style="width: 20px; height: 20px; background: #90EE90; border: 1px solid rgba(255,255,255,0.3); border-radius: 3px; cursor: pointer;"></button>
                            <button onclick="setBaseFrameColor('#006400')" title="061 - –¢–µ–º–Ω–æ-–∑–µ–ª–µ–Ω—ã–π" style="width: 20px; height: 20px; background: #006400; border: 1px solid rgba(255,255,255,0.3); border-radius: 3px; cursor: pointer;"></button>
                            <button onclick="setBaseFrameColor('#9ACD32')" title="063 - –ó–µ–ª–µ–Ω–æ–µ —è–±–ª–æ–∫–æ" style="width: 20px; height: 20px; background: #9ACD32; border: 1px solid rgba(255,255,255,0.3); border-radius: 3px; cursor: pointer;"></button>
                            <button onclick="setBaseFrameColor('#000000')" title="070 - –ß–µ—Ä–Ω—ã–π" style="width: 20px; height: 20px; background: #000000; border: 1px solid rgba(255,255,255,0.3); border-radius: 3px; cursor: pointer;"></button>
                            <button onclick="setBaseFrameColor('#C0C0C0')" title="090 - –°–≤–µ—Ç–ª–æ-—Å–µ—Ä—ã–π" style="width: 20px; height: 20px; background: #C0C0C0; border: 1px solid rgba(255,255,255,0.3); border-radius: 3px; cursor: pointer;"></button>
                        </div>
                    </div>
                </div>
                
                <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Å–Ω–æ–≤–∞–º–∏ –≤ 3D -->
                <div class="field-group" id="base-3d-group" style="display: none;">
                    <button onclick="addBase()" class="btn-add" style="margin-bottom: 8px;">
                        ‚ûï –î–æ–±–∞–≤–∏—Ç—å –≤ 3D —Å—Ü–µ–Ω—É
                    </button>
                    
                    <div id="bases-3d-list" style="max-height: 150px; overflow-y: auto; background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1); border-radius: 4px; padding: 5px;">
                        <div style="opacity: 0.5; font-size: 11px; padding: 8px; text-align: center;">–û—Å–Ω–æ–≤—ã –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã</div>
                    </div>
                    
                    <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–π –æ—Å–Ω–æ–≤–æ–π -->
                    <div id="base-controls" style="display: none; margin-top: 8px; padding: 8px; background: #2a2a2a; border-radius: 4px;">
                        <!-- –†–∞–∑–º–µ—Ä—ã –∞–∫—Ç–∏–≤–Ω–æ–π –æ—Å–Ω–æ–≤—ã -->
                        <div style="display: flex; flex-direction: column; align-items: center; gap: 3px; margin-bottom: 8px;">
                            <label style="font-size: 11px; color: rgba(255,255,255,0.5); text-align: center; margin-bottom: 2px;">—à–∏—Ä–∏–Ω–∞ (–º–º)</label>
                            <div style="display: flex; align-items: center; gap: 3px; width: 100%;">
                                <button onclick="changeActiveBaseWidth(-10)" class="btn-nav" style="width: 24px; height: 32px; font-size: 18px; padding: 0; line-height: 1;">‚àí</button>
                                <input type="number" id="active-base-width-input" min="100" max="10000" step="10" 
                                       oninput="updateActiveBaseWidth(this.value)" 
                                       style="flex: 1; height: 22px; background: rgba(0,0,0,0.4); border: 1px solid rgba(255,255,255,0.15); border-radius: 4px; color: white; text-align: center; font-size: 11px; padding: 0 4px;">
                                <button onclick="changeActiveBaseWidth(10)" class="btn-nav" style="width: 24px; height: 32px; font-size: 18px; padding: 0; line-height: 1;">+</button>
                            </div>
                        </div>
                        
                        <div style="display: flex; flex-direction: column; align-items: center; gap: 3px; margin-bottom: 8px;">
                            <label style="font-size: 11px; color: rgba(255,255,255,0.5); text-align: center; margin-bottom: 2px;">–≤—ã—Å–æ—Ç–∞ (–º–º)</label>
                            <div style="display: flex; align-items: center; gap: 3px; width: 100%;">
                                <button onclick="changeActiveBaseHeight(-10)" class="btn-nav" style="width: 24px; height: 32px; font-size: 18px; padding: 0; line-height: 1;">‚àí</button>
                                <input type="number" id="active-base-height-input" min="100" max="10000" step="10" 
                                       oninput="updateActiveBaseHeight(this.value)" 
                                       style="flex: 1; height: 22px; background: rgba(0,0,0,0.4); border: 1px solid rgba(255,255,255,0.15); border-radius: 4px; color: white; text-align: center; font-size: 11px; padding: 0 4px;">
                                <button onclick="changeActiveBaseHeight(10)" class="btn-nav" style="width: 24px; height: 32px; font-size: 18px; padding: 0; line-height: 1;">+</button>
                            </div>
                        </div>
                        
                        <!-- –ó–∞–≥–∏–± –∫—Ä–∞—ë–≤ (—Ç–æ–ª—å–∫–æ –¥–ª—è –∫–æ–º–ø–æ–∑–∏—Ç–∞) -->
                        <div id="active-base-bend-controls" style="display: none;">
                            <div style="display: flex; flex-direction: column; align-items: center; gap: 3px; margin-bottom: 8px;">
                                <label style="font-size: 11px; color: rgba(255,255,255,0.5); text-align: center; margin-bottom: 2px;">–∑–∞–≥–∏–± –∫—Ä–∞—ë–≤ (–º–º)</label>
                                <div style="display: flex; align-items: center; gap: 3px; width: 100%;">
                                    <button onclick="changeActiveBaseBend(-5)" class="btn-nav" style="width: 24px; height: 32px; font-size: 18px; padding: 0; line-height: 1;">‚àí</button>
                                    <input type="number" id="active-base-bend-input" min="0" max="200" step="5" value="0" 
                                           oninput="updateActiveBaseBend(this.value)" 
                                           style="flex: 1; height: 22px; background: rgba(0,0,0,0.4); border: 1px solid rgba(255,255,255,0.15); border-radius: 4px; color: white; text-align: center; font-size: 11px; padding: 0 4px;">
                                    <button onclick="changeActiveBaseBend(5)" class="btn-nav" style="width: 24px; height: 32px; font-size: 18px; padding: 0; line-height: 1;">+</button>
                                </div>
                            </div>
                            <div id="active-base-bend-warning" style="font-size: 10px; color: #ff9800; margin-top: 4px; display: none;">‚ö†Ô∏è –ù–µ –≤–º–µ—â–∞–µ—Ç—Å—è –≤ –ª–∏—Å—Ç!</div>
                            <div id="active-base-bend-info" style="font-size: 10px; opacity: 0.6; margin-bottom: 8px;">–ü–æ–ª–Ω—ã–π —Ä–∞–∑–º–µ—Ä: <span id="active-base-full-size">‚Äî</span></div>
                        </div>
                        
                        <!-- –ö–Ω–æ–ø–∫–∏ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –æ—Å–Ω–æ–≤—ã -->
                        <label style="font-size: 11px; opacity: 0.8; display: block; margin-bottom: 5px;">–ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ:</label>
                        <div style="display: flex; gap: 8px; margin-bottom: 8px;">
                            <div class="compact-nav" style="flex: 1;">
                            </div>
                        </div>
                        
                        <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
                        <div style="display: flex; gap: 5px;">
                            <button onclick="copyActiveBase()" style="flex: 1; padding: 6px; background: rgba(255,255,255,0.08); color: white; border: 1px solid rgba(255,255,255,0.2); border-radius: 4px; font-size: 11px; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center; gap: 4px;">
                                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                                </svg>
                                –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
                            </button>
                            <button onclick="deleteActiveBase()" style="flex: 1; padding: 6px; background: rgba(244,67,54,0.2); color: white; border: 1px solid rgba(244,67,54,0.4); border-radius: 4px; font-size: 11px; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center; gap: 4px;">
                                ‚úï –£–¥–∞–ª–∏—Ç—å
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- –û–ø—Ü–∏—è —É–≥–æ–ª–∫–∞ –¥–ª—è –ü–í–• –∏ –ø–æ–ª–∏–∫–∞—Ä–±–æ–Ω–∞—Ç–∞ -->
                <div class="field-group" id="base-corner-group" style="display: none;">
                    <label class="field-label">–û–±—Ä–∞–º–ª–µ–Ω–∏–µ —É–≥–æ–ª–∫–æ–º</label>
                    <select id="base-corner-type" onchange="window.updateBaseCorner(this.value)" style="background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.2); padding: 8px 12px; font-size: 13px; font-weight: 500; color: #fff;">
                        <option value="none">–ë–µ–∑ —É–≥–æ–ª–∫–∞</option>
                        <option value="corner-plastic">–ü–ª–∞—Å—Ç–∏–∫–æ–≤—ã–π 30√ó30–º–º (100‚ÇΩ/–º.–ø.)</option>
                        <option value="corner-metal">–ñ–µ—Å—Ç—è–Ω–æ–π 30√ó30–º–º (300‚ÇΩ/–º.–ø.)</option>
                    </select>
                </div>
            </div>
            </div><!-- /base-content -->

            <!-- –°–¢–ï–ù–ê (—Å–µ–∫—Ü–∏—è —É–¥–∞–ª–µ–Ω–∞ - —Ü–≤–µ—Ç —Ñ–æ–Ω–∞ —Ç–µ–ø–µ—Ä—å –≤ –ª–µ–≤–æ–π –ø–∞–Ω–µ–ª–∏) -->
            
            <!-- –ö–ê–õ–¨–ö–£–õ–Ø–¢–û–† –°–¢–û–ò–ú–û–°–¢–ò (–°–í–û–†–ê–ß–ò–í–ê–ï–ú–´–ô) -->
            <div class="section-title calc-toggle collapsed" onclick="toggleCalculator()">
                –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä
                <span class="calc-arrow">‚ñº</span>
            </div>
            <div class="calc-content collapsed">
                <div id="cost-calculator" style="background: rgba(0,0,0,0.3); padding: 12px; border-radius: 6px; font-size: 11px; line-height: 1.5; color: rgba(255,255,255,0.8);">
                    <div id="current-object-cost" style="margin-bottom: 10px; padding: 10px; background: rgba(255,255,255,0.08); border-radius: 4px; font-size: 11px; color: #fff;">
                        –í—ã–±–µ—Ä–∏—Ç–µ –æ–±—ä–µ–∫—Ç
                    </div>
                    
                    <div id="total-cost-list" style="margin-bottom: 8px; font-size: 11px; color: rgba(255,255,255,0.7);">
                        ‚Äî
                    </div>
                    
                    <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid rgba(255,209,0,0.3); font-weight: 700; font-size: 13px; color: var(--accent-color);">
                        –ò–¢–û–ì–û: <span id="total-cost">0 ‚ÇΩ</span>
                    </div>
                    
                    <!-- –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –∫–æ—Ä–∑–∏–Ω—É -->
                    <button id="add-to-cart-btn" onclick="addToCart()" style="
                        width: 100%;
                        margin-top: 12px;
                        padding: 12px;
                        background: linear-gradient(135deg, var(--accent-color) 0%, #FFB700 100%);
                        border: none;
                        border-radius: 6px;
                        color: #000;
                        font-weight: 700;
                        font-size: 12px;
                        cursor: pointer;
                        transition: all 0.2s;
                        text-transform: uppercase;
                        letter-spacing: 0.5px;
                        box-shadow: 0 4px 15px rgba(255,209,0,0.3);
                    " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(255,209,0,0.5)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(255,209,0,0.3)';">
                        üõí –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É
                    </button>
                    
                    <!-- –ö–Ω–æ–ø–∫–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è PDF –¢–ó -->
                    <button id="download-pdf-btn" onclick="generatePDF()" style="
                        width: 100%;
                        margin-top: 8px;
                        padding: 10px;
                        background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
                        border: none;
                        border-radius: 6px;
                        color: #fff;
                        font-weight: 600;
                        font-size: 11px;
                        cursor: pointer;
                        transition: all 0.2s;
                        text-transform: uppercase;
                        letter-spacing: 0.5px;
                        box-shadow: 0 2px 10px rgba(76,175,80,0.3);
                    " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 15px rgba(76,175,80,0.5)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 10px rgba(76,175,80,0.3)';">
                        üìÑ –°–∫–∞—á–∞—Ç—å PDF –¢–ó
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- –°–ö–†–´–¢–û–ï –ü–†–ï–í–¨–Æ SVG -->
    <div id="svg-preview-container" style="display: none;"></div>
    
    <script>
        // === –ì–õ–û–ë–ê–õ–¨–ù–û–ï –°–û–°–¢–û–Ø–ù–ò–ï ===
        const state = {
            construction: 'flat',
            hasBacklight: false,
            ledType: 'led-1.2w', // –¢–∏–ø –¥–∏–æ–¥–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1.2–í—Ç
            hasContour: false,
            hasSpacers: false,
            faceMaterial: { type: 'pvc', thickness: 4, color: null },
            faceColor: 'original', // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é - –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ —Ü–≤–µ—Ç–∞ –∏–∑ SVG
            sideMaterial: { type: 'pvc', thickness: 4 },
            sideColor: '#FFFFFF',
            bortHeight: 60,
            showWall: true, // –§–ª–∞–≥ –≤–∏–¥–∏–º–æ—Å—Ç–∏ —Å—Ç–µ–Ω—ã
            wallColor: '#C0C0C0', // –¶–≤–µ—Ç —Å—Ç–µ–Ω—ã (—Å–≤–µ—Ç–ª–æ-—Å–µ—Ä—ã–π Oracal 641 –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
            svgLoaded: false,
            svgRealSize: { width: 0, height: 0 }, // –†–µ–∞–ª—å–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã SVG –≤ –º–º
            svgScale: 1, // –ú–∞—Å—à—Ç–∞–± –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –µ–¥–∏–Ω–∏—Ü SVG –≤ –º–º
            frameType: 'none', // –¢–∏–ø –∫–∞—Ä–∫–∞—Å–∞
            frameColor: '#FFFFFF', // –¶–≤–µ—Ç –∫–∞—Ä–∫–∞—Å–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –±–µ–ª—ã–π)
            baseMaterial: 'none', // –ú–∞—Ç–µ—Ä–∏–∞–ª –æ—Å–Ω–æ–≤—ã
            baseColor: '#FFFFFF', // –¶–≤–µ—Ç –æ—Å–Ω–æ–≤—ã (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –±–µ–ª—ã–π)
            baseWidth: 1000, // –®–∏—Ä–∏–Ω–∞ –æ—Å–Ω–æ–≤—ã –≤ –º–º
            baseHeight: 1000, // –í—ã—Å–æ—Ç–∞ –æ—Å–Ω–æ–≤—ã –≤ –º–º
            baseBend: 0, // –†–∞–∑–º–µ—Ä –∑–∞–≥–∏–±–∞ –¥–ª—è –∫–æ–º–ø–æ–∑–∏—Ç–∞ –≤ –º–º
            baseCorner: 'none', // –û–±—Ä–∞–º–ª–µ–Ω–∏–µ —É–≥–æ–ª–∫–æ–º
            hasBaseFrame: false, // –ö–∞—Ä–∫–∞—Å –¥–ª—è –æ—Å–Ω–æ–≤—ã
            baseFrameProfile: '20x20', // –ü—Ä–æ—Ñ–∏–ª—å –∫–∞—Ä–∫–∞—Å–∞ (15x15, 20x20, 30x30, 40x20)
            baseFrameColor: '#808080' // –¶–≤–µ—Ç –∫–∞—Ä–∫–∞—Å–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–µ—Ä—ã–π)
        };
        
        // === –£–¢–ò–õ–ò–¢–´ ===
        function updateStatus(id, status, text) {
            const el = document.getElementById(id);
            if (el) {
                el.className = `status-dot ${status}`;
                el.textContent = text;
            }
        }
        
        function log(message, type = 'info') {
            const icons = { success: '‚úÖ', error: '‚ùå', warning: '‚ö†Ô∏è', info: '‚ÑπÔ∏è' };
            console.log(`[${icons[type] || '‚ÑπÔ∏è'}] ${message}`);
        }
        
        // === –õ–ï–ù–ò–í–ê–Ø –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø THREE.JS ===
        let initAttempts = 0;
        const maxAttempts = 50;
        const startTime = Date.now();
        
        function tryInit3D() {
            initAttempts++;
            
            const hasThree = typeof THREE !== 'undefined';
            const hasSVGLoader = hasThree && typeof THREE.SVGLoader !== 'undefined';
            const hasOrbitControls = hasThree && typeof THREE.OrbitControls !== 'undefined';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å—ã
            updateStatus('status-three', hasThree ? 'success' : 'pending', 
                hasThree ? '–Ø–î–†–û: –û–ö' : '–Ø–î–†–û: ...');
            updateStatus('status-svg-loader', hasSVGLoader ? 'success' : 'pending', 
                hasSVGLoader ? 'SVG: –û–ö' : 'SVG: ...');
            updateStatus('status-orbit', hasOrbitControls ? 'success' : 'pending', 
                hasOrbitControls ? '–ö–ê–ú–ï–†–ê: –û–ö' : '–ö–ê–ú–ï–†–ê: ...');
            
            if (hasThree && hasSVGLoader && hasOrbitControls) {
                const loadTime = ((Date.now() - startTime) / 1000).toFixed(2);
                log(`Three.js –∑–∞–≥—Ä—É–∂–µ–Ω –∑–∞ ${loadTime}—Å (–ø–æ–ø—ã—Ç–∫–∞ ${initAttempts})`, 'success');
                updateStatus('status-3d', 'pending', '–°–¶–ï–ù–ê: –°–¢–ê–†–¢');
                
                init3DScene();
            } else if (initAttempts < maxAttempts) {
                if (initAttempts % 10 === 0) {
                    log(`–û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏... (–ø–æ–ø—ã—Ç–∫–∞ ${initAttempts}/${maxAttempts})`, 'warning');
                }
                setTimeout(tryInit3D, 100);
            } else {
                const loadTime = ((Date.now() - startTime) / 1000).toFixed(2);
                log(`–¢–∞–π–º–∞—É—Ç! Three.js –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª—Å—è –∑–∞ ${loadTime}—Å`, 'error');
                updateStatus('status-3d', 'error', '‚ùå –¢–∞–π–º–∞—É—Ç');
            }
        }
        
        // === 3D –°–¶–ï–ù–ê ===
        let scene, camera, renderer, controls, backWall, backLight, keyLight;
        let svgGroups = []; // –ú–ê–°–°–ò–í –í–°–ï–• –ó–ê–ì–†–£–ñ–ï–ù–ù–´–• SVG-–û–ë–™–ï–ö–¢–û–í
        let activeSvgIndex = null; // –ò–ù–î–ï–ö–° –ê–ö–¢–ò–í–ù–û–ì–û (–í–´–ë–†–ê–ù–ù–û–ì–û) SVG
        let activeSvgHelper = null; // Helper –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ –≤—ã–¥–µ–ª–µ–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ SVG
        let shadowClones = []; // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–∞–∫ –º–∞—Å—Å–∏–≤ —Å—Ä–∞–∑—É
        
        // === –ö–ê–†–ö–ê–° (–Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–π —Å–ª–æ–π) ===
        let frameProfiles = []; // –ú–∞—Å—Å–∏–≤ –ø—Ä–æ—Ñ–∏–ª–µ–π –∫–∞—Ä–∫–∞—Å–∞
        let activeProfileIndex = null; // –ê–∫—Ç–∏–≤–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å
        
        // === –û–°–ù–û–í–ê (–ø–æ–¥–ª–æ–∂–∫–∞) ===
        let bases = []; // –ú–∞—Å—Å–∏–≤ –æ—Å–Ω–æ–≤
        let activeBaseIndex = null; // –ê–∫—Ç–∏–≤–Ω–∞—è –æ—Å–Ω–æ–≤–∞
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≥—Ä–∞–Ω–∏—Ü shadow camera –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–∞–∑–º–µ—Ä–∞ –±—É–∫–≤
        function updateShadowCamera() {
            if (svgGroups.length === 0 || !keyLight) {
                console.log('[updateShadowCamera] –ü—Ä–æ–ø—É—â–µ–Ω–æ: –Ω–µ—Ç SVG –∏–ª–∏ keyLight');
                return;
            }
            
            // –í—ã—á–∏—Å–ª—è–µ–º bounding box –≤—Å–µ—Ö SVG –æ–±—ä–µ–∫—Ç–æ–≤
            const bbox = new THREE.Box3();
            svgGroups.forEach(svgObj => {
                if (svgObj.group) bbox.expandByObject(svgObj.group);
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–æ—Ñ–∏–ª–∏ –≤ —Ä–∞—Å—á—ë—Ç
            if (frameProfiles && frameProfiles.length > 0) {
                frameProfiles.forEach(prof => {
                    if (prof.group) bbox.expandByObject(prof.group);
                });
            }
            
            const size = bbox.getSize(new THREE.Vector3());
            const center = bbox.getCenter(new THREE.Vector3());
            
            // –û–ì–†–û–ú–ù–´–ô –∑–∞–ø–∞—Å + –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –¥–ª—è 100% –ø–æ–∫—Ä—ã—Ç–∏—è
            const padding = 3.5;
            const minSize = 500;
            
            const width = Math.max(size.x * padding, minSize);
            const height = Math.max(size.y * padding, minSize);
            
            keyLight.shadow.camera.left = center.x - width;
            keyLight.shadow.camera.right = center.x + width;
            keyLight.shadow.camera.top = center.y + height;
            keyLight.shadow.camera.bottom = center.y - height;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –º–∞—Ç—Ä–∏—Ü—É –ø—Ä–æ–µ–∫—Ü–∏–∏ –∫–∞–º–µ—Ä—ã
            keyLight.shadow.camera.updateProjectionMatrix();
            
            console.log('[updateShadowCamera] –û–±–Ω–æ–≤–ª–µ–Ω–æ:', {
                center: `${center.x.toFixed(1)}, ${center.y.toFixed(1)}`,
                size: `${size.x.toFixed(1)}√ó${size.y.toFixed(1)}`,
                bounds: `${keyLight.shadow.camera.left.toFixed(1)}...${keyLight.shadow.camera.right.toFixed(1)}`,
                coverage: `${width.toFixed(1)}√ó${height.toFixed(1)}`
            });
        }
        
        
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // üîß –£–ü–†–ê–í–õ–ï–ù–ò–ï –ö–ê–†–ö–ê–°–û–ú (–ü–†–û–§–ò–õ–Ø–ú–ò)
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è –≤ 3D —Å—Ü–µ–Ω—É
        function addFrameProfile() {
            if (!state.frameType || state.frameType === 'none') {
                log('‚ùå –°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –ø—Ä–æ—Ñ–∏–ª—è!', 'warning');
                return;
            }
            
            const frameData = PRICES_DATA.frame[state.frameType];
            if (!frameData) return;
            
            // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –¥–ª–∏–Ω–∞ –ø–∞–ª–∫–∏ –∏–∑ –ø—Ä–∞–π—Å–∞
            const standardLength = frameData.length || 2000;
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–∞–∑–º–µ—Ä —Å–µ—á–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è (–ø–æ –ø–æ—Ä—è–¥–∫—É –∏–∑ SVG: 15, 20, 25, 30, 40)
            let profileSize = 15;
            let profileDepth = 15; // –ì–ª—É–±–∏–Ω–∞ (–∫ —Å—Ç–µ–Ω–µ)
            
            if (state.frameType.includes('20x20')) {
                profileSize = 20;
                profileDepth = 20;
            } else if (state.frameType.includes('25x25')) {
                profileSize = 25;
                profileDepth = 25;
            } else if (state.frameType.includes('30x30')) {
                profileSize = 30;
                profileDepth = 30;
            } else if (state.frameType.includes('40x20')) {
                profileSize = 40;    // –í—ã—Å–æ—Ç–∞ (–±–æ–ª—å—à–∞—è —Å—Ç–æ—Ä–æ–Ω–∞)
                profileDepth = 20;   // –ì–ª—É–±–∏–Ω–∞ (—É–∑–∫–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ –∫ —Å—Ç–µ–Ω–µ)
            }
            
            // –¶–≤–µ—Ç –ø—Ä–æ—Ñ–∏–ª—è –∏–∑ state.frameColor
            const frameColorHex = state.frameColor.replace('#', '0x');
            const frameColor = parseInt(frameColorHex, 16);
            
            // –°–æ–∑–¥–∞—ë–º –º–∞—Ç–µ—Ä–∏–∞–ª
            const material = new THREE.MeshStandardMaterial({
                color: frameColor,
                metalness: 0.2,
                roughness: 0.8
            });
            
            // –ú–∞—Å—à—Ç–∞–± —Å—Ü–µ–Ω—ã: 1 –µ–¥–∏–Ω–∏—Ü–∞ Three.js = 10 –º–º
            const SCENE_SCALE = 0.1; // 10–º–º = 1 –µ–¥–∏–Ω–∏—Ü–∞
            
            // –°–æ–∑–¥–∞—ë–º –≥–µ–æ–º–µ—Ç—Ä–∏—é —Å —É—á—ë—Ç–æ–º –º–∞—Å—à—Ç–∞–±–∞ —Å—Ü–µ–Ω—ã
            const geometry = new THREE.BoxGeometry(
                standardLength * SCENE_SCALE,     // –î–ª–∏–Ω–∞ –ø—Ä–æ—Ñ–∏–ª—è (–º–º ‚Üí –µ–¥–∏–Ω–∏—Ü—ã)
                profileSize * SCENE_SCALE,        // –í—ã—Å–æ—Ç–∞ (Y) (–º–º ‚Üí –µ–¥–∏–Ω–∏—Ü—ã)
                profileDepth * SCENE_SCALE        // –ì–ª—É–±–∏–Ω–∞ –∫ —Å—Ç–µ–Ω–µ (Z) (–º–º ‚Üí –µ–¥–∏–Ω–∏—Ü—ã)
            );
            const mesh = new THREE.Mesh(geometry, material);
            // –¢–µ–Ω–∏ –æ—Ç–∫–ª—é—á–µ–Ω—ã
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–Ω—Ç—É—Ä (–∫–∞–∫ —É –¥–µ—Ä–∂–∞—Ç–µ–ª–µ–π)
            const edges = new THREE.EdgesGeometry(geometry);
            const lineMaterial = new THREE.LineBasicMaterial({ 
                color: 0x000000, 
                linewidth: 2,
                transparent: true,
                opacity: 0.3
            });
            const outline = new THREE.LineSegments(edges, lineMaterial);
            
            // –ì—Ä—É–ø–ø–∞ –¥–ª—è –ø—Ä–æ—Ñ–∏–ª—è
            const group = new THREE.Group();
            group.add(mesh);
            group.add(outline); // –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–Ω—Ç—É—Ä
            // –ü—Ä–æ—Ñ–∏–ª—å: –∑–∞–¥–Ω—è—è –≥—Ä–∞–Ω—å –∫–∞—Å–∞–µ—Ç—Å—è —Å—Ç–µ–Ω—ã (Z = -10)
            // BoxGeometry —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∞, –ø–æ—ç—Ç–æ–º—É —Å–º–µ—â–∞–µ–º –≤–ø–µ—Ä—ë–¥ –Ω–∞ –ø–æ–ª–æ–≤–∏–Ω—É –ì–õ–£–ë–ò–ù–´
            const halfThickness = (profileDepth * SCENE_SCALE) / 2;
            group.position.set(0, 0, -10 + halfThickness);
            scene.add(group);
            
            // –û–±—ä–µ–∫—Ç –ø—Ä–æ—Ñ–∏–ª—è
            const profile = {
                id: `profile_${Date.now()}`,
                group: group,
                mesh: mesh,
                geometry: geometry,
                material: material,
                length: standardLength, // —Ç–µ–∫—É—â–∞—è –¥–ª–∏–Ω–∞ –≤ –º–º
                standardLength: standardLength, // —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –¥–ª–∏–Ω–∞ –ø–∞–ª–∫–∏
                profileSize: profileSize,      // –í—ã—Å–æ—Ç–∞ (–¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è)
                profileDepth: profileDepth,    // –ì–ª—É–±–∏–Ω–∞ (–¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Ç–æ–ª—â–∏–Ω—ã)
                rotation: 0,                   // –£–≥–æ–ª –ø–æ–≤–æ—Ä–æ—Ç–∞ –≤ –≥—Ä–∞–¥—É—Å–∞—Ö
                type: state.frameType,
                name: `${frameData.name} #${frameProfiles.length + 1}`
            };
            
            frameProfiles.push(profile);
            activeProfileIndex = frameProfiles.length - 1;
            
            updateProfilesList();
            updateProfileControls();
            updateCostCalculator(); // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–∞—Å—á—ë—Ç—ã
            updateWallAndShadows(); // –û—Ç–æ–¥–≤–∏–≥–∞–µ–º —Å—Ç–µ–Ω—É –ø–æ–¥ –∫–∞—Ä–∫–∞—Å
            
            log(`‚úÖ –î–æ–±–∞–≤–ª–µ–Ω: ${profile.name} (${standardLength}–º–º)`, 'success');
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø—Ä–æ—Ñ–∏–ª–µ–π
        function updateProfilesList() {
            const listEl = document.getElementById('profiles-3d-list');
            if (!listEl) return;
            
            if (frameProfiles.length === 0) {
                listEl.innerHTML = '<div style="opacity: 0.5; font-size: 11px; padding: 8px; text-align: center;">–ü—Ä–æ—Ñ–∏–ª–∏ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã</div>';
                return;
            }
            
            let html = '';
            frameProfiles.forEach((prof, idx) => {
                const isActive = idx === activeProfileIndex;
                const lengthM = (prof.length / 1000).toFixed(2);
                
                html += `
                    <div onclick="selectProfile(${idx})" 
                         style="padding: 8px; margin: 4px 0; 
                                background: ${isActive ? 'rgba(255,193,7,0.12)' : 'rgba(255,255,255,0.03)'}; 
                                border: 1px solid ${isActive ? 'rgba(255,193,7,0.4)' : 'rgba(255,255,255,0.1)'}; 
                                border-radius: 4px;
                                cursor: pointer; font-size: 11px; 
                                transition: all 0.2s;">
                        <div style="font-weight: 500; color: ${isActive ? '#ffd54f' : '#fff'};">${prof.name}</div>
                        <div style="opacity: 0.7; margin-top: 2px;">–î–ª–∏–Ω–∞: ${lengthM}–º (${prof.length}–º–º)</div>
                    </div>
                `;
            });
            
            listEl.innerHTML = html;
        }
        
        // –í—ã–±–æ—Ä –ø—Ä–æ—Ñ–∏–ª—è
        window.selectProfile = function(index) {
            // –°–ë–†–ê–°–´–í–ê–ï–ú –í–°–ï –î–†–£–ì–ò–ï –ê–ö–¢–ò–í–ù–´–ï –û–ë–™–ï–ö–¢–´
            // –°–Ω–∏–º–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å SVG
            if (activeSvgHelper) {
                scene.remove(activeSvgHelper);
                activeSvgHelper = null;
            }
            if (activeSvgIndex !== null) {
                activeSvgIndex = null;
                updateSVGList();
            }
            
            // –°–Ω–∏–º–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å –æ—Å–Ω–æ–≤—ã
            if (activeBaseIndex !== null && bases[activeBaseIndex]) {
                const prevBaseMesh = bases[activeBaseIndex].mesh;
                if (prevBaseMesh) {
                    if (prevBaseMesh.type === 'Group') {
                        prevBaseMesh.children.forEach(child => {
                            if (child.children[0]) {
                                child.children[0].material.opacity = 0.2;
                                child.children[0].material.color.setHex(0x000000);
                            }
                        });
                    } else if (prevBaseMesh.children[0]) {
                        prevBaseMesh.children[0].material.opacity = 0.2;
                        prevBaseMesh.children[0].material.color.setHex(0x000000);
                    }
                }
                activeBaseIndex = null;
                
                // –°–∫—Ä—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—Å–Ω–æ–≤–æ–π
                const baseControls = document.getElementById('base-controls');
                if (baseControls) {
                    baseControls.style.display = 'none';
                }
            }
            
            // –°–Ω–∏–º–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è
            if (activeProfileIndex !== null && frameProfiles[activeProfileIndex]) {
                const prevMesh = frameProfiles[activeProfileIndex].mesh;
                if (prevMesh && prevMesh.children[0]) {
                    prevMesh.children[0].material.opacity = 0.2;
                    prevMesh.children[0].material.color.setHex(0x000000);
                }
            }
            
            activeProfileIndex = index;
            
            // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –∫–æ–Ω—Ç—É—Ä –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è (–∑–µ–ª—ë–Ω—ã–π —è—Ä–∫–∏–π)
            if (frameProfiles[index] && frameProfiles[index].mesh) {
                const mesh = frameProfiles[index].mesh;
                if (mesh.children[0]) {
                    mesh.children[0].material.opacity = 0.8;
                    mesh.children[0].material.color.setHex(0x00FF00);
                }
            }
            
            updateProfilesList();
            updateProfileControls();
            log(`–í—ã–±—Ä–∞–Ω: ${frameProfiles[index].name}`, 'info');
        };
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª–µ–º
        function updateProfileControls() {
            const controlsDiv = document.getElementById('profile-controls');
            const lengthInput = document.getElementById('profile-length-input');
            const rotationInput = document.getElementById('profile-rotation-input');
            
            if (!controlsDiv || !lengthInput) return;
            
            if (activeProfileIndex !== null && frameProfiles[activeProfileIndex]) {
                const prof = frameProfiles[activeProfileIndex];
                controlsDiv.style.display = 'block';
                lengthInput.value = prof.length;
                if (rotationInput) {
                    rotationInput.value = Math.round(prof.rotation || 0);
                }
            } else {
                controlsDiv.style.display = 'none';
            }
        }
        
        // –ò–∑–º–µ–Ω–µ–Ω–∏–µ –¥–ª–∏–Ω—ã –ø—Ä–æ—Ñ–∏–ª—è
        window.updateProfileLength = function(newLength) {
            if (activeProfileIndex === null) return;
            
            const prof = frameProfiles[activeProfileIndex];
            const length = parseInt(newLength) || prof.standardLength;
            
            // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
            if (length < 10) return;
            if (length > 10000) return;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–ª–∏–Ω—É
            prof.length = length;
            
            // –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º –≥–µ–æ–º–µ—Ç—Ä–∏—é –ø–æ X
            const scale = length / prof.standardLength;
            prof.mesh.scale.x = scale;
            
            // –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º –∫–æ–Ω—Ç—É—Ä (LineSegments) —Ç–æ–∂–µ!
            prof.group.children.forEach(child => {
                if (child.type === 'LineSegments') {
                    child.scale.x = scale;
                }
            });
            
            updateProfilesList();
            updateCostCalculator(); // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–∞—Å—á—ë—Ç—ã
        };
        
        // –ò–∑–º–µ–Ω–µ–Ω–∏–µ –¥–ª–∏–Ω—ã –ø—Ä–æ—Ñ–∏–ª—è –∫–Ω–æ–ø–∫–∞–º–∏ +/-
        window.changeProfileLength = function(delta) {
            if (activeProfileIndex === null) return;
            
            const prof = frameProfiles[activeProfileIndex];
            const newLength = prof.length + delta;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º input –∏ –≤—ã–∑—ã–≤–∞–µ–º updateProfileLength
            const input = document.getElementById('profile-length-input');
            if (input) {
                input.value = newLength;
                updateProfileLength(newLength);
            }
        };
        
        // –ò–∑–º–µ–Ω–µ–Ω–∏–µ —É–≥–ª–∞ –ø–æ–≤–æ—Ä–æ—Ç–∞ –ø—Ä–æ—Ñ–∏–ª—è
        window.updateProfileRotation = function(angleDegrees) {
            if (activeProfileIndex === null) return;
            
            const prof = frameProfiles[activeProfileIndex];
            const angle = parseFloat(angleDegrees) || 0;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —É–≥–æ–ª
            prof.rotation = angle;
            prof.group.rotation.z = angle * Math.PI / 180; // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ —Ä–∞–¥–∏–∞–Ω—ã
            
            updateProfileControls();
        };
        
        // –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
        window.duplicateProfile = function() {
            if (activeProfileIndex === null) {
                log('‚ùå –°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å!', 'warning');
                return;
            }
            
            const original = frameProfiles[activeProfileIndex];
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –º–∞—Å—à—Ç–∞–± —Å—Ü–µ–Ω—ã
            const visibleSvg = svgGroups.find(obj => obj.visible);
            let sceneScale = 1;
            if (visibleSvg && visibleSvg.realWidth && visibleSvg.svgWidth) {
                sceneScale = visibleSvg.realWidth / visibleSvg.svgWidth;
            }
            
            // –°–æ–∑–¥–∞—ë–º –Ω–æ–≤—É—é –≥–µ–æ–º–µ—Ç—Ä–∏—é —Å —É—á—ë—Ç–æ–º –º–∞—Å—à—Ç–∞–±–∞ (–∏—Å–ø–æ–ª—å–∑—É–µ–º –≥–ª—É–±–∏–Ω—É!)
            const geometry = new THREE.BoxGeometry(
                original.standardLength / sceneScale,          // –î–ª–∏–Ω–∞
                original.profileSize / sceneScale,             // –í—ã—Å–æ—Ç–∞
                (original.profileDepth || original.profileSize) / sceneScale  // –ì–ª—É–±–∏–Ω–∞
            );
            const material = new THREE.MeshStandardMaterial({
                color: original.material.color,
                metalness: 0.7,
                roughness: 0.3
            });
            
            const mesh = new THREE.Mesh(geometry, material);
            // –¢–µ–Ω–∏ –æ—Ç–∫–ª—é—á–µ–Ω—ã
            mesh.scale.x = original.mesh.scale.x; // –ö–æ–ø–∏—Ä—É–µ–º –º–∞—Å—à—Ç–∞–±
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–Ω—Ç—É—Ä (–∫–∞–∫ —É –¥–µ—Ä–∂–∞—Ç–µ–ª–µ–π)
            const edges = new THREE.EdgesGeometry(geometry);
            const lineMaterial = new THREE.LineBasicMaterial({ 
                color: 0x000000, 
                linewidth: 2,
                transparent: true,
                opacity: 0.3
            });
            const outline = new THREE.LineSegments(edges, lineMaterial);
            outline.scale.x = original.mesh.scale.x; // –ö–æ–ø–∏—Ä—É–µ–º –º–∞—Å—à—Ç–∞–± –¥–ª—è –∫–æ–Ω—Ç—É—Ä–∞ —Ç–æ–∂–µ
            
            const group = new THREE.Group();
            group.add(mesh);
            group.add(outline); // –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–Ω—Ç—É—Ä
            
            // –ö–æ–ø–∏—Ä—É–µ–º –ø–æ–∑–∏—Ü–∏—é –∏ –ø–æ–≤–æ—Ä–æ—Ç (–±–µ–∑ —Å–º–µ—â–µ–Ω–∏—è)
            group.position.copy(original.group.position);
            group.rotation.copy(original.group.rotation);
            
            scene.add(group);
            
            const profile = {
                id: `profile_${Date.now()}`,
                group: group,
                mesh: mesh,
                geometry: geometry,
                material: material,
                length: original.length,
                standardLength: original.standardLength,
                profileSize: original.profileSize,
                profileDepth: original.profileDepth || original.profileSize,  // –ö–æ–ø–∏—Ä—É–µ–º –≥–ª—É–±–∏–Ω—É
                rotation: original.rotation || 0,  // –ö–æ–ø–∏—Ä—É–µ–º —É–≥–æ–ª –ø–æ–≤–æ—Ä–æ—Ç–∞
                type: original.type,
                name: `${PRICES_DATA.frame[original.type].name} #${frameProfiles.length + 1}`
            };
            
            frameProfiles.push(profile);
            activeProfileIndex = frameProfiles.length - 1;
            
            updateProfilesList();
            updateProfileControls();
            updateCostCalculator();
            
            log(`‚úÖ –ü—Ä–æ—Ñ–∏–ª—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω`, 'success');
        };
        
        // –£–¥–∞–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è
        window.deleteActiveProfile = function() {
            if (activeProfileIndex === null) return;
            
            const prof = frameProfiles[activeProfileIndex];
            
            // –£–¥–∞–ª—è–µ–º –∏–∑ —Å—Ü–µ–Ω—ã
            scene.remove(prof.group);
            
            // –û—á–∏—â–∞–µ–º –ø–∞–º—è—Ç—å
            prof.geometry.dispose();
            prof.material.dispose();
            
            // –£–¥–∞–ª—è–µ–º –∏–∑ –º–∞—Å—Å–∏–≤–∞
            frameProfiles.splice(activeProfileIndex, 1);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∏–Ω–¥–µ–∫—Å
            if (frameProfiles.length > 0) {
                activeProfileIndex = Math.min(activeProfileIndex, frameProfiles.length - 1);
            } else {
                activeProfileIndex = null;
            }
            
            updateProfilesList();
            updateProfileControls();
            updateCostCalculator();
            updateWallAndShadows(); // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å—Ç–µ–Ω—É –µ—Å–ª–∏ –ø—Ä–æ—Ñ–∏–ª–µ–π –Ω–µ –æ—Å—Ç–∞–ª–æ—Å—å
            
            log(`üóëÔ∏è –ü—Ä–æ—Ñ–∏–ª—å —É–¥–∞–ª—ë–Ω`, 'info');
        };
        
        // –ü–ª–∞–≤–Ω–æ–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è (—á–µ—Ä–µ–∑ requestAnimationFrame –∫–∞–∫ —É –±—É–∫–≤)
        let profileMoveActive = false;
        let profileMoveDirection = null;
        
        window.startProfileMove = function(direction) {
            if (activeProfileIndex === null) return;
            
            profileMoveDirection = direction;
            
            if (!profileMoveActive) {
                profileMoveActive = true;
                animateProfileMove();
            }
        };
        
        window.stopProfileMove = function() {
            profileMoveActive = false;
            profileMoveDirection = null;
        };
        
        function animateProfileMove() {
            if (!profileMoveActive || activeProfileIndex === null) {
                profileMoveActive = false;
                return;
            }
            
            const prof = frameProfiles[activeProfileIndex];
            const step = 0.1; // –®–∞–≥ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è (–º–µ–Ω—å—à–µ = –ø–ª–∞–≤–Ω–µ–µ)
            
            switch(profileMoveDirection) {
                case 'left':
                    prof.group.position.x -= step;
                    break;
                case 'right':
                    prof.group.position.x += step;
                    break;
                case 'up':
                    prof.group.position.y += step;
                    break;
                case 'down':
                    prof.group.position.y -= step;
                    break;
                case 'forward':
                    prof.group.position.z -= step; // –ö —Å—Ç–µ–Ω–µ
                    break;
                case 'backward':
                    prof.group.position.z += step; // –û—Ç —Å—Ç–µ–Ω—ã
                    break;
                case 'rotateLeft':
                    prof.group.rotation.z += Math.PI / 180; // 1 –≥—Ä–∞–¥—É—Å –ø—Ä–æ—Ç–∏–≤ —á–∞—Å–æ–≤–æ–π
                    prof.rotation = (prof.rotation || 0) + 1;
                    updateProfileControls(); // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª–µ
                    break;
                case 'rotateRight':
                    prof.group.rotation.z -= Math.PI / 180; // 1 –≥—Ä–∞–¥—É—Å –ø–æ —á–∞—Å–æ–≤–æ–π
                    prof.rotation = (prof.rotation || 0) - 1;
                    updateProfileControls(); // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª–µ
                    break;
            }
            
            // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é
            requestAnimationFrame(animateProfileMove);
        }
        
        
        function init3DScene() {
            try {
                const canvas = document.getElementById('canvas-3d');
                const width = window.innerWidth;
                const height = window.innerHeight;
                
                // –°—Ü–µ–Ω–∞
                scene = new THREE.Scene();
                scene.background = new THREE.Color(0x05080a);
                
                // –ö–∞–º–µ—Ä–∞
                camera = new THREE.PerspectiveCamera(45, width / height, 0.1, 1000);
                
                // –°–ú–ï–©–ê–ï–ú –¶–ï–ù–¢–† –ö–ê–ú–ï–†–´ –í–õ–ï–í–û (–Ω–∞ 210 –ø–∏–∫—Å–µ–ª–µ–π)
                camera.setViewOffset(width, height, 210, 0, width, height);
                
                camera.position.set(0, 0, 20);
                
                // –†–µ–Ω–¥–µ—Ä–µ—Ä
                renderer = new THREE.WebGLRenderer({ canvas, antialias: true });
                renderer.setSize(width, height);
                renderer.setPixelRatio(window.devicePixelRatio);
                renderer.shadowMap.enabled = false; // –¢–ï–ù–ò –û–¢–ö–õ–Æ–ß–ï–ù–´
                
                // –ö–æ–Ω—Ç—Ä–æ–ª—ã
                controls = new THREE.OrbitControls(camera, canvas);
                controls.enableDamping = true;
                controls.dampingFactor = 0.05;
                controls.enableZoom = true;
                controls.autoRotate = false;

                // === –ü–†–ò–ë–õ–ò–ñ–ï–ù–ò–ï –ö –ö–£–†–°–û–†–£ (ZOOM TO CURSOR) ===
                const raycaster = new THREE.Raycaster();
                const mouse = new THREE.Vector2();

                canvas.addEventListener('mousemove', (event) => {
                    const rect = canvas.getBoundingClientRect();
                    mouse.x = ((event.clientX - rect.left) / rect.width) * 2 - 1;
                    mouse.y = -((event.clientY - rect.top) / rect.height) * 2 + 1;
                });

                canvas.addEventListener('wheel', (event) => {
                    if (!controls.enableZoom) return;

                    // –ù–∞—Ö–æ–¥–∏–º —Ç–æ—á–∫—É –ø–æ–¥ –∫—É—Ä—Å–æ—Ä–æ–º
                    raycaster.setFromCamera(mouse, camera);
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ —Å–æ –≤—Å–µ–º–∏ –æ–±—ä–µ–∫—Ç–∞–º–∏ —Å—Ü–µ–Ω—ã (–±—É–∫–≤—ã, —Å—Ç–µ–Ω–∞)
                    const objectsToIntersect = [];
                    svgGroups.forEach(svgObj => {
                        if (svgObj.group) objectsToIntersect.push(svgObj.group);
                    });
                    if (backWall) objectsToIntersect.push(backWall);
                    
                    const intersects = raycaster.intersectObjects(objectsToIntersect, true);
                    
                    if (intersects.length > 0) {
                        const targetPoint = intersects[0].point;
                        
                        // –ü–ª–∞–≤–Ω–æ–µ —Å–º–µ—â–µ–Ω–∏–µ —Ü–µ–Ω—Ç—Ä–∞ –≤—Ä–∞—â–µ–Ω–∏—è (target) –∫ —Ç–æ—á–∫–µ –ø–æ–¥ –∫—É—Ä—Å–æ—Ä–æ–º
                        // –ß–µ–º –±–æ–ª—å—à–µ –∑—É–º, —Ç–µ–º —Å–∏–ª—å–Ω–µ–µ —Å–º–µ—â–∞–µ–º —Ü–µ–ª—å
                        const zoomFactor = 0.1; 
                        controls.target.lerp(targetPoint, zoomFactor);
                    }
                }, { passive: true });
                
                // === DRAG AND DROP –î–õ–Ø –û–ë–™–ï–ö–¢–û–í ===
                let isDragging = false;
                let draggedSvgIndex = null;
                let draggedBaseIndex = null;
                let draggedProfileIndex = null;
                let dragPlane = new THREE.Plane(new THREE.Vector3(0, 0, 1), 0); // –ü–ª–æ—Å–∫–æ—Å—Ç—å XY (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å—Ç–µ–Ω–µ)
                let dragOffset = new THREE.Vector3();
                let dragIntersectionPoint = new THREE.Vector3();
                
                // === –ö–õ–ò–ö –ü–û –û–ë–™–ï–ö–¢–ê–ú (–±–µ–∑ Shift) ===
                canvas.addEventListener('click', (event) => {
                    // –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ –ù–ï –∑–∞–∂–∞—Ç Shift (—á—Ç–æ–±—ã –Ω–µ –º–µ—à–∞—Ç—å drag and drop)
                    if (event.shiftKey) return;
                    
                    raycaster.setFromCamera(mouse, camera);
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–ª–∏–∫ –ø–æ SVG –æ–±—ä–µ–∫—Ç–∞–º
                    if (svgGroups && svgGroups.length > 0) {
                        for (let i = 0; i < svgGroups.length; i++) {
                            const svgObj = svgGroups[i];
                            if (svgObj.group) {
                                const svgIntersects = raycaster.intersectObjects(svgObj.group.children, true);
                                if (svgIntersects.length > 0) {
                                    selectSVG(i);
                                    return;
                                }
                            }
                        }
                    }
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–ª–∏–∫ –ø–æ –æ—Å–Ω–æ–≤–∞–º
                    if (bases && bases.length > 0) {
                        const baseMeshes = bases.map(b => b.mesh).filter(m => m);
                        const baseIntersects = raycaster.intersectObjects(baseMeshes, true);
                        
                        if (baseIntersects.length > 0) {
                            // –ù–∞—à–ª–∏ –∫–ª–∏–∫ –ø–æ –æ—Å–Ω–æ–≤–µ
                            const clickedMesh = baseIntersects[0].object;
                            const baseIndex = bases.findIndex(b => b.mesh === clickedMesh || b.mesh.children.includes(clickedMesh));
                            
                            if (baseIndex !== -1) {
                                selectBase(baseIndex);
                                return;
                            }
                        }
                    }
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–ª–∏–∫ –ø–æ –ø—Ä–æ—Ñ–∏–ª—è–º –∫–∞—Ä–∫–∞—Å–∞
                    if (frameProfiles && frameProfiles.length > 0) {
                        const profileMeshes = frameProfiles.map(p => p.mesh).filter(m => m);
                        const profileIntersects = raycaster.intersectObjects(profileMeshes, true);
                        
                        if (profileIntersects.length > 0) {
                            // –ù–∞—à–ª–∏ –∫–ª–∏–∫ –ø–æ –ø—Ä–æ—Ñ–∏–ª—é
                            const clickedMesh = profileIntersects[0].object;
                            const profileIndex = frameProfiles.findIndex(p => p.mesh === clickedMesh || p.mesh.children.includes(clickedMesh));
                            
                            if (profileIndex !== -1) {
                                selectProfile(profileIndex);
                                return;
                            }
                        }
                    }
                    
                    // –ï—Å–ª–∏ –∫–ª–∏–∫–Ω—É–ª–∏ –Ω–∞ –ø—É—Å—Ç—É—é –æ–±–ª–∞—Å—Ç—å - —Å–Ω–∏–º–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ
                    deselectAll();
                });
                
                // Mousedown - –Ω–∞—á–∞–ª–æ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è (SHIFT + –õ–ö–ú)
                canvas.addEventListener('mousedown', (event) => {
                    // –¢–æ–ª—å–∫–æ Shift + –ª–µ–≤–∞—è –∫–Ω–æ–ø–∫–∞ –º—ã—à–∏
                    if (event.button !== 0 || !event.shiftKey) return;
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∫–ª–∏–∫–Ω—É–ª–∏ –ª–∏ –Ω–∞ –æ–±—ä–µ–∫—Ç
                    raycaster.setFromCamera(mouse, camera);
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ —Å SVG, –æ—Å–Ω–æ–≤–∞–º–∏ –∏ –ø—Ä–æ—Ñ–∏–ª—è–º–∏
                    let intersectedObjects = [];
                    
                    // SVG –æ–±—ä–µ–∫—Ç—ã
                    svgGroups.forEach((svgObj, index) => {
                        if (svgObj.group) {
                            const intersects = raycaster.intersectObjects(svgObj.group.children, true);
                            if (intersects.length > 0) {
                                intersectedObjects.push({ type: 'svg', index, distance: intersects[0].distance });
                            }
                        }
                    });
                    
                    // –û—Å–Ω–æ–≤—ã
                    if (bases && bases.length > 0) {
                        bases.forEach((base, index) => {
                            if (base.mesh) {
                                const intersects = raycaster.intersectObjects([base.mesh], true);
                                if (intersects.length > 0) {
                                    intersectedObjects.push({ type: 'base', index, distance: intersects[0].distance });
                                }
                            }
                        });
                    }
                    
                    // –ü—Ä–æ—Ñ–∏–ª–∏
                    if (frameProfiles && frameProfiles.length > 0) {
                        frameProfiles.forEach((profile, index) => {
                            if (profile.mesh) {
                                const intersects = raycaster.intersectObjects([profile.mesh], true);
                                if (intersects.length > 0) {
                                    intersectedObjects.push({ type: 'profile', index, distance: intersects[0].distance });
                                }
                            }
                        });
                    }
                    
                    // –ë–µ—Ä–µ–º –±–ª–∏–∂–∞–π—à–∏–π –æ–±—ä–µ–∫—Ç
                    if (intersectedObjects.length > 0) {
                        intersectedObjects.sort((a, b) => a.distance - b.distance);
                        const nearest = intersectedObjects[0];
                        
                        isDragging = true;
                        
                        if (nearest.type === 'svg') {
                            draggedSvgIndex = nearest.index;
                            
                            // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é selectSVG –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ —Å–±—Ä–æ—Å–∞ –¥—Ä—É–≥–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤
                            selectSVG(draggedSvgIndex);
                            
                            const svgGroup = svgGroups[draggedSvgIndex].group;
                            raycaster.ray.intersectPlane(dragPlane, dragIntersectionPoint);
                            dragOffset.copy(dragIntersectionPoint).sub(svgGroup.position);
                            
                            log(`üñ±Ô∏è –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ SVG: ${svgGroups[draggedSvgIndex].name}`, 'info');
                        } else if (nearest.type === 'base') {
                            draggedBaseIndex = nearest.index;
                            selectBase(draggedBaseIndex);
                            
                            const baseMesh = bases[draggedBaseIndex].mesh;
                            raycaster.ray.intersectPlane(dragPlane, dragIntersectionPoint);
                            dragOffset.copy(dragIntersectionPoint).sub(baseMesh.position);
                            
                            log(`üñ±Ô∏è –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ –æ—Å–Ω–æ–≤—ã #${draggedBaseIndex + 1}`, 'info');
                        } else if (nearest.type === 'profile') {
                            draggedProfileIndex = nearest.index;
                            selectProfile(draggedProfileIndex);
                            
                            const profileMesh = frameProfiles[draggedProfileIndex].mesh;
                            raycaster.ray.intersectPlane(dragPlane, dragIntersectionPoint);
                            dragOffset.copy(dragIntersectionPoint).sub(profileMesh.position);
                            
                            log(`üñ±Ô∏è –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è #${draggedProfileIndex + 1}`, 'info');
                        }
                        
                        controls.enabled = false; // –û—Ç–∫–ª—é—á–∞–µ–º OrbitControls –≤–æ –≤—Ä–µ–º—è –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
                        canvas.style.cursor = 'grabbing';
                        event.preventDefault();
                    }
                });
                
                // Mousemove - –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ
                canvas.addEventListener('mousemove', (event) => {
                    if (!isDragging) return;
                    
                    raycaster.setFromCamera(mouse, camera);
                    raycaster.ray.intersectPlane(dragPlane, dragIntersectionPoint);
                    const newPos = dragIntersectionPoint.sub(dragOffset);
                    
                    if (draggedSvgIndex !== null) {
                        const svgObj = svgGroups[draggedSvgIndex];
                        
                        svgObj.group.position.x = newPos.x;
                        svgObj.group.position.y = newPos.y;
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–∞–∑–º–µ—Ä–Ω—ã–µ –ª–∏–Ω–∏–∏
                        if (svgObj.dimensionGroup) {
                            svgObj.dimensionGroup.position.x = newPos.x;
                            svgObj.dimensionGroup.position.y = newPos.y;
                        }
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–Ω–∏
                        if (svgObj.shadowClones && svgObj.shadowClones.length > 0) {
                            svgObj.shadowClones.forEach((clone) => {
                                const originalMesh = svgObj.group.children.find(m => m.userData.cloneSource === clone.uuid);
                                if (originalMesh) {
                                    clone.position.x = originalMesh.position.x + newPos.x;
                                    clone.position.y = originalMesh.position.y + newPos.y;
                                }
                            });
                        }
                        
                        updateShadowCamera();
                        updateActiveSvgHighlight();
                    } else if (draggedBaseIndex !== null) {
                        const base = bases[draggedBaseIndex];
                        if (base && base.mesh) {
                            base.mesh.position.x = newPos.x;
                            base.mesh.position.y = newPos.y;
                            base.positionX = newPos.x;
                            base.positionY = newPos.y;
                        }
                    } else if (draggedProfileIndex !== null) {
                        const profile = frameProfiles[draggedProfileIndex];
                        if (profile && profile.mesh) {
                            profile.mesh.position.x = newPos.x;
                            profile.mesh.position.y = newPos.y;
                            profile.positionX = newPos.x;
                            profile.positionY = newPos.y;
                        }
                    }
                });
                
                // Mouseup - –∫–æ–Ω–µ—Ü –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
                canvas.addEventListener('mouseup', () => {
                    if (isDragging) {
                        isDragging = false;
                        
                        let draggedName = '';
                        if (draggedSvgIndex !== null) {
                            draggedName = svgGroups[draggedSvgIndex].name;
                            draggedSvgIndex = null;
                        } else if (draggedBaseIndex !== null) {
                            draggedName = `–û—Å–Ω–æ–≤–∞ #${draggedBaseIndex + 1}`;
                            draggedBaseIndex = null;
                        } else if (draggedProfileIndex !== null) {
                            draggedName = `–ü—Ä–æ—Ñ–∏–ª—å #${draggedProfileIndex + 1}`;
                            draggedProfileIndex = null;
                        }
                        
                        controls.enabled = true;
                        canvas.style.cursor = 'grab';
                        
                        log(`‚úì –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ: ${draggedName}`, 'info');
                    }
                });
                
                // Mouseleave - –µ—Å–ª–∏ –º—ã—à—å —É—à–ª–∞ –∑–∞ –ø—Ä–µ–¥–µ–ª—ã canvas
                canvas.addEventListener('mouseleave', () => {
                    if (isDragging) {
                        isDragging = false;
                        draggedSvgIndex = null;
                        draggedBaseIndex = null;
                        draggedProfileIndex = null;
                        controls.enabled = true;
                        canvas.style.cursor = 'default';
                    }
                });
                
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫—É—Ä—Å–æ—Ä grab –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                canvas.style.cursor = 'grab';
                
                // –û—Å–≤–µ—â–µ–Ω–∏–µ (–±–µ–∑ —Ç–µ–Ω–µ–π –¥–ª—è —á–∏—Å—Ç–æ–≥–æ –≤–∏–¥–∞)
                const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
                scene.add(ambientLight);
                
                keyLight = new THREE.DirectionalLight(0xffffff, 0.5);
                keyLight.position.set(10, 3, 10);
                keyLight.castShadow = false; // –¢–ï–ù–ò –û–¢–ö–õ–Æ–ß–ï–ù–´
                // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–µ–Ω–µ–π –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–≤–µ—Ç–∞
                // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–µ–Ω–µ–π –Ω–µ –Ω—É–∂–Ω—ã (—Ç–µ–Ω–∏ –æ—Ç–∫–ª—é—á–µ–Ω—ã)
                scene.add(keyLight);
                
                const fillLight = new THREE.DirectionalLight(0xffffff, 0.3);
                fillLight.position.set(-3, -2, -5); // –ó–∞–ø–æ–ª–Ω—è—é—â–∏–π —Å–≤–µ—Ç —Å–ª–µ–≤–∞ (X: -3), —Å–Ω–∏–∑—É (Y: -2), —Å–∑–∞–¥–∏ (Z: -5)
                scene.add(fillLight);
                
                // –°—Ç–µ–Ω–∞ —Å–æ–∑–¥–∞—Å—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø–µ—Ä–≤–æ–≥–æ SVG
                // createLetterA(); // –£–ë–†–ê–õ–ò - –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω–∞ –¥–µ—Ñ–æ–ª—Ç–Ω–∞—è –±—É–∫–≤–∞
                
                // –ê–Ω–∏–º–∞—Ü–∏—è
                animate();
                
                // Resize
                window.addEventListener('resize', onResize);
                
                updateStatus('status-3d', 'success', '–°–¶–ï–ù–ê: –ì–û–¢–û–í–ê');
                log('3D —Å—Ü–µ–Ω–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞!', 'success');
            } catch (error) {
                log(`–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ 3D: ${error.message}`, 'error');
                updateStatus('status-3d', 'error', `‚ùå ${error.message}`);
            }
        }
        
        function createLetterA() {
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É addSVG()
            const svgString = `<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" width="104.698mm" height="111.803mm" viewBox="0 0 1751.52 1870.37">
<g>
<path d="M-0 1870.37l717.5 -1870.37 272.11 0 761.91 1870.37 -282.12 0 -216.38 -566.86 -787.6 0 -202.88 566.86 -262.53 0zm538.12 -768l637.39 0 -195.05 -518.53c-58.77,-157.61 -103.18,-287.78 -134.09,-390.53 -25.69,121.9 -60.08,241.63 -103.18,360.05l-205.06 549.01z"/>
</g>
</svg>`;
            
            addSVG(svgString, '–ë—É–∫–≤–∞ –ê');
            log('–ë—É–∫–≤–∞ "–ê" –¥–æ–±–∞–≤–ª–µ–Ω–∞', 'success');
        }
        
        // === –°–¢–ê–†–ê–Ø –§–£–ù–ö–¶–ò–Ø (–¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏) ===
        // === –°–¢–ê–†–ê–Ø –í–ï–†–°–ò–Ø –ù–ò–ñ–ï (–°–ö–†–´–¢–ê, –ù–û –ù–ï –£–î–ê–õ–ï–ù–ê) ===
        /* –°–¢–ê–†–ê–Ø –í–ï–†–°–ò–Ø createLetterA() - —Å–∫—Ä—ã—Ç–∞
        function createLetterA_OLD() {
            const svgString = `<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" width="104.698mm" height="111.803mm" viewBox="0 0 1751.52 1870.37">
<g>
<path d="M-0 1870.37l717.5 -1870.37 272.11 0 761.91 1870.37 -282.12 0 -216.38 -566.86 -787.6 0 -202.88 566.86 -262.53 0zm538.12 -768l637.39 0 -195.05 -518.53c-58.77,-157.61 -103.18,-287.78 -134.09,-390.53 -25.69,121.9 -60.08,241.63 -103.18,360.05l-205.06 549.01z"/>
</g>
</svg>`;
        */
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ dropdown
        function initCustomColorSelect() {
            const customSelect = document.getElementById('face-color-custom');
            const trigger = customSelect.querySelector('.custom-select-trigger');
            const options = customSelect.querySelectorAll('.custom-option');
            const hiddenInput = document.getElementById('face-color');
            
            log(`–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ dropdown: trigger=${!!trigger}, options=${options.length}`, 'info');
            
            // –û—Ç–∫—Ä—ã—Ç–∏–µ/–∑–∞–∫—Ä—ã—Ç–∏–µ dropdown
            trigger.addEventListener('click', () => {
                customSelect.classList.toggle('open');
                log(`Dropdown ${customSelect.classList.contains('open') ? '–æ—Ç–∫—Ä—ã—Ç' : '–∑–∞–∫—Ä—ã—Ç'}`, 'info');
            });
            
            // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ dropdown
            document.addEventListener('click', (e) => {
                if (!customSelect.contains(e.target)) {
                    customSelect.classList.remove('open');
                }
            });
            
            // –í—ã–±–æ—Ä –æ–ø—Ü–∏–∏
            options.forEach(option => {
                option.addEventListener('click', () => {
                    const value = option.getAttribute('data-value');
                    const text = option.textContent.trim();
                    const color = option.getAttribute('data-color');
                    
                    log(`–ö–ª–∏–∫–Ω—É—Ç–∞ –æ–ø—Ü–∏—è: ${text} (${value})`, 'info');
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –≤–∏–¥–∏–º—ã–π —Ç–µ–∫—Å—Ç —Å —Ü–≤–µ—Ç–Ω—ã–º –∫–≤–∞–¥—Ä–∞—Ç–∏–∫–æ–º
                    trigger.innerHTML = '';
                    if (color) {
                        const colorSquare = document.createElement('span');
                        colorSquare.className = 'color-square';
                        colorSquare.style.background = color;
                        if (color === '#FFFFFF') {
                            colorSquare.style.border = '1px solid #555';
                        }
                        trigger.appendChild(colorSquare);
                    }
                    const textNode = document.createTextNode(text);
                    trigger.appendChild(textNode);
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–∫—Ä—ã—Ç—ã–π input
                    hiddenInput.value = value;
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º selected –∫–ª–∞—Å—Å
                    options.forEach(opt => opt.classList.remove('selected'));
                    option.classList.add('selected');
                    
                    // –ó–∞–∫—Ä—ã–≤–∞–µ–º dropdown
                    customSelect.classList.remove('open');
                    
                    // –í—ã–∑—ã–≤–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ 3D –æ–±—ä–µ–∫—Ç–∞
                    state.faceColor = value;
                    log(`activeSvgIndex = ${activeSvgIndex}, svgGroups.length = ${svgGroups.length}`, 'info');
                    
                    if (activeSvgIndex !== null && svgGroups[activeSvgIndex]) {
                        // –û–±–Ω–æ–≤–ª—è–µ–º —Ü–≤–µ—Ç –≤ –æ–±—ä–µ–∫—Ç–µ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞
                        svgGroups[activeSvgIndex].color = value;
                        log(`üé® –¶–≤–µ—Ç –æ–±—ä–µ–∫—Ç–∞ –æ–±–Ω–æ–≤–ª—ë–Ω: ${value}`, 'info');
                        
                        updateActiveSVG();
                        log(`updateActiveSVG() –≤—ã–∑–≤–∞–Ω –ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ —Ü–≤–µ—Ç–∞`, 'info');
                    } else {
                        log(`‚ö†Ô∏è –ê–∫—Ç–∏–≤–Ω—ã–π SVG –Ω–µ –Ω–∞–π–¥–µ–Ω, —Ü–≤–µ—Ç –Ω–µ –ø—Ä–∏–º–µ–Ω–µ–Ω!`, 'warning');
                    }
                    
                    log(`–í—ã–±—Ä–∞–Ω —Ü–≤–µ—Ç: ${text} (${value})`, 'info');
                });
            });
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–µ—Ä–≤–æ–≥–æ —Ü–≤–µ—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–µ—Å–ª–∏ –Ω–µ "–û—Ä–∏–≥–∏–Ω–∞–ª –∏–∑ SVG")
            const firstColorOption = Array.from(options).find(opt => opt.getAttribute('data-color'));
            if (firstColorOption) {
                const text = firstColorOption.textContent.trim();
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º "–í—ã–±–µ—Ä–∏—Ç–µ" –∫–∞–∫ –¥–µ—Ñ–æ–ª—Ç (–±–µ–∑ –∫–≤–∞–¥—Ä–∞—Ç–∏–∫–∞)
                trigger.textContent = '–í—ã–±–µ—Ä–∏—Ç–µ';
            }
            
            log(`‚úÖ –ö–∞—Å—Ç–æ–º–Ω—ã–π dropdown –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω —Å ${options.length} –æ–ø—Ü–∏—è–º–∏`, 'success');
        }
        
        function initSideColorSelect() {
            const customSelect = document.getElementById('side-color-custom');
            const trigger = customSelect.querySelector('.custom-select-trigger');
            const options = customSelect.querySelectorAll('.custom-option');
            
            // –û—Ç–∫—Ä—ã—Ç–∏–µ/–∑–∞–∫—Ä—ã—Ç–∏–µ dropdown
            trigger.addEventListener('click', () => {
                customSelect.classList.toggle('open');
            });
            
            // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ dropdown
            document.addEventListener('click', (e) => {
                if (!customSelect.contains(e.target)) {
                    customSelect.classList.remove('open');
                }
            });
            
            // –í—ã–±–æ—Ä –æ–ø—Ü–∏–∏
            options.forEach(option => {
                option.addEventListener('click', () => {
                    const value = option.getAttribute('data-value');
                    const text = option.textContent.trim();
                    const color = option.getAttribute('data-color');
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –≤–∏–¥–∏–º—ã–π —Ç–µ–∫—Å—Ç —Å —Ü–≤–µ—Ç–Ω—ã–º –∫–≤–∞–¥—Ä–∞—Ç–∏–∫–æ–º
                    trigger.innerHTML = '';
                    if (color) {
                        const colorSquare = document.createElement('span');
                        colorSquare.className = 'color-square';
                        colorSquare.style.background = color;
                        if (color === '#FFFFFF') {
                            colorSquare.style.border = '1px solid #555';
                        }
                        trigger.appendChild(colorSquare);
                    }
                    const textNode = document.createTextNode(text);
                    trigger.appendChild(textNode);
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º selected –∫–ª–∞—Å—Å
                    options.forEach(opt => opt.classList.remove('selected'));
                    option.classList.add('selected');
                    
                    // –ó–∞–∫—Ä—ã–≤–∞–µ–º dropdown
                    customSelect.classList.remove('open');
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Ü–≤–µ—Ç –±–æ—Ä—Ç–∞
                    state.sideColor = value;
                    log(`‚úÖ –¶–≤–µ—Ç –±–æ—Ä—Ç–∞: ${text}`, 'success');
                    updateActiveSVG();
                });
            });
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–µ—Ä–≤–æ–≥–æ —Ü–≤–µ—Ç–∞ (–±–µ–ª—ã–π) –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            const firstOption = options[0];
            if (firstOption) {
                const color = firstOption.getAttribute('data-color');
                const text = firstOption.textContent.trim();
                
                trigger.innerHTML = '';
                if (color) {
                    const colorSquare = document.createElement('span');
                    colorSquare.className = 'color-square';
                    colorSquare.style.background = color;
                    if (color === '#FFFFFF') {
                        colorSquare.style.border = '1px solid #555';
                    }
                    trigger.appendChild(colorSquare);
                }
                const textNode = document.createTextNode(text);
                trigger.appendChild(textNode);
                firstOption.classList.add('selected');
            }
            
            log(`‚úÖ –ö–∞—Å—Ç–æ–º–Ω—ã–π dropdown "–¶–≤–µ—Ç –±–æ—Ä—Ç–∞" –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω —Å ${options.length} –æ–ø—Ü–∏—è–º–∏`, 'success');
        }
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ø–∞–ª–∏—Ç—Ä —Ü–≤–µ—Ç–æ–≤ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª–∞
        function updateColorPalette(materialType, acrylicColor) {
            // –†–∞–±–æ—Ç–∞–µ–º —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º dropdown
            const oracal641Group = document.getElementById('oracal-641-group');
            const oracal850Group = document.getElementById('oracal-850-group');
            const coloredAcrylicGroup = document.getElementById('colored-acrylic-group');
            const colorLabel = document.getElementById('color-label');
            const faceColorSelect = document.getElementById('face-color');
            const customSelectTrigger = document.querySelector('#face-color-custom .custom-select-trigger');
            
            // –ù–∞—Ö–æ–¥–∏–º —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π div —Å –ø–∞–ª–∏—Ç—Ä–æ–π —Ü–≤–µ—Ç–æ–≤
            const colorFieldGroup = colorLabel?.parentElement;
            
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –≥—Ä—É–ø–ø—ã –≤–Ω—É—Ç—Ä–∏ –ø–∞–ª–∏—Ç—Ä—ã
            if (oracal641Group) oracal641Group.style.display = 'none';
            if (oracal850Group) oracal850Group.style.display = 'none';
            if (coloredAcrylicGroup) coloredAcrylicGroup.style.display = 'none';
            
            if (materialType === 'acrylic') {
                // –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω —Ü–≤–µ—Ç–Ω–æ–π –∞–∫—Ä–∏–ª (–Ω–µ –º–æ–ª–æ—á–Ω—ã–π) - —Å–∫—Ä—ã–≤–∞–µ–º –ø–∞–ª–∏—Ç—Ä—É –ø–æ–ª–Ω–æ—Å—Ç—å—é
                if (acrylicColor && acrylicColor !== 'milk') {
                    // –¶–≤–µ—Ç–Ω–æ–π –∞–∫—Ä–∏–ª - –ø–∞–ª–∏—Ç—Ä–∞ –Ω–µ –Ω—É–∂–Ω–∞
                    if (colorFieldGroup) colorFieldGroup.style.display = 'none';
                    log('–¶–≤–µ—Ç–Ω–æ–π –∞–∫—Ä–∏–ª –≤—ã–±—Ä–∞–Ω - –ø–∞–ª–∏—Ç—Ä–∞ —Å–∫—Ä—ã—Ç–∞', 'info');
                } else {
                    // –ú–æ–ª–æ—á–Ω—ã–π –∞–∫—Ä–∏–ª - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–∞–ª–∏—Ç—Ä—É Oracal 8500
                    if (colorFieldGroup) colorFieldGroup.style.display = 'block';
                    if (oracal850Group) oracal850Group.style.display = 'block';
                    if (coloredAcrylicGroup) coloredAcrylicGroup.style.display = 'block';
                    colorLabel.textContent = '–¶–≤–µ—Ç –∞–∫—Ä–∏–ª–∞';
                    log('–î–æ—Å—Ç—É–ø–Ω—ã: Oracal 850 (–º–æ–ª–æ—á–Ω—ã–π) –∏ —Ü–≤–µ—Ç–Ω–æ–π –∞–∫—Ä–∏–ª', 'info');
                }
            } else {
                // –î–ª—è –ü–í–•/–ö–æ–º–ø–æ–∑–∏—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ Oracal 641
                if (colorFieldGroup) colorFieldGroup.style.display = 'block';
                if (oracal641Group) oracal641Group.style.display = 'block';
                colorLabel.textContent = '–¶–≤–µ—Ç (–ø–ª–µ–Ω–∫–∞ Oracal 641)';
                log('–î–æ—Å—Ç—É–ø–Ω–∞: Oracal 641 (–Ω–µ—Å–≤–µ—Ç–æ–≤–∞—è)', 'info');
            }
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–±–æ—Ä –Ω–∞ "–í—ã–±–µ—Ä–∏—Ç–µ" –ø—Ä–∏ —Å–º–µ–Ω–µ –º–∞—Ç–µ—Ä–∏–∞–ª–∞
            faceColorSelect.value = 'original';
            state.faceColor = 'original';
            if (customSelectTrigger) {
                customSelectTrigger.textContent = '–í—ã–±–µ—Ä–∏—Ç–µ';
            }
            
            // –£–±–∏—Ä–∞–µ–º selected –∫–ª–∞—Å—Å —Å–æ –≤—Å–µ—Ö –æ–ø—Ü–∏–π
            document.querySelectorAll('.custom-option').forEach(opt => opt.classList.remove('selected'));
        }
        
        // –û–±—ë—Ä—Ç–∫–∞ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å–æ —Å—Ç–∞—Ä—ã–º –∫–æ–¥–æ–º
        function update3DLetter() {
            updateActiveSVG();
        }
        
        /* –°–¢–ê–†–´–ô –ö–û–î update3DLetter() - —É–¥–∞–ª—ë–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è updateActiveSVG()
            if (!letterGroup) return;
            
            const { construction, faceMaterial, faceColor, sideMaterial, sideColor, bortHeight, hasBacklight, svgRealSize } = state;
            
            // –†–ï–ê–õ–¨–ù–´–ï –ü–†–û–ü–û–†–¶–ò–ò!
            // 3D –º–æ–¥–µ–ª—å –∏–º–µ–µ—Ç –≤—ã—Å–æ—Ç—É ~18 –µ–¥–∏–Ω–∏—Ü (targetHeight)
            // –†–µ–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞ SVG –≤ –º–º: svgRealSize.height
            const targetHeight = 18; // –≤—ã—Å–æ—Ç–∞ 3D –º–æ–¥–µ–ª–∏
            
            let depth;
            if (construction === 'volumetric') {
                // –í—ã—Å–æ—Ç–∞ –±–æ—Ä—Ç–∞ –≤ –º–º ‚Üí –ø—Ä–æ–ø–æ—Ä—Ü–∏—è –æ—Ç –≤—ã—Å–æ—Ç—ã –±—É–∫–≤—ã
                // –ù–∞–ø—Ä–∏–º–µ—Ä: –±–æ—Ä—Ç 80–º–º –ø—Ä–∏ –±—É–∫–≤–µ 111–º–º –≤—ã—Å–æ—Ç–æ–π = 80/111 * 18 = 12.97 –µ–¥–∏–Ω–∏—Ü
                depth = (bortHeight || 80) / svgRealSize.height * targetHeight;
                log(`–ë–æ—Ä—Ç: ${bortHeight}–º–º / ${svgRealSize.height.toFixed(1)}–º–º * ${targetHeight} = ${depth.toFixed(2)} –µ–¥`, 'info');
            } else {
                // –¢–æ–ª—â–∏–Ω–∞ –ª–∏—Ü–∞ –≤ –º–º ‚Üí –ø—Ä–æ–ø–æ—Ä—Ü–∏—è –æ—Ç –≤—ã—Å–æ—Ç—ã –±—É–∫–≤—ã
                // –ù–∞–ø—Ä–∏–º–µ—Ä: –ª–∏—Ü–æ 4–º–º –ø—Ä–∏ –±—É–∫–≤–µ 111–º–º –≤—ã—Å–æ—Ç–æ–π = 4/111 * 18 = 0.65 –µ–¥–∏–Ω–∏—Ü
                const faceThicknessMm = faceMaterial.thickness || 3;
                depth = faceThicknessMm / svgRealSize.height * targetHeight;
                log(`–õ–∏—Ü–æ: ${faceThicknessMm}–º–º / ${svgRealSize.height.toFixed(1)}–º–º * ${targetHeight} = ${depth.toFixed(3)} –µ–¥`, 'info');
            }
            
            // –û–ü–†–ï–î–ï–õ–Ø–ï–ú –¶–í–ï–¢ –ë–û–†–¢–ê (–ë–û–ö–û–í–ò–ù–´)
            let actualSideColor = sideColor;
            
            if (construction === 'flat') {
                // –î–ª—è –ø–ª–æ—Å–∫–∏—Ö –±—É–∫–≤ —Ü–≤–µ—Ç –±–æ—Ä—Ç–∞ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª–∞ –ª–∏—Ü–∞:
                if (faceMaterial.type === 'pvc') {
                    actualSideColor = '#FFFFFF'; // –ü–í–• ‚Üí –±–µ–ª—ã–π –±–æ—Ä—Ç
                } else if (faceMaterial.type === 'composite') {
                    actualSideColor = '#000000'; // –ö–æ–º–ø–æ–∑–∏—Ç ‚Üí —á—ë—Ä–Ω—ã–π –±–æ—Ä—Ç
                }
                // –ê–∫—Ä–∏–ª –Ω–µ –±—ã–≤–∞–µ—Ç –ø–ª–æ—Å–∫–∏–º (—Ç–æ–ª—å–∫–æ –æ–±—ä—ë–º–Ω—ã–π)
            }
            
            // –û–ü–†–ï–î–ï–õ–Ø–ï–ú –¶–í–ï–¢ –ó–ê–î–ù–ï–ô –ß–ê–°–¢–ò (BACK FACE)
            let backFaceColor = '#FFFFFF'; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –±–µ–ª—ã–π
            
            if (faceMaterial.type === 'pvc') {
                backFaceColor = '#FFFFFF'; // –ü–í–• ‚Üí –±–µ–ª–∞—è –∑–∞–¥–Ω—è—è —á–∞—Å—Ç—å
            } else if (faceMaterial.type === 'composite') {
                backFaceColor = '#8B9B86'; // –ö–æ–º–ø–æ–∑–∏—Ç ‚Üí —Å–µ—Ä–æ-–∑–µ–ª—ë–Ω–∞—è –∑–∞–¥–Ω—è—è —á–∞—Å—Ç—å
            } else if (faceMaterial.type === 'acrylic') {
                backFaceColor = '#FFFFFF'; // –ê–∫—Ä–∏–ª ‚Üí –±–µ–ª–∞—è –∑–∞–¥–Ω—è—è —á–∞—Å—Ç—å
            }
            
            log(`–¶–≤–µ—Ç –∑–∞–¥–Ω–∏–∫–∞: ${backFaceColor} (–º–∞—Ç–µ—Ä–∏–∞–ª: ${faceMaterial.type})`, 'info');
            
            letterGroup.children.forEach(mesh => {
                if (mesh.geometry) {
                    mesh.scale.z = depth;
                }
                
                if (Array.isArray(mesh.material) && mesh.material.length >= 2) {
                    const faceMat = mesh.material[0];  // –õ–∏—Ü–æ+–∑–∞–¥–Ω–∏–∫ (front+back face, materialIndex 0)
                    const sideMat = mesh.material[1];  // –ë–æ—Ä—Ç (side, materialIndex 1)
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º geometry groups
                    if (mesh.geometry && mesh.geometry.groups) {
                        console.log('[DEBUG] Geometry groups:', mesh.geometry.groups);
                    }
                    console.log('[DEBUG] –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –≤ –º–∞—Å—Å–∏–≤–µ:', mesh.material.length);
                    console.log('[DEBUG] –¶–≤–µ—Ç–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –î–û –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:', {
                        face: '#' + faceMat.color.getHexString(),
                        side: sideMat ? '#' + sideMat.color.getHexString() : 'undefined'
                    });
                    
                    // –û–ü–†–ï–î–ï–õ–Ø–ï–ú –¶–í–ï–¢ –õ–ò–¶–ê: –µ—Å–ª–∏ "–æ—Ä–∏–≥–∏–Ω–∞–ª" - –±–µ—Ä—ë–º –∏–∑ userData, –∏–Ω–∞—á–µ –∏–∑ UI
                    let actualFaceColor;
                    if (faceColor === 'original') {
                        // –ï—Å–ª–∏ —Ä–µ–∂–∏–º "–û—Ä–∏–≥–∏–Ω–∞–ª" - –±–µ—Ä—ë–º —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–π —Ü–≤–µ—Ç –∏–∑ userData
                        actualFaceColor = mesh.userData.originalFaceColor || '#FFFFFF';
                    } else {
                        // –ò–Ω–∞—á–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ü–≤–µ—Ç –∏–∑ UI
                        actualFaceColor = faceColor;
                    }
                    
                    faceMat.color.setStyle(actualFaceColor);
                    
                    // –°–≤–æ–π—Å—Ç–≤–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–∞ –ª–∏—Ü–∞
                    if (faceMaterial.type === 'acrylic') {
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–∏ –ø–ª–µ–Ω–∫–∞ Oracal 8500 (–º–∞—Ç–æ–≤–∞—è/—Ç—Ä–∞–Ω—Å–ª—é—Ü–µ–Ω—Ç–Ω–∞—è)
                        const faceColorValue = document.getElementById('face-color').value;
                        const selectedCustomOption = document.querySelector(`.custom-option[data-value="${faceColorValue}"]`);
                        const isOracal8500 = selectedCustomOption && 
                                            selectedCustomOption.closest('#oracal-850-group') !== null;
                        
                        if (isOracal8500) {
                            // Oracal 8500 - –º–∞—Ç–æ–≤–∞—è —Ç—Ä–∞–Ω—Å–ª—é—Ü–µ–Ω—Ç–Ω–∞—è –ø–ª–µ–Ω–∫–∞
                            faceMat.roughness = 0.7;
                            faceMat.metalness = 0.05;
                        } else {
                            // –ì–ª—è–Ω—Ü–µ–≤—ã–π —Ü–≤–µ—Ç–Ω–æ–π –∞–∫—Ä–∏–ª
                            faceMat.roughness = 0.2;
                            faceMat.metalness = 0.1;
                        }
                        
                        // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–∫—Ä–∏–ª–∞
                        if (hasBacklight) {
                            faceMat.emissive.setStyle(actualFaceColor);
                            faceMat.emissiveIntensity = 0.5;
                        } else {
                            faceMat.emissive.setHex(0x000000);
                            faceMat.emissiveIntensity = 0;
                        }
                    } else if (faceMaterial.type === 'pvc') {
                        faceMat.roughness = 0.8;
                        faceMat.metalness = 0.05;
                        faceMat.emissive.setHex(0x000000);
                        faceMat.emissiveIntensity = 0;
                    } else if (faceMaterial.type === 'composite') {
                        faceMat.roughness = 0.6;
                        faceMat.metalness = 0.15;
                        faceMat.emissive.setHex(0x000000);
                        faceMat.emissiveIntensity = 0;
                    }
                    
                    // –ë–æ—Ä—Ç (–∏—Å–ø–æ–ª—å–∑—É–µ–º actualSideColor!)
                    if (sideMat) {
                        sideMat.color.setStyle(actualSideColor);
                        
                        // –ü—Ä–∏ –∫–æ–Ω—Ç—Ä–∞–∂—É—Ä–µ –±–æ—Ä—Ç –ù–ï –¥–æ–ª–∂–µ–Ω —Å–≤–µ—Ç–∏—Ç—å—Å—è - –¥–µ–ª–∞–µ–º –º–∞—Ç–æ–≤—ã–º
                        if (state.hasContour) {
                            sideMat.roughness = 1.0; // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –º–∞—Ç–æ–≤—ã–π
                            sideMat.metalness = 0;
                        } else {
                            sideMat.roughness = 0.7;
                            sideMat.metalness = 0.1;
                        }
                        
                        sideMat.emissive.setHex(0x000000);
                        sideMat.emissiveIntensity = 0;
                        sideMat.needsUpdate = true; // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º –º–∞—Ç–µ—Ä–∏–∞–ª
                    }
                    
                    console.log('[DEBUG] –¶–≤–µ—Ç–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –ü–û–°–õ–ï –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:', {
                        face: '#' + faceMat.color.getHexString(),
                        side: sideMat ? '#' + sideMat.color.getHexString() : 'undefined'
                    });
                }
            });
            
            log('3D –º–æ–¥–µ–ª—å –æ–±–Ω–æ–≤–ª–µ–Ω–∞', 'info');
            
            // –ü–µ—Ä–µ—Å–æ–∑–¥–∞—ë–º —Å—Ç–µ–Ω—É –ø–æ–¥ —Ä–∞–∑–º–µ—Ä –±—É–∫–≤
            createWall();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª–æ–∂–µ–Ω–∏–µ –±—É–∫–≤ –∏ –ø–æ–¥—Å–≤–µ—Ç–∫—É
            updateWallAndShadows();
            */
        
        // === –°–¢–ï–ù–ê (–°–û–ó–î–ê–Å–¢–°–Ø –ü–û–î –†–ê–ó–ú–ï–† –ë–£–ö–í) ===
        function createWall() {
            // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—É—é —Å—Ç–µ–Ω—É
            if (backWall) {
                scene.remove(backWall);
                backWall = null;
            }
            
            if (svgGroups.length === 0) return;
            
            // –í–´–ß–ò–°–õ–Ø–ï–ú –†–ê–ó–ú–ï–† –°–¢–ï–ù–´ –ù–ê –û–°–ù–û–í–ï –í–°–ï–• SVG –û–ë–™–ï–ö–¢–û–í –ò –ò–• –ü–û–ó–ò–¶–ò–ô
            const box = new THREE.Box3();
            
            // –£—á–∏—Ç—ã–≤–∞–µ–º –≤—Å–µ –æ–±—ä–µ–∫—Ç—ã –∏ –∏—Ö –ø–æ–∑–∏—Ü–∏–∏
            svgGroups.forEach(svgObj => {
                if (svgObj.group) {
                    // –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π Box3 –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –æ–±—ä–µ–∫—Ç–∞
                    const objBox = new THREE.Box3().setFromObject(svgObj.group);
                    box.union(objBox);
                }
                
                // –¢–∞–∫–∂–µ —É—á–∏—Ç—ã–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä–Ω—ã–µ –ª–∏–Ω–∏–∏, –µ—Å–ª–∏ –æ–Ω–∏ –≤–∏–¥–Ω—ã
                if (svgObj.dimensionGroup && svgObj.dimensionsVisible !== false) {
                    const dimBox = new THREE.Box3().setFromObject(svgObj.dimensionGroup);
                    box.union(dimBox);
                }
            });
            
            const width = box.max.x - box.min.x;
            const height = box.max.y - box.min.y;
            const padding = 30; // –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π –æ—Ç—Å—Ç—É–ø –¥–ª—è —Ä–∞–∑–º–µ—Ä–Ω—ã—Ö –ª–∏–Ω–∏–π –∏ —Ç–µ–Ω–µ–π
            
            // –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã —Å—Ç–µ–Ω—ã (–¥–ª—è –º–∞–ª–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –æ–±—ä–µ–∫—Ç–æ–≤)
            const minWallWidth = 250;
            const minWallHeight = 150;
            
            const wallWidth = Math.max(width + padding * 2, minWallWidth);
            const wallHeight = Math.max(height + padding * 2, minWallHeight);
            
            const wallGeometry = new THREE.PlaneGeometry(wallWidth, wallHeight);
            const wallMaterial = new THREE.MeshStandardMaterial({
                color: state.wallColor, // –¶–≤–µ—Ç —Å—Ç–µ–Ω—ã –∏–∑ state
                roughness: 0.9,
                metalness: 0.05
            });
            
            backWall = new THREE.Mesh(wallGeometry, wallMaterial);
            backWall.visible = state.showWall;
            
            // –¶–ï–ù–¢–†–ò–†–£–ï–ú –°–¢–ï–ù–£ –û–¢–ù–û–°–ò–¢–ï–õ–¨–ù–û –í–°–ï–• –û–ë–™–ï–ö–¢–û–í
            const centerX = (box.max.x + box.min.x) / 2;
            const centerY = (box.max.y + box.min.y) / 2;
            
            // –°–¢–ï–ù–ê –°–¢–ê–¢–ò–ß–ù–ê - –§–ò–ö–°–ò–†–û–í–ê–ù–ù–ê–Ø –ü–û–ó–ò–¶–ò–Ø Z = -10, –Ω–æ —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∞ –ø–æ X –∏ Y
            backWall.position.set(centerX, centerY, -10);
            
            backWall.receiveShadow = true;
            scene.add(backWall);
            log(`üß± –°—Ç–µ–Ω–∞: ${wallWidth.toFixed(0)}√ó${wallHeight.toFixed(0)} –µ–¥, —Ü–µ–Ω—Ç—Ä: (${centerX.toFixed(1)}, ${centerY.toFixed(1)}, -10)`, 'info');
        }
        
        // === –°–û–ó–î–ê–ù–ò–ï –ü–õ–û–°–ö–ò–• –î–£–ë–õ–ò–ö–ê–¢–û–í –ë–£–ö–í (–ò–ú–ò–¢–ê–¶–ò–Ø –¢–ï–ù–ò) ===
        function createShadowClones(mode) {
            // mode: 'contour' (—è—Ä–∫–∞—è —Ä–∞–∑–º—ã—Ç–∞—è) –∏–ª–∏ 'spacers' (—Ç—ë–º–Ω–∞—è —Ä–∞–∑–º—ã—Ç–∞—è)
            
            // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –∫–ª–æ–Ω—ã
            if (shadowClones) {
                shadowClones.forEach(clone => scene.remove(clone));
            }
            shadowClones = [];
            
            // –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –±–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è - –∏—Å–ø–æ–ª—å–∑—É–µ–º createShadowClonesForSVG()
            console.warn('[DEPRECATED] createShadowClones() –≤—ã–∑–≤–∞–Ω–∞, –Ω–æ –¥–æ–ª–∂–Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è createShadowClonesForSVG()');
            return;
            
            // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –∫–æ–Ω—Ç—É—Ä–∞ —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º
            let cloneColor, blurLayers, blurStep, maxOpacity;
            if (mode === 'contour') {
                cloneColor = 0xFFFFFF; // –ë–µ–ª—ã–π –¥–ª—è –∫–æ–Ω—Ç—Ä–∞–∂—É—Ä–∞
                blurLayers = 16;       // –£–≤–µ–ª–∏—á–∏–ª–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ª–æ–µ–≤ –¥–ª—è –±–æ–ª—å—à–µ–≥–æ —Å–≤–µ—á–µ–Ω–∏—è
                blurStep = 0.008;      
                maxOpacity = 0.12;     
            } else {
                cloneColor = 0x202020; // –¢—ë–º–Ω–æ-—Å–µ—Ä—ã–π –¥–ª—è –¥–∏—Å—Ç–∞–Ω—Ü–∏–æ–Ω–æ–∫
                blurLayers = 16;       // –£–≤–µ–ª–∏—á–∏–ª–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ª–æ–µ–≤
                blurStep = 0.008;      
                maxOpacity = 0.07;     
            }

            // –î–ª—è –∫–∞–∂–¥–æ–π –±—É–∫–≤—ã —Å–æ–∑–¥–∞—ë–º —Ç–µ–Ω—å —Å –≤–Ω–µ—à–Ω–∏–º –∫–æ–Ω—Ç—É—Ä–æ–º
            letterGroup.children.forEach(mesh => {
                if (!mesh.geometry) return;
                
                // –í—ã—á–∏—Å–ª—è–µ–º –≤–∏–∑—É–∞–ª—å–Ω—ã–π —Ü–µ–Ω—Ç—Ä –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–π –±—É–∫–≤—ã –æ–¥–∏–Ω —Ä–∞–∑
                mesh.geometry.computeBoundingBox();
                const bbox = mesh.geometry.boundingBox;
                const geomCenterX = (bbox.max.x + bbox.min.x) / 2;
                const geomCenterY = (bbox.max.y + bbox.min.y) / 2;

                for (let i = 0; i < blurLayers; i++) {
                    const cloneGeometry = mesh.geometry.clone();
                    cloneGeometry.center(); // –¶–ï–ù–¢–†–ò–†–£–ï–ú –ì–ï–û–ú–ï–¢–†–ò–Æ: —Ç–µ–ø–µ—Ä—å (0,0,0) ‚Äî —ç—Ç–æ –≤–∏–∑—É–∞–ª—å–Ω—ã–π —Ü–µ–Ω—Ç—Ä
                    
                    // –ú–∞—Å—à—Ç–∞–±: –¥–ª—è –∫–æ–Ω—Ç—Ä–∞–∂—É—Ä–∞ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –±—É–¥–µ—Ç +7.5%, –¥–ª—è —Ç–µ–Ω–µ–π +15%
                    const scale = 1.0 + (i * blurStep);
                    
                    // –ì—Ä–∞–¥–∏–µ–Ω—Ç –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏
                    const opacity = maxOpacity - (i / (blurLayers - 1)) * (maxOpacity * 0.9);
                    
                    const shadowMaterial = new THREE.MeshBasicMaterial({
                        color: cloneColor,
                        transparent: true,
                        opacity: opacity,
                        side: THREE.DoubleSide,
                        depthWrite: false,
                        depthTest: true
                    });
                    
                    const clone = new THREE.Mesh(cloneGeometry, shadowMaterial);
                    const hasBase = bases && bases.length > 0;
                    clone.visible = state.showWall || hasBase; // –¢–µ–Ω–∏ –≤–∏–¥–Ω—ã –µ—Å–ª–∏ –µ—Å—Ç—å —Å—Ç–µ–Ω–∞ –ò–õ–ò –æ—Å–Ω–æ–≤–∞
                    
                    // –ö–æ–ø–∏—Ä—É–µ–º –ø–æ–≤–æ—Ä–æ—Ç
                    clone.rotation.copy(mesh.rotation);
                    
                    // –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º –æ—Ç —Ü–µ–Ω—Ç—Ä–∞
                    clone.scale.set(
                        mesh.scale.x * scale,
                        mesh.scale.y * scale,
                        0.001
                    );
                    
                    // –ü–æ–º–µ—â–∞–µ–º –Ω–∞ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç—å —Å—Ç–µ–Ω—ã –ò–õ–ò –æ—Å–Ω–æ–≤—ã
                    clone.position.x = mesh.position.x + geomCenterX * mesh.scale.x;
                    clone.position.y = mesh.position.y + geomCenterY * mesh.scale.y;
                    
                    if (hasBase) {
                        const baseFrameDepth = getMaxBaseFrameDepth();
                        const baseBend = getMaxBaseBend();
                        const baseThickness = getBaseThicknessInScene();
                        clone.position.z = -10 + baseFrameDepth + baseBend + baseThickness + 0.02 + (i * 0.002);
                    } else {
                        clone.position.z = -depth + 0.001 + (i * 0.001);
                    }

                    scene.add(clone);
                    shadowClones.push(clone);
                }
            });
            
            const modeText = mode === 'contour' ? '—è—Ä–∫–∏–µ (–∫–æ–Ω—Ç—Ä–∞–∂—É—Ä)' : '—Ç—ë–º–Ω—ã–µ (–¥–∏—Å—Ç–∞–Ω—Ü–∏–æ–Ω–∫–∏)';
            log(`–ü–ª–æ—Å–∫–∏–µ –∫–ª–æ–Ω—ã —Å–æ–∑–¥–∞–Ω—ã: ${shadowClones.length} —à—Ç. (${modeText})`, 'info');
        }
        
        // === –°–û–ó–î–ê–ù–ò–ï –ü–õ–û–°–ö–ò–• –î–£–ë–õ–ò–ö–ê–¢–û–í –î–õ–Ø –ö–û–ù–ö–†–ï–¢–ù–û–ì–û SVG ===
        function createShadowClonesForSVG(svgObj, mode) {
            // mode: 'contour' (—è—Ä–∫–∞—è —Ä–∞–∑–º—ã—Ç–∞—è) –∏–ª–∏ 'spacers' (—Ç—ë–º–Ω–∞—è —Ä–∞–∑–º—ã—Ç–∞—è)
            
            // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –∫–ª–æ–Ω—ã —ç—Ç–æ–≥–æ SVG
            if (svgObj.shadowClones && svgObj.shadowClones.length > 0) {
                svgObj.shadowClones.forEach(clone => scene.remove(clone));
            }
            svgObj.shadowClones = [];
            
            if (!svgObj.group || !backWall) return;
            
            const depth = svgObj.group.children[0] ? Math.abs(svgObj.group.children[0].scale.z) : 0.5;
            const currentLetterZ = svgObj.group.position.z || 0;
            
            // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –∫–æ–Ω—Ç—É—Ä–∞ —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º
            let cloneColor, blurLayers, blurStep, maxOpacity;
            if (mode === 'contour') {
                cloneColor = 0xFFFFFF; // –ë–µ–ª—ã–π –¥–ª—è –∫–æ–Ω—Ç—Ä–∞–∂—É—Ä–∞
                blurLayers = 16;       
                blurStep = 0.008;      
                maxOpacity = 0.12;     
            } else {
                cloneColor = 0x202020; // –¢—ë–º–Ω–æ-—Å–µ—Ä—ã–π –¥–ª—è –¥–∏—Å—Ç–∞–Ω—Ü–∏–æ–Ω–æ–∫
                blurLayers = 16;       
                blurStep = 0.008;      
                maxOpacity = 0.07;     
            }

            // –î–ª—è –∫–∞–∂–¥–æ–π –±—É–∫–≤—ã —Å–æ–∑–¥–∞—ë–º —Ç–µ–Ω—å —Å –≤–Ω–µ—à–Ω–∏–º –∫–æ–Ω—Ç—É—Ä–æ–º
            svgObj.group.children.forEach(mesh => {
                if (!mesh.geometry) return;
                
                // –í—ã—á–∏—Å–ª—è–µ–º –≤–∏–∑—É–∞–ª—å–Ω—ã–π —Ü–µ–Ω—Ç—Ä –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–π –±—É–∫–≤—ã –æ–¥–∏–Ω —Ä–∞–∑
                mesh.geometry.computeBoundingBox();
                const bbox = mesh.geometry.boundingBox;
                const geomCenterX = (bbox.max.x + bbox.min.x) / 2;
                const geomCenterY = (bbox.max.y + bbox.min.y) / 2;

                for (let i = 0; i < blurLayers; i++) {
                    const cloneGeometry = mesh.geometry.clone();
                    cloneGeometry.center(); // –¶–ï–ù–¢–†–ò–†–£–ï–ú –ì–ï–û–ú–ï–¢–†–ò–Æ
                    
                    const scale = 1.0 + (i * blurStep);
                    const opacity = maxOpacity - (i / (blurLayers - 1)) * (maxOpacity * 0.9);
                    
                    const shadowMaterial = new THREE.MeshBasicMaterial({
                        color: cloneColor,
                        transparent: true,
                        opacity: opacity,
                        side: THREE.DoubleSide,
                        depthWrite: false,
                        depthTest: true
                    });
                    
                    const clone = new THREE.Mesh(cloneGeometry, shadowMaterial);
                    // –¢–µ–Ω–∏ –≤–∏–¥–Ω—ã –µ—Å–ª–∏ –µ—Å—Ç—å —Å—Ç–µ–Ω–∞ –ò–õ–ò –æ—Å–Ω–æ–≤–∞ (–æ—Å–Ω–æ–≤–∞ = –Ω–æ–≤–∞—è "—Å—Ç–µ–Ω–∞")
                    const hasBase = bases && bases.length > 0;
                    clone.visible = state.showWall || hasBase;
                    
                    // –ö–æ–ø–∏—Ä—É–µ–º –ø–æ–≤–æ—Ä–æ—Ç
                    clone.rotation.copy(mesh.rotation);
                    
                    // –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º –æ—Ç —Ü–µ–Ω—Ç—Ä–∞ (—Å —É—á–µ—Ç–æ–º –º–∞—Å—à—Ç–∞–±–∞ –≥—Ä—É–ø–ø—ã!)
                    const groupScaleX = svgObj.group.scale.x;
                    const groupScaleY = svgObj.group.scale.y;
                    clone.scale.set(
                        mesh.scale.x * scale * groupScaleX,
                        mesh.scale.y * scale * groupScaleY,
                        0.001
                    );
                    
                    // –ü–æ–º–µ—â–∞–µ–º —Ç–æ—á–Ω–æ –Ω–∞ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç—å —Å—Ç–µ–Ω—ã (—Å —É—á—ë—Ç–æ–º –ø–æ–∑–∏—Ü–∏–∏ SVG –∏ –º–∞—Å—à—Ç–∞–±–∞ –≥—Ä—É–ø–ø—ã)
                    clone.position.x = mesh.position.x * groupScaleX + geomCenterX * mesh.scale.x * groupScaleX + svgObj.position.x;
                    clone.position.y = mesh.position.y * groupScaleY + geomCenterY * mesh.scale.y * groupScaleY + svgObj.position.y;
                    // –ù–∞ –ü–ï–†–ï–î–ù–ï–ô –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏ –æ—Å–Ω–æ–≤—ã (—É—á–∏—Ç—ã–≤–∞–µ–º –ö–ê–†–ö–ê–°!)
                    // –°–ª–æ–∏ –æ—Ç —Å—Ç–µ–Ω—ã: –ö–ê–†–ö–ê–° ‚Üí –ó–ê–ì–ò–ë ‚Üí –û–°–ù–û–í–ê ‚Üí –ö–õ–û–ù–´ ‚Üí –ë–£–ö–í–´
                    const baseFrameDepth = getMaxBaseFrameDepth(); // –ì–ª—É–±–∏–Ω–∞ –∫–∞—Ä–∫–∞—Å–∞
                    const baseBend = getMaxBaseBend(); // –ó–∞–≥–∏–± –æ—Å–Ω–æ–≤—ã
                    const baseThickness = getBaseThicknessInScene(); // –¢–æ–ª—â–∏–Ω–∞ –æ—Å–Ω–æ–≤—ã
                    // –ö–ª–æ–Ω—ã –Ω–∞ –ø–µ—Ä–µ–¥–Ω–µ–π –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏ –æ—Å–Ω–æ–≤—ã (–∫–∞—Ä–∫–∞—Å + –∑–∞–≥–∏–± + –æ—Å–Ω–æ–≤–∞ + offset)
                    clone.position.z = -10 + baseFrameDepth + baseBend + baseThickness + 0.02 + (i * 0.002);

                    scene.add(clone);
                    svgObj.shadowClones.push(clone);
                }
            });
            
            const modeText = mode === 'contour' ? '—è—Ä–∫–∏–µ (–∫–æ–Ω—Ç—Ä–∞–∂—É—Ä)' : '—Ç—ë–º–Ω—ã–µ (–¥–∏—Å—Ç–∞–Ω—Ü–∏–æ–Ω–∫–∏)';
            log(`–ü–ª–æ—Å–∫–∏–µ –∫–ª–æ–Ω—ã –¥–ª—è "${svgObj.name}": ${svgObj.shadowClones.length} —à—Ç. (${modeText})`, 'info');
        }
        
        // === –°–û–ó–î–ê–ù–ò–ï –ö–ê–†–ö–ê–°–ê –î–õ–Ø –û–°–ù–û–í–´ ===
        function createBaseFrame(baseWidth, baseHeight, profileSize, color, baseThickness, baseBend, posX = 0, posY = 0) {
            // –ú–∞—Å—à—Ç–∞–± —Å—Ü–µ–Ω—ã
            const SCENE_SCALE = 0.1; // 10–º–º = 1 –µ–¥–∏–Ω–∏—Ü–∞
            
            // –†–∞–∑–º–µ—Ä –∫–∞—Ä–∫–∞—Å–∞ = –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π —Ä–∞–∑–º–µ—Ä –æ—Å–Ω–æ–≤—ã
            // –ï—Å–ª–∏ –µ—Å—Ç—å –∑–∞–≥–∏–±—ã - —Ä–∞–∑–º–µ—Ä –º–µ–∂–¥—É –±–æ—Ä—Ç–∏–∫–∞–º–∏
            // –ï—Å–ª–∏ –Ω–µ—Ç –∑–∞–≥–∏–±–æ–≤ - –æ—Å–Ω–æ–≤–∞ –º–∏–Ω—É—Å 8–º–º (–ø–æ 4–º–º —Å –∫–∞–∂–¥–æ–π —Å—Ç–æ—Ä–æ–Ω—ã)
            let frameWidth, frameHeight;
            if (baseBend > 0) {
                // –ü-–æ–±—Ä–∞–∑–Ω–∞—è –æ—Å–Ω–æ–≤–∞: –∫–∞—Ä–∫–∞—Å = –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π —Ä–∞–∑–º–µ—Ä (–º–∏–Ω—É—Å —Ç–æ–ª—â–∏–Ω–∞ –±–æ—Ä—Ç–∏–∫–æ–≤ —Å –æ–±–µ–∏—Ö —Å—Ç–æ—Ä–æ–Ω)
                frameWidth = baseWidth - (baseThickness * 2);
                frameHeight = baseHeight - (baseThickness * 2);
            } else {
                // –ü–ª–æ—Å–∫–∞—è –æ—Å–Ω–æ–≤–∞: –∫–∞—Ä–∫–∞—Å –º–µ–Ω—å—à–µ –Ω–∞ 8–º–º
                frameWidth = baseWidth - 8;
                frameHeight = baseHeight - 8;
            }
            
            // –†–∞–∑–º–µ—Ä –ø—Ä–æ—Ñ–∏–ª—è (–ø–∞—Ä—Å–∏–º –∏–∑ —Å—Ç—Ä–æ–∫–∏ "20x20" –∏–ª–∏ "40x20")
            const parts = profileSize.split('x');
            const profileSizeMm = parseInt(parts[0]); // –®–∏—Ä–∏–Ω–∞/–≤—ã—Å–æ—Ç–∞ –ø—Ä–æ—Ñ–∏–ª—è
            const profileDepth = parseInt(parts[1] || parts[0]); // –ì–ª—É–±–∏–Ω–∞ –∫ —Å—Ç–µ–Ω–µ (–µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–∞ = —à–∏—Ä–∏–Ω–µ)
            
            // –¶–≤–µ—Ç –∫–∞—Ä–∫–∞—Å–∞
            const frameColorHex = color.replace('#', '0x');
            const frameColorNum = parseInt(frameColorHex, 16);
            const material = new THREE.MeshStandardMaterial({
                color: frameColorNum,
                metalness: 0.3,
                roughness: 0.7
            });
            
            const group = new THREE.Group();
            
            // 1. –í–µ—Ä—Ö–Ω—è—è –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è —Ä–∞–º–∞ (–Ω–∞ –≤—Å—é —à–∏—Ä–∏–Ω—É)
            const topGeo = new THREE.BoxGeometry(
                frameWidth * SCENE_SCALE,
                profileSizeMm * SCENE_SCALE,
                profileDepth * SCENE_SCALE
            );
            const topMesh = new THREE.Mesh(topGeo, material.clone());
            topMesh.position.set(0, ((frameHeight / 2) - (profileSizeMm / 2)) * SCENE_SCALE, 0);
            const topOutline = new THREE.LineSegments(
                new THREE.EdgesGeometry(topGeo),
                new THREE.LineBasicMaterial({ color: 0x000000, opacity: 0.3, transparent: true })
            );
            topMesh.add(topOutline);
            group.add(topMesh);
            
            // 2. –ù–∏–∂–Ω—è—è –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è —Ä–∞–º–∞ (–Ω–∞ –≤—Å—é —à–∏—Ä–∏–Ω—É)
            const bottomGeo = new THREE.BoxGeometry(
                frameWidth * SCENE_SCALE,
                profileSizeMm * SCENE_SCALE,
                profileDepth * SCENE_SCALE
            );
            const bottomMesh = new THREE.Mesh(bottomGeo, material.clone());
            bottomMesh.position.set(0, (-(frameHeight / 2) + (profileSizeMm / 2)) * SCENE_SCALE, 0);
            const bottomOutline = new THREE.LineSegments(
                new THREE.EdgesGeometry(bottomGeo),
                new THREE.LineBasicMaterial({ color: 0x000000, opacity: 0.3, transparent: true })
            );
            bottomMesh.add(bottomOutline);
            group.add(bottomMesh);
            
            // 3. –õ–µ–≤–∞—è –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞—è —Å—Ç–æ–π–∫–∞ (–º–µ–∂–¥—É –≤–µ—Ä—Ö–æ–º –∏ –Ω–∏–∑–æ–º)
            const leftGeo = new THREE.BoxGeometry(
                profileSizeMm * SCENE_SCALE,
                (frameHeight - profileSizeMm * 2) * SCENE_SCALE,
                profileDepth * SCENE_SCALE
            );
            const leftMesh = new THREE.Mesh(leftGeo, material.clone());
            leftMesh.position.set((-(frameWidth / 2) + (profileSizeMm / 2)) * SCENE_SCALE, 0, 0);
            const leftOutline = new THREE.LineSegments(
                new THREE.EdgesGeometry(leftGeo),
                new THREE.LineBasicMaterial({ color: 0x000000, opacity: 0.3, transparent: true })
            );
            leftMesh.add(leftOutline);
            group.add(leftMesh);
            
            // 4. –ü—Ä–∞–≤–∞—è –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞—è —Å—Ç–æ–π–∫–∞ (–º–µ–∂–¥—É –≤–µ—Ä—Ö–æ–º –∏ –Ω–∏–∑–æ–º)
            const rightGeo = new THREE.BoxGeometry(
                profileSizeMm * SCENE_SCALE,
                (frameHeight - profileSizeMm * 2) * SCENE_SCALE,
                profileDepth * SCENE_SCALE
            );
            const rightMesh = new THREE.Mesh(rightGeo, material.clone());
            rightMesh.position.set(((frameWidth / 2) - (profileSizeMm / 2)) * SCENE_SCALE, 0, 0);
            const rightOutline = new THREE.LineSegments(
                new THREE.EdgesGeometry(rightGeo),
                new THREE.LineBasicMaterial({ color: 0x000000, opacity: 0.3, transparent: true })
            );
            rightMesh.add(rightOutline);
            group.add(rightMesh);
            
            // 5. –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º—ã—á–∫–∏
            // –õ–æ–≥–∏–∫–∞: 1000-2000–º–º ‚Üí 1 –ø–µ—Ä–µ–º—ã—á–∫–∞, –±–æ–ª—å—à–µ 2000–º–º ‚Üí –∫–∞–∂–¥—ã–µ 1000–º–º
            let crossbarCount = 0;
            if (frameWidth >= 1000 && frameWidth <= 2000) {
                crossbarCount = 1;
            } else if (frameWidth > 2000) {
                crossbarCount = Math.floor(frameWidth / 1000);
            }
            
            // –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –ª–µ–≤–æ–π –∏ –ø—Ä–∞–≤–æ–π —Å—Ç–æ–π–∫–∞–º–∏ (–≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —à–∏—Ä–∏–Ω–∞)
            const innerWidth = frameWidth - profileSizeMm * 2;
            
            if (crossbarCount > 0) {
                const spacing = innerWidth / (crossbarCount + 1);
                
                for (let i = 1; i <= crossbarCount; i++) {
                    const crossbarGeo = new THREE.BoxGeometry(
                        profileSizeMm * SCENE_SCALE,
                        (frameHeight - profileSizeMm * 2) * SCENE_SCALE,
                        profileDepth * SCENE_SCALE
                    );
                    const crossbarMesh = new THREE.Mesh(crossbarGeo, material.clone());
                    // –ü–æ–∑–∏—Ü–∏—è X: –æ—Ç –ª–µ–≤–æ–π —Å—Ç–æ–π–∫–∏ (—Ü–µ–Ω—Ç—Ä) + —à–∞–≥
                    const leftStanchionCenter = (-(frameWidth / 2) + (profileSizeMm / 2)) * SCENE_SCALE;
                    const xPos = leftStanchionCenter + ((profileSizeMm / 2) + (spacing * i)) * SCENE_SCALE;
                    // –ü–æ–∑–∏—Ü–∏—è Y: –ø–æ —Ü–µ–Ω—Ç—Ä—É (0), —Ç–∞–∫ –∫–∞–∫ –ø–µ—Ä–µ–º—ã—á–∫–∏ –º–µ–∂–¥—É –≤–µ—Ä—Ö–æ–º –∏ –Ω–∏–∑–æ–º
                    crossbarMesh.position.set(xPos, 0, 0);
                    const crossbarOutline = new THREE.LineSegments(
                        new THREE.EdgesGeometry(crossbarGeo),
                        new THREE.LineBasicMaterial({ color: 0x000000, opacity: 0.3, transparent: true })
                    );
                    crossbarMesh.add(crossbarOutline);
                    group.add(crossbarMesh);
                }
            }
            
            // –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞—Ä–∫–∞—Å–∞: –º–µ–∂–¥—É —Å—Ç–µ–Ω–æ–π –∏ –æ—Å–Ω–æ–≤–æ–π
            // Z = -10 + –ø–æ–ª–æ–≤–∏–Ω–∞ –≥–ª—É–±–∏–Ω—ã –ø—Ä–æ—Ñ–∏–ª—è
            const frameZ = -10 + (profileDepth * SCENE_SCALE) / 2;
            
            // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ë–ê–ì–ê: –ø—Ä–∏ –∑–∞–≥–∏–±–µ –æ—Å–Ω–æ–≤–∞ —Å–¥–≤–∏–≥–∞–µ—Ç—Å—è –≤–ø–µ—Ä—ë–¥, –∫–∞—Ä–∫–∞—Å –¥–æ–ª–∂–µ–Ω —Å–ª–µ–¥–æ–≤–∞—Ç—å –∑–∞ –Ω–µ–π
            // –ö–∞—Ä–∫–∞—Å –∫—Ä–µ–ø–∏—Ç—Å—è –∫ –∑–∞–¥–Ω–µ–π —á–∞—Å—Ç–∏ –æ—Å–Ω–æ–≤—ã, –ø–æ—ç—Ç–æ–º—É —É—á–∏—Ç—ã–≤–∞–µ–º bendOffset
            const bendOffset = baseBend * SCENE_SCALE;
            
            group.position.set(posX, posY, frameZ + bendOffset);
            
            return group;
        }
        
        // === –°–û–ó–î–ê–ù–ò–ï –û–°–ù–û–í–´ ===
        function addBase() {
            // –ï—Å–ª–∏ –º–∞—Ç–µ—Ä–∏–∞–ª –Ω–µ –≤—ã–±—Ä–∞–Ω - –≤—ã—Ö–æ–¥–∏–º
            if (!state.baseMaterial || state.baseMaterial === 'none') {
                alert('–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –º–∞—Ç–µ—Ä–∏–∞–ª –æ—Å–Ω–æ–≤—ã');
                return;
            }
            
            // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª–∞
            const baseMaterialData = PRICES_DATA.materials[state.baseMaterial];
            if (!baseMaterialData) return;
            
            // –ü–æ–ª—É—á–∞–µ–º —Ç–æ–ª—â–∏–Ω—É –∏–∑ –Ω–∞–∑–≤–∞–Ω–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–∞ (pvc-3, composite-3-1220 –∏ —Ç.–¥.)
            let thickness = 3;
            const match = state.baseMaterial.match(/(\d+)/);
            if (match) thickness = parseInt(match[1]);
            
            // –ú–∞—Å—à—Ç–∞–± —Å—Ü–µ–Ω—ã: 1 –µ–¥–∏–Ω–∏—Ü–∞ Three.js = 10 –º–º
            const SCENE_SCALE = 0.1; // 10–º–º = 1 –µ–¥–∏–Ω–∏—Ü–∞
            
            // –ó–∞–≥–∏–± –¥–ª—è –∫–æ–º–ø–æ–∑–∏—Ç–∞
            const bend = state.baseMaterial.startsWith('composite') ? state.baseBend : 0;
            
            // –°–æ–∑–¥–∞—ë–º –º–∞—Ç–µ—Ä–∏–∞–ª (–∏—Å–ø–æ–ª—å–∑—É–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ü–≤–µ—Ç Oracal 641)
            const baseColorHex = state.baseColor.replace('#', '0x');
            const baseColorNum = parseInt(baseColorHex, 16);
            
            const material = new THREE.MeshStandardMaterial({
                color: baseColorNum,
                metalness: 0.2,
                roughness: 0.8,
                side: THREE.DoubleSide
            });
            
            let meshOrGroup;
            
            if (bend === 0) {
                // –ü—Ä–æ—Å—Ç–∞—è –ø–ª–æ—Å–∫–∞—è –æ—Å–Ω–æ–≤–∞
                const geometry = new THREE.BoxGeometry(
                    state.baseWidth * SCENE_SCALE,
                    state.baseHeight * SCENE_SCALE,
                    thickness * SCENE_SCALE
                );
                const mesh = new THREE.Mesh(geometry, material);
                mesh.castShadow = false;
                mesh.receiveShadow = false;
                
                // –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–Ω—Ç—É—Ä
                const edges = new THREE.EdgesGeometry(geometry);
                const lineMaterial = new THREE.LineBasicMaterial({ 
                    color: 0x000000, 
                    linewidth: 1,
                    transparent: true,
                    opacity: 0.2
                });
                const outline = new THREE.LineSegments(edges, lineMaterial);
                mesh.add(outline);
                
                meshOrGroup = mesh;
            } else {
                // –ü-–æ–±—Ä–∞–∑–Ω–∞—è –æ—Å–Ω–æ–≤–∞ —Å –∑–∞–≥–∏–±–∞–º–∏
                const group = new THREE.Group();
                
                // 1. –õ–∏—Ü–µ–≤–∞—è –ø–ª–æ—Å–∫–æ—Å—Ç—å
                const frontGeo = new THREE.BoxGeometry(
                    state.baseWidth * SCENE_SCALE,
                    state.baseHeight * SCENE_SCALE,
                    thickness * SCENE_SCALE
                );
                const frontMesh = new THREE.Mesh(frontGeo, material);
                const frontEdges = new THREE.EdgesGeometry(frontGeo);
                const frontOutline = new THREE.LineSegments(frontEdges, new THREE.LineBasicMaterial({ color: 0x000000, opacity: 0.2, transparent: true }));
                frontMesh.add(frontOutline);
                group.add(frontMesh);
                
                // 2-5. –ß–µ—Ç—ã—Ä–µ –±–æ—Ä—Ç–∏–∫–∞
                const bendDepth = bend * SCENE_SCALE;
                
                // –í–µ—Ä—Ö–Ω–∏–π –±–æ—Ä—Ç–∏–∫
                const topGeo = new THREE.BoxGeometry(state.baseWidth * SCENE_SCALE, thickness * SCENE_SCALE, bendDepth);
                const topMesh = new THREE.Mesh(topGeo, material);
                topMesh.position.set(0, (state.baseHeight * SCENE_SCALE / 2) - (thickness * SCENE_SCALE / 2), -bendDepth / 2);
                const topOutline = new THREE.LineSegments(new THREE.EdgesGeometry(topGeo), new THREE.LineBasicMaterial({ color: 0x000000, opacity: 0.2, transparent: true }));
                topMesh.add(topOutline);
                group.add(topMesh);
                
                // –ù–∏–∂–Ω–∏–π –±–æ—Ä—Ç–∏–∫
                const bottomGeo = new THREE.BoxGeometry(state.baseWidth * SCENE_SCALE, thickness * SCENE_SCALE, bendDepth);
                const bottomMesh = new THREE.Mesh(bottomGeo, material);
                bottomMesh.position.set(0, -(state.baseHeight * SCENE_SCALE / 2) + (thickness * SCENE_SCALE / 2), -bendDepth / 2);
                const bottomOutline = new THREE.LineSegments(new THREE.EdgesGeometry(bottomGeo), new THREE.LineBasicMaterial({ color: 0x000000, opacity: 0.2, transparent: true }));
                bottomMesh.add(bottomOutline);
                group.add(bottomMesh);
                
                // –õ–µ–≤—ã–π –±–æ—Ä—Ç–∏–∫
                const leftGeo = new THREE.BoxGeometry(thickness * SCENE_SCALE, (state.baseHeight * SCENE_SCALE) - (2 * thickness * SCENE_SCALE), bendDepth);
                const leftMesh = new THREE.Mesh(leftGeo, material);
                leftMesh.position.set(-(state.baseWidth * SCENE_SCALE / 2) + (thickness * SCENE_SCALE / 2), 0, -bendDepth / 2);
                const leftOutline = new THREE.LineSegments(new THREE.EdgesGeometry(leftGeo), new THREE.LineBasicMaterial({ color: 0x000000, opacity: 0.2, transparent: true }));
                leftMesh.add(leftOutline);
                group.add(leftMesh);
                
                // –ü—Ä–∞–≤—ã–π –±–æ—Ä—Ç–∏–∫
                const rightGeo = new THREE.BoxGeometry(thickness * SCENE_SCALE, (state.baseHeight * SCENE_SCALE) - (2 * thickness * SCENE_SCALE), bendDepth);
                const rightMesh = new THREE.Mesh(rightGeo, material);
                rightMesh.position.set((state.baseWidth * SCENE_SCALE / 2) - (thickness * SCENE_SCALE / 2), 0, -bendDepth / 2);
                const rightOutline = new THREE.LineSegments(new THREE.EdgesGeometry(rightGeo), new THREE.LineBasicMaterial({ color: 0x000000, opacity: 0.2, transparent: true }));
                rightMesh.add(rightOutline);
                group.add(rightMesh);
                
                meshOrGroup = group;
            }
            
            // –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä—É–µ–º: –∑–∞–¥–Ω—è—è –≥—Ä–∞–Ω—å –∫–∞—Å–∞–µ—Ç—Å—è —Å—Ç–µ–Ω—ã (Z = -10)
            // –ï—Å–ª–∏ –µ—Å—Ç—å –∑–∞–≥–∏–± - –æ—Ç–æ–¥–≤–∏–≥–∞–µ–º –æ—Å–Ω–æ–≤—É –≤–ø–µ—Ä—ë–¥, —á—Ç–æ–±—ã –±–æ—Ä—Ç–∏–∫–∏ –¥–æ—Å—Ç–∞–≤–∞–ª–∏ –¥–æ —Å—Ç–µ–Ω—ã
            // –ï—Å–ª–∏ –µ—Å—Ç—å –∫–∞—Ä–∫–∞—Å - –æ—Å–Ω–æ–≤–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ù–ê –∫–∞—Ä–∫–∞—Å–µ (+ –≥–ª—É–±–∏–Ω–∞ –ø—Ä–æ—Ñ–∏–ª—è –∫–∞—Ä–∫–∞—Å–∞)
            const halfThickness = (thickness * SCENE_SCALE) / 2;
            const bendOffset = bend * SCENE_SCALE; // –û—Ç—Å—Ç—É–ø –≤–ø–µ—Ä—ë–¥ –Ω–∞ –≤–µ–ª–∏—á–∏–Ω—É –∑–∞–≥–∏–±–∞
            
            // –£—á–∏—Ç—ã–≤–∞–µ–º –≥–ª—É–±–∏–Ω—É –∫–∞—Ä–∫–∞—Å–∞ (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω)
            let frameDepthOffset = 0;
            if (state.hasBaseFrame) {
                const parts = state.baseFrameProfile.split('x');
                const profileDepth = parseInt(parts[1] || parts[0]); // –ì–ª—É–±–∏–Ω–∞ –∫ —Å—Ç–µ–Ω–µ (–≤—Ç–æ—Ä–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ!)
                frameDepthOffset = profileDepth * SCENE_SCALE; // –ì–ª—É–±–∏–Ω–∞ –ø—Ä–æ—Ñ–∏–ª—è –∫ —Å—Ç–µ–Ω–µ
            }
            
            const baseZ = -10 + frameDepthOffset + halfThickness + bendOffset;
            meshOrGroup.position.set(0, 0, baseZ);
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≤ —Å—Ü–µ–Ω—É
            scene.add(meshOrGroup);
            
            // –°–æ–∑–¥–∞—ë–º –∫–∞—Ä–∫–∞—Å –¥–ª—è –æ—Å–Ω–æ–≤—ã (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω)
            let frameMesh = null;
            if (state.hasBaseFrame) {
                frameMesh = createBaseFrame(state.baseWidth, state.baseHeight, state.baseFrameProfile, state.baseFrameColor, thickness, bend, 0, 0);
                scene.add(frameMesh);
            }
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –º–∞—Å—Å–∏–≤
            const baseData = {
                mesh: meshOrGroup,
                frameMesh: frameMesh, // –ö–∞—Ä–∫–∞—Å –æ—Å–Ω–æ–≤—ã
                width: state.baseWidth,
                height: state.baseHeight,
                thickness: thickness,
                material: state.baseMaterial,
                color: state.baseColor,
                bend: bend, // –¢–µ–∫—É—â–∏–π –∑–∞–≥–∏–±
                hasFrame: state.hasBaseFrame,
                frameProfile: state.baseFrameProfile,
                frameColor: state.baseFrameColor,
                positionX: 0,
                positionY: 0,
                positionZ: baseZ
            };
            bases.push(baseData);
            
            // –î–µ–ª–∞–µ–º –Ω–æ–≤—É—é –æ—Å–Ω–æ–≤—É –∞–∫—Ç–∏–≤–Ω–æ–π
            selectBase(bases.length - 1);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º UI
            renderBasesList();
            updateWallAndShadows();
            updateCostCalculator();
            
            log(`‚úÖ –°–æ–∑–¥–∞–Ω–∞ –æ—Å–Ω–æ–≤–∞ ${state.baseWidth}√ó${state.baseHeight}–º–º, —Ç–æ–ª—â–∏–Ω–∞ ${thickness}–º–º`, 'success');
        }
        
        // === –†–ï–ù–î–ï–† –°–ü–ò–°–ö–ê –û–°–ù–û–í ===
        function renderBasesList() {
            const list = document.getElementById('bases-3d-list');
            if (!list) return;
            
            if (bases.length === 0) {
                list.innerHTML = '<div style="opacity: 0.5; font-size: 11px; padding: 8px; text-align: center;">–û—Å–Ω–æ–≤—ã –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã</div>';
                return;
            }
            
            list.innerHTML = bases.map((base, index) => {
                const isActive = activeBaseIndex === index;
                const matData = PRICES_DATA.materials[base.material];
                const matName = matData ? matData.name : base.material;
                
                return `
                    <div onclick="selectBase(${index})" 
                         style="padding: 8px; margin: 4px 0; 
                                background: ${isActive ? 'rgba(255,193,7,0.12)' : 'rgba(255,255,255,0.03)'}; 
                                border: 1px solid ${isActive ? 'rgba(255,193,7,0.4)' : 'rgba(255,255,255,0.1)'}; 
                                border-radius: 4px; cursor: pointer; font-size: 11px; transition: all 0.2s;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="font-weight: 500; color: ${isActive ? '#ffd54f' : '#fff'};">üì¶ –û—Å–Ω–æ–≤–∞ #${index + 1}</span>
                            <span style="opacity: 0.7;">${base.width}√ó${base.height}</span>
                        </div>
                        <div style="opacity: 0.6; font-size: 10px; margin-top: 2px;">${matName}</div>
                    </div>
                `;
            }).join('');
        }
        
        // === –û–ë–ù–û–í–õ–ï–ù–ò–ï –ü–û–î–°–í–ï–¢–ö–ò –ê–ö–¢–ò–í–ù–û–ì–û SVG ===
        function updateActiveSvgHighlight() {
            if (activeSvgIndex !== null && svgGroups[activeSvgIndex]) {
                if (activeSvgHelper) {
                    activeSvgHelper.update();
                }
            }
        }
        
        // === –°–ù–Ø–¢–ò–ï –í–´–î–ï–õ–ï–ù–ò–Ø –°–û –í–°–ï–• –û–ë–™–ï–ö–¢–û–í ===
        function deselectAll() {
            // –°–Ω–∏–º–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å SVG
            if (activeSvgHelper) {
                scene.remove(activeSvgHelper);
                activeSvgHelper = null;
            }
            if (activeSvgIndex !== null) {
                activeSvgIndex = null;
                updateSVGList();
            }
            
            // –°–Ω–∏–º–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å –æ—Å–Ω–æ–≤
            if (activeBaseIndex !== null && bases[activeBaseIndex]) {
                const prevMesh = bases[activeBaseIndex].mesh;
                if (prevMesh) {
                    if (prevMesh.type === 'Group') {
                        prevMesh.children.forEach(child => {
                            if (child.children[0]) {
                                child.children[0].material.opacity = 0.2;
                                child.children[0].material.color.setHex(0x000000);
                            }
                        });
                    } else if (prevMesh.children[0]) {
                        prevMesh.children[0].material.opacity = 0.2;
                        prevMesh.children[0].material.color.setHex(0x000000);
                    }
                }
                activeBaseIndex = null;
                
                // –°–∫—Ä—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—Å–Ω–æ–≤–æ–π
                const baseControls = document.getElementById('base-controls');
                if (baseControls) {
                    baseControls.style.display = 'none';
                }
            }
            
            // –°–Ω–∏–º–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å –ø—Ä–æ—Ñ–∏–ª–µ–π
            if (activeProfileIndex !== null && frameProfiles[activeProfileIndex]) {
                const prevMesh = frameProfiles[activeProfileIndex].mesh;
                if (prevMesh && prevMesh.children[0]) {
                    prevMesh.children[0].material.opacity = 0.2;
                    prevMesh.children[0].material.color.setHex(0x000000);
                }
                activeProfileIndex = null;
                
                // –°–∫—Ä—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª–µ–º
                const profileControls = document.getElementById('profile-controls');
                if (profileControls) {
                    profileControls.style.display = 'none';
                }
            }
            
            log('–í—ã–¥–µ–ª–µ–Ω–∏–µ —Å–Ω—è—Ç–æ', 'info');
        }
        
        // === –í–´–ë–û–† –û–°–ù–û–í–´ ===
        function selectBase(index) {
            if (index < 0 || index >= bases.length) return;
            
            // –°–ë–†–ê–°–´–í–ê–ï–ú –í–°–ï –î–†–£–ì–ò–ï –ê–ö–¢–ò–í–ù–´–ï –û–ë–™–ï–ö–¢–´
            // –°–Ω–∏–º–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å SVG
            if (activeSvgHelper) {
                scene.remove(activeSvgHelper);
                activeSvgHelper = null;
            }
            if (activeSvgIndex !== null) {
                activeSvgIndex = null;
                updateSVGList();
            }
            
            // –°–Ω–∏–º–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å –ø—Ä–æ—Ñ–∏–ª–µ–π –∫–∞—Ä–∫–∞—Å–∞
            if (activeProfileIndex !== null && frameProfiles[activeProfileIndex]) {
                const prevProfMesh = frameProfiles[activeProfileIndex].mesh;
                if (prevProfMesh && prevProfMesh.children[0]) {
                    prevProfMesh.children[0].material.opacity = 0.2;
                    prevProfMesh.children[0].material.color.setHex(0x000000);
                }
                activeProfileIndex = null;
                
                // –°–∫—Ä—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª–µ–º
                const profileControls = document.getElementById('profile-controls');
                if (profileControls) {
                    profileControls.style.display = 'none';
                }
            }
            
            // –°–Ω–∏–º–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å –ø—Ä–µ–¥—ã–¥—É—â–µ–π –æ—Å–Ω–æ–≤—ã
            if (activeBaseIndex !== null && bases[activeBaseIndex]) {
                const prevMesh = bases[activeBaseIndex].mesh;
                if (prevMesh) {
                    if (prevMesh.type === 'Group') {
                        // –î–ª—è Group (—Å –∑–∞–≥–∏–±–∞–º–∏) - –æ–±—Ö–æ–¥–∏–º –≤—Å–µ –¥–æ—á–µ—Ä–Ω–∏–µ mesh'—ã
                        prevMesh.children.forEach(child => {
                            if (child.children[0]) {
                                child.children[0].material.opacity = 0.2;
                                child.children[0].material.color.setHex(0x000000);
                            }
                        });
                    } else if (prevMesh.children[0]) {
                        // –î–ª—è –ø—Ä–æ—Å—Ç–æ–≥–æ Mesh
                        prevMesh.children[0].material.opacity = 0.2;
                        prevMesh.children[0].material.color.setHex(0x000000);
                    }
                }
            }
            
            // –í—ã–±–∏—Ä–∞–µ–º –Ω–æ–≤—É—é –æ—Å–Ω–æ–≤—É
            activeBaseIndex = index;
            const base = bases[index];
            
            // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –∫–æ–Ω—Ç—É—Ä –∞–∫—Ç–∏–≤–Ω–æ–π –æ—Å–Ω–æ–≤—ã (–∑–µ–ª—ë–Ω—ã–π —è—Ä–∫–∏–π)
            if (base.mesh) {
                if (base.mesh.type === 'Group') {
                    // –î–ª—è Group (—Å –∑–∞–≥–∏–±–∞–º–∏) - –æ–±—Ö–æ–¥–∏–º –≤—Å–µ –¥–æ—á–µ—Ä–Ω–∏–µ mesh'—ã
                    base.mesh.children.forEach(child => {
                        if (child.children[0]) {
                            child.children[0].material.opacity = 0.8;
                            child.children[0].material.color.setHex(0x00FF00);
                        }
                    });
                } else if (base.mesh.children[0]) {
                    // –î–ª—è –ø—Ä–æ—Å—Ç–æ–≥–æ Mesh
                    base.mesh.children[0].material.opacity = 0.8;
                    base.mesh.children[0].material.color.setHex(0x00FF00);
                }
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
            const controls = document.getElementById('base-controls');
            if (controls) {
                controls.style.display = 'block';
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª—è –≤–≤–æ–¥–∞ —Ä–∞–∑–º–µ—Ä–æ–≤ –∞–∫—Ç–∏–≤–Ω–æ–π –æ—Å–Ω–æ–≤—ã
            const widthInput = document.getElementById('active-base-width-input');
            const heightInput = document.getElementById('active-base-height-input');
            if (widthInput) widthInput.value = base.width;
            if (heightInput) heightInput.value = base.height;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª–µ –∑–∞–≥–∏–±–∞ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –µ–≥–æ –¥–ª—è –∫–æ–º–ø–æ–∑–∏—Ç–∞
            const bendControls = document.getElementById('active-base-bend-controls');
            const bendInput = document.getElementById('active-base-bend-input');
            if (bendControls && bendInput) {
                if (base.material && base.material.startsWith('composite')) {
                    bendControls.style.display = 'block';
                    bendInput.value = base.bend || 0;
                    checkActiveBaseSizeWithBend();
                } else {
                    bendControls.style.display = 'none';
                }
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫
            renderBasesList();
            
            log(`–í—ã–±—Ä–∞–Ω–∞ –æ—Å–Ω–æ–≤–∞ #${index + 1}`, 'info');
        }
        
        // === –ö–û–ü–ò–†–û–í–ê–ù–ò–ï –û–°–ù–û–í–´ ===
        function copyActiveBase() {
            if (activeBaseIndex === null || !bases[activeBaseIndex]) return;
            
            const original = bases[activeBaseIndex];
            
            // –í—Ä–µ–º–µ–Ω–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
            const oldWidth = state.baseWidth;
            const oldHeight = state.baseHeight;
            const oldMaterial = state.baseMaterial;
            const oldColor = state.baseColor;
            const oldBend = state.baseBend;
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–ø–∏—Ä—É–µ–º–æ–π –æ—Å–Ω–æ–≤—ã
            state.baseWidth = original.width;
            state.baseHeight = original.height;
            state.baseMaterial = original.material;
            state.baseColor = original.color || '#FFFFFF';
            state.baseBend = original.bend || 0;
            
            // –°–æ–∑–¥–∞—ë–º –∫–æ–ø–∏—é
            addBase();
            
            // –ù–µ–º–Ω–æ–≥–æ —Å–¥–≤–∏–≥–∞–µ–º –∫–æ–ø–∏—é –¥–ª—è –≤–∏–¥–∏–º–æ—Å—Ç–∏
            const newBase = bases[bases.length - 1];
            
            // –ú–∞—Å—à—Ç–∞–± —Å—Ü–µ–Ω—ã: 1 –µ–¥–∏–Ω–∏—Ü–∞ Three.js = 10 –º–º
            const SCENE_SCALE = 0.1; // 10–º–º = 1 –µ–¥–∏–Ω–∏—Ü–∞
            
            newBase.mesh.position.x = original.mesh.position.x + (50 * SCENE_SCALE);
            newBase.mesh.position.y = original.mesh.position.y + (50 * SCENE_SCALE);
            newBase.positionX = newBase.mesh.position.x;
            newBase.positionY = newBase.mesh.position.y;
            
            // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º –∫–∞—Ä–∫–∞—Å (–∫–æ–ø–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ X –∏ Y)
            if (newBase.frameMesh) {
                newBase.frameMesh.position.x = newBase.mesh.position.x;
                newBase.frameMesh.position.y = newBase.mesh.position.y;
                // Z –Ω–µ —Ç—Ä–æ–≥–∞–µ–º - –∫–∞—Ä–∫–∞—Å –∏–º–µ–µ—Ç —Å–≤–æ—é –≥–ª—É–±–∏–Ω—É —Å —É—á—ë—Ç–æ–º –∑–∞–≥–∏–±–∞
            }
            
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—Ç–∞—Ä—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
            state.baseWidth = oldWidth;
            state.baseHeight = oldHeight;
            state.baseMaterial = oldMaterial;
            state.baseColor = oldColor;
            state.baseBend = oldBend;
            
            log('‚úÖ –û—Å–Ω–æ–≤–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞', 'success');
        }
        
        // === –£–î–ê–õ–ï–ù–ò–ï –û–°–ù–û–í–´ ===
        function deleteActiveBase() {
            if (activeBaseIndex === null || !bases[activeBaseIndex]) return;
            
            const base = bases[activeBaseIndex];
            
            // –£–¥–∞–ª—è–µ–º –∏–∑ —Å—Ü–µ–Ω—ã
            if (base.mesh) {
                scene.remove(base.mesh);
                
                if (base.mesh.type === 'Group') {
                    // –î–ª—è Group (—Å –∑–∞–≥–∏–±–∞–º–∏) - —É–¥–∞–ª—è–µ–º –≤—Å–µ –¥–æ—á–µ—Ä–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã
                    base.mesh.children.forEach(child => {
                        if (child.geometry) child.geometry.dispose();
                        if (child.material) {
                            if (Array.isArray(child.material)) {
                                child.material.forEach(m => m.dispose());
                            } else {
                                child.material.dispose();
                            }
                        }
                    });
                } else {
                    // –î–ª—è –ø—Ä–æ—Å—Ç–æ–≥–æ Mesh
                    if (base.mesh.geometry) base.mesh.geometry.dispose();
                    if (base.mesh.material) {
                        if (Array.isArray(base.mesh.material)) {
                            base.mesh.material.forEach(m => m.dispose());
                        } else {
                            base.mesh.material.dispose();
                        }
                    }
                }
            }
            
            // –£–¥–∞–ª—è–µ–º –∫–∞—Ä–∫–∞—Å
            if (base.frameMesh) {
                scene.remove(base.frameMesh);
                base.frameMesh.children.forEach(child => {
                    if (child.geometry) child.geometry.dispose();
                    if (child.material) child.material.dispose();
                });
            }
            
            // –£–¥–∞–ª—è–µ–º –∏–∑ –º–∞—Å—Å–∏–≤–∞
            bases.splice(activeBaseIndex, 1);
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
            activeBaseIndex = null;
            
            // –°–∫—Ä—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
            const controls = document.getElementById('base-controls');
            if (controls) {
                controls.style.display = 'none';
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º UI
            renderBasesList();
            updateWallAndShadows();
            updateCostCalculator();
            
            log('üóëÔ∏è –û—Å–Ω–æ–≤–∞ —É–¥–∞–ª–µ–Ω–∞', 'info');
        }
        
        // === –ü–ï–†–ï–ú–ï–©–ï–ù–ò–ï –û–°–ù–û–í–´ ===
        let baseMoveInterval = null;
        
        function startBaseMove(direction) {
            if (activeBaseIndex === null || !bases[activeBaseIndex]) return;
            
            const base = bases[activeBaseIndex];
            
            // –ú–∞—Å—à—Ç–∞–± —Å—Ü–µ–Ω—ã: 1 –µ–¥–∏–Ω–∏—Ü–∞ Three.js = 10 –º–º
            const SCENE_SCALE = 0.1; // 10–º–º = 1 –µ–¥–∏–Ω–∏—Ü–∞
            const step = 5 * SCENE_SCALE; // 5–º–º –≤ –µ–¥–∏–Ω–∏—Ü–∞—Ö —Å—Ü–µ–Ω—ã
            
            const moveBase = () => {
                switch(direction) {
                    case 'up':
                        base.mesh.position.y += step;
                        base.positionY += step;
                        break;
                    case 'down':
                        base.mesh.position.y -= step;
                        base.positionY -= step;
                        break;
                    case 'left':
                        base.mesh.position.x -= step;
                        base.positionX -= step;
                        break;
                    case 'right':
                        base.mesh.position.x += step;
                        base.positionX += step;
                        break;
                    case 'forward':
                        base.mesh.position.z += step;
                        if (base.positionZ !== undefined) base.positionZ += step;
                        break;
                    case 'backward':
                        base.mesh.position.z -= step;
                        if (base.positionZ !== undefined) base.positionZ -= step;
                        break;
                }
                
                // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º –ø–æ–∑–∏—Ü–∏—é –∫–∞—Ä–∫–∞—Å–∞ —Å –æ—Å–Ω–æ–≤–æ–π (–µ—Å–ª–∏ –µ—Å—Ç—å)
                // –í–ê–ñ–ù–û: –∫–æ–ø–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ X –∏ Y, Z –æ—Å—Ç–∞—ë—Ç—Å—è —Å–≤–æ–∏–º (–∫–∞—Ä–∫–∞—Å –°–ó–ê–î–ò –æ—Å–Ω–æ–≤—ã)
                if (base.frameMesh) {
                    base.frameMesh.position.x = base.mesh.position.x;
                    base.frameMesh.position.y = base.mesh.position.y;
                    // Z –Ω–µ —Ç—Ä–æ–≥–∞–µ–º - –∫–∞—Ä–∫–∞—Å –∏–º–µ–µ—Ç —Å–≤–æ—é –≥–ª—É–±–∏–Ω—É —Å —É—á—ë—Ç–æ–º –∑–∞–≥–∏–±–∞
                }
                
                updateCostCalculator();
            };
            
            moveBase(); // –ü–µ—Ä–≤–æ–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ —Å—Ä–∞–∑—É
            baseMoveInterval = setInterval(moveBase, 50); // –ü–æ–≤—Ç–æ—Ä –∫–∞–∂–¥—ã–µ 50–º—Å
        }
        
        window.stopBaseMove = function() {
            if (baseMoveInterval) {
                clearInterval(baseMoveInterval);
                baseMoveInterval = null;
            }
        }
        
        // === –£–ü–†–ê–í–õ–ï–ù–ò–ï –†–ê–ó–ú–ï–†–ê–ú–ò –ê–ö–¢–ò–í–ù–û–ô –û–°–ù–û–í–´ ===
        window.changeActiveBaseWidth = function(delta) {
            if (activeBaseIndex === null || !bases[activeBaseIndex]) return;
            
            const input = document.getElementById('active-base-width-input');
            if (!input) return;
            
            const currentValue = parseInt(input.value) || 1000;
            const newValue = Math.max(100, Math.min(10000, currentValue + delta));
            input.value = newValue;
            updateActiveBaseWidth(newValue);
        };
        
        window.changeActiveBaseHeight = function(delta) {
            if (activeBaseIndex === null || !bases[activeBaseIndex]) return;
            
            const input = document.getElementById('active-base-height-input');
            if (!input) return;
            
            const currentValue = parseInt(input.value) || 1000;
            const newValue = Math.max(100, Math.min(10000, currentValue + delta));
            input.value = newValue;
            updateActiveBaseHeight(newValue);
        };
        
        window.updateActiveBaseWidth = function(value) {
            if (activeBaseIndex === null || !bases[activeBaseIndex]) return;
            
            const newWidth = parseInt(value) || 1000;
            bases[activeBaseIndex].width = newWidth;
            updateActiveBaseSize();
        };
        
        window.updateActiveBaseHeight = function(value) {
            if (activeBaseIndex === null || !bases[activeBaseIndex]) return;
            
            const newHeight = parseInt(value) || 1000;
            bases[activeBaseIndex].height = newHeight;
            updateActiveBaseSize();
        };
        
        // === –£–ü–†–ê–í–õ–ï–ù–ò–ï –ó–ê–ì–ò–ë–û–ú –ê–ö–¢–ò–í–ù–û–ô –û–°–ù–û–í–´ ===
        window.changeActiveBaseBend = function(delta) {
            if (activeBaseIndex === null || !bases[activeBaseIndex]) return;
            
            const base = bases[activeBaseIndex];
            if (!base.material || !base.material.startsWith('composite')) return;
            
            const input = document.getElementById('active-base-bend-input');
            if (!input) return;
            
            const currentValue = parseInt(input.value) || 0;
            const newValue = Math.max(0, Math.min(200, currentValue + delta));
            input.value = newValue;
            updateActiveBaseBend(newValue);
        };
        
        window.updateActiveBaseBend = function(value) {
            if (activeBaseIndex === null || !bases[activeBaseIndex]) return;
            
            const base = bases[activeBaseIndex];
            if (!base.material || !base.material.startsWith('composite')) return;
            
            const newBend = parseInt(value) || 0;
            bases[activeBaseIndex].bend = newBend;
            
            // –ü–µ—Ä–µ—Å–æ–∑–¥–∞—ë–º –≥–µ–æ–º–µ—Ç—Ä–∏—é —Å –Ω–æ–≤—ã–º –∑–∞–≥–∏–±–æ–º
            updateActiveBaseGeometry();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä—ã
            checkActiveBaseSizeWithBend();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é –±—É–∫–≤ (–æ—Ç–æ–¥–≤–∏–≥–∞–µ–º –æ—Ç —Å—Ç–µ–Ω—ã —Å —É—á—ë—Ç–æ–º –∑–∞–≥–∏–±–∞)
            updateWallAndShadows();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–∞—Å—á—ë—Ç
            updateCostCalculator();
            
            log(`–ó–∞–≥–∏–± –æ—Å–Ω–æ–≤—ã –æ–±–Ω–æ–≤–ª—ë–Ω: ${newBend}–º–º`, 'info');
        };
        
        // === –ü–†–û–í–ï–†–ö–ê –†–ê–ó–ú–ï–†–û–í –ê–ö–¢–ò–í–ù–û–ô –û–°–ù–û–í–´ –° –ó–ê–ì–ò–ë–û–ú ===
        function checkActiveBaseSizeWithBend() {
            if (activeBaseIndex === null || !bases[activeBaseIndex]) return;
            
            const base = bases[activeBaseIndex];
            if (!base.material || !base.material.startsWith('composite')) return;
            
            const materialData = PRICES_DATA.materials[base.material];
            if (!materialData) return;
            
            const sheetWidth = materialData.sheet_width || 1500;
            const sheetHeight = materialData.sheet_height || 4000;
            
            // –ü–æ–ª–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Å —É—á—ë—Ç–æ–º –∑–∞–≥–∏–±–æ–≤ —Å –æ–±–µ–∏—Ö —Å—Ç–æ—Ä–æ–Ω
            const fullWidth = base.width + (base.bend * 2);
            const fullHeight = base.height + (base.bend * 2);
            
            const warningEl = document.getElementById('active-base-bend-warning');
            const infoEl = document.getElementById('active-base-bend-info');
            const fullSizeSpan = document.getElementById('active-base-full-size');
            
            if (fullSizeSpan) {
                fullSizeSpan.textContent = `${fullWidth}√ó${fullHeight}–º–º`;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤–º–µ—â–∞–µ—Ç—Å—è –ª–∏ –≤ –ª–∏—Å—Ç
            const fitsInSheet = (fullWidth <= sheetWidth && fullHeight <= sheetHeight) || 
                               (fullWidth <= sheetHeight && fullHeight <= sheetWidth);
            
            if (warningEl) {
                if (!fitsInSheet) {
                    warningEl.style.display = 'block';
                    warningEl.textContent = `‚ö†Ô∏è –ù–µ –≤–º–µ—â–∞–µ—Ç—Å—è –≤ –ª–∏—Å—Ç ${sheetWidth}√ó${sheetHeight}–º–º!`;
                } else {
                    warningEl.style.display = 'none';
                }
            }
            
            if (infoEl) {
                infoEl.style.color = fitsInSheet ? 'rgba(76, 175, 80, 0.8)' : 'rgba(244, 67, 54, 0.8)';
            }
        };
        
        // === –ü–ï–†–ï–°–û–ó–î–ê–ù–ò–ï –ì–ï–û–ú–ï–¢–†–ò–ò –ê–ö–¢–ò–í–ù–û–ô –û–°–ù–û–í–´ ===
        function updateActiveBaseGeometry() {
            if (activeBaseIndex === null || !bases[activeBaseIndex]) return;
            
            const base = bases[activeBaseIndex];
            if (!base.mesh) return;
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â—É—é –ø–æ–∑–∏—Ü–∏—é
            const currentPosition = base.mesh.position.clone();
            
            // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π mesh/group –∏–∑ —Å—Ü–µ–Ω—ã
            scene.remove(base.mesh);
            if (base.mesh.geometry) {
                base.mesh.geometry.dispose();
            }
            if (base.mesh.material) {
                if (Array.isArray(base.mesh.material)) {
                    base.mesh.material.forEach(m => m.dispose());
                } else {
                    base.mesh.material.dispose();
                }
            }
            
            // –ú–∞—Å—à—Ç–∞–± —Å—Ü–µ–Ω—ã
            const SCENE_SCALE = 0.1; // 10–º–º = 1 –µ–¥–∏–Ω–∏—Ü–∞
            
            // –°–æ–∑–¥–∞—ë–º –º–∞—Ç–µ—Ä–∏–∞–ª
            const baseColorHex = base.color.replace('#', '0x');
            const baseColorNum = parseInt(baseColorHex, 16);
            const material = new THREE.MeshStandardMaterial({
                color: baseColorNum,
                metalness: 0.2,
                roughness: 0.8,
                side: THREE.DoubleSide
            });
            
            let newMeshOrGroup;
            
            if (base.bend === 0) {
                // –ü—Ä–æ—Å—Ç–∞—è –ø–ª–æ—Å–∫–∞—è –æ—Å–Ω–æ–≤–∞
                const geometry = new THREE.BoxGeometry(
                    base.width * SCENE_SCALE,
                    base.height * SCENE_SCALE,
                    base.thickness * SCENE_SCALE
                );
                const mesh = new THREE.Mesh(geometry, material);
                mesh.castShadow = false;
                mesh.receiveShadow = false;
                
                // –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–Ω—Ç—É—Ä
                const edges = new THREE.EdgesGeometry(geometry);
                const lineMaterial = new THREE.LineBasicMaterial({ 
                    color: 0x000000, 
                    linewidth: 1,
                    transparent: true,
                    opacity: 0.2
                });
                const outline = new THREE.LineSegments(edges, lineMaterial);
                mesh.add(outline);
                
                newMeshOrGroup = mesh;
            } else {
                // –ü-–æ–±—Ä–∞–∑–Ω–∞—è –æ—Å–Ω–æ–≤–∞ —Å –∑–∞–≥–∏–±–∞–º–∏
                const group = new THREE.Group();
                const bendDepth = base.bend * SCENE_SCALE;
                const edgeColor = 0x000000;
                const edgeOpacity = 0.2;
                
                // 1. –õ–∏—Ü–µ–≤–∞—è –ø–ª–æ—Å–∫–æ—Å—Ç—å
                const frontGeo = new THREE.BoxGeometry(
                    base.width * SCENE_SCALE,
                    base.height * SCENE_SCALE,
                    base.thickness * SCENE_SCALE
                );
                const frontMesh = new THREE.Mesh(frontGeo, material);
                const frontEdges = new THREE.EdgesGeometry(frontGeo);
                const frontOutline = new THREE.LineSegments(frontEdges, new THREE.LineBasicMaterial({ color: edgeColor, opacity: edgeOpacity, transparent: true }));
                frontMesh.add(frontOutline);
                group.add(frontMesh);
                
                // 2. –í–µ—Ä—Ö–Ω–∏–π –±–æ—Ä—Ç–∏–∫
                const topGeo = new THREE.BoxGeometry(base.width * SCENE_SCALE, base.thickness * SCENE_SCALE, bendDepth);
                const topMesh = new THREE.Mesh(topGeo, material);
                topMesh.position.set(0, (base.height * SCENE_SCALE / 2) - (base.thickness * SCENE_SCALE / 2), -bendDepth / 2);
                const topOutline = new THREE.LineSegments(new THREE.EdgesGeometry(topGeo), new THREE.LineBasicMaterial({ color: edgeColor, opacity: edgeOpacity, transparent: true }));
                topMesh.add(topOutline);
                group.add(topMesh);
                
                // 3. –ù–∏–∂–Ω–∏–π –±–æ—Ä—Ç–∏–∫
                const bottomGeo = new THREE.BoxGeometry(base.width * SCENE_SCALE, base.thickness * SCENE_SCALE, bendDepth);
                const bottomMesh = new THREE.Mesh(bottomGeo, material);
                bottomMesh.position.set(0, -(base.height * SCENE_SCALE / 2) + (base.thickness * SCENE_SCALE / 2), -bendDepth / 2);
                const bottomOutline = new THREE.LineSegments(new THREE.EdgesGeometry(bottomGeo), new THREE.LineBasicMaterial({ color: edgeColor, opacity: edgeOpacity, transparent: true }));
                bottomMesh.add(bottomOutline);
                group.add(bottomMesh);
                
                // 4. –õ–µ–≤—ã–π –±–æ—Ä—Ç–∏–∫
                const leftGeo = new THREE.BoxGeometry(base.thickness * SCENE_SCALE, (base.height * SCENE_SCALE) - (2 * base.thickness * SCENE_SCALE), bendDepth);
                const leftMesh = new THREE.Mesh(leftGeo, material);
                leftMesh.position.set(-(base.width * SCENE_SCALE / 2) + (base.thickness * SCENE_SCALE / 2), 0, -bendDepth / 2);
                const leftOutline = new THREE.LineSegments(new THREE.EdgesGeometry(leftGeo), new THREE.LineBasicMaterial({ color: edgeColor, opacity: edgeOpacity, transparent: true }));
                leftMesh.add(leftOutline);
                group.add(leftMesh);
                
                // 5. –ü—Ä–∞–≤—ã–π –±–æ—Ä—Ç–∏–∫
                const rightGeo = new THREE.BoxGeometry(base.thickness * SCENE_SCALE, (base.height * SCENE_SCALE) - (2 * base.thickness * SCENE_SCALE), bendDepth);
                const rightMesh = new THREE.Mesh(rightGeo, material);
                rightMesh.position.set((base.width * SCENE_SCALE / 2) - (base.thickness * SCENE_SCALE / 2), 0, -bendDepth / 2);
                const rightOutline = new THREE.LineSegments(new THREE.EdgesGeometry(rightGeo), new THREE.LineBasicMaterial({ color: edgeColor, opacity: edgeOpacity, transparent: true }));
                rightMesh.add(rightOutline);
                group.add(rightMesh);
                
                newMeshOrGroup = group;
            }
            
            // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º Z-–ø–æ–∑–∏—Ü–∏—é —Å —É—á—ë—Ç–æ–º –ö–ê–†–ö–ê–°–ê –∏ –∑–∞–≥–∏–±–∞
            let frameDepthOffset = 0;
            if (base.hasFrame && base.frameProfile) {
                const parts = base.frameProfile.split('x');
                const profileDepth = parseInt(parts[1] || parts[0]);
                frameDepthOffset = profileDepth * SCENE_SCALE;
            }
            const halfThickness = (base.thickness * SCENE_SCALE) / 2;
            const bendOffset = base.bend * SCENE_SCALE;
            const newZ = -10 + frameDepthOffset + halfThickness + bendOffset;
            
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º X –∏ Y, –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º Z
            newMeshOrGroup.position.set(currentPosition.x, currentPosition.y, newZ);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—É—é –ø–æ–∑–∏—Ü–∏—é
            bases[activeBaseIndex].positionZ = newZ;
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–æ–≤—ã–π mesh/group
            bases[activeBaseIndex].mesh = newMeshOrGroup;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≤ —Å—Ü–µ–Ω—É
            scene.add(newMeshOrGroup);
            
            // –ü–µ—Ä–µ—Å–æ–∑–¥–∞—ë–º –∫–∞—Ä–∫–∞—Å (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω)
            if (base.frameMesh) {
                scene.remove(base.frameMesh);
                base.frameMesh.traverse(child => {
                    if (child.geometry) child.geometry.dispose();
                    if (child.material) {
                        if (Array.isArray(child.material)) {
                            child.material.forEach(m => m.dispose());
                        } else {
                            child.material.dispose();
                        }
                    }
                });
                base.frameMesh = null;
            }
            
            if (base.hasFrame) {
                const newFrameMesh = createBaseFrame(
                    base.width,
                    base.height,
                    base.frameProfile || '20x20',
                    base.frameColor || '#808080',
                    base.thickness,
                    base.bend || 0,
                    currentPosition.x,
                    currentPosition.y
                );
                scene.add(newFrameMesh);
                bases[activeBaseIndex].frameMesh = newFrameMesh;
            }
            
            log(`–ì–µ–æ–º–µ—Ç—Ä–∏—è –æ—Å–Ω–æ–≤—ã –æ–±–Ω–æ–≤–ª–µ–Ω–∞: ${base.width}√ó${base.height}–º–º, –∑–∞–≥–∏–±: ${base.bend}–º–º, Z: ${newZ.toFixed(2)}`, 'info');
        }
        
        // === –û–ë–ù–û–í–õ–ï–ù–ò–ï –†–ê–ó–ú–ï–†–û–í –ê–ö–¢–ò–í–ù–û–ô –û–°–ù–û–í–´ ===
        function updateActiveBaseSize() {
            if (activeBaseIndex === null || !bases[activeBaseIndex]) return;
            
            // –ü–µ—Ä–µ—Å–æ–∑–¥–∞—ë–º –≥–µ–æ–º–µ—Ç—Ä–∏—é
            updateActiveBaseGeometry();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä—ã —Å –∑–∞–≥–∏–±–æ–º –µ—Å–ª–∏ —ç—Ç–æ –∫–æ–º–ø–æ–∑–∏—Ç
            const base = bases[activeBaseIndex];
            if (base.material && base.material.startsWith('composite')) {
                checkActiveBaseSizeWithBend();
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫
            renderBasesList();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–∞—Å—á—ë—Ç
            updateCostCalculator();
            
            log(`–†–∞–∑–º–µ—Ä –æ—Å–Ω–æ–≤—ã –æ–±–Ω–æ–≤–ª—ë–Ω: ${base.width}√ó${base.height}–º–º`, 'info');
        }
        
        // === –ü–û–õ–£–ß–ï–ù–ò–ï –ú–ê–ö–°–ò–ú–ê–õ–¨–ù–û–ô –¢–û–õ–©–ò–ù–´ –û–°–ù–û–í–´ –í –ï–î–ò–ù–ò–¶–ê–• –°–¶–ï–ù–´ ===
        function getBaseThicknessInScene() {
            if (bases.length === 0) {
                return 0;
            }
            
            // –ù–∞—Ö–æ–¥–∏–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é —Ç–æ–ª—â–∏–Ω—É —Å—Ä–µ–¥–∏ –≤—Å–µ—Ö –æ—Å–Ω–æ–≤
            let maxThickness = 0;
            bases.forEach(base => {
                if (base.thickness > maxThickness) {
                    maxThickness = base.thickness;
                }
            });
            
            // –ú–∞—Å—à—Ç–∞–± —Å—Ü–µ–Ω—ã: 1 –µ–¥–∏–Ω–∏—Ü–∞ Three.js = 10 –º–º
            const SCENE_SCALE = 0.1; // 10–º–º = 1 –µ–¥–∏–Ω–∏—Ü–∞
            
            return maxThickness * SCENE_SCALE;
        }
        
        // === –ü–û–õ–£–ß–ï–ù–ò–ï –ú–ê–ö–°–ò–ú–ê–õ–¨–ù–û–ì–û –ó–ê–ì–ò–ë–ê –û–°–ù–û–í–´ –í –ï–î–ò–ù–ò–¶–ê–• –°–¶–ï–ù–´ ===
        function getMaxBaseBend() {
            if (bases.length === 0) {
                return 0;
            }
            
            // –ù–∞—Ö–æ–¥–∏–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –∑–∞–≥–∏–± —Å—Ä–µ–¥–∏ –≤—Å–µ—Ö –æ—Å–Ω–æ–≤
            let maxBend = 0;
            bases.forEach(base => {
                if (base.bend && base.bend > maxBend) {
                    maxBend = base.bend;
                }
            });
            
            // –ú–∞—Å—à—Ç–∞–± —Å—Ü–µ–Ω—ã: 1 –µ–¥–∏–Ω–∏—Ü–∞ Three.js = 10 –º–º
            const SCENE_SCALE = 0.1; // 10–º–º = 1 –µ–¥–∏–Ω–∏—Ü–∞
            
            return maxBend * SCENE_SCALE;
        }
        
        // === –ü–û–õ–£–ß–ï–ù–ò–ï –ú–ê–ö–°–ò–ú–ê–õ–¨–ù–û–ô –ì–õ–£–ë–ò–ù–´ –ö–ê–†–ö–ê–°–ê –û–°–ù–û–í–´ –í –ï–î–ò–ù–ò–¶–ê–• –°–¶–ï–ù–´ ===
        function getMaxBaseFrameDepth() {
            if (bases.length === 0) {
                return 0;
            }
            
            // –ù–∞—Ö–æ–¥–∏–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –≥–ª—É–±–∏–Ω—É –∫–∞—Ä–∫–∞—Å–∞ —Å—Ä–µ–¥–∏ –≤—Å–µ—Ö –æ—Å–Ω–æ–≤
            let maxFrameDepth = 0;
            bases.forEach(base => {
                if (base.hasFrame && base.frameProfile) {
                    const parts = base.frameProfile.split('x');
                    const profileDepth = parseInt(parts[1] || parts[0]); // –ì–ª—É–±–∏–Ω–∞ = –≤—Ç–æ—Ä–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
                    if (profileDepth > maxFrameDepth) {
                        maxFrameDepth = profileDepth;
                    }
                }
            });
            
            // –ú–∞—Å—à—Ç–∞–± —Å—Ü–µ–Ω—ã: 1 –µ–¥–∏–Ω–∏—Ü–∞ Three.js = 10 –º–º
            const SCENE_SCALE = 0.1; // 10–º–º = 1 –µ–¥–∏–Ω–∏—Ü–∞
            
            return maxFrameDepth * SCENE_SCALE;
        }
        
        // === –ü–û–õ–£–ß–ï–ù–ò–ï –ú–ê–ö–°–ò–ú–ê–õ–¨–ù–û–ô –¢–û–õ–©–ò–ù–´ (–®–ò–†–ò–ù–´) –ö–ê–†–ö–ê–°–ê –û–°–ù–û–í–´ –í –ï–î–ò–ù–ò–¶–ê–• –°–¶–ï–ù–´ ===
        function getMaxBaseFrameThickness() {
            if (bases.length === 0) {
                return 0;
            }
            
            // –ù–∞—Ö–æ–¥–∏–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é —Ç–æ–ª—â–∏–Ω—É/—à–∏—Ä–∏–Ω—É –∫–∞—Ä–∫–∞—Å–∞ —Å—Ä–µ–¥–∏ –≤—Å–µ—Ö –æ—Å–Ω–æ–≤
            let maxFrameThickness = 0;
            bases.forEach(base => {
                if (base.hasFrame && base.frameProfile) {
                    const parts = base.frameProfile.split('x');
                    const profileThickness = parseInt(parts[0]); // –®–∏—Ä–∏–Ω–∞ = –ø–µ—Ä–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
                    if (profileThickness > maxFrameThickness) {
                        maxFrameThickness = profileThickness;
                    }
                }
            });
            
            // –ú–∞—Å—à—Ç–∞–± —Å—Ü–µ–Ω—ã: 1 –µ–¥–∏–Ω–∏—Ü–∞ Three.js = 10 –º–º
            const SCENE_SCALE = 0.1; // 10–º–º = 1 –µ–¥–∏–Ω–∏—Ü–∞
            
            return maxFrameThickness * SCENE_SCALE;
        }
        
        // === –£–ü–†–ê–í–õ–ï–ù–ò–ï –ü–û–õ–û–ñ–ï–ù–ò–ï–ú –ë–£–ö–í –ò –ü–û–î–°–í–ï–¢–ö–û–ô ===
        function updateWallAndShadows() {
            log('–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–Ω–µ–π –∏ —Å—Ç–µ–Ω—ã...', 'info');
            
            // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π —Å–≤–µ—Ç
            if (backLight) {
                if (Array.isArray(backLight)) {
                    backLight.forEach(light => scene.remove(light));
                } else {
                    scene.remove(backLight);
                }
                backLight = null;
            }
            
            // –†–∞–±–æ—Ç–∞–µ–º —Å –∞–∫—Ç–∏–≤–Ω—ã–º SVG
            if (activeSvgIndex === null || !svgGroups[activeSvgIndex]) {
                log('–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–≥–æ SVG', 'warning');
                return;
            }
            
            const svgObj = svgGroups[activeSvgIndex];
            
            // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –∫–ª–æ–Ω—ã (—Ç–µ–Ω–∏) –∞–∫—Ç–∏–≤–Ω–æ–≥–æ SVG
            if (svgObj.shadowClones && svgObj.shadowClones.length > 0) {
                log(`–£–¥–∞–ª—è–µ–º ${svgObj.shadowClones.length} –∫–ª–æ–Ω–æ–≤ (—Ç–µ–Ω–µ–π)`, 'info');
                svgObj.shadowClones.forEach(clone => scene.remove(clone));
                svgObj.shadowClones = [];
            }
            
            // –¢–µ–Ω–∏ –æ—Ç–∫–ª—é—á–µ–Ω—ã –¥–ª—è —á–∏—Å—Ç–æ–≥–æ –≤–∏–¥–∞
            // (–≤ –±—É–¥—É—â–µ–º –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å outline-—ç—Ñ—Ñ–µ–∫—Ç –¥–ª—è –∫–∞—Ä–∫–∞—Å–∞)
            
            // –í—ã—á–∏—Å–ª—è–µ–º —Ç–æ–ª—â–∏–Ω—É –ø—Ä–æ—Ñ–∏–ª–µ–π –≤ —Å—Ü–µ–Ω–µ (–∏—Å–ø–æ–ª—å–∑—É–µ–º –ì–õ–£–ë–ò–ù–£, –Ω–µ –≤—ã—Å–æ—Ç—É!)
            let maxProfileThickness = 0;
            if (frameProfiles && frameProfiles.length > 0 && svgGroups && svgGroups.length > 0) {
                const visibleSvg = svgGroups.find(obj => obj.visible);
                if (visibleSvg && visibleSvg.realWidth && visibleSvg.svgWidth) {
                    const sceneScale = visibleSvg.realWidth / visibleSvg.svgWidth;
                    frameProfiles.forEach(prof => {
                        const thicknessInScene = (prof.profileDepth || prof.profileSize || 15) / sceneScale;
                        if (thicknessInScene > maxProfileThickness) {
                            maxProfileThickness = thicknessInScene;
                        }
                    });
                }
            }
            
            // –°–¢–ï–ù–ê –Ω–∞ Z = -10
            // –ö–ê–†–ö–ê–° –û–°–ù–û–í–´ –æ—Ç Z = -10 –¥–æ Z = -10 + –≥–ª—É–±–∏–Ω–∞_–∫–∞—Ä–∫–∞—Å–∞_–∫_—Å—Ç–µ–Ω–µ
            // –û–°–ù–û–í–ê –æ—Ç Z = -10 + –∫–∞—Ä–∫–∞—Å –¥–æ Z = -10 + –∫–∞—Ä–∫–∞—Å + —Ç–æ–ª—â–∏–Ω–∞_–æ—Å–Ω–æ–≤—ã
            // –ó–ê–ì–ò–ë –û–°–ù–û–í–´ –æ—Ç Z = -10 + –∫–∞—Ä–∫–∞—Å + –æ—Å–Ω–æ–≤–∞ –¥–æ Z = -10 + –∫–∞—Ä–∫–∞—Å + –æ—Å–Ω–æ–≤–∞ + –∑–∞–≥–∏–±
            // –ü–†–û–§–ò–õ–¨ –æ—Ç Z = -10 + –∫–∞—Ä–∫–∞—Å + –æ—Å–Ω–æ–≤–∞ + –∑–∞–≥–∏–± –¥–æ Z = -10 + –∫–∞—Ä–∫–∞—Å + –æ—Å–Ω–æ–≤–∞ + –∑–∞–≥–∏–± + —Ç–æ–ª—â–∏–Ω–∞_–ø—Ä–æ—Ñ–∏–ª—è
            // –ë–£–ö–í–´ –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è –æ—Ç Z = -10 + –∫–∞—Ä–∫–∞—Å + –æ—Å–Ω–æ–≤–∞ + –∑–∞–≥–∏–± + –ø—Ä–æ—Ñ–∏–ª—å
            const baseFrameDepth = getMaxBaseFrameDepth(); // –ì–ª—É–±–∏–Ω–∞ –∫–∞—Ä–∫–∞—Å–∞ –∫ —Å—Ç–µ–Ω–µ (20–º–º –∏–∑ "40x20")
            const baseThickness = getBaseThicknessInScene();
            const baseBend = getMaxBaseBend();
            const spacerDistance = 1.5; // ~20-25–º–º –æ—Ç—Å—Ç—É–ø –æ—Ç –ø—Ä–æ—Ñ–∏–ª—è/—Å—Ç–µ–Ω—ã –ø—Ä–∏ —ç—Ñ—Ñ–µ–∫—Ç–∞—Ö
            const depth = svgObj.group.children[0] ? Math.abs(svgObj.group.children[0].scale.z) : 0.5;
            
            // –ë–∞–∑–æ–≤–∞—è –ø–æ–∑–∏—Ü–∏—è - –∑–∞–¥–Ω–∏–∫ –±—É–∫–≤—ã –∫–∞—Å–∞–µ—Ç—Å—è –ø—Ä–æ—Ñ–∏–ª—è (–∏–ª–∏ –æ—Å–Ω–æ–≤—ã/—Å—Ç–µ–Ω—ã –µ—Å–ª–∏ –Ω–µ—Ç –ø—Ä–æ—Ñ–∏–ª—è)
            // –£—á–∏—Ç—ã–≤–∞–µ–º: –ì–õ–£–ë–ò–ù–ê_–ö–ê–†–ö–ê–°–ê + –û–°–ù–û–í–ê + –ó–ê–ì–ò–ë + –ü–†–û–§–ò–õ–¨!
            const baseZ = -10 + baseFrameDepth + baseThickness + baseBend + maxProfileThickness + depth;
            
            if (state.hasSpacers || state.hasContour) {
                // –û—Ç–æ–¥–≤–∏–≥–∞–µ–º –±—É–∫–≤—ã –æ—Ç –ø—Ä–æ—Ñ–∏–ª—è + —É—á–∏—Ç—ã–≤–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ —Å–º–µ—â–µ–Ω–∏–µ
                svgObj.group.position.z = baseZ + spacerDistance + svgObj.position.z;
                if (svgObj.dimensionGroup) {
                    svgObj.dimensionGroup.position.z = baseZ + spacerDistance + svgObj.position.z;
                }
            } else {
                // –ë—É–∫–≤—ã –≤–ø–ª–æ—Ç–Ω—É—é –∫ –ø—Ä–æ—Ñ–∏–ª—é + –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ —Å–º–µ—â–µ–Ω–∏–µ –ø–æ Z
                svgObj.group.position.z = baseZ + svgObj.position.z;
                if (svgObj.dimensionGroup) {
                    svgObj.dimensionGroup.position.z = baseZ + svgObj.position.z;
                }
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ü–≤–µ—Ç —Å—Ç–µ–Ω—ã (–ø–æ–∑–∏—Ü–∏—è –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è - —Å—Ç–∞—Ç–∏—á–Ω–∞ –Ω–∞ Z = -10)
            if (backWall) {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º —Ü–≤–µ—Ç –∏–∑ state
                log(`üé® –ü—Ä–∏–º–µ–Ω—è—é —Ü–≤–µ—Ç —Å—Ç–µ–Ω—ã –∏–∑ state: ${state.wallColor}`, 'info');
                backWall.material.color.set(state.wallColor);
            }
            
            // –°–æ–∑–¥–∞—ë–º –ø–ª–æ—Å–∫–∏–µ –∫–ª–æ–Ω—ã –±—É–∫–≤ (–∏–º–∏—Ç–∞—Ü–∏—è —Ç–µ–Ω–∏) –µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω—ã –¥–∏—Å—Ç–∞–Ω—Ü–∏–æ–Ω–∫–∏/–∫–æ–Ω—Ç—Ä–∞–∂—É—Ä
            if (state.hasContour) {
                // –ö–û–ù–¢–†–ê–ñ–£–†: –º—è–≥–∫–∏–π –æ—Ä–µ–æ–ª
                createShadowClonesForSVG(svgObj, 'contour'); 
            } else if (state.hasSpacers) {
                // –î–ò–°–¢–ê–ù–¶–ò–û–ù–ö–ò: —Ç—ë–º–Ω–∞—è —Ä–∞–∑–º—ã—Ç–∞—è —Ç–µ–Ω—å
                createShadowClonesForSVG(svgObj, 'spacers');
            }
            
            // –î–ª—è –∫–æ–Ω—Ç—Ä–∞–∂—É—Ä–Ω–æ–π –ø–æ–¥—Å–≤–µ—Ç–∫–∏ (–ò–°–ü–û–õ–¨–ó–£–ï–ú –¢–û–õ–¨–ö–û –ü–õ–û–°–ö–ò–ï –ö–õ–û–ù–´)
            if (state.hasContour) {
                log(`–ö–æ–Ω—Ç—Ä–∞–∂—É—Ä–Ω–∞—è –ø–æ–¥—Å–≤–µ—Ç–∫–∞: –í–ö–õ (–±–µ–ª—ã–π –æ—Ä–µ–æ–ª)`, 'info');
            } else if (state.hasSpacers) {
                log('–î–∏—Å—Ç–∞–Ω—Ü–∏–æ–Ω–Ω—ã–µ –¥–µ—Ä–∂–∞—Ç–µ–ª–∏: –í–ö–õ (—Ç—ë–º–Ω–∞—è —Ç–µ–Ω—å)', 'info');
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≥—Ä–∞–Ω–∏—Ü—ã shadow camera –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª–æ–∂–µ–Ω–∏—è –±—É–∫–≤
            updateShadowCamera();
        }
        
        function animate() {
            requestAnimationFrame(animate);
            
            if (controls) controls.update();
            if (renderer && scene && camera) {
                renderer.render(scene, camera);
            }
        }
        
        function onResize() {
            const canvas = document.getElementById('canvas-3d');
            if (!canvas || !renderer) return;
            
            const width = window.innerWidth;
            const height = window.innerHeight;
            
            camera.aspect = width / height;
            
            // –°–ú–ï–©–ê–ï–ú –¶–ï–ù–¢–† –ö–ê–ú–ï–†–´ –í–õ–ï–í–û (–Ω–∞ 210 –ø–∏–∫—Å–µ–ª–µ–π)
            // –≠—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç –±—É–∫–≤–∞–º –±—ã—Ç—å –≤–∏–∑—É–∞–ª—å–Ω–æ –ø–æ —Ü–µ–Ω—Ç—Ä—É –ª–µ–≤–æ–π –æ–±–ª–∞—Å—Ç–∏, 
            // –Ω–µ –∑–∞–µ–∑–∂–∞—è –ø–æ–¥ –ø—Ä–∞–≤—É—é –ø–∞–Ω–µ–ª—å (420px / 2 = 210)
            camera.setViewOffset(width, height, 210, 0, width, height);
            
            camera.updateProjectionMatrix();
            renderer.setSize(width, height);
            
            log(`–°—Ü–µ–Ω–∞ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–∞: ${width}x${height} —Å–æ —Å–º–µ—â–µ–Ω–∏–µ–º 210px`, 'info');
        }
        
        // === –ó–ê–ì–†–£–ó–ö–ê SVG ===
        function handleSVGUpload(file) {
            if (!file || !file.name.toLowerCase().endsWith('.svg')) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª SVG');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = (e) => {
                const svgText = e.target.result;
                const container = document.getElementById('svg-preview-container');
                container.innerHTML = svgText;
                container.style.display = 'flex';
                
                const uploadZone = document.getElementById('upload-zone');
                uploadZone.classList.add('has-file');
                
                // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ SVG
                const svg = container.querySelector('svg');
                if (svg) {
                    const viewBox = svg.getAttribute('viewBox');
                    const width = svg.getAttribute('width');
                    const height = svg.getAttribute('height');
                    
                    
                    state.svgLoaded = true;
                    log(`SVG –∑–∞–≥—Ä—É–∂–µ–Ω: ${file.name}`, 'success');
                    
                    // üî• –î–û–ë–ê–í–õ–Ø–ï–ú –ù–û–í–´–ô SVG –í –°–¶–ï–ù–£!
                    addSVG(svgText, file.name);
                }
            };
            reader.readAsText(file);
        }
        
        // === –†–ï–ö–£–†–°–ò–í–ù–ê–Ø –ó–ê–ú–ï–ù–ê –¶–í–ï–¢–ê –í–û –í–°–ï–• –≠–õ–ï–ú–ï–ù–¢–ê–• ===
        function applyColorToElement(element, color) {
            let count = 0;
            
            // –°–ø–∏—Å–æ–∫ –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ SVG
            const graphicElements = ['path', 'polygon', 'circle', 'rect', 'ellipse', 'line', 'polyline'];
            
            function processNode(node) {
                // –ï—Å–ª–∏ —ç—Ç–æ –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π —ç–ª–µ–º–µ–Ω—Ç
                if (graphicElements.includes(node.tagName?.toLowerCase())) {
                    // –£–¥–∞–ª—è–µ–º stroke –µ—Å–ª–∏ –µ—Å—Ç—å (—á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ –∫–æ–Ω—Ç—É—Ä–æ–≤)
                    if (node.hasAttribute('stroke')) {
                        node.removeAttribute('stroke');
                    }
                    
                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º fill
                    node.setAttribute('fill', color);
                    count++;
                    
                    // –¢–∞–∫–∂–µ –ø—Ä–æ–≤–µ—Ä—è–µ–º style
                    if (node.hasAttribute('style')) {
                        let style = node.getAttribute('style');
                        // –£–±–∏—Ä–∞–µ–º stroke
                        style = style.replace(/stroke\s*:\s*[^;]+;?/gi, '');
                        // –ó–∞–º–µ–Ω—è–µ–º –∏–ª–∏ –¥–æ–±–∞–≤–ª—è–µ–º fill
                        if (/fill\s*:/.test(style)) {
                            style = style.replace(/fill\s*:\s*[^;]+/gi, `fill:${color}`);
                        } else {
                            style += `; fill:${color}`;
                        }
                        node.setAttribute('style', style);
                    }
                }
                
                // –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –¥–æ—á–µ—Ä–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã
                if (node.children) {
                    for (let child of node.children) {
                        processNode(child);
                    }
                }
            }
            
            processNode(element);
            return count;
        }
        
        // === –≠–ö–°–ü–û–†–¢ –í–°–ï–ô –ö–û–ú–ü–û–ó–ò–¶–ò–ò –í SVG (–í–ê–†–ò–ê–ù–¢ B) ===
        function exportSceneToSVG() {
            if (svgGroups.length === 0) {
                throw new Error('–ù–µ—Ç –æ–±—ä–µ–∫—Ç–æ–≤ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞');
            }
            
            // 1. –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—â–∏–π bounding box –≤—Å–µ–π –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏
            let minX = Infinity, minY = Infinity, maxX = -Infinity, maxY = -Infinity;
            
            svgGroups.forEach(svgObj => {
                const pos = svgObj.position || { x: 0, y: 0, z: 0 };
                const width = svgObj.currentWidth || svgObj.realWidth;
                const height = svgObj.currentHeight || svgObj.realHeight;
                
                // –ü–æ–∑–∏—Ü–∏—è —Ü–µ–Ω—Ç—Ä–∞ –æ–±—ä–µ–∫—Ç–∞
                const centerX = pos.x * 10; // Three.js –µ–¥–∏–Ω–∏—Ü—ã ‚Üí –º–º
                const centerY = -pos.y * 10; // –ò–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º Y (Three.js ‚Üí SVG)
                
                // –ì—Ä–∞–Ω–∏—Ü—ã –æ–±—ä–µ–∫—Ç–∞
                const left = centerX - width / 2;
                const right = centerX + width / 2;
                const top = centerY - height / 2;
                const bottom = centerY + height / 2;
                
                minX = Math.min(minX, left);
                maxX = Math.max(maxX, right);
                minY = Math.min(minY, top);
                maxY = Math.max(maxY, bottom);
            });
            
            const padding = 50; // –û—Ç—Å—Ç—É–ø—ã –≤ –º–º
            const totalWidth = maxX - minX + padding * 2;
            const totalHeight = maxY - minY + padding * 2;
            
            // 2. –°–æ–∑–¥–∞—ë–º SVG –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
            let svgContent = `<?xml version="1.0" encoding="UTF-8"?>\n`;
            svgContent += `<svg xmlns="http://www.w3.org/2000/svg" `;
            svgContent += `width="${totalWidth}mm" height="${totalHeight}mm" `;
            svgContent += `viewBox="0 0 ${totalWidth} ${totalHeight}">\n`;
            svgContent += `  <desc>–ö–æ–º–ø–æ–∑–∏—Ü–∏—è –∏–∑ ${svgGroups.length} –æ–±—ä–µ–∫—Ç–æ–≤, —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∏–∑ 3D —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞</desc>\n\n`;
            
            // 3. –î–æ–±–∞–≤–ª—è–µ–º –∫–∞–∂–¥—ã–π SVG –æ–±—ä–µ–∫—Ç —Å —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è–º–∏
            svgGroups.forEach((svgObj, index) => {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ originalSvg
                if (!svgObj.originalSvg) {
                    log(`‚ö†Ô∏è –û–±—ä–µ–∫—Ç ${svgObj.name} –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç originalSvg, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º`, 'warning');
                    return;
                }
                
                const pos = svgObj.position || { x: 0, y: 0, z: 0 };
                const currentWidth = svgObj.currentWidth || svgObj.realWidth;
                const currentHeight = svgObj.currentHeight || svgObj.realHeight;
                const realWidth = svgObj.realWidth;
                const realHeight = svgObj.realHeight;
                
                // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –º–∞—Å—à—Ç–∞–±: —Ç–µ–∫—É—â–∏–π / –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π
                const scaleX = currentWidth / realWidth;
                const scaleY = currentHeight / realHeight;
                
                // –ü–æ–∑–∏—Ü–∏—è –≤ SVG –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞—Ö (–æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ª–µ–≤–æ–≥–æ –≤–µ—Ä—Ö–Ω–µ–≥–æ —É–≥–ª–∞ –æ–±—â–µ–≥–æ —Ö–æ–ª—Å—Ç–∞)
                const centerX = pos.x * 10 - minX + padding;
                const centerY = -pos.y * 10 - minY + padding;
                
                // –ü–∞—Ä—Å–∏–º –∏—Å—Ö–æ–¥–Ω—ã–π SVG
                const parser = new DOMParser();
                const doc = parser.parseFromString(svgObj.originalSvg, 'image/svg+xml');
                const svgElement = doc.querySelector('svg');
                
                if (!svgElement) {
                    log(`‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å SVG –æ–±—ä–µ–∫—Ç–∞ ${svgObj.name}`, 'warning');
                    return;
                }
                
                log(`‚úÖ –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É—é: ${svgObj.name}, —Ä–∞–∑–º–µ—Ä: ${currentWidth.toFixed(1)}√ó${currentHeight.toFixed(1)}–º–º (scale: ${scaleX.toFixed(2)}), —Ü–≤–µ—Ç: ${svgObj.color}`, 'info');
                
                // –ü–æ–ª—É—á–∞–µ–º viewBox –∏–ª–∏ —Ä–∞–∑–º–µ—Ä—ã
                let viewBox = svgElement.getAttribute('viewBox');
                if (!viewBox) {
                    const vbWidth = svgElement.getAttribute('width') || realWidth;
                    const vbHeight = svgElement.getAttribute('height') || realHeight;
                    viewBox = `0 0 ${vbWidth} ${vbHeight}`;
                }
                
                log(`üîç –¶–≤–µ—Ç –æ–±—ä–µ–∫—Ç–∞ ${svgObj.name}: "${svgObj.color}"`, 'info');
                
                // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ü–≤–µ—Ç –µ—Å–ª–∏ –Ω–µ "–æ—Ä–∏–≥–∏–Ω–∞–ª"
                if (svgObj.color && svgObj.color !== 'original') {
                    log(`üé® –ü—Ä–∏–º–µ–Ω—è—é —Ü–≤–µ—Ç ${svgObj.color} –∫ –æ–±—ä–µ–∫—Ç—É ${svgObj.name}`, 'info');
                    const fillCount = applyColorToElement(svgElement, svgObj.color);
                    log(`‚úÖ –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ ${fillCount} –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤`, 'info');
                } else {
                    log(`‚ö†Ô∏è –¶–≤–µ—Ç –Ω–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è (—Ü–≤–µ—Ç="${svgObj.color}")`, 'warning');
                }
                
                // –ü–æ–ª—É—á–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ SVG (–≤—Å–µ –≤–ª–æ–∂–µ–Ω–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã)
                const serializer = new XMLSerializer();
                let content = '';
                
                // –°–µ—Ä–∏–∞–ª–∏–∑—É–µ–º –≤—Å–µ –¥–æ—á–µ—Ä–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã
                for (let child of svgElement.children) {
                    content += serializer.serializeToString(child);
                }
                
                // –°–æ–∑–¥–∞—ë–º –≥—Ä—É–ø–ø—É —Å —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è–º–∏
                svgContent += `  <!-- –û–±—ä–µ–∫—Ç ${index + 1}: ${svgObj.name} (${currentWidth.toFixed(1)}√ó${currentHeight.toFixed(1)}–º–º) -->\n`;
                svgContent += `  <g id="object-${index}" transform="translate(${centerX.toFixed(2)}, ${centerY.toFixed(2)})">\n`;
                svgContent += `    <g transform="translate(${(-currentWidth / 2).toFixed(2)}, ${(-currentHeight / 2).toFixed(2)}) scale(${scaleX.toFixed(6)}, ${scaleY.toFixed(6)})">\n`;
                svgContent += `      <svg width="${realWidth}" height="${realHeight}" viewBox="${viewBox}" xmlns="http://www.w3.org/2000/svg">\n`;
                svgContent += `        ${content}\n`;
                svgContent += `      </svg>\n`;
                svgContent += `    </g>\n`;
                svgContent += `  </g>\n\n`;
            });
            
            svgContent += `</svg>`;
            
            log(`üìê SVG –∫–æ–º–ø–æ–∑–∏—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞: ${totalWidth.toFixed(1)}√ó${totalHeight.toFixed(1)}–º–º`, 'info');
            
            return svgContent;
        }
        
        // === –î–û–ë–ê–í–õ–ï–ù–ò–ï –ù–û–í–û–ì–û SVG –í –°–¶–ï–ù–£ ===
        function addSVG(svgString, filename = 'SVG') {
            console.log('[DEBUG addSVG] –í—ã–∑–≤–∞–Ω–∞ —Å filename:', filename);
            console.log('[DEBUG addSVG] scene exists:', !!scene);
            console.log('[DEBUG addSVG] svgGroups –¥–æ:', svgGroups.length);
            
            if (!scene) {
                log('3D —Å—Ü–µ–Ω–∞ –µ—â—ë –Ω–µ –≥–æ—Ç–æ–≤–∞', 'warning');
                console.error('[ERROR] scene –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!');
                return;
            }
            
            console.log('[DEBUG addSVG] –ù–∞—á–∏–Ω–∞—é –æ–±—Ä–∞–±–æ—Ç–∫—É SVG...');
            
            try {
                // === –ö–†–ò–¢–ò–ß–ù–û: –û–ß–ò–°–¢–ö–ê SVG –î–û –ü–ê–†–°–ò–ù–ì–ê THREE.JS ===
                // Three.js SVGLoader –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç —ç–ª–µ–º–µ–Ω—Ç—ã —Ç–æ–ª—å–∫–æ —Å–æ stroke!
                // –ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å fill –î–û –ø–µ—Ä–µ–¥–∞—á–∏ –≤ loader
                
                const cleanParser = new DOMParser();
                const cleanDoc = cleanParser.parseFromString(svgString, 'image/svg+xml');
                const cleanSvg = cleanDoc.querySelector('svg');
                
                if (cleanSvg) {
                    let processedCount = 0;
                    let strokeOnlyCount = 0;
                    let fillOnlyCount = 0;
                    
                    // –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã
                    function cleanSVGElement(element) {
                        const graphicElements = ['path', 'polygon', 'circle', 'rect', 'ellipse', 'line', 'polyline'];
                        
                        if (graphicElements.includes(element.tagName?.toLowerCase())) {
                            processedCount++;
                            
                            // –ü—Ä–æ–≤–µ—Ä—è–µ–º fill –∏ stroke (–∏ –≤ –∞—Ç—Ä–∏–±—É—Ç–∞—Ö –∏ –≤ style)
                            let fillValue = null;
                            let strokeValue = null;
                            
                            // –ß–∏—Ç–∞–µ–º –∏–∑ –∞—Ç—Ä–∏–±—É—Ç–æ–≤
                            if (element.hasAttribute('fill') && element.getAttribute('fill') !== 'none') {
                                fillValue = element.getAttribute('fill');
                            }
                            if (element.hasAttribute('stroke') && element.getAttribute('stroke') !== 'none') {
                                strokeValue = element.getAttribute('stroke');
                            }
                            
                            // –ß–∏—Ç–∞–µ–º –∏–∑ style
                            if (element.hasAttribute('style')) {
                                const style = element.getAttribute('style');
                                const fillMatch = style.match(/fill\s*:\s*([^;]+)/);
                                const strokeMatch = style.match(/stroke\s*:\s*([^;]+)/);
                                
                                if (fillMatch && fillMatch[1] !== 'none') {
                                    fillValue = fillMatch[1].trim();
                                }
                                if (strokeMatch && strokeMatch[1] !== 'none') {
                                    strokeValue = strokeMatch[1].trim();
                                }
                            }
                            
                            // –°–õ–£–ß–ê–ô 1: –ï—Å—Ç—å stroke –Ω–æ –Ω–µ—Ç fill ‚Üí –∫–æ–ø–∏—Ä—É–µ–º stroke –≤ fill
                            if (strokeValue && !fillValue) {
                                element.setAttribute('fill', strokeValue);
                                fillValue = strokeValue;
                                strokeOnlyCount++;
                            }
                            
                            // –°–õ–£–ß–ê–ô 2: –ù–µ—Ç –Ω–∏ fill –Ω–∏ stroke ‚Üí —Å—Ç–∞–≤–∏–º —á—ë—Ä–Ω—ã–π
                            if (!fillValue && !strokeValue) {
                                element.setAttribute('fill', '#000000');
                                fillValue = '#000000';
                            }
                            
                            // –°–õ–£–ß–ê–ô 3: –ï—Å—Ç—å fill
                            if (fillValue && !strokeValue) {
                                fillOnlyCount++;
                            }
                            
                            // –ù–ï —É–¥–∞–ª—è–µ–º stroke - Three.js –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –µ–≥–æ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –≥–µ–æ–º–µ—Ç—Ä–∏–∏
                            // –ü—Ä–æ–±–ª–µ–º–∞ CorelDRAW: –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –∫–æ–Ω—Ç—É—Ä—ã –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–µ paths
                        }
                        
                        // –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ –¥–ª—è –¥–µ—Ç–µ–π
                        for (let child of element.children) {
                            cleanSVGElement(child);
                        }
                    }
                    
                    cleanSVGElement(cleanSvg);
                    
                    log(`‚úÖ –û—á–∏—Å—Ç–∫–∞: ${processedCount} —ç–ª–µ–º–µ–Ω—Ç–æ–≤ | fill+stroke‚Üífill: ${strokeOnlyCount} | —Ç–æ–ª—å–∫–æ fill: ${fillOnlyCount}`, 'info');
                    
                    // –°–µ—Ä–∏–∞–ª–∏–∑—É–µ–º –æ–±—Ä–∞—Ç–Ω–æ
                    const serializer = new XMLSerializer();
                    svgString = serializer.serializeToString(cleanDoc);
                }
                
                // –ù–ï —É–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ SVG, –∞ –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π!
                
                // –°–æ–∑–¥–∞—ë–º –Ω–æ–≤—É—é –∏–∑ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–≥–æ SVG
                const group = new THREE.Group();
                const loader = new THREE.SVGLoader();
                const svgData = loader.parse(svgString);
                
                if (!svgData || !svgData.paths || svgData.paths.length === 0) {
                    log('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–∞—Ä—Å–∏—Ç—å –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–π SVG', 'error');
                    return;
                }
                
                // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å —Ä–∞–∑–º–µ—Ä—ã –∏–∑ viewBox
                let svgWidth, svgHeight, svgCenterX, svgCenterY, minX, minY;
                
                // –ü–∞—Ä—Å–∏–º SVG –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è viewBox
                const viewBoxParser = new DOMParser();
                const viewBoxDoc = viewBoxParser.parseFromString(svgString, 'image/svg+xml');
                const viewBoxSvg = viewBoxDoc.querySelector('svg');
                
                if (viewBoxSvg && viewBoxSvg.getAttribute('viewBox')) {
                    const viewBox = viewBoxSvg.getAttribute('viewBox');
                    const parts = viewBox.split(/[\s,]+/).filter(v => v !== '');
                    if (parts.length === 4) {
                        minX = parseFloat(parts[0]);
                        minY = parseFloat(parts[1]);
                        svgWidth = parseFloat(parts[2]);
                        svgHeight = parseFloat(parts[3]);
                        svgCenterX = minX + svgWidth / 2;
                        svgCenterY = minY + svgHeight / 2;
                        log(`üìê –ò—Å–ø–æ–ª—å–∑—É–µ–º viewBox: ${svgWidth.toFixed(0)}√ó${svgHeight.toFixed(0)} –µ–¥ (–æ—Ç ${minX},${minY})`, 'info');
                    }
                }
                
                // –ï—Å–ª–∏ viewBox –Ω–µ –Ω–∞–π–¥–µ–Ω - —Å—á–∏—Ç–∞–µ–º –ø–æ —Ç–æ—á–∫–∞–º
                if (!svgWidth || !svgHeight) {
                    minX = Infinity;
                    minY = Infinity;
                    let maxX = -Infinity;
                    let maxY = -Infinity;
                    
                    svgData.paths.forEach(path => {
                        const shapes = path.toShapes(true);
                        shapes.forEach(shape => {
                            const points = shape.getPoints();
                            points.forEach(p => {
                                if (p.x < minX) minX = p.x;
                                if (p.x > maxX) maxX = p.x;
                                if (p.y < minY) minY = p.y;
                                if (p.y > maxY) maxY = p.y;
                            });
                        });
                    });
                    
                    svgWidth = maxX - minX;
                    svgHeight = maxY - minY;
                    svgCenterX = (minX + maxX) / 2;
                    svgCenterY = (minY + maxY) / 2;
                    log(`üìê –†–∞—Å—Å—á–∏—Ç–∞–Ω–æ –ø–æ —Ç–æ—á–∫–∞–º: ${svgWidth.toFixed(0)}√ó${svgHeight.toFixed(0)} –µ–¥`, 'info');
                }
                
                // –í–´–ß–ò–°–õ–Ø–ï–ú –†–ï–ê–õ–¨–ù–´–ï –†–ê–ó–ú–ï–†–´ –∏–∑ SVG –∞—Ç—Ä–∏–±—É—Ç–æ–≤
                const parser = new DOMParser();
                const svgDoc = parser.parseFromString(svgString, 'image/svg+xml');
                const svgElement = svgDoc.querySelector('svg');
                
                let realWidth = 0, realHeight = 0, totalElementsHeight = 0;
                
                if (svgElement) {
                    const widthAttr = svgElement.getAttribute('width');
                    const heightAttr = svgElement.getAttribute('height');
                    
                    // –ü–∞—Ä—Å–∏–º —Ä–∞–∑–º–µ—Ä—ã —Å –µ–¥–∏–Ω–∏—Ü–∞–º–∏ –∏–∑–º–µ—Ä–µ–Ω–∏—è
                    const parseSize = (str) => {
                        if (!str) return 0;
                        const num = parseFloat(str);
                        if (str.includes('mm')) return num;
                        if (str.includes('cm')) return num * 10;
                        if (str.includes('m') && !str.includes('mm')) return num * 1000;
                        return num * 0.26458; // px ‚Üí mm (96 DPI)
                    };
                    
                    realWidth = parseSize(widthAttr);
                    realHeight = parseSize(heightAttr);
                    
                    // –ï—Å–ª–∏ —Ä–∞–∑–º–µ—Ä—ã –Ω–µ —É–∫–∞–∑–∞–Ω—ã, –ø—Ä–æ–±—É–µ–º –≤—ã—á–∏—Å–ª–∏—Ç—å –∏–∑ viewBox
                    if (!realWidth || !realHeight) {
                        const viewBox = svgElement.getAttribute('viewBox');
                        if (viewBox) {
                            const parts = viewBox.split(/[\s,]+/).filter(v => v !== '');
                            if (parts.length === 4) {
                                // –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º —á—Ç–æ viewBox –≤ –µ–¥–∏–Ω–∏—Ü–∞—Ö px
                                realWidth = parseFloat(parts[2]) * 0.26458;
                                realHeight = parseFloat(parts[3]) * 0.26458;
                            }
                        }
                    }
                    
                    // –ü–û–î–°–ß–ò–¢–´–í–ê–ï–ú –°–£–ú–ú–£ –í–´–°–û–¢ –í–°–ï–• –≠–õ–ï–ú–ï–ù–¢–û–í (–í–°–ï–ì–î–ê, –∫–∞–∫ –≤ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–µ)
                    if (realWidth > 0 && realHeight > 0) {
                        const viewBox = svgElement.getAttribute('viewBox');
                        if (viewBox) {
                            const parts = viewBox.split(/[\s,]+/).filter(v => v !== '');
                            if (parts.length === 4) {
                                const viewBoxWidth = parseFloat(parts[2]);
                                const viewBoxHeight = parseFloat(parts[3]);
                                const mmPerUnit = realWidth / viewBoxWidth; // –º–º –Ω–∞ –µ–¥–∏–Ω–∏—Ü—É viewBox
                                
                                // –°–æ–∑–¥–∞—ë–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ SVG
                                const tempContainer = document.createElement('div');
                                tempContainer.style.position = 'absolute';
                                tempContainer.style.left = '-9999px';
                                tempContainer.style.visibility = 'hidden';
                                tempContainer.innerHTML = svgString;
                                document.body.appendChild(tempContainer);
                                
                                const tempSvg = tempContainer.querySelector('svg');
                                if (tempSvg) {
                                    // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã
                                    const elements = tempSvg.querySelectorAll('path, rect, circle, ellipse, polygon, polyline');
                                    let totalHeightUnits = 0;
                                    
                                    elements.forEach(el => {
                                        if (el.tagName === 'svg' || el.getAttribute('display') === 'none') return;
                                        // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Ñ–æ–Ω–æ–≤—ã–µ rect –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å
                                        if (el.tagName === 'rect' && viewBoxWidth > 0) {
                                            const rw = parseFloat(el.getAttribute('width'));
                                            if (Math.abs(rw - viewBoxWidth) < 1) return; // –≠—Ç–æ —Ñ–æ–Ω
                                        }
                                        try {
                                            const box = el.getBBox();
                                            if (box.width > 0.1 && box.height > 0.1) {
                                                totalHeightUnits += box.height; // –°—É–º–º–∏—Ä—É–µ–º –≤—ã—Å–æ—Ç—ã
                                            }
                                        } catch(e) {}
                                    });
                                    
                                    totalElementsHeight = totalHeightUnits * mmPerUnit; // –ü–µ—Ä–µ–≤–æ–¥–∏–º –≤ –º–º
                                    console.log(`[üìê –í–´–°–û–¢–ê –≠–õ–ï–ú–ï–ù–¢–û–í] ${totalHeightUnits.toFixed(1)} –µ–¥ √ó ${mmPerUnit.toFixed(4)} = ${totalElementsHeight.toFixed(1)} –º–º`);
                                }
                                
                                // –£–¥–∞–ª—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
                                document.body.removeChild(tempContainer);
                            }
                        }
                    }
                }
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∞–ª—å–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã
                state.svgRealSize = { 
                    width: realWidth || 100, 
                    height: realHeight || 100,
                    totalElementsHeight: totalElementsHeight || realHeight || 100 // –°—É–º–º–∞ –≤—ã—Å–æ—Ç —ç–ª–µ–º–µ–Ω—Ç–æ–≤
                };
                state.svgScale = svgHeight > 0 ? state.svgRealSize.height / svgHeight : 1;
                
                log(`SVG: ${svgWidth.toFixed(0)}√ó${svgHeight.toFixed(0)} –µ–¥, —Ä–µ–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: ${state.svgRealSize.width.toFixed(1)}√ó${state.svgRealSize.height.toFixed(1)}–º–º`, 'info');
                log(`–ú–∞—Å—à—Ç–∞–±: ${state.svgScale.toFixed(6)} –º–º/–µ–¥`, 'info');
                
                // –ü–†–ê–í–ò–õ–¨–ù–´–ô –ú–ê–°–®–¢–ê–ë: —Ä–µ–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –≤ –º–º * –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –¥–ª—è —Å—Ü–µ–Ω—ã
                // 1 –µ–¥–∏–Ω–∏—Ü–∞ Three.js = 10 –º–º (–¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞)
                const SCENE_SCALE = 0.1; // 10–º–º = 1 –µ–¥–∏–Ω–∏—Ü–∞
                const scale = state.svgScale * SCENE_SCALE;
                
                // –°–æ–∑–¥–∞—ë–º 3D –≥–µ–æ–º–µ—Ç—Ä–∏—é
                let firstPathColor = null;
                let totalShapes = 0;
                let emptyPaths = 0;
                
                // ‚ïê‚ïê‚ïê –†–ê–°–ß–Å–¢ –†–ï–ê–õ–¨–ù–û–ô –ü–õ–û–©–ê–î–ò –ò –ü–ï–†–ò–ú–ï–¢–†–ê ‚ïê‚ïê‚ïê
                let totalRealArea = 0; // –°—É–º–º–∞ –ø–ª–æ—â–∞–¥–µ–π –≤—Å–µ—Ö shapes (–≤ –µ–¥–∏–Ω–∏—Ü–∞—Ö SVG¬≤)
                let totalRealPerimeter = 0; // –°—É–º–º–∞ –ø–µ—Ä–∏–º–µ—Ç—Ä–æ–≤ –≤—Å–µ—Ö shapes (–≤ –µ–¥–∏–Ω–∏—Ü–∞—Ö SVG)
                let allShapesData = []; // –î–∞–Ω–Ω—ã–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ shape (–¥–ª—è LED —Ä–∞—Å—á—ë—Ç–∞)
                
                svgData.paths.forEach((path, pathIndex) => {
                    const shapes = path.toShapes(true);
                    
                    if (shapes.length === 0) {
                        emptyPaths++;
                        console.log(`[‚ö†Ô∏è] Path ${pathIndex} –Ω–µ —Å–æ–∑–¥–∞–ª shapes!`);
                        return; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—É—Å—Ç—ã–µ paths
                    }
                    
                    totalShapes += shapes.length;
                    
                    // –ò–ó–í–õ–ï–ö–ê–ï–ú –¶–í–ï–¢ –ò–ó SVG PATH
                    const svgColor = path.color ? '#' + path.color.getHexString() : '#FFFFFF';
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ü–≤–µ—Ç –ø–µ—Ä–≤–æ–≥–æ path –¥–ª—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
                    if (pathIndex === 0) {
                        firstPathColor = svgColor;
                    }
                    
                    shapes.forEach((shape, shapeIndex) => {
                        const mainArea = THREE.ShapeUtils.area(shape.getPoints());
                        
                        // –§–ò–ö–° CorelDRAW: –ø—Ä–æ–≤–µ—Ä—è–µ–º holes —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å
                        if (shape.holes.length > 0) {
                            // –ï—Å–ª–∏ –µ—Å—Ç—å holes, main –î–û–õ–ñ–ï–ù –±—ã—Ç—å CCW
                            if (mainArea < 0) {
                                console.log(`[üîß] Path ${pathIndex}: main CW‚ÜíCCW (–µ—Å—Ç—å ${shape.holes.length} holes)`);
                                shape.curves.reverse();
                                shape.curves.forEach(curve => {
                                    if (curve.v1 && curve.v2) {
                                        [curve.v1, curve.v2] = [curve.v2, curve.v1];
                                    }
                                });
                            }
                            
                            shape.holes.forEach((hole, holeIndex) => {
                                const holeArea = THREE.ShapeUtils.area(hole.getPoints());
                                const absMainArea = Math.abs(mainArea);
                                const absHoleArea = Math.abs(holeArea);
                                
                                // –ï—Å–ª–∏ hole > main –ø–æ –ø–ª–æ—â–∞–¥–∏ - –æ–Ω–∏ –ø–µ—Ä–µ–ø—É—Ç–∞–Ω—ã!
                                if (absHoleArea > absMainArea * 0.8) {
                                    console.log(`[‚ö†Ô∏è] Path ${pathIndex}: hole${holeIndex} (${absHoleArea.toFixed(0)}) –±–æ–ª—å—à–µ main (${absMainArea.toFixed(0)}) - SWAP!`);
                                    // –ú–µ–Ω—è–µ–º –º–µ—Å—Ç–∞–º–∏ main –∏ hole
                                    const tempCurves = shape.curves;
                                    shape.curves = hole.curves;
                                    hole.curves = tempCurves;
                                }
                                
                                // –ï—Å–ª–∏ hole=CCW (–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–∞—è area), –∏–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º
                                if (holeArea > 0) {
                                    console.log(`[üîß] Path ${pathIndex}: hole${holeIndex} CCW‚ÜíCW (–∏–Ω–≤–µ—Ä—Ç–∏—Ä—É—é)`);
                                    hole.curves.reverse();
                                    hole.curves.forEach(curve => {
                                        if (curve.v1 && curve.v2) {
                                            [curve.v1, curve.v2] = [curve.v2, curve.v1];
                                        }
                                    });
                                }
                            });
                        }
                        
                        // ‚ïê‚ïê‚ïê –†–ê–°–ß–Å–¢ –†–ï–ê–õ–¨–ù–û–ô –ü–õ–û–©–ê–î–ò –ò –ü–ï–†–ò–ú–ï–¢–†–ê –≠–¢–û–ì–û SHAPE ‚ïê‚ïê‚ïê
                        const points = shape.getPoints();
                        let shapeArea = Math.abs(THREE.ShapeUtils.area(points));
                        
                        // –í—ã—á–∏—Ç–∞–µ–º –ø–ª–æ—â–∞–¥–∏ holes
                        let holesArea = 0;
                        let holesPerimeter = 0;
                        shape.holes.forEach(hole => {
                            const holePoints = hole.getPoints();
                            const holeA = Math.abs(THREE.ShapeUtils.area(holePoints));
                            holesArea += holeA;
                            
                            // –ü–µ—Ä–∏–º–µ—Ç—Ä hole
                            for (let i = 0; i < holePoints.length; i++) {
                                const p1 = holePoints[i];
                                const p2 = holePoints[(i + 1) % holePoints.length];
                                holesPerimeter += Math.sqrt((p2.x - p1.x) ** 2 + (p2.y - p1.y) ** 2);
                            }
                        });
                        
                        const finalArea = shapeArea - holesArea;
                        
                        // –ü–µ—Ä–∏–º–µ—Ç—Ä main –∫–æ–Ω—Ç—É—Ä–∞ (–í–ù–ï–®–ù–ò–ô –ø–µ—Ä–∏–º–µ—Ç—Ä)
                        let mainPerimeter = 0;
                        for (let i = 0; i < points.length; i++) {
                            const p1 = points[i];
                            const p2 = points[(i + 1) % points.length];
                            mainPerimeter += Math.sqrt((p2.x - p1.x) ** 2 + (p2.y - p1.y) ** 2);
                        }
                        
                        // –î–õ–Ø –ë–û–†–¢–ê –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ –í–ù–ï–®–ù–ò–ô –ø–µ—Ä–∏–º–µ—Ç—Ä
                        // –î–õ–Ø LED –Ω—É–∂–Ω—ã –æ–±–∞ (–≤–Ω–µ—à–Ω–∏–π + –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –∫–æ–Ω—Ç—É—Ä—ã)
                        totalRealArea += finalArea;
                        totalRealPerimeter += mainPerimeter; // –¢–æ–ª—å–∫–æ –≤–Ω–µ—à–Ω–∏–π –∫–æ–Ω—Ç—É—Ä –¥–ª—è –±–æ—Ä—Ç–∞!
                        
                        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è LED —Ä–∞—Å—á—ë—Ç–∞
                        allShapesData.push({
                            area: finalArea,
                            outerPerimeter: mainPerimeter,
                            innerPerimeters: holesPerimeter,
                            totalPerimeter: mainPerimeter + holesPerimeter, // –î–ª—è LED - –≤—Å–µ –∫–æ–Ω—Ç—É—Ä—ã
                            points: points,
                            holes: shape.holes.map(h => h.getPoints())
                        });
                        
                        const depth = 1.0; // –ë–∞–∑–æ–≤–∞—è —Ç–æ–ª—â–∏–Ω–∞ 1.0 –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è
                        const geometry = new THREE.ExtrudeGeometry(shape, {
                            depth: depth,
                            bevelEnabled: false
                        });
                        
                        // –°–î–í–ò–ì–ê–ï–ú –≥–µ–æ–º–µ—Ç—Ä–∏—é –Ω–∞–∑–∞–¥, —á—Ç–æ–±—ã –ª–∏—Ü–æ –±—ã–ª–æ –Ω–∞ z=0, –∑–∞–¥–Ω–∏–∫ –Ω–∞ z=-1.0
                        geometry.translate(0, 0, -depth);
                        
                        // –ó–ê–î–ù–Ø–Ø –°–¢–û–†–û–ù–ê (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª–∞)
                        let backColor = 0xFFFFFF; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –±–µ–ª—ã–π
                        if (state.faceMaterial.type === 'pvc') {
                            backColor = 0xFFFFFF; // –ü–í–• ‚Üí –±–µ–ª—ã–π
                        } else if (state.faceMaterial.type === 'composite') {
                            backColor = 0x8B9B86; // –ö–æ–º–ø–æ–∑–∏—Ç ‚Üí —Å–µ—Ä–æ-–∑–µ–ª—ë–Ω—ã–π
                        } else if (state.faceMaterial.type === 'acrylic') {
                            backColor = 0xFFFFFF; // –ê–∫—Ä–∏–ª ‚Üí –±–µ–ª—ã–π
                        }
                        
                        // –¶–í–ï–¢ –ë–û–†–¢–ê (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∏ –º–∞—Ç–µ—Ä–∏–∞–ª–∞)
                        let actualSideColor = state.sideColor;
                        if (state.construction === 'flat') {
                            if (state.faceMaterial.type === 'pvc') {
                                actualSideColor = '#FFFFFF'; // –ü–í–• ‚Üí –±–µ–ª—ã–π –±–æ—Ä—Ç
                            } else if (state.faceMaterial.type === 'composite') {
                                actualSideColor = '#000000'; // –ö–æ–º–ø–æ–∑–∏—Ç ‚Üí —á—ë—Ä–Ω—ã–π –±–æ—Ä—Ç
                            }
                        }
                        
                        const faceMaterial = new THREE.MeshStandardMaterial({
                            color: svgColor, // –ò–°–ü–û–õ–¨–ó–£–ï–ú –¶–í–ï–¢ –ò–ó SVG!
                            metalness: 0.3,
                            roughness: 0.4,
                            emissive: 0x000000,
                            emissiveIntensity: 0
                        });
                        
                        const sideMaterial = new THREE.MeshStandardMaterial({
                            color: actualSideColor, // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ü–≤–µ—Ç –±–æ—Ä—Ç–∞
                            metalness: 0.1,
                            roughness: 0.7,
                            emissive: 0x000000,
                            emissiveIntensity: 0
                        });
                        
                        // ExtrudeGeometry –∏—Å–ø–æ–ª—å–∑—É–µ—Ç 2 materialIndex: 0 (front+back), 1 (side)
                        const mesh = new THREE.Mesh(geometry, [faceMaterial, sideMaterial]);
                        mesh.scale.set(scale, -scale, 1); // -scale –ø–æ Y –¥–ª—è –ø–µ—Ä–µ–≤–æ—Ä–æ—Ç–∞
                        mesh.position.set(-svgCenterX * scale, svgCenterY * scale, 0);
                        mesh.userData.isLetter = true;
                        mesh.userData.originalFaceColor = svgColor; // –°–û–•–†–ê–ù–Ø–ï–ú –û–†–ò–ì–ò–ù–ê–õ–¨–ù–´–ô –¶–í–ï–¢ –ò–ó SVG!
                        console.log(`[DEBUG] replaceLetterWithSVG: –ë—É–∫–≤–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ —Å —Ü–≤–µ—Ç–æ–º ${svgColor}`);
                        // –¢–µ–Ω–∏ –æ—Ç–∫–ª—é—á–µ–Ω—ã
                        
                        group.add(mesh);
                    });
                });
                
                // –õ–æ–≥–∏—Ä—É–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–∞—Ä—Å–∏–Ω–≥–∞
                log(`üìä –ü–∞—Ä—Å–∏–Ω–≥: ${svgData.paths.length} paths ‚Üí ${totalShapes} shapes, –ø—Ä–æ–ø—É—â–µ–Ω–æ: ${emptyPaths}`, 'info');
                
                if (firstPathColor) {
                    log(`–¶–≤–µ—Ç –∏–∑ SVG: ${firstPathColor}`, 'info');
                }
                
                if (group.children.length === 0) {
                    log('‚ùå –û–®–ò–ë–ö–ê: Three.js –Ω–µ —Å–æ–∑–¥–∞–ª –Ω–∏ –æ–¥–Ω–æ–≥–æ mesh! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É SVG', 'error');
                    return;
                }
                
                // ‚ïê‚ïê‚ïê –ü–ï–†–ï–°–ß–ò–¢–´–í–ê–ï–ú –í –†–ï–ê–õ–¨–ù–´–ï –ú–ú ‚ïê‚ïê‚ïê
                const realAreaMm2 = totalRealArea * (state.svgScale ** 2);
                const realPerimeterMm = totalRealPerimeter * state.svgScale;
                
                console.log(`[üìê –ì–ï–û–ú–ï–¢–†–ò–Ø] –ü–ª–æ—â–∞–¥—å: ${(realAreaMm2 / 1_000_000).toFixed(3)} –º¬≤ | –ü–µ—Ä–∏–º–µ—Ç—Ä: ${(realPerimeterMm / 1000).toFixed(2)} –º`);
                
                // –°–û–ó–î–ê–Å–ú –û–ë–™–ï–ö–¢ SVG –° –ú–ï–¢–ê–î–ê–ù–ù–´–ú–ò
                const svgObject = {
                    id: Date.now(), // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID
                    name: filename,
                    group: group,
                    color: state.faceColor, // –¶–≤–µ—Ç (–º–æ–∂–Ω–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—Ç—å)
                    position: { x: 0, y: 0, z: 0 }, // –ü–æ–ª–æ–∂–µ–Ω–∏–µ –≤ 3D
                    svgWidth: svgWidth * scale,
                    svgHeight: svgHeight * scale,
                    realWidth: state.svgRealSize.width,
                    realHeight: state.svgRealSize.height,
                    totalElementsHeight: state.svgRealSize.totalElementsHeight, // –°–£–ú–ú–ê –≤—ã—Å–æ—Ç –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
                    pathsCount: svgData.paths.length, // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±—É–∫–≤/paths –≤ SVG
                    currentWidth: state.svgRealSize.width, // –¢–µ–∫—É—â–∞—è —à–∏—Ä–∏–Ω–∞ –ø–æ—Å–ª–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è
                    currentHeight: state.svgRealSize.height, // –¢–µ–∫—É—â–∞—è –≤—ã—Å–æ—Ç–∞ –ø–æ—Å–ª–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è
                    shadowClones: [], // –¢–µ–Ω–∏ –¥–ª—è —ç—Ç–æ–≥–æ SVG
                    dimensionGroup: null, // –†–∞–∑–º–µ—Ä–Ω—ã–µ –ª–∏–Ω–∏–∏ –¥–ª—è —ç—Ç–æ–≥–æ SVG
                    visible: true, // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤–∏–¥–∏–º—ã–π
                    dimensionsVisible: true, // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Ä–∞–∑–º–µ—Ä—ã –ø–æ–∫–∞–∑–∞–Ω—ã
                    originalSvg: svgString, // –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π SVG –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞
                    // ‚ïê‚ïê‚ïê –†–ï–ê–õ–¨–ù–ê–Ø –ì–ï–û–ú–ï–¢–†–ò–Ø –î–õ–Ø –†–ê–°–ß–Å–¢–ê ‚ïê‚ïê‚ïê
                    geometry: {
                        areaMm2: realAreaMm2,           // –ü–ª–æ—â–∞–¥—å –∫–æ–Ω—Ç—É—Ä–æ–≤ (–º–º¬≤)
                        perimeterMm: realPerimeterMm,   // –ü–µ—Ä–∏–º–µ—Ç—Ä –í–ù–ï–®–ù–ò–• –∫–æ–Ω—Ç—É—Ä–æ–≤ –¥–ª—è –±–æ—Ä—Ç–∞ (–º–º)
                        shapesData: allShapesData.map(s => ({ // –î–∞–Ω–Ω—ã–µ –¥–ª—è LED –ø–æ —Å—Ä–µ–¥–Ω–µ–π –ª–∏–Ω–∏–∏
                            area: s.area * (state.svgScale ** 2),
                            outerPerimeter: s.outerPerimeter * state.svgScale,
                            innerPerimeters: s.innerPerimeters * state.svgScale,
                            totalPerimeter: s.totalPerimeter * state.svgScale
                        }))
                    }
                };
                
                // –î–û–ë–ê–í–õ–Ø–ï–ú –í –ú–ê–°–°–ò–í –ò –°–¶–ï–ù–£
                svgGroups.push(svgObject);
                console.log('[DEBUG addSVG] svgObject –¥–æ–±–∞–≤–ª–µ–Ω –≤ –º–∞—Å—Å–∏–≤, —Ç–µ–ø–µ—Ä—å svgGroups.length:', svgGroups.length);
                console.log('[DEBUG addSVG] svgObject:', svgObject);
                
                scene.add(group);
                console.log('[DEBUG addSVG] group –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ —Å—Ü–µ–Ω—É');
                
                // –û–ë–ù–û–í–õ–Ø–ï–ú –°–ü–ò–°–û–ö –í UI
                updateSVGList();
                console.log('[DEBUG addSVG] updateSVGList() –≤—ã–∑–≤–∞–Ω');
                
                // –î–µ–ª–∞–µ–º –Ω–æ–≤—ã–π SVG –∞–∫—Ç–∏–≤–Ω—ã–º
                activeSvgIndex = svgGroups.length - 1;
                console.log('[DEBUG addSVG] activeSvgIndex —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω:', activeSvgIndex);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–ø—É—Ç—ã –º–∞—Å—à—Ç–∞–±–∞
                updateScaleInputs();
                
                // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ç–µ–∫—É—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
                console.log('[DEBUG addSVG] –í—ã–∑—ã–≤–∞–µ–º updateActiveSVG...');
                updateActiveSVG();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –≥—Ä–∞–Ω–∏—Ü—ã shadow camera –ø–æ–¥ —Ä–∞–∑–º–µ—Ä –±—É–∫–≤
                console.log('[DEBUG addSVG] –í—ã–∑—ã–≤–∞–µ–º updateShadowCamera...');
                updateShadowCamera();
                
                // –°–æ–∑–¥–∞—ë–º —Ä–∞–∑–º–µ—Ä–Ω—ã–µ –ª–∏–Ω–∏–∏ –¥–ª—è —ç—Ç–æ–≥–æ SVG
                console.log('[DEBUG addSVG] –°–æ–∑–¥–∞—ë–º —Ä–∞–∑–º–µ—Ä–Ω—ã–µ –ª–∏–Ω–∏–∏...');
                svgObject.dimensionGroup = createDimensionLines(
                    svgObject.svgWidth, 
                    svgObject.svgHeight, 
                    svgObject.realWidth, 
                    svgObject.realHeight
                );
                
                // –û–±–Ω–æ–≤–ª—è–µ–º UI —Å–ø–∏—Å–∫–∞ SVG
                console.log('[DEBUG addSVG] –ü–µ—Ä–µ–¥ updateSVGList, svgGroups.length:', svgGroups.length);
                console.log('[DEBUG addSVG] –í—ã–∑—ã–≤–∞–µ–º updateSVGList...');
                updateSVGList();
                console.log('[DEBUG addSVG] updateSVGList –∑–∞–≤–µ—Ä—à—ë–Ω');
                
                // –ü–µ—Ä–µ—Å–æ–∑–¥–∞—ë–º —Å—Ç–µ–Ω—É —Å —É—á–µ—Ç–æ–º –Ω–æ–≤–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞
                console.log('[DEBUG addSVG] –ü–µ—Ä–µ—Å–æ–∑–¥–∞—ë–º —Å—Ç–µ–Ω—É...');
                createWall();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å—Ç–æ–∏–º–æ—Å—Ç–∏
                updateCostCalculator();
                
                log(`‚ú® SVG "${filename}" –¥–æ–±–∞–≤–ª–µ–Ω! –í—Å–µ–≥–æ SVG: ${svgGroups.length}`, 'success');
            } catch (error) {
                log(`–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è 3D –º–æ–¥–µ–ª–∏: ${error.message}`, 'error');
            }
        }
        
        // === –£–ü–†–ê–í–õ–ï–ù–ò–ï SVG-–û–ë–™–ï–ö–¢–ê–ú–ò ===
        
        // –í—ã–±—Ä–∞—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–π SVG
        window.selectSVG = function(index) {
            if (index < 0 || index >= svgGroups.length) return;
            
            // –°–ë–†–ê–°–´–í–ê–ï–ú –í–°–ï –î–†–£–ì–ò–ï –ê–ö–¢–ò–í–ù–´–ï –û–ë–™–ï–ö–¢–´
            // –°–Ω–∏–º–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å –æ—Å–Ω–æ–≤—ã
            if (activeBaseIndex !== null && bases[activeBaseIndex]) {
                const prevBaseMesh = bases[activeBaseIndex].mesh;
                if (prevBaseMesh) {
                    if (prevBaseMesh.type === 'Group') {
                        prevBaseMesh.children.forEach(child => {
                            if (child.children[0]) {
                                child.children[0].material.opacity = 0.2;
                                child.children[0].material.color.setHex(0x000000);
                            }
                        });
                    } else if (prevBaseMesh.children[0]) {
                        prevBaseMesh.children[0].material.opacity = 0.2;
                        prevBaseMesh.children[0].material.color.setHex(0x000000);
                    }
                }
                activeBaseIndex = null;
                
                // –°–∫—Ä—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—Å–Ω–æ–≤–æ–π
                const baseControls = document.getElementById('base-controls');
                if (baseControls) {
                    baseControls.style.display = 'none';
                }
            }
            
            // –°–Ω–∏–º–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å –ø—Ä–æ—Ñ–∏–ª–µ–π –∫–∞—Ä–∫–∞—Å–∞
            if (activeProfileIndex !== null && frameProfiles[activeProfileIndex]) {
                const prevProfMesh = frameProfiles[activeProfileIndex].mesh;
                if (prevProfMesh && prevProfMesh.children[0]) {
                    prevProfMesh.children[0].material.opacity = 0.2;
                    prevProfMesh.children[0].material.color.setHex(0x000000);
                }
                activeProfileIndex = null;
                
                // –°–∫—Ä—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª–µ–º
                const profileControls = document.getElementById('profile-controls');
                if (profileControls) {
                    profileControls.style.display = 'none';
                }
            }
            
            // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—É—é –ø–æ–¥—Å–≤–µ—Ç–∫—É SVG
            if (activeSvgHelper) {
                scene.remove(activeSvgHelper);
                activeSvgHelper = null;
            }
            
            activeSvgIndex = index;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∑–µ–ª—ë–Ω—É—é —Ä–∞–º–∫—É –≤–æ–∫—Ä—É–≥ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ SVG
            const svgObj = svgGroups[index];
            if (svgObj && svgObj.group) {
                activeSvgHelper = new THREE.BoxHelper(svgObj.group, 0x00FF00); // –ó–µ–ª—ë–Ω—ã–π
                activeSvgHelper.material.linewidth = 2;
                activeSvgHelper.material.opacity = 0.8;
                activeSvgHelper.material.transparent = true;
                scene.add(activeSvgHelper);
            }
            
            updateSVGList();
            updateCostCalculator();
            updateScaleInputs();
            log(`–í—ã–±—Ä–∞–Ω SVG: ${svgGroups[index].name}`, 'info');
        }
        
        // –°–∫—Ä—ã—Ç—å/–ü–æ–∫–∞–∑–∞—Ç—å SVG
        window.toggleVisibility = function(index) {
            if (index < 0 || index >= svgGroups.length) return;
            
            const svgObj = svgGroups[index];
            
            // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é true)
            svgObj.visible = svgObj.visible === false ? true : false;
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å –∫ –≥—Ä—É–ø–ø–µ
            if (svgObj.group) {
                svgObj.group.visible = svgObj.visible;
            }
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å –∫ —Ç–µ–Ω—è–º
            if (svgObj.shadowClones && svgObj.shadowClones.length > 0) {
                svgObj.shadowClones.forEach(clone => {
                    clone.visible = svgObj.visible;
                });
            }
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å –∫ —Ä–∞–∑–º–µ—Ä–Ω—ã–º –ª–∏–Ω–∏—è–º (–µ—Å–ª–∏ –æ–±—ä–µ–∫—Ç —Å–∫—Ä—ã—Ç, —Å–∫—Ä—ã–≤–∞–µ–º –∏ —Ä–∞–∑–º–µ—Ä—ã)
            if (svgObj.dimensionGroup) {
                svgObj.dimensionGroup.visible = svgObj.visible && (svgObj.dimensionsVisible !== false);
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º UI –∏ —Å—Ü–µ–Ω—É
            updateSVGList();
            updateCostCalculator();
            render();
            
            log(`${svgObj.visible ? '–ü–æ–∫–∞–∑–∞–Ω' : '–°–∫—Ä—ã—Ç'} SVG: ${svgObj.name}`, 'info');
        }
        
        // –°–∫—Ä—ã—Ç—å/–ü–æ–∫–∞–∑–∞—Ç—å —Ä–∞–∑–º–µ—Ä–Ω—ã–µ –ª–∏–Ω–∏–∏
        window.toggleDimensions = function(index) {
            if (index < 0 || index >= svgGroups.length) return;
            
            const svgObj = svgGroups[index];
            
            // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å —Ä–∞–∑–º–µ—Ä–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é true)
            svgObj.dimensionsVisible = svgObj.dimensionsVisible === false ? true : false;
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å –∫ —Ä–∞–∑–º–µ—Ä–Ω—ã–º –ª–∏–Ω–∏—è–º (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–±—ä–µ–∫—Ç –≤–∏–¥–∏–º—ã–π)
            if (svgObj.dimensionGroup) {
                svgObj.dimensionGroup.visible = svgObj.dimensionsVisible && (svgObj.visible !== false);
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º UI –∏ —Å—Ü–µ–Ω—É
            updateSVGList();
            render();
            
            log(`–†–∞–∑–º–µ—Ä—ã ${svgObj.dimensionsVisible ? '–ø–æ–∫–∞–∑–∞–Ω—ã' : '—Å–∫—Ä—ã—Ç—ã'} –¥–ª—è: ${svgObj.name}`, 'info');
        }
        
        // –£–¥–∞–ª–∏—Ç—å SVG
        window.removeSVG = function(index) {
            if (index < 0 || index >= svgGroups.length) return;
            
            const svgObj = svgGroups[index];
            
            // –£–¥–∞–ª—è–µ–º –≥—Ä—É–ø–ø—É –∏–∑ —Å—Ü–µ–Ω—ã
            scene.remove(svgObj.group);
            
            // –£–¥–∞–ª—è–µ–º —Ç–µ–Ω–∏
            if (svgObj.shadowClones && svgObj.shadowClones.length > 0) {
                svgObj.shadowClones.forEach(clone => scene.remove(clone));
            }
            
            // –£–¥–∞–ª—è–µ–º —Ä–∞–∑–º–µ—Ä–Ω—ã–µ –ª–∏–Ω–∏–∏
            if (svgObj.dimensionGroup) {
                scene.remove(svgObj.dimensionGroup);
            }
            
            // –£–¥–∞–ª—è–µ–º –∏–∑ –º–∞—Å—Å–∏–≤–∞
            svgGroups.splice(index, 1);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∏–Ω–¥–µ–∫—Å
            if (activeSvgIndex === index) {
                activeSvgIndex = svgGroups.length > 0 ? 0 : null;
            } else if (activeSvgIndex > index) {
                activeSvgIndex--;
            }
            
            updateSVGList();
            updateCostCalculator();
            log(`SVG "${svgObj.name}" —É–¥–∞–ª—ë–Ω. –û—Å—Ç–∞–ª–æ—Å—å: ${svgGroups.length}`, 'info');
        }
        
        // –î—É–±–ª–∏—Ä–æ–≤–∞—Ç—å SVG –æ–±—ä–µ–∫—Ç
        window.duplicateSVG = function(index) {
            if (index < 0 || index >= svgGroups.length) return;
            
            const originalObj = svgGroups[index];
            
            // –ö–ª–æ–Ω–∏—Ä—É–µ–º Three.js –≥—Ä—É–ø–ø—É
            const clonedGroup = originalObj.group.clone(true);
            
            // –ö–ª–æ–Ω–∏—Ä—É–µ–º –º–∞—Ç–µ—Ä–∏–∞–ª—ã –¥–ª—è –Ω–æ–≤–æ–π –≥—Ä—É–ø–ø—ã (—á—Ç–æ–±—ã –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–µ –≤–ª–∏—è–ª–∏ –Ω–∞ –æ—Ä–∏–≥–∏–Ω–∞–ª)
            clonedGroup.traverse((child) => {
                if (child.isMesh && child.material) {
                    // –ú–∞—Ç–µ—Ä–∏–∞–ª –º–æ–∂–µ—Ç –±—ã—Ç—å –º–∞—Å—Å–∏–≤–æ–º –∏–ª–∏ –æ–¥–Ω–∏–º –æ–±—ä–µ–∫—Ç–æ–º
                    if (Array.isArray(child.material)) {
                        child.material = child.material.map(mat => mat.clone ? mat.clone() : mat);
                    } else if (child.material.clone) {
                        child.material = child.material.clone();
                    }
                    // –ö–æ–ø–∏—Ä—É–µ–º userData —Å –æ—Ä–∏–≥–∏–Ω–∞–ª–∞
                    if (originalObj.group.children.length > 0) {
                        const originalChild = originalObj.group.children.find(c => c.isMesh);
                        if (originalChild && originalChild.userData) {
                            child.userData = { ...originalChild.userData };
                        }
                    }
                }
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≤ —Å—Ü–µ–Ω—É
            scene.add(clonedGroup);
            
            // –í—ã—á–∏—Å–ª—è–µ–º –∏–º—è –¥–ª—è –∫–æ–ø–∏–∏
            let copyName = originalObj.name;
            const copyMatch = copyName.match(/(.*?)\s*(?:\(–∫–æ–ø–∏—è\s*(\d+)\))?$/);
            if (copyMatch) {
                const baseName = copyMatch[1].trim();
                const copyNum = copyMatch[2] ? parseInt(copyMatch[2]) + 1 : 1;
                copyName = `${baseName} (–∫–æ–ø–∏—è ${copyNum})`;
            }
            
            // –°–æ–∑–¥–∞—ë–º –æ–±—ä–µ–∫—Ç –¥—É–±–ª–∏–∫–∞—Ç–∞ –Ω–∞ —Ç–æ–π –∂–µ –ø–æ–∑–∏—Ü–∏–∏
            const duplicateObject = {
                id: Date.now(),
                name: copyName,
                group: clonedGroup,
                color: originalObj.color,
                position: {
                    x: originalObj.position.x,
                    y: originalObj.position.y,
                    z: originalObj.position.z
                },
                svgWidth: originalObj.svgWidth,
                svgHeight: originalObj.svgHeight,
                realWidth: originalObj.realWidth,
                realHeight: originalObj.realHeight,
                totalElementsHeight: originalObj.totalElementsHeight, // –ö–æ–ø–∏—Ä—É–µ–º —Å—É–º–º—É –≤—ã—Å–æ—Ç —ç–ª–µ–º–µ–Ω—Ç–æ–≤
                currentWidth: originalObj.currentWidth || originalObj.realWidth,
                currentHeight: originalObj.currentHeight || originalObj.realHeight,
                shadowClones: [],
                dimensionGroup: null,
                visible: true, // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤–∏–¥–∏–º—ã–π
                dimensionsVisible: true, // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Ä–∞–∑–º–µ—Ä—ã –ø–æ–∫–∞–∑–∞–Ω—ã
                originalSvg: originalObj.originalSvg, // –ö–æ–ø–∏—Ä—É–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π SVG –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞
                geometry: originalObj.geometry // –ö–æ–ø–∏—Ä—É–µ–º –≥–µ–æ–º–µ—Ç—Ä–∏—é
            };
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º –ø–æ–∑–∏—Ü–∏—é –∫ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –≥—Ä—É–ø–ø–µ
            clonedGroup.position.set(
                duplicateObject.position.x,
                duplicateObject.position.y,
                duplicateObject.position.z
            );
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≤ –º–∞—Å—Å–∏–≤
            svgGroups.push(duplicateObject);
            
            // –î–µ–ª–∞–µ–º –Ω–æ–≤—ã–π –æ–±—ä–µ–∫—Ç –∞–∫—Ç–∏–≤–Ω—ã–º
            activeSvgIndex = svgGroups.length - 1;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–ø—É—Ç—ã –º–∞—Å—à—Ç–∞–±–∞
            updateScaleInputs();
            
            // –°–æ–∑–¥–∞—ë–º —Ä–∞–∑–º–µ—Ä–Ω—ã–µ –ª–∏–Ω–∏–∏ –¥–ª—è –Ω–æ–≤–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞
            duplicateObject.dimensionGroup = createDimensionLines(
                duplicateObject.svgWidth,
                duplicateObject.svgHeight,
                duplicateObject.realWidth,
                duplicateObject.realHeight
            );
            
            // –°–ù–ê–ß–ê–õ–ê –æ–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ UI
            console.log('[DEBUG duplicateSVG] –ü–µ—Ä–µ–¥ updateSVGList, svgGroups.length:', svgGroups.length);
            console.log('[DEBUG duplicateSVG] activeSvgIndex:', activeSvgIndex);
            updateSVGList();
            
            // –ó–∞—Ç–µ–º –æ–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –æ–±—ä–µ–∫—Ç
            updateActiveSVG();
            updateCostCalculator();
            
            // –ü–µ—Ä–µ—Å–æ–∑–¥–∞—ë–º —Å—Ç–µ–Ω—É —Å —É—á–µ—Ç–æ–º –Ω–æ–≤–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞
            createWall();
            
            render();
            
            log(`‚ú® –°–æ–∑–¥–∞–Ω–∞ –∫–æ–ø–∏—è: ${copyName}`, 'success');
            
            log(`–û–±—ä–µ–∫—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω: ${copyName}`, 'success');
        }
        
        // –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–π SVG
        // === –ù–ï–ü–†–ï–†–´–í–ù–û–ï –î–í–ò–ñ–ï–ù–ò–ï –ü–†–ò –£–î–ï–†–ñ–ê–ù–ò–ò –ö–ù–û–ü–ö–ò ===
        let moveInterval = null;
        let currentMoveDirection = null;
        
        window.moveSVG = function(direction, amount = 0.5) {
            if (activeSvgIndex === null) return;
            
            const svgObj = svgGroups[activeSvgIndex];
            
            switch(direction) {
                case 'left':
                    svgObj.position.x -= amount;
                    break;
                case 'right':
                    svgObj.position.x += amount;
                    break;
                case 'up':
                    svgObj.position.y += amount;
                    break;
                case 'down':
                    svgObj.position.y -= amount;
                    break;
                case 'forward':
                    // –û—Ç —Å—Ç–µ–Ω—ã (–∫ –∫–∞–º–µ—Ä–µ)
                    svgObj.position.z += amount;
                    break;
                case 'backward':
                    // –ö —Å—Ç–µ–Ω–µ
                    svgObj.position.z -= amount;
                    // –ù–µ –¥–∞—ë–º –æ–±—ä–µ–∫—Ç—É —É–π—Ç–∏ –∑–∞ —Å—Ç–µ–Ω—É (Z = -10)
                    if (svgObj.position.z < -10) svgObj.position.z = -10;
                    break;
            }
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º –ø–æ–∑–∏—Ü–∏—é –∫ –≥—Ä—É–ø–ø–µ
            svgObj.group.position.set(svgObj.position.x, svgObj.position.y, svgObj.position.z);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–∞–∑–º–µ—Ä–Ω—ã–µ –ª–∏–Ω–∏–∏ (–æ–Ω–∏ —Å–ª–µ–¥—É—é—Ç –∑–∞ –æ–±—ä–µ–∫—Ç–æ–º)
            if (svgObj.dimensionGroup) {
                svgObj.dimensionGroup.position.set(svgObj.position.x, svgObj.position.y, svgObj.position.z);
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–Ω–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å)
            updateWallAndShadows();
        }
        
        window.startContinuousMove = function(direction) {
            if (moveInterval) stopContinuousMove(); // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–µ–µ –¥–≤–∏–∂–µ–Ω–∏–µ
            
            currentMoveDirection = direction;
            moveSVG(direction); // –ü–µ—Ä–≤–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ —Å—Ä–∞–∑—É
            
            // –ù–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 50–º—Å
            moveInterval = setInterval(() => {
                moveSVG(direction);
            }, 50);
        }
        
        window.stopContinuousMove = function() {
            if (moveInterval) {
                clearInterval(moveInterval);
                moveInterval = null;
                currentMoveDirection = null;
            }
        }
        
        // === –£–ü–†–ê–í–õ–ï–ù–ò–ï –ò–ó –°–¶–ï–ù–´ (–ü–õ–ê–í–ê–Æ–©–ê–Ø –ü–ê–ù–ï–õ–¨) ===
        window.handleSceneControlMouseDown = function(direction) {
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –æ–±—ä–µ–∫—Ç/–ø—Ä–æ—Ñ–∏–ª—å/–æ—Å–Ω–æ–≤—É
            if (activeSvgIndex !== null && svgGroups[activeSvgIndex]) {
                // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ SVG –æ–±—ä–µ–∫—Ç–æ–º
                startContinuousMove(direction);
            } else if (activeProfileIndex !== null && frameProfiles[activeProfileIndex]) {
                // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª–µ–º –∫–∞—Ä–∫–∞—Å–∞
                startProfileMove(direction);
            } else if (activeBaseIndex !== null && bases[activeBaseIndex]) {
                // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Å–Ω–æ–≤–æ–π
                startBaseMove(direction);
            }
        }
        
        window.handleSceneControlMouseUp = function() {
            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–µ –¥–≤–∏–∂–µ–Ω–∏—è
            stopContinuousMove();
            stopProfileMove();
            stopBaseMove();
        }
        
        // === –£–ü–†–ê–í–õ–ï–ù–ò–ï –° –ö–õ–ê–í–ò–ê–¢–£–†–´ ===
        document.addEventListener('keydown', (e) => {
            // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º, –µ—Å–ª–∏ —Ñ–æ–∫—É—Å –Ω–∞ input/textarea
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA' || e.target.tagName === 'SELECT') {
                return;
            }
            
            let direction = null;
            
            switch(e.key) {
                case 'ArrowUp':
                    direction = 'up';
                    e.preventDefault();
                    break;
                case 'ArrowDown':
                    direction = 'down';
                    e.preventDefault();
                    break;
                case 'ArrowLeft':
                    direction = 'left';
                    e.preventDefault();
                    break;
                case 'ArrowRight':
                    direction = 'right';
                    e.preventDefault();
                    break;
            }
            
            if (direction) {
                handleSceneControlMouseDown(direction);
            }
        });
        
        document.addEventListener('keyup', (e) => {
            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥–≤–∏–∂–µ–Ω–∏–µ –ø—Ä–∏ –æ—Ç–ø—É—Å–∫–∞–Ω–∏–∏ —Å—Ç—Ä–µ–ª–∫–∏
            if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(e.key)) {
                handleSceneControlMouseUp();
                e.preventDefault();
            }
        });
        
        // === –ú–ê–°–®–¢–ê–ë–ò–†–û–í–ê–ù–ò–ï –û–ë–™–ï–ö–¢–û–í ===
        let proportionalScale = false;
        
        window.toggleProportions = function() {
            proportionalScale = !proportionalScale;
            const lockBtn = document.getElementById('lock-proportions');
            const lockShackle = document.getElementById('lock-shackle');
            const lockIcon = document.getElementById('lock-icon');
            
            if (proportionalScale) {
                // –ó–∞–∫—Ä—ã—Ç—ã–π –∑–∞–º–æ–∫
                lockShackle.setAttribute('d', 'M7 11V7a5 5 0 0 1 10 0v4');
                lockBtn.style.background = 'rgba(255,209,0,0.15)';
                lockBtn.style.borderColor = 'rgba(255,209,0,0.4)';
                lockIcon.style.stroke = '#FFD100';
            } else {
                // –û—Ç–∫—Ä—ã—Ç—ã–π –∑–∞–º–æ–∫
                lockShackle.setAttribute('d', 'M7 11V7a5 5 0 0 1 9.9-1');
                lockBtn.style.background = 'rgba(255,255,255,0.05)';
                lockBtn.style.borderColor = 'rgba(255,255,255,0.15)';
                lockIcon.style.stroke = 'currentColor';
            }
        }
        
        window.scaleObject = function(dimension, delta) {
            if (activeSvgIndex === null || !svgGroups[activeSvgIndex]) return;
            
            const svgObj = svgGroups[activeSvgIndex];
            const widthInput = document.getElementById('scale-width');
            const heightInput = document.getElementById('scale-height');
            
            let currentWidth = parseFloat(widthInput.value) || svgObj.realWidth;
            let currentHeight = parseFloat(heightInput.value) || svgObj.realHeight;
            
            if (dimension === 'width') {
                currentWidth = Math.max(1, currentWidth + delta);
                if (proportionalScale && svgObj.realWidth && svgObj.realHeight) {
                    const ratio = svgObj.realHeight / svgObj.realWidth;
                    currentHeight = currentWidth * ratio;
                }
            } else if (dimension === 'height') {
                currentHeight = Math.max(1, currentHeight + delta);
                if (proportionalScale && svgObj.realWidth && svgObj.realHeight) {
                    const ratio = svgObj.realWidth / svgObj.realHeight;
                    currentWidth = currentHeight * ratio;
                }
            }
            
            applyScale(currentWidth, currentHeight);
        }
        
        window.onScaleInput = function(dimension) {
            if (activeSvgIndex === null || !svgGroups[activeSvgIndex]) return;
            
            const svgObj = svgGroups[activeSvgIndex];
            const widthInput = document.getElementById('scale-width');
            const heightInput = document.getElementById('scale-height');
            
            let currentWidth = parseFloat(widthInput.value) || svgObj.realWidth;
            let currentHeight = parseFloat(heightInput.value) || svgObj.realHeight;
            
            if (dimension === 'width' && proportionalScale && svgObj.realWidth && svgObj.realHeight) {
                const ratio = svgObj.realHeight / svgObj.realWidth;
                currentHeight = currentWidth * ratio;
            } else if (dimension === 'height' && proportionalScale && svgObj.realWidth && svgObj.realHeight) {
                const ratio = svgObj.realWidth / svgObj.realHeight;
                currentWidth = currentHeight * ratio;
            }
            
            applyScale(currentWidth, currentHeight);
        }
        
        window.onScaleKeypress = function(event, dimension) {
            if (event.key === 'Enter') {
                onScaleInput(dimension);
            }
        }
        
        function applyScale(newWidth, newHeight) {
            if (activeSvgIndex === null || !svgGroups[activeSvgIndex]) return;
            
            const svgObj = svgGroups[activeSvgIndex];
            if (!svgObj.realWidth || !svgObj.realHeight) return;
            
            const scaleX = newWidth / svgObj.realWidth;
            const scaleY = newHeight / svgObj.realHeight;
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º –º–∞—Å—à—Ç–∞–± –∫ –≥—Ä—É–ø–ø–µ
            if (svgObj.group) {
                svgObj.group.scale.set(scaleX, scaleY, 1);
            }
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–µ —Ä–∞–∑–º–µ—Ä—ã
            svgObj.currentWidth = newWidth;
            svgObj.currentHeight = newHeight;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–ø—É—Ç—ã
            document.getElementById('scale-width').value = Math.round(newWidth * 10) / 10;
            document.getElementById('scale-height').value = Math.round(newHeight * 10) / 10;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–∞–∑–º–µ—Ä–Ω—ã–µ –ª–∏–Ω–∏–∏
            updateDimensionLines();
            updateWallAndShadows();
            updateActiveSvgHighlight();
            
            log(`üìè –ú–∞—Å—à—Ç–∞–±: ${Math.round(newWidth)}√ó${Math.round(newHeight)}–º–º`, 'info');
        }
        
        function updateScaleInputs() {
            if (activeSvgIndex === null || !svgGroups[activeSvgIndex]) {
                document.getElementById('scale-width').value = 0;
                document.getElementById('scale-height').value = 0;
                return;
            }
            
            const svgObj = svgGroups[activeSvgIndex];
            const currentWidth = svgObj.currentWidth || svgObj.realWidth || 0;
            const currentHeight = svgObj.currentHeight || svgObj.realHeight || 0;
            
            document.getElementById('scale-width').value = Math.round(currentWidth * 10) / 10;
            document.getElementById('scale-height').value = Math.round(currentHeight * 10) / 10;
        }
        
        // === –°–ë–†–û–° –ú–ê–°–®–¢–ê–ë–ê –ò –ü–û–ó–ò–¶–ò–ò ===
        window.resetScale = function() {
            if (activeSvgIndex === null || !svgGroups[activeSvgIndex]) return;
            
            const svgObj = svgGroups[activeSvgIndex];
            if (!svgObj.realWidth || !svgObj.realHeight) return;
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –º–∞—Å—à—Ç–∞–± –∫ –∏—Å—Ö–æ–¥–Ω–æ–º—É
            applyScale(svgObj.realWidth, svgObj.realHeight);
            
            log('üîÑ –ú–∞—Å—à—Ç–∞–± —Å–±—Ä–æ—à–µ–Ω', 'info');
        }
        
        window.resetPosition = function() {
            if (activeSvgIndex === null || !svgGroups[activeSvgIndex]) return;
            
            const svgObj = svgGroups[activeSvgIndex];
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é –∫ –Ω–∞—á–∞–ª—å–Ω–æ–π
            svgObj.position.x = 0;
            svgObj.position.y = 0;
            svgObj.position.z = 0;
            
            if (svgObj.group) {
                svgObj.group.position.set(0, 0, 0);
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–Ω–∏ –∏ —Ä–∞–∑–º–µ—Ä–Ω—ã–µ –ª–∏–Ω–∏–∏
            updateWallAndShadows();
            updateDimensionLines();
            
            log('üîÑ –ü–æ–∑–∏—Ü–∏—è —Å–±—Ä–æ—à–µ–Ω–∞', 'info');
        }
        
        // === –ò–ó–ú–ï–ù–ï–ù–ò–ï –¶–í–ï–¢–ê –°–¢–ï–ù–´ ===
        // –ü–∞–ª–∏—Ç—Ä–∞ Oracal 641
        const wallColorPalette = [
            { color: '#FFFFFF', name: '010 - –ë–µ–ª—ã–π' },
            { color: '#FFD700', name: '020 - –ó–æ–ª–æ—Ç–æ–π –∂–µ–ª—Ç—ã–π' },
            { color: '#FFD100', name: '021 - –ñ–µ–ª—Ç—ã–π' },
            { color: '#FF6B00', name: '034 - –û—Ä–∞–Ω–∂–µ–≤—ã–π' },
            { color: '#E3000F', name: '031 - –ö—Ä–∞—Å–Ω—ã–π' },
            { color: '#DC143C', name: '032 - –¢–µ–º–Ω–æ-–∫—Ä–∞—Å–Ω—ã–π' },
            { color: '#800020', name: '338 - –ë–æ—Ä–¥–æ–≤—ã–π' },
            { color: '#FF1493', name: '043 - –†–æ–∑–æ–≤—ã–π' },
            { color: '#8B4513', name: '080 - –ö–æ—Ä–∏—á–Ω–µ–≤—ã–π' },
            { color: '#4B0082', name: '055 - –§–∏–æ–ª–µ—Ç–æ–≤—ã–π' },
            { color: '#003893', name: '052 - –°–∏–Ω–∏–π' },
            { color: '#00BFFF', name: '053 - –ì–æ–ª—É–±–æ–π' },
            { color: '#32CD32', name: '060 - –°–≤–µ—Ç–ª–æ-–∑–µ–ª–µ–Ω—ã–π' },
            { color: '#006400', name: '061 - –¢–µ–º–Ω–æ-–∑–µ–ª–µ–Ω—ã–π' },
            { color: '#9ACD32', name: '063 - –ó–µ–ª–µ–Ω–æ–µ —è–±–ª–æ–∫–æ' },
            { color: '#000000', name: '070 - –ß–µ—Ä–Ω—ã–π' },
            { color: '#808080', name: '071 - –°–µ—Ä—ã–π' },
            { color: '#C0C0C0', name: '090 - –°–≤–µ—Ç–ª–æ-—Å–µ—Ä—ã–π' }
        ];
        
        function renderWallColors() {
            const row1 = document.getElementById('wall-colors-row-1');
            const row2 = document.getElementById('wall-colors-row-2');
            if (!row1 || !row2) return;
            
            row1.innerHTML = '';
            row2.innerHTML = '';
            
            // –î–µ–ª–∏–º –ø–∞–ª–∏—Ç—Ä—É –ø–æ–ø–æ–ª–∞–º
            const halfLength = Math.ceil(wallColorPalette.length / 2);
            
            wallColorPalette.forEach((colorData, index) => {
                const btn = document.createElement('button');
                btn.onclick = () => setWallColor(colorData.color);
                btn.title = colorData.name;
                btn.style.cssText = `
                    width: 20px;
                    height: 20px;
                    background: ${colorData.color};
                    border: ${colorData.color === '#FFFFFF' ? '1px solid rgba(255,255,255,0.5)' : '1px solid rgba(255,255,255,0.3)'};
                    border-radius: 3px;
                    cursor: pointer;
                    transition: all 0.2s;
                    flex-shrink: 0;
                `;
                btn.onmouseover = () => btn.style.transform = 'scale(1.2)';
                btn.onmouseout = () => btn.style.transform = 'scale(1)';
                
                // –î–æ–±–∞–≤–ª—è–µ–º –≤ –ø–µ—Ä–≤—ã–π –∏–ª–∏ –≤—Ç–æ—Ä–æ–π —Ä—è–¥
                if (index < halfLength) {
                    row1.appendChild(btn);
                } else {
                    row2.appendChild(btn);
                }
            });
        }
        
        window.changeWallColor = function(color) {
            log(`üé® –ú–µ–Ω—è—é —Ü–≤–µ—Ç —Å—Ç–µ–Ω—ã –Ω–∞: ${color}`, 'info');
            state.wallColor = color;
            log(`üé® state.wallColor —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: ${state.wallColor}`, 'info');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ü–≤–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å—Ç–µ–Ω—ã
            if (backWall && backWall.material) {
                backWall.material.color.set(color);
                log(`üé® –¶–≤–µ—Ç –ø—Ä–∏–º–µ–Ω–µ–Ω –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å—Ç–µ–Ω–µ`, 'info');
            } else {
                log(`‚ö†Ô∏è –°—Ç–µ–Ω–∞ –µ—â–µ –Ω–µ —Å–æ–∑–¥–∞–Ω–∞`, 'warning');
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º colorpicker
            document.getElementById('wall-color-picker').value = color;
            
            // –ù–∞—Ö–æ–¥–∏–º –Ω–∞–∑–≤–∞–Ω–∏–µ —Ü–≤–µ—Ç–∞ –≤ –ø–∞–ª–∏—Ç—Ä–µ
            const colorInfo = wallColorPalette.find(c => c.color.toLowerCase() === color.toLowerCase());
            const colorName = colorInfo ? colorInfo.name : color;
            
            log(`‚úÖ –¶–≤–µ—Ç —Å—Ç–µ–Ω—ã –∏–∑–º–µ–Ω–µ–Ω: ${colorName}`, 'success');
        }
        
        window.setWallColor = function(color) {
            changeWallColor(color);
        }
        
        // === –£–ü–†–ê–í–õ–ï–ù–ò–ï –ò–ö–û–ù–û–ß–ù–´–ú–ò –ö–ù–û–ü–ö–ê–ú–ò ===
        window.toggleConstruction = function(type) {
            // –û–±–Ω–æ–≤–ª—è–µ–º UI –∫–Ω–æ–ø–æ–∫
            document.getElementById('btn-volumetric').classList.toggle('active', type === 'volumetric');
            document.getElementById('btn-flat').classList.toggle('active', type === 'flat');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–∫—Ä—ã—Ç—ã–µ radio
            document.getElementById('construction-volumetric').checked = (type === 'volumetric');
            document.getElementById('construction-flat').checked = (type === 'flat');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º state
            state.construction = type;
            
            // –°–∫—Ä—ã–≤–∞–µ–º/–ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–µ–∫—Ü–∏—é –±–æ—Ä—Ç–∞
            const isVolumetric = (type === 'volumetric');
            const sideToggle = document.querySelector('[data-section="side-content"]');
            const sideContent = document.getElementById('side-content');
            if (sideToggle && sideContent) {
                if (isVolumetric) {
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–µ–∫—Ü–∏—é "–ë–æ—Ä—Ç"
                    sideToggle.style.display = 'block';
                    sideContent.style.display = 'block';
                    // –†–∞—Å–∫—Ä—ã–≤–∞–µ–º –µ—Å–ª–∏ —Å–≤—ë—Ä–Ω—É—Ç–∞
                    if (sideContent.classList.contains('collapsed')) {
                        sideToggle.classList.remove('collapsed');
                        sideContent.classList.remove('collapsed');
                    }
                    
                    // –ü—Ä–∏ –≤—ã–±–æ—Ä–µ "–ë–û–†–¢" —Å—Ç–∞–≤–∏–º –ê–∫—Ä–∏–ª –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                    const faceMaterialSelect = document.getElementById('face-material-type');
                    if (faceMaterialSelect && faceMaterialSelect.value.startsWith('pvc')) {
                        faceMaterialSelect.value = 'acrylic-3';
                        // –û–±–Ω–æ–≤–ª—è–µ–º state
                        const [type, thickness] = faceMaterialSelect.value.split('-');
                        state.faceMaterial.type = type;
                        state.faceMaterial.thickness = thickness;
                        updateActiveSVG();
                    }
                    
                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ê–ª—é–º–∏–Ω–∏–π 60–º–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                    const sideMaterialSelect = document.getElementById('side-material-type');
                    if (sideMaterialSelect) {
                        sideMaterialSelect.value = 'aluminum-6';
                        sideMaterialSelect.dispatchEvent(new Event('change'));
                    }
                } else {
                    // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å—é —Å–µ–∫—Ü–∏—é "–ë–æ—Ä—Ç" –¥–ª—è –ø–ª–æ—Å–∫–∏—Ö
                    sideToggle.style.display = 'none';
                    sideContent.style.display = 'none';
                }
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º 3D
            updateActiveSVG();
            log(`–¢–∏–ø: ${type === 'volumetric' ? '–û–±—ä—ë–º–Ω—ã–π' : '–ü–ª–æ—Å–∫–∏–π'}`, 'info');
        }
        
        window.toggleOption = function(option) {
            const checkbox = document.getElementById(`option-${option}`);
            const btn = document.getElementById(`btn-${option}`);
            
            // –°–ü–ï–¶–ò–ê–õ–¨–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê –î–õ–Ø –ü–û–î–°–í–ï–¢–ö–ò
            if (option === 'backlight') {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–∞—Ç–µ—Ä–∏–∞–ª –ü–ï–†–ï–î –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ–º
                if (!checkbox.checked) { // –ü—ã—Ç–∞–µ–º—Å—è –≤–∫–ª—é—á–∏—Ç—å
                    if (state.faceMaterial.type !== 'acrylic') {
                        alert('–í—ã–±–µ—Ä–∏—Ç–µ –º–∞—Ç–µ—Ä–∏–∞–ª –∞–∫—Ä–∏–ª');
                        return; // –ù–ï –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º
                    }
                    if (state.construction === 'flat') {
                        alert('–ü–æ–¥—Å–≤–µ—Ç–∫–∞ –≤–æ–∑–º–æ–∂–Ω–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è –æ–±—ä—ë–º–Ω—ã—Ö –±—É–∫–≤!');
                        return; // –ù–ï –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º
                    }
                }
            }
            
            // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            checkbox.checked = !checkbox.checked;
            btn.classList.toggle('active', checkbox.checked);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º state
            if (option === 'backlight') {
                state.hasBacklight = checkbox.checked;
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –ø–æ–ª–µ –≤—ã–±–æ—Ä–∞ —Ç–∏–ø–∞ LED
                const ledTypeGroup = document.getElementById('led-type-group');
                if (ledTypeGroup) {
                    ledTypeGroup.style.display = checkbox.checked ? 'block' : 'none';
                }
                updateActiveSVG();
            } else if (option === 'side') {
                // –í–∫–ª—é—á–∞–µ–º –æ–±—ä—ë–º–Ω—É—é –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å –±–æ—Ä—Ç–∞
                if (checkbox.checked) {
                    state.construction = 'volumetric';
                    document.getElementById('construction-volumetric').checked = true;
                    setConstruction('volumetric');
                }
                updateActiveSVG();
            } else if (option === 'contour') {
                state.hasContour = checkbox.checked;
                updateWallAndShadows();
            } else if (option === 'spacers') {
                state.hasSpacers = checkbox.checked;
                updateWallAndShadows();
            }
            
            log(`${option}: ${checkbox.checked ? '–í–ö–õ' : '–í–´–ö–õ'}`, 'info');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä
            updateCostCalculator();
        }
        
        // === –£–ü–†–ê–í–õ–ï–ù–ò–ï –ò–ù–î–ò–ö–ê–¢–û–†–û–ú –ê–ö–¢–ò–í–ù–û–ô –°–ï–ö–¶–ò–ò ===
        function updateSectionIndicator(sectionElement) {
            const indicator = document.getElementById('section-indicator');
            if (!indicator || !sectionElement) return;
            
            const rect = sectionElement.getBoundingClientRect();
            const panel = document.querySelector('.overlay-right');
            const panelRect = panel.getBoundingClientRect();
            
            // –ü–æ–∑–∏—Ü–∏—è –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ø–∞–Ω–µ–ª–∏
            const topPosition = rect.top - panelRect.top + panel.scrollTop;
            
            indicator.style.top = `${panelRect.top + (rect.top - panelRect.top)}px`;
        }
        
        // === –°–í–û–†–ê–ß–ò–í–ê–ù–ò–ï –°–ï–ö–¶–ò–ô (–£–ù–ò–í–ï–†–°–ê–õ–¨–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø) ===
        window.toggleSection = function(sectionId) {
            const toggle = document.querySelector(`[data-section="${sectionId}"]`);
            const content = document.getElementById(sectionId);
            if (!toggle || !content) return;
            
            toggle.classList.toggle('collapsed');
            content.classList.toggle('collapsed');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä
            updateSectionIndicator(toggle);
        }
        
        window.toggleCalculator = function() {
            const toggle = document.querySelector('.calc-toggle');
            const content = document.querySelector('.calc-content');
            toggle.classList.toggle('collapsed');
            content.classList.toggle('collapsed');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä
            updateSectionIndicator(toggle);
        }
        
        // === –î–û–ë–ê–í–õ–ï–ù–ò–ï –í –ö–û–†–ó–ò–ù–£ –¢–ò–õ–¨–î–´ ===
        window.addToCart = function() {
            if (svgGroups.length === 0) {
                showToast('‚ö†Ô∏è –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω SVG –æ–±—ä–µ–∫—Ç!', 3000);
                return;
            }
            
            try {
                // 1. –§–æ—Ä–º–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –∑–∞–∫–∞–∑–∞
                const orderData = {
                    date: new Date().toISOString(),
                    objects: [],
                    totalPrice: 0
                };
                
                svgGroups.forEach(svgObj => {
                    const cost = calculateObjectCost(svgObj);
                    const exactPrice = Math.round(cost.total);
                    
                    orderData.objects.push({
                        name: svgObj.name,
                        width: Math.round(svgObj.currentWidth || svgObj.realWidth),
                        height: Math.round(svgObj.currentHeight || svgObj.realHeight),
                        construction: state.construction === 'volumetric' ? '–û–±—ä—ë–º–Ω—ã–µ' : '–ü–ª–æ—Å–∫–∏–µ',
                        materials: cost.materialsList,
                        price: exactPrice
                    });
                    
                    orderData.totalPrice += exactPrice;
                });
                
                // 2. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º JSON —Ñ–∞–π–ª —Å –¥–∞–Ω–Ω—ã–º–∏ –∑–∞–∫–∞–∑–∞
                const orderJSON = JSON.stringify(orderData, null, 2);
                const orderBlob = new Blob([orderJSON], { type: 'application/json' });
                const orderFile = new File([orderBlob], 'order-data.json', { type: 'application/json' });
                
                // 3. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º SVG –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞ (–≤—Å–µ –æ–±—ä–µ–∫—Ç—ã –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ)
                const productionSVG = exportSceneToSVG(); // –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ñ—É–Ω–∫—Ü–∏—é
                const svgBlob = new Blob([productionSVG], { type: 'image/svg+xml' });
                const svgFile = new File([svgBlob], 'production-layout.svg', { type: 'image/svg+xml' });
                
                // 4. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ –∫–æ—Ä–∑–∏–Ω—É –¢–∏–ª—å–¥—ã
                // TODO: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Tilda Cart API
                console.log('[addToCart] –î–∞–Ω–Ω—ã–µ –∑–∞–∫–∞–∑–∞:', orderData);
                console.log('[addToCart] –§–∞–π–ª—ã –≥–æ—Ç–æ–≤—ã:', orderFile, svgFile);
                
                // –í—Ä–µ–º–µ–Ω–Ω–æ: —Å–∫–∞—á–∏–≤–∞–µ–º —Ñ–∞–π–ª—ã –ª–æ–∫–∞–ª—å–Ω–æ
                downloadFile(orderFile);
                setTimeout(() => downloadFile(svgFile), 500);
                
                showToast('‚úÖ –î–∞–Ω–Ω—ã–µ –∑–∞–∫–∞–∑–∞ –≥–æ—Ç–æ–≤—ã! –§–∞–π–ª—ã —Å–∫–∞—á–∞–Ω—ã.', 3000);
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é
                setTimeout(() => {
                    alert('üì¶ –§–∞–π–ª—ã –¥–ª—è –∑–∞–∫–∞–∑–∞ —Å–∫–∞—á–∞–Ω—ã:\n\n1. order-data.json - –¥–∞–Ω–Ω—ã–µ –∑–∞–∫–∞–∑–∞\n2. production-layout.svg - –º–∞–∫–µ—Ç –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞\n\n–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥: –ø—Ä–∏–∫—Ä–µ–ø–∏—Ç–µ —ç—Ç–∏ —Ñ–∞–π–ª—ã –≤ –∫–æ—Ä–∑–∏–Ω–µ –∏ –æ—Ñ–æ—Ä–º–∏—Ç–µ –∑–∞–∫–∞–∑.');
                }, 1000);
                
            } catch (error) {
                console.error('[addToCart] –û—à–∏–±–∫–∞:', error);
                showToast('‚ùå –û—à–∏–±–∫–∞ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞: ' + error.message, 5000);
            }
        }
        
        // === –ì–ï–ù–ï–†–ê–¶–ò–Ø PDF –¢–ï–•–ù–ò–ß–ï–°–ö–û–ì–û –ó–ê–î–ê–ù–ò–Ø (–æ—Ç–∫—Ä—ã–≤–∞–µ—Ç HTML –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ –¥–ª—è –ø–µ—á–∞—Ç–∏) ===
        window.generatePDF = async function() {
            try {
                log('‚è≥ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è PDF –¢–ó...', 'info');
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –¥–∞–Ω–Ω—ã—Ö
                if (svgGroups.length === 0 && bases.length === 0) {
                    log('‚ö†Ô∏è –î–æ–±–∞–≤—å—Ç–µ –±—É–∫–≤—ã –∏–ª–∏ –æ—Å–Ω–æ–≤—É!', 'warning');
                    alert('‚ö†Ô∏è –î–æ–±–∞–≤—å—Ç–µ –±—É–∫–≤—ã –∏–ª–∏ –æ—Å–Ω–æ–≤—É –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º PDF!');
                    return;
                }
                
                // –§—É–Ω–∫—Ü–∏—è —É–¥–∞–ª–µ–Ω–∏—è —Ü–µ–Ω –∏ —É–ª—É—á—à–µ–Ω–∏—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                const cleanPrices = (text) => {
                    // –£–¥–∞–ª—è–µ–º —Ü–µ–Ω—ã
                    text = text.replace(/[\d\s,]+‚ÇΩ/g, '');
                    
                    // –£–±–∏—Ä–∞–µ–º —Ñ—Ä–µ–∑–µ—Ä–æ–≤–∫—É
                    if (text.includes('–§—Ä–µ–∑–µ—Ä–æ–≤–∫–∞') || text.includes('—Ñ—Ä–µ–∑–µ—Ä–æ–≤–∫–∞')) return '';
                    
                    // –£–±–∏—Ä–∞–µ–º –ø–æ–∫–ª–µ–π–∫—É –ø–ª—ë–Ω–∫–∏
                    if (text.includes('–ü–æ–∫–ª–µ–π–∫–∞') || text.includes('–ø–æ–∫–ª–µ–π–∫–∞')) return '';
                    
                    // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —Ü–≤–µ—Ç–∞ –ø–ª—ë–Ω–∫–∏: #FF9800 #FF9800 Oracal ‚Üí —Ü–≤–µ—Ç –û—Ä–∞–Ω–∂–µ–≤—ã–π Oracal
                    text = text.replace(/–ü–ª—ë–Ω–∫–∞\s+(#[0-9A-F]{6})\s+\1\s+/, '–ü–ª—ë–Ω–∫–∞ —Ü–≤–µ—Ç ');
                    
                    // –£–±–∏—Ä–∞–µ–º (–≤–∫–ª—é—á—ë–Ω –≤ —Å—Ç–æ–∏–º–æ—Å—Ç—å)
                    text = text.replace(/\s*\(–≤–∫–ª—é—á—ë–Ω –≤ —Å—Ç–æ–∏–º–æ—Å—Ç—å\)/gi, '');
                    
                    // –î–ª—è –ø—Ä–æ—Ñ–∏–ª—è –¥–æ–±–∞–≤–ª—è–µ–º "—Ü–≤–µ—Ç" –ø–µ—Ä–µ–¥ —Ü–≤–µ—Ç–æ–º
                    text = text.replace(/–ü—Ä–æ—Ñ–∏–ª—å - (–ê–ª—é–º–∏–Ω–∏–µ–≤—ã–π)\s+(\d+–º–º)/gi, '–ü—Ä–æ—Ñ–∏–ª—å - $1 —Ü–≤–µ—Ç –ë–µ–ª—ã–π $2');
                    
                    // –û—á–∏—Å—Ç–∫–∞ –ª–∏—à–Ω–∏—Ö –ø—Ä–æ–±–µ–ª–æ–≤
                    return text.replace(/:\s*$/g, '').replace(/\s+/g, ' ').trim();
                };
                
                // –§—É–Ω–∫—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ SVG-—á–µ—Ä—Ç–µ–∂–∞ —Å —Ä–∞–∑–º–µ—Ä–Ω—ã–º–∏ –ª–∏–Ω–∏—è–º–∏
                const generateDrawingSVG = (width, height, label, options = {}) => {
                    const {
                        frameWidth = null,
                        frameHeight = null,
                        hasBend = false,
                        bendSize = 0
                    } = options;
                    
                    // –ú–∞—Å—à—Ç–∞–±: 1 –µ–¥–∏–Ω–∏—Ü–∞ SVG = 1–º–º —Ä–µ–∞–ª—å–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞, –Ω–æ —É–º–µ–Ω—å—à–∞–µ–º –¥–ª—è –≤–ø–∏—Å—ã–≤–∞–Ω–∏—è –≤ —Å—Ç—Ä–∞–Ω–∏—Ü—É
                    const maxSvgWidth = 500; // –º–∞–∫—Å —à–∏—Ä–∏–Ω–∞ –≤ –ø–∏–∫—Å–µ–ª—è—Ö
                    const padding = 60; // –æ—Ç—Å—Ç—É–ø –¥–ª—è —Ä–∞–∑–º–µ—Ä–Ω—ã—Ö –ª–∏–Ω–∏–π
                    const scale = Math.min(maxSvgWidth / Math.max(width, height), 0.5);
                    
                    const scaledW = width * scale;
                    const scaledH = height * scale;
                    const svgWidth = scaledW + padding * 2;
                    const svgHeight = scaledH + padding * 2;
                    
                    let svg = `<svg width="${svgWidth}" height="${svgHeight}" style="margin: 10mm auto; display: block; border: 1px solid #ddd; background: #fafafa;">`;
                    
                    // –û—Å–Ω–æ–≤–Ω–æ–π –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫
                    svg += `<rect x="${padding}" y="${padding}" width="${scaledW}" height="${scaledH}" fill="none" stroke="#333" stroke-width="2"/>`;
                    
                    // –ó–∞–≥–∏–± (–µ—Å–ª–∏ –µ—Å—Ç—å)
                    if (hasBend && bendSize > 0) {
                        const bendScaled = bendSize * scale;
                        // –õ–µ–≤—ã–π –±–æ—Ä—Ç
                        svg += `<rect x="${padding - bendScaled}" y="${padding}" width="${bendScaled}" height="${scaledH}" fill="#e0e0e0" stroke="#666" stroke-width="1"/>`;
                        // –ü—Ä–∞–≤—ã–π –±–æ—Ä—Ç
                        svg += `<rect x="${padding + scaledW}" y="${padding}" width="${bendScaled}" height="${scaledH}" fill="#e0e0e0" stroke="#666" stroke-width="1"/>`;
                        // –í–µ—Ä—Ö–Ω–∏–π –±–æ—Ä—Ç
                        svg += `<rect x="${padding}" y="${padding - bendScaled}" width="${scaledW}" height="${bendScaled}" fill="#e0e0e0" stroke="#666" stroke-width="1"/>`;
                        // –ù–∏–∂–Ω–∏–π –±–æ—Ä—Ç
                        svg += `<rect x="${padding}" y="${padding + scaledH}" width="${scaledW}" height="${bendScaled}" fill="#e0e0e0" stroke="#666" stroke-width="1"/>`;
                        
                        // –†–∞–∑–º–µ—Ä–Ω–∞—è –ª–∏–Ω–∏—è –¥–ª—è –∑–∞–≥–∏–±–∞
                        const bendY = padding - bendScaled - 15;
                        svg += `<line x1="${padding - bendScaled}" y1="${bendY}" x2="${padding}" y2="${bendY}" stroke="#999" stroke-width="1" marker-end="url(#arrowend)" marker-start="url(#arrowstart)"/>`;
                        svg += `<text x="${padding - bendScaled/2}" y="${bendY - 5}" fill="#666" font-size="10" text-anchor="middle">${bendSize}–º–º</text>`;
                    }
                    
                    // –ö–∞—Ä–∫–∞—Å (–µ—Å–ª–∏ –µ—Å—Ç—å)
                    if (frameWidth && frameHeight) {
                        const fw = frameWidth * scale;
                        const fh = frameHeight * scale;
                        const offsetX = (scaledW - fw) / 2;
                        const offsetY = (scaledH - fh) / 2;
                        svg += `<rect x="${padding + offsetX}" y="${padding + offsetY}" width="${fw}" height="${fh}" fill="none" stroke="#ff6600" stroke-width="2" stroke-dasharray="5,5"/>`;
                        
                        // –†–∞–∑–º–µ—Ä–Ω—ã–µ –ª–∏–Ω–∏–∏ –¥–ª—è –∫–∞—Ä–∫–∞—Å–∞
                        const frameLineY = padding + offsetY + fh + 15;
                        svg += `<line x1="${padding + offsetX}" y1="${frameLineY}" x2="${padding + offsetX + fw}" y2="${frameLineY}" stroke="#ff6600" stroke-width="1" marker-end="url(#arrowend2)" marker-start="url(#arrowstart2)"/>`;
                        svg += `<text x="${padding + offsetX + fw/2}" y="${frameLineY + 15}" fill="#ff6600" font-size="10" text-anchor="middle" font-weight="bold">–∫–∞—Ä–∫–∞—Å ${frameWidth}–º–º</text>`;
                    }
                    
                    // –†–∞–∑–º–µ—Ä–Ω—ã–µ –ª–∏–Ω–∏–∏
                    // –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è (–≤–Ω–∏–∑—É)
                    const dimLineY = padding + scaledH + 25;
                    svg += `<line x1="${padding}" y1="${dimLineY}" x2="${padding + scaledW}" y2="${dimLineY}" stroke="#000" stroke-width="1" marker-end="url(#arrowend)" marker-start="url(#arrowstart)"/>`;
                    svg += `<text x="${padding + scaledW/2}" y="${dimLineY + 15}" fill="#000" font-size="12" text-anchor="middle" font-weight="bold">${width} –º–º</text>`;
                    
                    // –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞—è (—Å–ø—Ä–∞–≤–∞)
                    const dimLineX = padding + scaledW + 25;
                    svg += `<line x1="${dimLineX}" y1="${padding}" x2="${dimLineX}" y2="${padding + scaledH}" stroke="#000" stroke-width="1" marker-end="url(#arrowend)" marker-start="url(#arrowstart)"/>`;
                    svg += `<text x="${dimLineX + 10}" y="${padding + scaledH/2}" fill="#000" font-size="12" text-anchor="start" font-weight="bold" transform="rotate(90 ${dimLineX + 10} ${padding + scaledH/2})">${height} –º–º</text>`;
                    
                    // –ú–∞—Ä–∫–µ—Ä—ã —Å—Ç—Ä–µ–ª–æ–∫
                    svg += `<defs>
                        <marker id="arrowstart" markerWidth="10" markerHeight="10" refX="0" refY="3" orient="auto" markerUnits="strokeWidth">
                            <path d="M0,3 L3,0 L3,6 Z" fill="#000"/>
                        </marker>
                        <marker id="arrowend" markerWidth="10" markerHeight="10" refX="3" refY="3" orient="auto" markerUnits="strokeWidth">
                            <path d="M3,3 L0,0 L0,6 Z" fill="#000"/>
                        </marker>
                        <marker id="arrowstart2" markerWidth="10" markerHeight="10" refX="0" refY="3" orient="auto" markerUnits="strokeWidth">
                            <path d="M0,3 L3,0 L3,6 Z" fill="#ff6600"/>
                        </marker>
                        <marker id="arrowend2" markerWidth="10" markerHeight="10" refX="3" refY="3" orient="auto" markerUnits="strokeWidth">
                            <path d="M3,3 L0,0 L0,6 Z" fill="#ff6600"/>
                        </marker>
                    </defs>`;
                    
                    svg += `</svg>`;
                    return svg;
                };
                
                // –ü–æ–ª—É—á–∞–µ–º —Å–∫—Ä–∏–Ω—à–æ—Ç 3D —Å—Ü–µ–Ω—ã
                let sceneImage = '';
                try {
                    if (renderer && scene && camera) {
                        const oldBg = renderer.getClearColor(new THREE.Color());
                        renderer.setClearColor(0xffffff, 1);
                        renderer.render(scene, camera);
                        sceneImage = renderer.domElement.toDataURL('image/jpeg', 0.9);
                        renderer.setClearColor(oldBg);
                        renderer.render(scene, camera);
                    }
                } catch(e) {
                    console.warn('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–∫—Ä–∏–Ω—à–æ—Ç–∞:', e);
                }
                
                // –°–æ–∑–¥–∞—ë–º HTML –∫–æ–Ω—Ç–µ–Ω—Ç
                let htmlContent = `
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –ó–∞–¥–∞–Ω–∏–µ - ${new Date().toLocaleDateString('ru-RU')}</title>
    <style>
        @media print {
            body { margin: 0; padding: 20mm; }
            h1, h2, h3 { page-break-after: avoid; }
            .page-break { page-break-before: always; }
        }
        body {
            font-family: Arial, sans-serif;
            font-size: 10pt;
            line-height: 1.4;
            color: #000;
            background: #fff;
            max-width: 210mm;
            margin: 0 auto;
            padding: 20mm;
        }
        h1 {
            font-size: 20pt;
            text-align: center;
            margin-bottom: 10mm;
            border-bottom: 2px solid #000;
            padding-bottom: 5mm;
        }
        h2 {
            font-size: 14pt;
            margin-top: 10mm;
            margin-bottom: 3mm;
            border-bottom: 1px solid #000;
            padding-bottom: 2mm;
        }
        h3 {
            font-size: 11pt;
            margin-top: 5mm;
            margin-bottom: 2mm;
        }
        .param {
            margin: 2mm 0;
        }
        .item {
            margin-left: 5mm;
            font-size: 8pt;
            line-height: 1.3;
        }
        img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 5mm auto;
        }
        .print-button {
            position: fixed;
            top: 10mm;
            right: 10mm;
            padding: 10px 20px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14pt;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
        .print-button:hover {
            background: #45a049;
        }
        @media print {
            .print-button { display: none; }
        }
    </style>
</head>
<body>
    <button class="print-button" onclick="window.print()">üñ®Ô∏è –ü–µ—á–∞—Ç—å / –°–æ—Ö—Ä–∞–Ω–∏—Ç—å PDF</button>
    
    <h1>–¢–ï–•–ù–ò–ß–ï–°–ö–û–ï –ó–ê–î–ê–ù–ò–ï</h1>
    <div class="param" style="font-size:12pt; margin-bottom:10mm;">
        <strong>–î–∞—Ç–∞:</strong> ${new Date().toLocaleDateString('ru-RU')}
    </div>
    
    <h2>–ú–ê–ö–ï–¢ 3D –ú–û–î–ï–õ–ò</h2>
    ${sceneImage ? `<img src="${sceneImage}" alt="3D –º–æ–¥–µ–ª—å" style="max-height:100mm;">` : '<p style="font-style:italic;">(–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ)</p>'}
    
                    <h2>–û–ë–©–ò–ï –ü–ê–†–ê–ú–ï–¢–†–´ –ö–û–ù–°–¢–†–£–ö–¶–ò–ò</h2>
                    <div class="param"><strong>–¢–∏–ø –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏:</strong> ${state.construction === 'flat' ? '–ü–ª–æ—Å–∫–∞—è (–±–µ–∑ –±–æ—Ä—Ç–∞)' : '–û–±—ä—ë–º–Ω–∞—è (—Å –±–æ—Ä—Ç–æ–º)'}</div>
                    ${state.construction === 'volumetric' ? `<div class="param"><strong>–í—ã—Å–æ—Ç–∞ –±–æ—Ä—Ç–∞:</strong> ${state.bortHeight} –º–º</div>` : ''}
                    <div class="param"><strong>–ü–æ–¥—Å–≤–µ—Ç–∫–∞:</strong> ${state.hasBacklight ? '–î–∞' : '–ù–µ—Ç'}</div>
                    ${state.hasBacklight ? `<div class="param"><strong>–¢–∏–ø –¥–∏–æ–¥–æ–≤:</strong> ${state.ledType}</div>` : ''}
                    <div class="param"><strong>–î–∏—Å—Ç–∞–Ω—Ü–∏–æ–Ω–Ω—ã–µ –¥–µ—Ä–∂–∞—Ç–µ–ª–∏:</strong> ${state.hasSpacers ? '–î–∞' : '–ù–µ—Ç'}</div>
                    ${bases && bases.length > 0 ? `<div class="param"><strong>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Å–Ω–æ–≤:</strong> ${bases.length} —à—Ç</div>` : ''}
`;
                
                // –ß–ï–†–¢–ï–ñ–ò –° –û–ü–ò–°–ê–ù–ò–ï–ú –ú–ê–¢–ï–†–ò–ê–õ–û–í (–û–ë–™–ï–î–ò–ù–ï–ù–´)
                htmlContent += `<div class="page-break"></div><h2>–ß–ï–†–¢–ï–ñ–ò –ò –°–ü–ï–¶–ò–§–ò–ö–ê–¶–ò–Ø</h2>`;
                
                // –ß–µ—Ä—Ç–µ–∂–∏ SVG –æ–±—ä–µ–∫—Ç–æ–≤ + –º–∞—Ç–µ—Ä–∏–∞–ª—ã
                for (let i = 0; i < svgGroups.length; i++) {
                    const obj = svgGroups[i];
                    const cost = calculateObjectCost(obj);
                    const w = Math.round(obj.currentWidth || 0);
                    const h = Math.round(obj.currentHeight || 0);
                    
                    htmlContent += `
                        <h3>${i + 1}. ${obj.name || '–û–±—ä–µ–∫—Ç-' + (i + 1)}</h3>
                        <div class="param"><strong>–†–∞–∑–º–µ—Ä—ã:</strong> ${w} √ó ${h} –º–º | <strong>–ü–ª–æ—â–∞–¥—å:</strong> ${cost.areaM2.toFixed(3)} –º¬≤ | <strong>–ü–µ—Ä–∏–º–µ—Ç—Ä:</strong> ${cost.perimeterM.toFixed(2)} –º</div>
                    `;
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º —á–µ—Ä—Ç–µ–∂ —Å –ø–æ–ª–Ω—ã–º SVG-–∫–æ–Ω—Ç—É—Ä–æ–º
                    if (obj.originalSvg) {
                        // –ü–∞—Ä—Å–∏–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π SVG –∏ –∏–∑–≤–ª–µ–∫–∞–µ–º viewBox –∏ –ø—É—Ç–∏
                        const parser = new DOMParser();
                        const svgDoc = parser.parseFromString(obj.originalSvg, 'image/svg+xml');
                        const svgElement = svgDoc.querySelector('svg');
                        
                        // –ü–æ–ª—É—á–∞–µ–º viewBox –∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ SVG
                        let viewBox = svgElement.getAttribute('viewBox');
                        if (!viewBox) {
                            // –ï—Å–ª–∏ –Ω–µ—Ç viewBox, —Å–æ–∑–¥–∞–µ–º –∏–∑ width/height
                            const svgWidth = svgElement.getAttribute('width') || w;
                            const svgHeight = svgElement.getAttribute('height') || h;
                            viewBox = `0 0 ${svgWidth} ${svgHeight}`;
                        }
                        
                        const [vbX, vbY, vbW, vbH] = viewBox.split(' ').map(Number);
                        
                        // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ö–ª–æ–Ω–∏—Ä—É–µ–º –≤–µ—Å—å SVG –∫–æ–Ω—Ç–µ–Ω—Ç —Ü–µ–ª–∏–∫–æ–º, –≤–∫–ª—é—á–∞—è –≥—Ä—É–ø–ø—ã –∏ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏
                        const svgContent = svgElement.innerHTML;
                        
                        if (svgContent && svgContent.trim()) {
                            // –í—ã—á–∏—Å–ª—è–µ–º —Ä–∞–∑–º–µ—Ä—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Å —É—á–µ—Ç–æ–º –æ—Ç—Å—Ç—É–ø–æ–≤ –¥–ª—è —Ä–∞–∑–º–µ—Ä–Ω—ã—Ö –ª–∏–Ω–∏–π
                            const padding = Math.max(vbW, vbH) * 0.15;
                            const totalW = vbW + padding * 2;
                            const totalH = vbH + padding * 2;
                            const newViewBox = `${vbX - padding} ${vbY - padding} ${totalW} ${totalH}`;
                            
                            htmlContent += `<div style="background: #fafafa; padding: 20px; border: 1px solid #ddd; margin: 15px 0; page-break-inside: avoid;">`;
                            htmlContent += `<svg width="100%" height="auto" viewBox="${newViewBox}" preserveAspectRatio="xMidYMid meet" style="display: block; margin: 0 auto; max-width: 900px;">`;
                            
                            // –í—Å—Ç–∞–≤–ª—è–µ–º –≤–µ—Å—å SVG –∫–æ–Ω—Ç–µ–Ω—Ç (–≤–∫–ª—é—á–∞—è –≥—Ä—É–ø–ø—ã, —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏ —Ç.–¥.)
                            htmlContent += `<g fill="#333" stroke="#333" stroke-width="${Math.max(vbW, vbH) * 0.002}">${svgContent}</g>`;
                            
                            // –†–∞–∑–º–µ—Ä–Ω—ã–µ –ª–∏–Ω–∏–∏ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º
                            const fontSize = Math.max(vbW, vbH) * 0.04;
                            htmlContent += `<text x="${vbX + vbW/2}" y="${vbY + vbH + padding * 0.5}" fill="#000" font-size="${fontSize}" text-anchor="middle" font-weight="bold">${w} –º–º</text>`;
                            htmlContent += `<text x="${vbX - padding * 0.5}" y="${vbY + vbH/2}" fill="#000" font-size="${fontSize}" text-anchor="middle" font-weight="bold" transform="rotate(-90, ${vbX - padding * 0.5}, ${vbY + vbH/2})">${h} –º–º</text>`;
                            htmlContent += `</svg>`;
                            htmlContent += `</div>`;
                        } else {
                            // Fallback: –ø—Ä–æ—Å—Ç–æ–π –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫ —Å —Ä–∞–∑–º–µ—Ä–∞–º–∏
                            htmlContent += generateDrawingSVG(w, h, obj.name || '–û–±—ä–µ–∫—Ç-' + (i + 1));
                        }
                    } else {
                        // Fallback: –ø—Ä–æ—Å—Ç–æ–π –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫ —Å —Ä–∞–∑–º–µ—Ä–∞–º–∏
                        htmlContent += generateDrawingSVG(w, h, obj.name || '–û–±—ä–µ–∫—Ç-' + (i + 1));
                    }
                    
                    // –ú–ê–¢–ï–†–ò–ê–õ–´ –ü–†–Ø–ú–û –ü–û–î –ß–ï–†–¢–ï–ñ–û–ú
                    htmlContent += '<div style="margin-top: 10px; padding: 10px; background: #f5f5f5; border-left: 4px solid #2196f3;">';
                    
                    // –õ–ò–¶–û
                    if (cost.breakdownFace.length > 0) {
                        htmlContent += '<h4 style="margin: 5px 0;">–õ–ò–¶–û:</h4>';
                        cost.breakdownFace.forEach(line => {
                            const clean = cleanPrices(line);
                            if (clean) htmlContent += `<div class="item">‚Ä¢ ${clean}</div>`;
                        });
                    }
                    
                    // –ë–û–†–¢
                    if (cost.breakdownSide.length > 0) {
                        htmlContent += '<h4 style="margin: 10px 0 5px 0;">–ë–û–†–¢:</h4>';
                        cost.breakdownSide.forEach(line => {
                            const clean = cleanPrices(line);
                            if (clean) htmlContent += `<div class="item">‚Ä¢ ${clean}</div>`;
                        });
                    }
                    
                    // –ü–û–î–°–í–ï–¢–ö–ê
                    if (cost.breakdownLight.length > 0) {
                        htmlContent += '<h4 style="margin: 10px 0 5px 0;">–ü–û–î–°–í–ï–¢–ö–ê:</h4>';
                        cost.breakdownLight.forEach(line => {
                            const clean = cleanPrices(line);
                            if (clean) htmlContent += `<div class="item">‚Ä¢ ${clean}</div>`;
                        });
                    }
                    
                    // –ö–ê–†–ö–ê–°
                    if (cost.breakdownFrame.length > 0) {
                        htmlContent += '<h4 style="margin: 10px 0 5px 0;">–ö–ê–†–ö–ê–°:</h4>';
                        
                        // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º —Å—Ç—Ä–æ–∫–∏ –∫–∞—Ä–∫–∞—Å–∞ –ø–æ –ø—Ä–æ—Ñ–∏–ª—è–º
                        let currentProfile = [];
                        let frameGroups = [];
                        
                        cost.breakdownFrame.forEach(line => {
                            const clean = cleanPrices(line);
                            if (!clean) return;
                            
                            // –ï—Å–ª–∏ —ç—Ç–æ —Å—Ç—Ä–æ–∫–∞ "–ü—Ä–æ—Ñ–∏–ª—å #N:", –Ω–∞—á–∏–Ω–∞–µ–º –Ω–æ–≤—É—é –≥—Ä—É–ø–ø—É
                            if (clean.includes('–ü—Ä–æ—Ñ–∏–ª—å #')) {
                                if (currentProfile.length > 0) {
                                    frameGroups.push(currentProfile);
                                }
                                currentProfile = [clean];
                            } else if (clean.includes('–ò—Ç–æ–≥–æ:')) {
                                currentProfile.push(clean);
                                frameGroups.push(currentProfile);
                                currentProfile = [];
                            } else {
                                currentProfile.push(clean);
                            }
                        });
                        
                        // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é –≥—Ä—É–ø–ø—É –µ—Å–ª–∏ –µ—Å—Ç—å
                        if (currentProfile.length > 0) {
                            frameGroups.push(currentProfile);
                        }
                        
                        // –í—ã–≤–æ–¥–∏–º –≥—Ä—É–ø–ø—ã
                        frameGroups.forEach((group, idx) => {
                            group.forEach(line => {
                                htmlContent += `<div class="item">‚Ä¢ ${line}</div>`;
                            });
                            // –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É –º–µ–∂–¥—É –≥—Ä—É–ø–ø–∞–º–∏
                            if (idx < frameGroups.length - 1) {
                                htmlContent += '<div style="height: 5px;"></div>';
                            }
                        });
                    }
                    
                    htmlContent += '</div>';  // –∑–∞–∫—Ä—ã–≤–∞–µ–º –±–ª–æ–∫ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
                }
                
                // –ß–µ—Ä—Ç–µ–∂–∏ –æ—Å–Ω–æ–≤ + –º–∞—Ç–µ—Ä–∏–∞–ª—ã
                if (bases && bases.length > 0) {
                    bases.forEach((base, idx) => {
                        const hasBend = base.material && base.material.startsWith('composite') && base.bend > 0;
                        const bendSize = hasBend ? base.bend : 0;
                        const fullWidth = base.width + (bendSize * 2);
                        const fullHeight = base.height + (bendSize * 2);
                        const baseAreaM2 = (base.width * base.height) / 1000000;
                        const basePerimeterM = ((base.width + base.height) * 2) / 1000;
                        
                        htmlContent += `
                            <h3>${svgGroups.length + idx + 1}. –û–°–ù–û–í–ê ${bases.length > 1 ? '#' + (idx + 1) : ''}</h3>
                            <div class="param"><strong>–†–∞–∑–º–µ—Ä—ã:</strong> ${base.width} √ó ${base.height} –º–º${hasBend ? ` (—Å –∑–∞–≥–∏–±–æ–º ${bendSize}–º–º: ${fullWidth} √ó ${fullHeight} –º–º)` : ''}</div>
                            <div class="param"><strong>–¢–æ–ª—â–∏–Ω–∞:</strong> ${base.thickness} –º–º | <strong>–ü–ª–æ—â–∞–¥—å:</strong> ${baseAreaM2.toFixed(3)} –º¬≤</div>
                        `;
                        
                        // –ß–µ—Ä—Ç–µ–∂ –æ—Å–Ω–æ–≤—ã
                        htmlContent += generateDrawingSVG(base.width, base.height, `–û–°–ù–û–í–ê ${bases.length > 1 ? '#' + (idx + 1) : ''}`, {
                            frameWidth: null,
                            frameHeight: null,
                            hasBend: hasBend,
                            bendSize: bendSize
                        });
                        
                        // –ú–ê–¢–ï–†–ò–ê–õ–´ –û–°–ù–û–í–´
                        const baseMaterialData = PRICES_DATA.materials[base.material];
                        if (baseMaterialData) {
                            htmlContent += '<div style="margin-top: 10px; padding: 10px; background: #f5f5f5; border-left: 4px solid #4caf50;">';
                            htmlContent += '<h4 style="margin: 5px 0;">–ú–ê–¢–ï–†–ò–ê–õ –û–°–ù–û–í–´:</h4>';
                            htmlContent += `<div class="item">‚Ä¢ ${baseMaterialData.name} ${base.thickness}–º–º (${baseAreaM2.toFixed(3)} –º¬≤)</div>`;
                            
                            if (hasBend) {
                                const bendAreaMm2 = 2 * bendSize * (base.width + base.height);
                                const bendAreaM2 = bendAreaMm2 / 1000000;
                                htmlContent += `<div class="item">‚Ä¢ –ú–∞—Ç–µ—Ä–∏–∞–ª –∑–∞–≥–∏–±–∞ ${bendSize}–º–º (${bendAreaM2.toFixed(3)} –º¬≤)</div>`;
                            }
                            htmlContent += '</div>';
                        }
                        
                        // –ö–∞—Ä–∫–∞—Å (–µ—Å–ª–∏ –µ—Å—Ç—å)
                        let frameWidth = null, frameHeight = null;
                        if (base.hasFrame) {
                            if (base.bend > 0) {
                                frameWidth = base.width - (base.thickness * 2);
                                frameHeight = base.height - (base.thickness * 2);
                            } else {
                                frameWidth = base.width - 8;
                                frameHeight = base.height - 8;
                            }
                            const framePerimeterM = ((frameWidth + frameHeight) * 2) / 1000;
                            const crossbarStep = 800;
                            const profileSizeMm = parseInt(base.frameProfile.split('x')[0]);
                            const crossbarCount = Math.floor((frameWidth - profileSizeMm * 2) / crossbarStep);
                            const crossbarLengthM = crossbarCount * ((frameHeight - profileSizeMm * 2) / 1000);
                            const totalProfileM = framePerimeterM + crossbarLengthM;
                            
                            htmlContent += `<h3 style="margin-top: 20px;">–ö–ê–†–ö–ê–° –¥–ª—è –æ—Å–Ω–æ–≤—ã ${bases.length > 1 ? '#' + (idx + 1) : ''}</h3>`;
                            htmlContent += `<div class="param"><strong>–†–∞–∑–º–µ—Ä:</strong> ${frameWidth} √ó ${frameHeight} –º–º | <strong>–ü–µ—Ä–∏–º–µ—Ç—Ä:</strong> ${framePerimeterM.toFixed(2)} –º</div>`;
                            
                            // –ß–µ—Ä—Ç–µ–∂ –∫–∞—Ä–∫–∞—Å–∞
                            htmlContent += generateDrawingSVG(frameWidth, frameHeight, `–ö–ê–†–ö–ê–° ${bases.length > 1 ? '#' + (idx + 1) : ''}`, {
                                frameWidth: null,
                                frameHeight: null,
                                hasBend: false,
                                bendSize: 0
                            });
                            
                            // –ú–ê–¢–ï–†–ò–ê–õ–´ –ö–ê–†–ö–ê–°–ê
                            htmlContent += '<div style="margin-top: 10px; padding: 10px; background: #f5f5f5; border-left: 4px solid #ff9800;">';
                            htmlContent += '<h4 style="margin: 5px 0;">–ú–ê–¢–ï–†–ò–ê–õ –ö–ê–†–ö–ê–°–ê:</h4>';
                            htmlContent += `<div class="item">‚Ä¢ –ü—Ä–æ—Ñ–∏–ª—å ${base.frameProfile}–º–º (${totalProfileM.toFixed(2)}–º)</div>`;
                            
                            if (base.frameColor && base.frameColor !== '#808080') {
                                const frameColorName = getOracalColorName(base.frameColor);
                                htmlContent += `<div class="item">‚Ä¢ –ü–æ–∫—Ä–∞—Å–∫–∞ Oracal 641 ${frameColorName} (${totalProfileM.toFixed(2)}–º)</div>`;
                            }
                            htmlContent += '</div>';
                        }
                    });
                }
                
                // –ò—Ç–æ–≥–æ
                htmlContent += `<div class="page-break"></div><h2>–ò–¢–û–ì–û –ü–û –ü–†–û–ï–ö–¢–£</h2>`;
                htmlContent += `<div class="param">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—ä–µ–∫—Ç–æ–≤: ${svgGroups.length} —à—Ç</div>`;
                if (bases && bases.length > 0) {
                    htmlContent += `<div class="param">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Å–Ω–æ–≤: ${bases.length} —à—Ç</div>`;
                }
                htmlContent += `<hr style="margin:10mm 0;"><div style="text-align:center; font-size:9pt; font-style:italic;">–°–æ—Å—Ç–∞–≤–ª–µ–Ω–æ –≤ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–µ –í–´–í–ï–°–ö–ò 3D PRO v2.0</div>`;
                htmlContent += `</body></html>`;
                
                // –°–æ–∑–¥–∞—ë–º HTML-—Ñ–∞–π–ª –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
                const blob = new Blob([htmlContent], { type: 'text/html; charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                
                // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è —Ñ–∞–π–ª–∞: TZ_2026-01-09_14-35-21.html
                const now = new Date();
                const date = now.toISOString().slice(0, 10);  // 2026-01-09
                const time = now.toTimeString().slice(0, 8).replace(/:/g, '-');  // 14-35-21
                a.download = `TZ_${date}_${time}.html`;
                
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                log('‚úÖ –¢–ó —Å–∫–∞—á–∞–Ω–æ –∫–∞–∫ HTML!', 'success');
                alert('‚úÖ –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –ó–∞–¥–∞–Ω–∏–µ —Å–∫–∞—á–∞–Ω–æ –∫–∞–∫ HTML-—Ñ–∞–π–ª!\n\n–û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª –≤ –±—Ä–∞—É–∑–µ—Ä–µ –∏ –Ω–∞–∂–º–∏—Ç–µ Ctrl+P –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ PDF.');
                
            } catch (error) {
                console.error('[generatePDF] –û—à–∏–±–∫–∞:', error);
                log('‚ùå –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¢–ó: ' + error.message, 'error');
                alert('‚ùå –û—à–∏–±–∫–∞: ' + error.message);
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞
        function downloadFile(file) {
            const url = URL.createObjectURL(file);
            const a = document.createElement('a');
            a.href = url;
            a.download = file.name;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        window.changeBortHeight = function(delta) {
            const input = document.getElementById('bort-height');
            const display = document.getElementById('bort-height-display');
            let value = parseInt(input.value) || 60;
            
            value = value + delta;
            // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ: 1-1000–º–º
            if (value > 1000) value = 1000;
            if (value < 1) value = 1;
            
            input.value = value;
            display.value = value;
            
            state.bortHeight = value;
            updateActiveSVG();
            log(`–í—ã—Å–æ—Ç–∞ –±–æ—Ä—Ç–∞: ${value}–º–º`, 'info');
        }
        
        window.onBortHeightInput = function() {
            const display = document.getElementById('bort-height-display');
            const input = document.getElementById('bort-height');
            const value = parseInt(display.value);
            
            // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Ñ–æ–∫—É—Å–∞
            if (isNaN(value) || display.value === '') {
                // –ï—Å–ª–∏ –ø—É—Å—Ç–æ–µ –ø–æ–ª–µ –∏–ª–∏ NaN - –∏—Å–ø–æ–ª—å–∑—É–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                display.value = 60;
                input.value = 60;
                state.bortHeight = 60;
            } else if (value < 1) {
                // –ú–∏–Ω–∏–º—É–º 1–º–º
                display.value = 1;
                input.value = 1;
                state.bortHeight = 1;
            } else if (value > 1000) {
                // –ú–∞–∫—Å–∏–º—É–º 1000–º–º
                display.value = 1000;
                input.value = 1000;
                state.bortHeight = 1000;
            } else {
                // –õ—é–±–æ–µ –≤–∞–ª–∏–¥–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –æ—Ç 1 –¥–æ 1000
                input.value = value;
                state.bortHeight = value;
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º 3D
            updateActiveSVG();
            log(`–í—ã—Å–æ—Ç–∞ –±–æ—Ä—Ç–∞: ${state.bortHeight}–º–º (—Ä—É—á–Ω–æ–π –≤–≤–æ–¥)`, 'info');
        }
        
        window.onBortHeightKeypress = function(event) {
            // –ï—Å–ª–∏ –Ω–∞–∂–∞—Ç Enter - –ø—Ä–∏–º–µ–Ω—è–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ
            if (event.key === 'Enter' || event.keyCode === 13) {
                event.preventDefault();
                const display = document.getElementById('bort-height-display');
                display.blur(); // –£–±–∏—Ä–∞–µ–º —Ñ–æ–∫—É—Å, —á—Ç–æ –≤—ã–∑–æ–≤–µ—Ç onBortHeightInput()
            }
        }
        
        // === –ò–ó–ú–ï–ù–ï–ù–ò–ï –¢–ò–ü–ê LED –î–ò–û–î–û–í ===
        window.changeLedType = function(ledType) {
            state.ledType = ledType;
            log(`–¢–∏–ø LED: ${ledType}`, 'info');
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä
            updateCostCalculator();
        }
        
        // === –ö–ê–õ–¨–ö–£–õ–Ø–¢–û–† –°–¢–û–ò–ú–û–°–¢–ò ===
        // –ü—Ä–∞–π—Å –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∏–∑ —Ñ–∞–π–ª–∞ prices.js
        // –î–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ü–µ–Ω –æ—Ç–∫—Ä–æ–π—Ç–µ prices.js –∏ —Å–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ —Ç–∞–º
        
        // === –ú–ê–ü–ü–ò–ù–ì –¶–í–ï–¢–û–í ORACAL 641 ===
        const ORACAL_641_COLORS = {
            '#FFFFFF': '010 - –ë–µ–ª—ã–π',
            '#FFD700': '020 - –ó–æ–ª–æ—Ç–æ–π –∂–µ–ª—Ç—ã–π',
            '#FFD100': '021 - –ñ–µ–ª—Ç—ã–π',
            '#FF6B00': '034 - –û—Ä–∞–Ω–∂–µ–≤—ã–π',
            '#E3000F': '031 - –ö—Ä–∞—Å–Ω—ã–π',
            '#DC143C': '032 - –¢–µ–º–Ω–æ-–∫—Ä–∞—Å–Ω—ã–π',
            '#800020': '338 - –ë–æ—Ä–¥–æ–≤—ã–π',
            '#FF1493': '043 - –†–æ–∑–æ–≤—ã–π',
            '#8B4513': '080 - –ö–æ—Ä–∏—á–Ω–µ–≤—ã–π',
            '#4B0082': '055 - –§–∏–æ–ª–µ—Ç–æ–≤—ã–π',
            '#003893': '052 - –°–∏–Ω–∏–π',
            '#00BFFF': '053 - –ì–æ–ª—É–±–æ–π',
            '#32CD32': '060 - –°–≤–µ—Ç–ª–æ-–∑–µ–ª–µ–Ω—ã–π',
            '#006400': '061 - –¢–µ–º–Ω–æ-–∑–µ–ª–µ–Ω—ã–π',
            '#9ACD32': '063 - –ó–µ–ª–µ–Ω–æ–µ —è–±–ª–æ–∫–æ',
            '#000000': '070 - –ß–µ—Ä–Ω—ã–π',
            '#808080': '071 - –°–µ—Ä—ã–π',
            '#C0C0C0': '090 - –°–≤–µ—Ç–ª–æ-—Å–µ—Ä—ã–π'
        };
        
        function getOracalColorName(hexColor) {
            const upperHex = hexColor.toUpperCase();
            return ORACAL_641_COLORS[upperHex] || hexColor;
        }
        
        // === –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –û–ë–ù–û–í–õ–ï–ù–ò–Ø –í–°–ï–• –ú–ê–†–ñ–ï–ô (–≥–ª–æ–±–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ –∑–∞ —Å–º) ===
        window.updateAllMargins = function() {
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–∞—Å—á—ë—Ç –ø–æ –≤—ã—Å–æ—Ç–µ –¥–ª—è –≤—Å–µ—Ö –æ–±—ä–µ–∫—Ç–æ–≤
            const pricePerCmInput = document.getElementById('price-per-cm-global');
            const pricePerCm = parseFloat(pricePerCmInput?.value) || 0;
            
            // –°—á–∏—Ç–∞–µ–º –û–ë–©–£–Æ –≤—ã—Å–æ—Ç—É –í–°–ï–• –æ–±—ä–µ–∫—Ç–æ–≤ (–≤—ã—Å–æ—Ç–∞ SVG √ó –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±—É–∫–≤)
            let totalHeightCm = 0;
            svgGroups.forEach(obj => {
                if (obj.visible) {
                    // –í—ã—Å–æ—Ç–∞ –æ–¥–Ω–æ–≥–æ SVG √ó –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ë–£–ö–í (–∫–∞–∂–¥–∞—è –±—É–∫–≤–∞ = 2 paths: –∫–æ–Ω—Ç—É—Ä + –æ—Ç–≤–µ—Ä—Å—Ç–∏–µ)
                    const heightMm = obj.realHeight || 0;
                    const pathsCount = obj.pathsCount || 1;
                    const lettersCount = Math.ceil(pathsCount / 2); // –î–µ–ª–∏–º –Ω–∞ 2, —Ç.–∫. –±—É–∫–≤–∞ = –∫–æ–Ω—Ç—É—Ä + –¥—ã—Ä–∫–∞
                    totalHeightCm += (heightMm / 10) * lettersCount;
                }
            });
            
            const totalPriceByHeight = pricePerCm * totalHeightCm;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            const priceByHeightSpan = document.getElementById('price-by-height-global');
            if (priceByHeightSpan) {
                priceByHeightSpan.textContent = Math.round(totalPriceByHeight).toLocaleString('ru-RU');
            }
            
            console.log(`[üí∞ –ü–û –í–´–°–û–¢–ï] ${pricePerCm}‚ÇΩ/—Å–º √ó ${totalHeightCm.toFixed(1)}—Å–º = ${Math.round(totalPriceByHeight)}‚ÇΩ (—Å–ø—Ä–∞–≤–æ—á–Ω–æ)`);
        };
        
        // === –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –û–ë–ù–û–í–õ–ï–ù–ò–Ø –ú–ê–†–ñ–ò (PRO –≤–µ—Ä—Å–∏—è) ===
        window.updateMargin = function(svgId) {
            // –ß–∏—Ç–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ –ø–æ–ª–µ–π
            const marginInput = document.getElementById(`margin-input-${svgId}`);
            const marginPercent = parseFloat(marginInput?.value) || 0;
            
            // –ù–∞—Ö–æ–¥–∏–º –æ–±—ä–µ–∫—Ç
            const svgObj = svgGroups.find(obj => obj.id === svgId);
            if (!svgObj) return;
            
            // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º
            const cost = calculateObjectCost(svgObj);
            
            // –ú–∞—Ä–∂–∞ –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö (—Ç–æ–ª—å–∫–æ —ç—Ç–æ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∫ –∏—Ç–æ–≥–æ)
            const totalMarginAmount = cost.totalWithoutMargin * (marginPercent / 100);
            const totalWithMargin = cost.totalWithoutMargin + totalMarginAmount;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—É–º–º—É –º–∞—Ä–∂–∏
            const marginAmountSpan = document.getElementById(`margin-amount-${svgId}`);
            if (marginAmountSpan) {
                marginAmountSpan.textContent = `+${Math.round(totalMarginAmount).toLocaleString('ru-RU')} ‚ÇΩ`;
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏—Ç–æ–≥–æ
            const totalSpan = document.getElementById(`total-with-margin-${svgId}`);
            if (totalSpan) {
                totalSpan.textContent = Math.round(totalWithMargin).toLocaleString('ru-RU');
            }
            
            // –û–ë–ù–û–í–õ–Ø–ï–ú –°–ü–ò–°–û–ö –û–ë–™–ï–ö–¢–û–í –ò –ò–¢–û–ì–û
            if (svgGroups.length > 1) {
                let grandTotal = 0;
                let html = '';
                
                svgGroups.forEach((obj, idx) => {
                    const objCost = calculateObjectCost(obj);
                    const isActive = idx === activeSvgIndex;
                    
                    // –ü–æ–ª—É—á–∞–µ–º –º–∞—Ä–∂—É –∏–∑ input (—Ç–æ–ª—å–∫–æ –ø—Ä–æ—Ü–µ–Ω—Ç)
                    const marginInput = document.getElementById(`margin-input-${obj.id}`);
                    const marginPercent = marginInput ? parseFloat(marginInput.value) || 100 : 100;
                    
                    // –ú–∞—Ä–∂–∞ –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö (—Ç–æ–ª—å–∫–æ —ç—Ç–æ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∫ –∏—Ç–æ–≥–æ)
                    const objTotalMarginAmount = objCost.totalWithoutMargin * (marginPercent / 100);
                    const objTotalWithMargin = objCost.totalWithoutMargin + objTotalMarginAmount;
                    
                    grandTotal += objTotalWithMargin;
                    
                    html += `<div style="padding: 5px 0; color: ${isActive ? 'var(--accent-color)' : 'rgba(255,255,255,0.7)'}; font-weight: ${isActive ? '600' : '400'}; font-size: 11px; line-height: 1.4;">`;
                    html += `${idx + 1}. ${obj.name}: —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å - ${Math.round(objCost.totalWithoutMargin).toLocaleString('ru-RU')} ‚ÇΩ, –º–∞—Ä–∂–∞ - ${Math.round(objTotalMarginAmount).toLocaleString('ru-RU')} ‚ÇΩ`;
                    html += `</div>`;
                });
                
                const totalCostListDiv = document.getElementById('total-cost-list');
                const totalCostSpan = document.getElementById('total-cost');
                
                if (totalCostListDiv) totalCostListDiv.innerHTML = html;
                if (totalCostSpan) totalCostSpan.textContent = `${Math.round(grandTotal).toLocaleString('ru-RU')} ‚ÇΩ`;
            } else if (svgGroups.length === 1) {
                // –î–ª—è –æ–¥–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ —Ç–æ–∂–µ –æ–±–Ω–æ–≤–ª—è–µ–º –ò–¢–û–ì–û
                const obj = svgGroups[0];
                const objCost = calculateObjectCost(obj);
                const marginInput = document.getElementById(`margin-input-${obj.id}`);
                const marginPercent = marginInput ? parseFloat(marginInput.value) || 100 : 100;
                
                // –ú–∞—Ä–∂–∞ –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö (—Ç–æ–ª—å–∫–æ —ç—Ç–æ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∫ –∏—Ç–æ–≥–æ)
                const objTotalMarginAmount = objCost.totalWithoutMargin * (marginPercent / 100);
                const objTotalWithMargin = objCost.totalWithoutMargin + objTotalMarginAmount;
                
                const totalCostListDiv = document.getElementById('total-cost-list');
                const totalCostSpan = document.getElementById('total-cost');
                
                if (totalCostListDiv) {
                    totalCostListDiv.innerHTML = `<div style="padding: 5px 0; color: var(--accent-color); font-weight: 600; font-size: 11px; line-height: 1.4;">
                        1. ${obj.name}: —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å - ${Math.round(objCost.totalWithoutMargin).toLocaleString('ru-RU')} ‚ÇΩ, –º–∞—Ä–∂–∞ - ${Math.round(objTotalMarginAmount).toLocaleString('ru-RU')} ‚ÇΩ
                    </div>`;
                }
                if (totalCostSpan) {
                    totalCostSpan.textContent = `${Math.round(objTotalWithMargin).toLocaleString('ru-RU')} ‚ÇΩ`;
                }
            }
            
            console.log(`[üí∞ –ú–ê–†–ñ–ê] ${marginPercent}% = +${Math.round(totalMarginAmount)}‚ÇΩ ‚Üí –ò–¢–û–ì–û: ${Math.round(totalWithMargin)}‚ÇΩ`);
        }
        
        function calculateObjectCost(svgObj) {
            if (!svgObj) {
                console.log('[calculateObjectCost] svgObj = null, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º 0');
                return { total: 0, breakdown: [] };
            }
            
            try {
                const breakdown = []; // –û—Å—Ç–∞–≤–ª—è–µ–º –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
                const breakdownFace = []; // –õ–∏—Ü–æ
                const breakdownSide = []; // –ë–æ—Ä—Ç
                const breakdownBase = []; // –û—Å–Ω–æ–≤–∞
                const breakdownFrame = []; // –ö–∞—Ä–∫–∞—Å
                const breakdownLight = []; // –°–≤–µ—Ç
                const breakdownWork = []; // –†–∞–±–æ—Ç–∞
                let total = 0;
                let workCost = 0; // –û—Ç–¥–µ–ª—å–Ω—ã–π —É—á—ë—Ç —Ä–∞–±–æ—Ç—ã
                let materialsCost = 0; // –û—Ç–¥–µ–ª—å–Ω—ã–π —É—á—ë—Ç –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
                let wasteCost = 0; // –ë—Ä–∞–∫
                
                // ‚ïê‚ïê‚ïê –ò–°–ü–û–õ–¨–ó–£–ï–ú –†–ï–ê–õ–¨–ù–£–Æ –ì–ï–û–ú–ï–¢–†–ò–Æ –ö–û–ù–¢–£–†–û–í ‚ïê‚ïê‚ïê
                const widthMm = svgObj.currentWidth || svgObj.realWidth || 0;
                const heightMm = svgObj.currentHeight || svgObj.realHeight || 0;
                console.log('[calculateObjectCost] –ì–∞–±–∞—Ä–∏—Ç—ã:', widthMm, 'x', heightMm, '–º–º');
                
                if (!svgObj.geometry || !svgObj.geometry.areaMm2 || !svgObj.geometry.perimeterMm) {
                    console.warn('[calculateObjectCost] –ì–µ–æ–º–µ—Ç—Ä–∏—è –Ω–µ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–∞! –ò—Å–ø–æ–ª—å–∑—É–µ–º –≥–∞–±–∞—Ä–∏—Ç—ã');
                    return { total: 0, breakdown: ['‚ùå –û—à–∏–±–∫–∞: –≥–µ–æ–º–µ—Ç—Ä–∏—è –æ–±—ä–µ–∫—Ç–∞ –Ω–µ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–∞'] };
                }
                
                // –£—á–∏—Ç—ã–≤–∞–µ–º –º–∞—Å—à—Ç–∞–± –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const userScaleX = svgObj.scale?.x || 1;
                const userScaleY = svgObj.scale?.y || 1;
                const avgScale = userScaleX * userScaleY;
                
                // –†–ï–ê–õ–¨–ù–ê–Ø –ø–ª–æ—â–∞–¥—å –∫–æ–Ω—Ç—É—Ä–æ–≤ (–º–º¬≤ ‚Üí –º¬≤)
                const realAreaMm2 = svgObj.geometry.areaMm2 * avgScale;
                const areaM2 = realAreaMm2 / 1_000_000;
                
                // –†–ï–ê–õ–¨–ù–´–ô –ø–µ—Ä–∏–º–µ—Ç—Ä –í–ù–ï–®–ù–ò–• –∫–æ–Ω—Ç—É—Ä–æ–≤ –¥–ª—è –±–æ—Ä—Ç–∞ (–º–º ‚Üí –º)
                const realPerimeterMm = svgObj.geometry.perimeterMm * Math.sqrt(avgScale);
                const perimeterM = realPerimeterMm / 1000;
                
                // –†–ï–ê–õ–¨–ù–ê–Ø —à–∏—Ä–∏–Ω–∞ (–¥–ª—è –∞–ª—é–º–∏–Ω–∏–µ–≤–æ–≥–æ –∫–∞—Ä–∫–∞—Å–∞)
                const realWidth = widthMm * userScaleX;
                
                console.log(`[üìê –†–ï–ê–õ–¨–ù–ê–Ø –ì–ï–û–ú–ï–¢–†–ò–Ø] –ü–ª–æ—â–∞–¥—å: ${areaM2.toFixed(3)} –º¬≤ | –ü–µ—Ä–∏–º–µ—Ç—Ä: ${perimeterM.toFixed(2)} –º`);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –ø—Ä–∞–π—Å –∑–∞–≥—Ä—É–∂–µ–Ω
            if (typeof PRICES_DATA === 'undefined') {
                console.error('[calculateObjectCost] PRICES_DATA –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π–ª prices.js');
                return { total: 0, breakdown: ['‚ùå –û—à–∏–±–∫–∞: —Ñ–∞–π–ª —Å —Ü–µ–Ω–∞–º–∏ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω'] };
            }
            
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            // 1Ô∏è‚É£ –õ–ò–¶–ï–í–ê–Ø –ü–ê–ù–ï–õ–¨
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            
            // A. –ú–∞—Ç–µ—Ä–∏–∞–ª –ª–∏—Ü–∞
            let faceMaterialKey;
            if (state.faceMaterial.type === 'acrylic' && state.faceMaterial.color) {
                faceMaterialKey = `${state.faceMaterial.type}-${state.faceMaterial.thickness}-${state.faceMaterial.color}`;
            } else {
                faceMaterialKey = `${state.faceMaterial.type}-${state.faceMaterial.thickness}`;
            }
            const faceMaterialData = PRICES_DATA.materials[faceMaterialKey];
            const faceMaterialPrice = faceMaterialData?.price || 1200;
            const faceMaterialName = faceMaterialData?.name || '–ú–∞—Ç–µ—Ä–∏–∞–ª';
            const faceCost = areaM2 * faceMaterialPrice;
            total += faceCost;
            materialsCost += faceCost; // –£—á–∏—Ç—ã–≤–∞–µ–º –º–∞—Ç–µ—Ä–∏–∞–ª—ã
            breakdownFace.push(`–ú–∞—Ç–µ—Ä–∏–∞–ª - ${faceMaterialName} (${areaM2.toFixed(3)} –º¬≤ √ó ${faceMaterialPrice}‚ÇΩ): ${faceCost.toFixed(0)} ‚ÇΩ`);
            
            // B. –§—Ä–µ–∑–µ—Ä–æ–≤–∫–∞ –ª–∏—Ü–∞ (60‚ÇΩ/–º.–ø.)
            const faceMilling = perimeterM * 60;
            total += faceMilling;
            workCost += faceMilling; // –£—á–∏—Ç—ã–≤–∞–µ–º —Ä–∞–±–æ—Ç—É
            breakdownFace.push(`–§—Ä–µ–∑–µ—Ä–æ–≤–∫–∞ (${perimeterM.toFixed(2)} –º.–ø. √ó 60‚ÇΩ): ${faceMilling.toFixed(0)} ‚ÇΩ`);
            
            // C. –ü–ª—ë–Ω–∫–∞ Oracal
            // –î–ª—è –º–æ–ª–æ—á–Ω–æ–≥–æ –∞–∫—Ä–∏–ª–∞ - Oracal 8500 (—Ç—Ä–∞–Ω—Å–ª—é—Ü–µ–Ω—Ç–Ω–∞—è)
            // –î–ª—è –ü–í–•/–ö–æ–º–ø–æ–∑–∏—Ç–∞ - Oracal 641 (–µ—Å–ª–∏ —Ü–≤–µ—Ç –Ω–µ original)
            // –î–ª—è —Ü–≤–µ—Ç–Ω—ã—Ö –∞–∫—Ä–∏–ª–æ–≤ - –ø–ª—ë–Ω–∫–∞ –ù–ï –Ω—É–∂–Ω–∞
            const isMilkAcrylic = faceMaterialKey === 'acrylic-3-milk';
            const isColoredAcrylic = faceMaterialKey.startsWith('acrylic-3-') && !isMilkAcrylic;
            
            if (isMilkAcrylic && state.faceColor !== 'original') {
                // –ú–æ–ª–æ—á–Ω—ã–π –∞–∫—Ä–∏–ª —Å –ø–ª—ë–Ω–∫–æ–π Oracal 8500
                const filmPrice = PRICES_DATA.films['oracal-8500']?.price || 1000;
                const filmCost = areaM2 * filmPrice;
                total += filmCost;
                materialsCost += filmCost;
                
                // –ü–æ–ª—É—á–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ —Ü–≤–µ—Ç–∞ –∏ –Ω–æ–º–µ—Ä Oracal (–¥–ª—è 8500 —Ç–æ–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ –∂–µ —Ü–≤–µ—Ç–∞)
                const faceColorName = getOracalColorName(state.faceColor);
                const colorParts = faceColorName.split(' - '); // ["031", "–ö—Ä–∞—Å–Ω—ã–π"]
                const colorNumber = colorParts[0] || '';
                const colorNameOnly = colorParts[1] || faceColorName;
                
                breakdownFace.push(`–ü–ª—ë–Ω–∫–∞ ${colorNameOnly} ${colorNumber} Oracal 8500 (${areaM2.toFixed(3)} –º¬≤ √ó ${filmPrice}‚ÇΩ): ${filmCost.toFixed(0)} ‚ÇΩ`);
                
                const filmWork = PRICES_DATA.work['film-application'];
                const filmWorkHours = areaM2 * (filmWork?.hours_per_m2 || 1.5);
                const filmWorkCost = filmWorkHours * (filmWork?.rate_per_hour || 500);
                total += filmWorkCost;
                workCost += filmWorkCost;
                breakdownFace.push(`–ü–æ–∫–ª–µ–π–∫–∞ –ø–ª—ë–Ω–∫–∏ (${filmWorkHours.toFixed(1)}—á √ó 500‚ÇΩ): ${filmWorkCost.toFixed(0)} ‚ÇΩ`);
            } else if (!isColoredAcrylic && state.faceMaterial.type !== 'acrylic' && state.faceColor !== 'original') {
                // –ü–í–•/–ö–æ–º–ø–æ–∑–∏—Ç —Å –ø–ª—ë–Ω–∫–æ–π Oracal 641
                const filmPrice = PRICES_DATA.films['oracal-641']?.price || 800;
                const filmCost = areaM2 * filmPrice;
                total += filmCost;
                materialsCost += filmCost;
                
                // –ü–æ–ª—É—á–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ —Ü–≤–µ—Ç–∞ –∏ –Ω–æ–º–µ—Ä Oracal
                const faceColorName = getOracalColorName(state.faceColor);
                const colorParts = faceColorName.split(' - '); // ["031", "–ö—Ä–∞—Å–Ω—ã–π"]
                const colorNumber = colorParts[0] || '';
                const colorNameOnly = colorParts[1] || faceColorName;
                
                breakdownFace.push(`–ü–ª—ë–Ω–∫–∞ ${colorNameOnly} ${colorNumber} Oracal 641 (${areaM2.toFixed(3)} –º¬≤ √ó ${filmPrice}‚ÇΩ): ${filmCost.toFixed(0)} ‚ÇΩ`);
                
                const filmWork = PRICES_DATA.work['film-application'];
                const filmWorkHours = areaM2 * (filmWork?.hours_per_m2 || 1.5);
                const filmWorkCost = filmWorkHours * (filmWork?.rate_per_hour || 500);
                total += filmWorkCost;
                workCost += filmWorkCost;
                breakdownFace.push(`–ü–æ–∫–ª–µ–π–∫–∞ –ø–ª—ë–Ω–∫–∏ (${filmWorkHours.toFixed(1)}—á √ó 500‚ÇΩ): ${filmWorkCost.toFixed(0)} ‚ÇΩ`);
            }
            
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            // 2Ô∏è‚É£ –ó–ê–î–ù–ò–ö (—Ç–æ–ª—å–∫–æ –æ–±—ä—ë–º–Ω—ã–µ)
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            if (state.construction === 'volumetric') {
                // A. –ú–∞—Ç–µ—Ä–∏–∞–ª –∑–∞–¥–Ω–∏–∫–∞ (–ü–í–• 8–º–º)
                const backMaterialData = PRICES_DATA.materials['pvc-8-back'];
                const backMaterialPrice = backMaterialData?.price || 1200;
                const backMaterialName = backMaterialData?.name || '–ü–í–• 8–º–º';
                const backCost = areaM2 * backMaterialPrice;
                total += backCost;
                materialsCost += backCost; // –£—á–∏—Ç—ã–≤–∞–µ–º –º–∞—Ç–µ—Ä–∏–∞–ª—ã
                breakdownFace.push(`–ó–∞–¥–Ω–∏–∫ - ${backMaterialName} (${areaM2.toFixed(3)} –º¬≤ √ó ${backMaterialPrice}‚ÇΩ): ${backCost.toFixed(0)} ‚ÇΩ`);
                
                // B. –§—Ä–µ–∑–µ—Ä–æ–≤–∫–∞ –∑–∞–¥–Ω–∏–∫–∞ (60‚ÇΩ/–º.–ø.)
                const backMilling = perimeterM * 60;
                total += backMilling;
                workCost += backMilling; // –£—á–∏—Ç—ã–≤–∞–µ–º —Ä–∞–±–æ—Ç—É
                breakdownFace.push(`–§—Ä–µ–∑–µ—Ä–æ–≤–∫–∞ –∑–∞–¥–Ω–∏–∫–∞ (${perimeterM.toFixed(2)} –º.–ø. √ó 60‚ÇΩ): ${backMilling.toFixed(0)} ‚ÇΩ`);
            }
            
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            // 3Ô∏è‚É£ –ë–û–ö–û–í–û–ô –ü–†–û–§–ò–õ–¨ (—Ç–æ–ª—å–∫–æ –æ–±—ä—ë–º–Ω—ã–µ)
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            if (state.construction === 'volumetric') {
                const profileKey = `${state.sideMaterial.type}-${state.sideMaterial.thickness}`;
                const profileData = PRICES_DATA.profiles[profileKey];
                const profilePrice = profileData?.price || 200;
                
                // A. –ú–∞—Ç–µ—Ä–∏–∞–ª –ø—Ä–æ—Ñ–∏–ª—è
                const profileName = profileData?.name || '–ü—Ä–æ—Ñ–∏–ª—å';
                const profileCost = perimeterM * profilePrice;
                total += profileCost;
                materialsCost += profileCost; // –£—á–∏—Ç—ã–≤–∞–µ–º –º–∞—Ç–µ—Ä–∏–∞–ª—ã
                
                // –£–±–∏—Ä–∞–µ–º —Å–ª–æ–≤–æ "–ë–æ—Ä—Ç" –∏–∑ –Ω–∞–∑–≤–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è –∏ –¥–æ–±–∞–≤–ª—è–µ–º —Ü–≤–µ—Ç —Å –Ω–æ–º–µ—Ä–æ–º Oracal
                const profileNameClean = profileName.replace('–ë–æ—Ä—Ç ', ''); // –£–±–∏—Ä–∞–µ–º "–ë–æ—Ä—Ç " –∏–∑ –Ω–∞—á–∞–ª–∞
                const bortColorName = getOracalColorName(state.sideColor);
                const colorParts = bortColorName.split(' - '); // ["031", "–ö—Ä–∞—Å–Ω—ã–π"]
                const colorNumber = colorParts[0] || '';
                const colorNameOnly = colorParts[1] || bortColorName;
                
                // –§–æ—Ä–º–∏—Ä—É–µ–º –ø–æ–ª–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Å —Ü–≤–µ—Ç–æ–º –∏ –Ω–æ–º–µ—Ä–æ–º Oracal
                let profileDisplayName = profileNameClean;
                if (state.sideColor !== '#FFFFFF') {
                    profileDisplayName = `${profileNameClean} ${colorNameOnly.toLowerCase()} ${colorNumber} Oracal 641`;
                }
                
                // –ê–ª—é–º–∏–Ω–∏–π: –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —É–ø–ª–æ—Ç–Ω–∏—Ç–µ–ª—å –æ—Ç–¥–µ–ª—å–Ω–æ (–≤—Ö–æ–¥–∏—Ç –≤ —Å—Ç–æ–∏–º–æ—Å—Ç—å)
                if (state.sideMaterial.type === 'aluminum') {
                    breakdownSide.push(`–ü—Ä–æ—Ñ–∏–ª—å - ${profileDisplayName} (${perimeterM.toFixed(2)} –º.–ø. √ó ${profilePrice}‚ÇΩ): ${profileCost.toFixed(0)} ‚ÇΩ`);
                    breakdownSide.push(`–£–ø–ª–æ—Ç–Ω–∏—Ç–µ–ª—å (–≤–∫–ª—é—á—ë–Ω –≤ —Å—Ç–æ–∏–º–æ—Å—Ç—å)`);
                } else {
                    breakdownSide.push(`–ü—Ä–æ—Ñ–∏–ª—å - ${profileDisplayName} (${perimeterM.toFixed(2)} –º.–ø. √ó ${profilePrice}‚ÇΩ): ${profileCost.toFixed(0)} ‚ÇΩ`);
                }
                
                // B. –ü—Ä–∏–∫–ª–µ–π–∫–∞ –±–æ—Ä—Ç–∞ (—Ä–∞–±–æ—Ç–∞) - –¥–ª—è –í–°–ï–• —Ç–∏–ø–æ–≤ –±–æ—Ä—Ç–æ–≤
                const gluingWork = PRICES_DATA.work['side-gluing'];
                const gluingHours = perimeterM * (gluingWork?.hours_per_m || 0.1);
                const gluingCost = gluingHours * (gluingWork?.rate_per_hour || 500);
                total += gluingCost;
                workCost += gluingCost; // –£—á–∏—Ç—ã–≤–∞–µ–º —Ä–∞–±–æ—Ç—É
                breakdownWork.push(`–ü—Ä–∏–∫–ª–µ–π–∫–∞ –±–æ—Ä—Ç–∞ (${gluingHours.toFixed(1)}—á √ó 500‚ÇΩ): ${gluingCost.toFixed(0)} ‚ÇΩ`);
                
                // C. –û–∫–ª–µ–π–∫–∞ –±–æ—Ä—Ç–∞ Oracal (—Ç–æ–ª—å–∫–æ –¥–ª—è –ü–í–• –ø—Ä–æ—Ñ–∏–ª—è, –µ—Å–ª–∏ —Ü–≤–µ—Ç –Ω–µ –±–µ–ª—ã–π)
                if (state.sideMaterial.type === 'pvc' && state.sideColor !== '#FFFFFF') {
                    const bortHeight = state.bortHeight || profileData?.height || 60;
                    const bortAreaM2 = (perimeterM * bortHeight) / 1000; // –º.–ø. √ó –º–º ‚Üí –º¬≤
                    
                    // –ü–æ–ª—É—á–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ —Ü–≤–µ—Ç–∞ –∏ –Ω–æ–º–µ—Ä Oracal
                    const bortColorName = getOracalColorName(state.sideColor);
                    const colorParts = bortColorName.split(' - '); // ["031", "–ö—Ä–∞—Å–Ω—ã–π"]
                    const colorNumber = colorParts[0] || '';
                    const colorNameOnly = colorParts[1] || bortColorName;
                    
                    // –ú–∞—Ç–µ—Ä–∏–∞–ª –ø–ª—ë–Ω–∫–∏
                    const bortFilmPrice = PRICES_DATA.films['oracal-641']?.price || 800;
                    const bortFilmCost = bortAreaM2 * bortFilmPrice;
                    total += bortFilmCost;
                    materialsCost += bortFilmCost; // –£—á–∏—Ç—ã–≤–∞–µ–º –º–∞—Ç–µ—Ä–∏–∞–ª—ã
                    breakdownSide.push(`–ü–ª—ë–Ω–∫–∞ ${colorNameOnly} ${colorNumber} Oracal (${bortAreaM2.toFixed(3)} –º¬≤ √ó ${bortFilmPrice}‚ÇΩ): ${bortFilmCost.toFixed(0)} ‚ÇΩ`);
                    
                    // –†–∞–±–æ—Ç–∞ –ø–æ –æ–∫–ª–µ–π–∫–µ –±–æ—Ä—Ç–∞
                    const bortFilmWork = perimeterM * 50;
                    total += bortFilmWork;
                    workCost += bortFilmWork; // –£—á–∏—Ç—ã–≤–∞–µ–º —Ä–∞–±–æ—Ç—É
                    breakdownWork.push(`–ü–æ–∫–ª–µ–π–∫–∞ –ø–ª—ë–Ω–∫–∏ –±–æ—Ä—Ç–∞ (${perimeterM.toFixed(2)} –º.–ø. √ó 50‚ÇΩ): ${bortFilmWork.toFixed(0)} ‚ÇΩ`);
                }
            }
            
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            // 4Ô∏è‚É£ –ü–û–î–°–í–ï–¢–ö–ê (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–∞)
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            if (state.hasBacklight) {
                const ledType = state.ledType || 'led-1.2w'; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é 1.2–í—Ç
                const ledData = PRICES_DATA.lighting[ledType];
                const ledPrice = ledData?.price || 20;
                const spacing = ledData?.spacing_mm || 65;
                
                // A. LED –¥–∏–æ–¥—ã (—Ä–∞—Å—á—ë—Ç –ø–æ —Å—Ä–µ–¥–Ω–µ–π –ª–∏–Ω–∏–∏ - —É–ø—Ä–æ—â—ë–Ω–Ω–æ)
                const densityByArea = Math.ceil(areaM2 * 100);
                const densityByPerimeter = Math.ceil((perimeterM * 1000) / spacing);
                const ledCount = Math.ceil((densityByArea + densityByPerimeter) / 2);
                
                const ledCost = ledCount * ledPrice;
                total += ledCost;
                materialsCost += ledCost; // –£—á–∏—Ç—ã–≤–∞–µ–º –º–∞—Ç–µ—Ä–∏–∞–ª—ã
                const ledName = ledData?.name || 'LED –¥–∏–æ–¥—ã';
                breakdownLight.push(`${ledName} (${ledCount} —à—Ç √ó ${ledPrice}‚ÇΩ): ${ledCost.toFixed(0)} ‚ÇΩ`);
                console.log(`[üí° LED] –ü–æ –ø–ª–æ—â–∞–¥–∏: ${densityByArea} | –ü–æ –ø–µ—Ä–∏–º–µ—Ç—Ä—É: ${densityByPerimeter} | –ò–¢–û–ì–û: ${ledCount} —à—Ç`);
                
                // B. –ë–ª–æ–∫ –ø–∏—Ç–∞–Ω–∏—è (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–¥–±–æ—Ä —Å –∑–∞–ø–∞—Å–æ–º 30%)
                const totalPower = ledCount * (ledData?.power_w || 0.72);
                const requiredPower = totalPower * 1.3; // +30% –∑–∞–ø–∞—Å–∞
                
                // –ü–æ–¥–±–∏—Ä–∞–µ–º –±–ª–∏–∂–∞–π—à–∏–π –±–æ–ª—å—à–∏–π –±–ª–æ–∫
                let psuKey = 'power-supply-60w';
                if (requiredPower > 60) psuKey = 'power-supply-100w';
                if (requiredPower > 100) psuKey = 'power-supply-150w';
                if (requiredPower > 150) psuKey = 'power-supply-200w';
                if (requiredPower > 200) psuKey = 'power-supply-400w';
                
                const psuData = PRICES_DATA.lighting[psuKey];
                const psuPrice = psuData?.price || 1100;
                const psuPowerRating = psuData?.power_w || 60;
                total += psuPrice;
                materialsCost += psuPrice; // –£—á–∏—Ç—ã–≤–∞–µ–º –º–∞—Ç–µ—Ä–∏–∞–ª—ã
                breakdownLight.push(`–ë–ª–æ–∫ –ø–∏—Ç–∞–Ω–∏—è ${psuPowerRating}–í—Ç (${Math.ceil(totalPower)}–í—Ç + 30% –∑–∞–ø–∞—Å): ${psuPrice.toFixed(0)} ‚ÇΩ`);
                
                // C. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ LED (—Ä–∞–±–æ—Ç–∞)
                const ledWorkData = PRICES_DATA.work['led-installation'];
                const ledWorkHours = areaM2 * (ledWorkData?.hours_per_m2 || 1.5);
                const ledWorkCost = ledWorkHours * (ledWorkData?.rate_per_hour || 500);
                total += ledWorkCost;
                workCost += ledWorkCost; // –£—á–∏—Ç—ã–≤–∞–µ–º —Ä–∞–±–æ—Ç—É
                breakdownWork.push(`–£—Å—Ç–∞–Ω–æ–≤–∫–∞ LED (${ledWorkHours.toFixed(1)}—á √ó 500‚ÇΩ): ${ledWorkCost.toFixed(0)} ‚ÇΩ`);
            }
            
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            // 5Ô∏è‚É£ –°–ë–û–†–ö–ê –ë–£–ö–í (—Ç–æ–ª—å–∫–æ –æ–±—ä—ë–º–Ω—ã–µ)
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            if (state.construction === 'volumetric') {
                const workData = PRICES_DATA.work['assembly-volumetric'];
                const hours = areaM2 * (workData?.hours_per_m2 || 4);
                const rate = workData?.rate_per_hour || 500;
                const assemblyCost = hours * rate;
                total += assemblyCost;
                workCost += assemblyCost; // –£—á–∏—Ç—ã–≤–∞–µ–º —Ä–∞–±–æ—Ç—É
                breakdownWork.push(`–°–±–æ—Ä–∫–∞ –±—É–∫–≤ (${hours.toFixed(1)}—á √ó ${rate}‚ÇΩ): ${assemblyCost.toFixed(0)} ‚ÇΩ`);
            }
            
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            // 6Ô∏è‚É£ –î–ò–°–¢–ê–ù–¶–ò–û–ù–ù–´–ï –î–ï–†–ñ–ê–¢–ï–õ–ò (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            if (state.hasSpacers) {
                const spacersCount = Math.max(4, Math.ceil(perimeterM * 1.5));
                const spacerPrice = PRICES_DATA.hardware.spacers?.price || 50;
                const spacersCost = spacersCount * spacerPrice;
                total += spacersCost;
                materialsCost += spacersCost; // –£—á–∏—Ç—ã–≤–∞–µ–º –º–∞—Ç–µ—Ä–∏–∞–ª—ã
                breakdownWork.push(`–î–∏—Å—Ç–∞–Ω—Ü. –¥–µ—Ä–∂–∞—Ç–µ–ª–∏ (${spacersCount} —à—Ç √ó ${spacerPrice}‚ÇΩ): ${spacersCost.toFixed(0)} ‚ÇΩ`);
            }
            
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            // 7Ô∏è‚É£ –°–ï–ë–ï–°–¢–û–ò–ú–û–°–¢–¨ –ú–ê–¢–ï–†–ò–ê–õ–û–í (–¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ –±—Ä–∞–∫–∞)
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            
            // materialsCost —É–∂–µ –ø–æ–¥—Å—á–∏—Ç–∞–Ω –≤—ã—à–µ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∫–∞–∂–¥–æ–π –ø–æ–∑–∏—Ü–∏–∏
            
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            // 8Ô∏è‚É£ –ö–ê–†–ö–ê–° (–ø—Ä–æ—Ñ–∏–ª—å–Ω—ã–µ —Ç—Ä—É–±—ã –∏–ª–∏ –∞–ª—é–º–∏–Ω–∏–µ–≤—ã–µ –ø—Ä–æ—Ñ–∏–ª–∏)
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            
            // –ù–û–í–ê–Ø –õ–û–ì–ò–ö–ê: –±–µ—Ä—ë–º –¥–∞–Ω–Ω—ã–µ –∏–∑ 3D –ø—Ä–æ—Ñ–∏–ª–µ–π, –µ—Å–ª–∏ –æ–Ω–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã
            if (frameProfiles && frameProfiles.length > 0) {
                // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø—Ä–æ—Ñ–∏–ª–∏ –ø–æ —Ç–∏–ø—É
                const profilesByType = {};
                let totalFrameLengthM = 0;
                
                frameProfiles.forEach(prof => {
                    if (!profilesByType[prof.type]) {
                        profilesByType[prof.type] = [];
                    }
                    profilesByType[prof.type].push(prof);
                    totalFrameLengthM += prof.length / 1000; // –ü–µ—Ä–µ–≤–æ–¥–∏–º –≤ –º–µ—Ç—Ä—ã
                });
                
                // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ –ø—Ä–æ—Ñ–∏–ª—è
                Object.keys(profilesByType).forEach(type => {
                    const profiles = profilesByType[type];
                    const frameData = PRICES_DATA.frame[type];
                    if (!frameData) return;
                    
                    const standardLength = frameData.length; // –≤ –º–º
                    
                    // –ü–æ–ª—É—á–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ —Ü–≤–µ—Ç–∞ Oracal
                    const frameColorName = getOracalColorName(state.frameColor);
                    const frameColorParts = frameColorName.split(' - ');
                    const frameColorNumber = frameColorParts[0] || '';
                    const frameColorNameOnly = frameColorParts[1] || frameColorName;
                    
                    breakdownFrame.push(`${frameData.name} (—Ü–≤–µ—Ç ${frameColorNameOnly} ${frameColorNumber} Oracal 641):`);
                    
                    // –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–∞–∑–±–∏–≤–∫—É
                    profiles.forEach((prof, idx) => {
                        const lengthMm = prof.length;
                        const lengthM = lengthMm / 1000;
                        
                        // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Ä–∞–∑–±–∏–≤–∫—É –Ω–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∫—É—Å–∫–∏
                        const fullPieces = Math.floor(lengthMm / standardLength);
                        const remainder = lengthMm % standardLength;
                        
                        let cuttingInfo = '';
                        if (fullPieces === 0 && remainder > 0) {
                            // –¢–æ–ª—å–∫–æ –æ–¥–∏–Ω –∫—É—Å–æ–∫ –º–µ–Ω—å—à–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –¥–ª–∏–Ω—ã
                            cuttingInfo = `${remainder}–º–º √ó 1—à—Ç`;
                        } else if (fullPieces > 0 && remainder > 0) {
                            // –ù–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–ª–Ω—ã—Ö + –æ—Å—Ç–∞—Ç–æ–∫
                            cuttingInfo = `${standardLength}–º–º √ó ${fullPieces}—à—Ç –∏ ${remainder}–º–º √ó 1—à—Ç`;
                        } else if (fullPieces > 0 && remainder === 0) {
                            // –¢–æ–ª—å–∫–æ –ø–æ–ª–Ω—ã–µ –∫—É—Å–∫–∏
                            cuttingInfo = `${standardLength}–º–º √ó ${fullPieces}—à—Ç`;
                        }
                        
                        breakdownFrame.push(`  –ü—Ä–æ—Ñ–∏–ª—å #${idx + 1}: ${lengthM.toFixed(2)}–º (${cuttingInfo})`);
                    });
                    
                    // –û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞ –ø—Ä–æ—Ñ–∏–ª—è
                    const typeTotalLengthM = profiles.reduce((sum, p) => sum + p.length / 1000, 0);
                    const typeCost = typeTotalLengthM * frameData.price;
                    total += typeCost;
                    materialsCost += typeCost;
                    
                    breakdownFrame.push(`  –ò—Ç–æ–≥–æ: ${typeTotalLengthM.toFixed(2)} –º.–ø. √ó ${frameData.price}‚ÇΩ = ${typeCost.toFixed(0)} ‚ÇΩ`);
                });
                
                // –ü–æ–∫—Ä–∞—Å–∫–∞ (–≤—Å–µ–≥–¥–∞, –µ—Å–ª–∏ –µ—Å—Ç—å –∫–∞—Ä–∫–∞—Å)
                const paintData = PRICES_DATA.hardware['paint-spray'];
                const sprayCansCoverage = paintData.coverage / 1000; // 6 –º–µ—Ç—Ä–æ–≤ –Ω–∞ –±–∞–ª–ª–æ–Ω
                const sprayNeeded = Math.ceil(totalFrameLengthM / sprayCansCoverage);
                const paintCost = sprayNeeded * paintData.price;
                total += paintCost;
                materialsCost += paintCost;
                breakdownFrame.push(`–ü–æ–∫—Ä–∞—Å–∫–∞: ${sprayNeeded} –±–∞–ª–ª–æ–Ω(–æ–≤) √ó ${paintData.price}‚ÇΩ = ${paintCost.toFixed(0)} ‚ÇΩ`);
                
                // –†–∞–±–æ—Ç–∞ –ø–æ —Å–≤–∞—Ä–∫–µ –∫–∞—Ä–∫–∞—Å–∞ (—Ç–æ–ª—å–∫–æ –¥–ª—è —Å—Ç–∞–ª—å–Ω—ã—Ö —Ç—Ä—É–±)
                // –§–æ—Ä–º—É–ª–∞: (–º–∞—Ç–µ—Ä–∏–∞–ª + –ø–æ–∫—Ä–∞—Å–∫–∞) * 2 + 20% –º–∞—Ç–µ—Ä–∏–∞–ª–∞
                const totalFrameMaterialCost = Object.keys(frameByType).reduce((sum, type) => {
                    const frameData = PRICES_DATA.frame[type];
                    const profiles = frameByType[type];
                    const typeTotalLengthM = profiles.reduce((s, p) => s + p.length / 1000, 0);
                    return sum + typeTotalLengthM * frameData.price;
                }, 0);
                
                const isSteel = Object.keys(frameByType).some(type => type.startsWith('steel-'));
                if (isSteel) {
                    const weldingCost = (totalFrameMaterialCost + paintCost) * 2 + totalFrameMaterialCost * 0.2;
                    total += weldingCost;
                    workCost += weldingCost;
                    breakdownWork.push(`–°–≤–∞—Ä–∫–∞ –∫–∞—Ä–∫–∞—Å–∞: ${weldingCost.toFixed(0)} ‚ÇΩ`);
                }
                
            } else if (state.frameType && state.frameType !== 'none') {
                // –°–¢–ê–†–ê–Ø –õ–û–ì–ò–ö–ê: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á—ë—Ç (–µ—Å–ª–∏ –ø—Ä–æ—Ñ–∏–ª–∏ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤—Ä—É—á–Ω—É—é)
                const frameData = PRICES_DATA.frame[state.frameType];
                if (frameData) {
                    const isAluminum = state.frameType.startsWith('alu-');
                    
                    let frameLengthM;
                    let frameDescription = '';
                    
                    if (isAluminum) {
                        frameLengthM = (realWidth / 1000) * 2;
                        frameDescription = `2 –Ω–∞–ø—Ä–∞–≤–ª—è—é—â–∏—Ö –ø–æ ${(realWidth / 1000).toFixed(2)}–º`;
                    } else {
                        frameLengthM = perimeterM * 2;
                        frameDescription = `–ø–µ—Ä–∏–º–µ—Ç—Ä ${perimeterM.toFixed(2)}–º √ó 2`;
                    }
                    
                    const profileLength = frameData.length / 1000;
                    const piecesNeeded = Math.ceil(frameLengthM / profileLength);
                    const totalProfileLength = piecesNeeded * profileLength;
                    const wasteLength = totalProfileLength - frameLengthM;
                    
                    let cuttingDetails = '';
                    if (piecesNeeded === 1) {
                        cuttingDetails = `1 –ø–∞–ª–∫–∞ ${profileLength}–º (–æ—Å—Ç–∞—Ç–æ–∫: ${(wasteLength * 1000).toFixed(0)}–º–º)`;
                    } else {
                        const fullPieces = Math.floor(frameLengthM / profileLength);
                        const remainingLength = frameLengthM - (fullPieces * profileLength);
                        
                        if (remainingLength > 0.01) {
                            cuttingDetails = `${piecesNeeded} –ø–∞–ª–æ–∫ –ø–æ ${profileLength}–º (${fullPieces} —Ü–µ–ª—ã—Ö + 1 –æ—Ç—Ä–µ–∑–æ–∫ ${(remainingLength * 1000).toFixed(0)}–º–º, –æ—Å—Ç–∞—Ç–æ–∫: ${(wasteLength * 1000).toFixed(0)}–º–º)`;
                        } else {
                            cuttingDetails = `${piecesNeeded} –ø–∞–ª–æ–∫ –ø–æ ${profileLength}–º`;
                        }
                    }
                    
                    const frameCost = frameLengthM * frameData.price;
                    total += frameCost;
                    materialsCost += frameCost;
                    
                    // –ü–æ–ª—É—á–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ —Ü–≤–µ—Ç–∞ Oracal
                    const frameColorName = getOracalColorName(state.frameColor);
                    const frameColorParts = frameColorName.split(' - ');
                    const frameColorNumber = frameColorParts[0] || '';
                    const frameColorNameOnly = frameColorParts[1] || frameColorName;
                    
                    breakdownFrame.push(`${frameData.name} (—Ü–≤–µ—Ç ${frameColorNameOnly} ${frameColorNumber} Oracal 641):`);
                    breakdownFrame.push(`  ${frameDescription} = ${frameLengthM.toFixed(2)} –º.–ø.`);
                    breakdownFrame.push(`  ${cuttingDetails}`);
                    breakdownFrame.push(`  ${frameLengthM.toFixed(2)} –º.–ø. √ó ${frameData.price}‚ÇΩ = ${frameCost.toFixed(0)} ‚ÇΩ`);
                    
                    // –ü–æ–∫—Ä–∞—Å–∫–∞ (–≤—Å–µ–≥–¥–∞)
                    const paintData = PRICES_DATA.hardware['paint-spray'];
                    const sprayCansCoverage = paintData.coverage / 1000;
                    const sprayNeeded = Math.ceil(frameLengthM / sprayCansCoverage);
                    const paintCost = sprayNeeded * paintData.price;
                    total += paintCost;
                    materialsCost += paintCost;
                    breakdownFrame.push(`  –ü–æ–∫—Ä–∞—Å–∫–∞: ${sprayNeeded} –±–∞–ª–ª–æ–Ω(–æ–≤) √ó ${paintData.price}‚ÇΩ = ${paintCost.toFixed(0)} ‚ÇΩ`);
                    
                    // –†–∞–±–æ—Ç–∞ –ø–æ —Å–≤–∞—Ä–∫–µ –∫–∞—Ä–∫–∞—Å–∞ (—Ç–æ–ª—å–∫–æ –¥–ª—è —Å—Ç–∞–ª—å–Ω—ã—Ö —Ç—Ä—É–±)
                    // –§–æ—Ä–º—É–ª–∞: (–º–∞—Ç–µ—Ä–∏–∞–ª + –ø–æ–∫—Ä–∞—Å–∫–∞) * 2 + 20% –º–∞—Ç–µ—Ä–∏–∞–ª–∞
                    const isSteel = state.frameType.startsWith('steel-');
                    if (isSteel) {
                        const weldingCost = (frameCost + paintCost) * 2 + frameCost * 0.2;
                        total += weldingCost;
                        workCost += weldingCost;
                        breakdownWork.push(`–°–≤–∞—Ä–∫–∞ –∫–∞—Ä–∫–∞—Å–∞: ${weldingCost.toFixed(0)} ‚ÇΩ`);
                    }
                }
            }
            
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            // 9Ô∏è‚É£ –û–°–ù–û–í–ê (–ø–æ–¥–ª–æ–∂–∫–∞/–∑–∞–¥–Ω–∏–∫)
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            if (bases && bases.length > 0) {
                bases.forEach((base, idx) => {
                    const baseMaterialData = PRICES_DATA.materials[base.material];
                    if (!baseMaterialData) return;
                    
                    // –ü–ª–æ—â–∞–¥—å –æ—Å–Ω–æ–≤—ã –ø–æ —Ä–∞–∑–º–µ—Ä–∞–º (–º–º¬≤ ‚Üí –º¬≤)
                    const baseAreaM2 = (base.width * base.height) / 1000000;
                    
                    // –ü–µ—Ä–∏–º–µ—Ç—Ä –æ—Å–Ω–æ–≤—ã –¥–ª—è —É–≥–æ–ª–∫–∞
                    const basePerimeterM = ((base.width + base.height) * 2) / 1000;
                    
                    // –ü–æ–ª—É—á–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ —Ü–≤–µ—Ç–∞ Oracal
                    const baseColorName = getOracalColorName(base.color || '#FFFFFF');
                    const baseColorParts = baseColorName.split(' - ');
                    const baseColorNumber = baseColorParts[0] || '';
                    const baseColorNameOnly = baseColorParts[1] || baseColorName;
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∑–∞–≥–∏–±–∞
                    const hasBend = base.material.startsWith('composite') && base.bend > 0;
                    const bendSize = hasBend ? base.bend : 0;
                    
                    // –ü–æ–ª–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Å —É—á—ë—Ç–æ–º –∑–∞–≥–∏–±–∞
                    const fullWidth = base.width + (bendSize * 2);
                    const fullHeight = base.height + (bendSize * 2);
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤–º–µ—â–∞–µ—Ç—Å—è –ª–∏ –≤ –ª–∏—Å—Ç
                    const sheetWidth = baseMaterialData.sheet_width || 1500;
                    const sheetHeight = baseMaterialData.sheet_height || 4000;
                    const fitsInSheet = (fullWidth <= sheetWidth && fullHeight <= sheetHeight) || 
                                       (fullWidth <= sheetHeight && fullHeight <= sheetWidth);
                    
                    // –ú–∞—Ç–µ—Ä–∏–∞–ª –æ—Å–Ω–æ–≤—ã
                    const baseCost = baseAreaM2 * baseMaterialData.price;
                    total += baseCost;
                    materialsCost += baseCost;
                    
                    if (bases.length > 1) {
                        breakdownBase.push(`–û—Å–Ω–æ–≤–∞ #${idx + 1} (—Ü–≤–µ—Ç ${baseColorNameOnly} ${baseColorNumber} Oracal 641):`);
                    } else {
                        breakdownBase.push(`–û—Å–Ω–æ–≤–∞ (—Ü–≤–µ—Ç ${baseColorNameOnly} ${baseColorNumber} Oracal 641):`);
                    }
                    
                    let sizeInfo = `${base.width}√ó${base.height}–º–º`;
                    if (hasBend) {
                        sizeInfo += ` (—Å –∑–∞–≥–∏–±–æ–º ${bendSize}–º–º = ${fullWidth}√ó${fullHeight}–º–º)`;
                        if (!fitsInSheet) {
                            sizeInfo += ` ‚ö†Ô∏è –ù–ï –í–ú–ï–©–ê–ï–¢–°–Ø –í –õ–ò–°–¢ ${sheetWidth}√ó${sheetHeight}–º–º`;
                        }
                    }
                    
                    breakdownBase.push(`–ú–∞—Ç–µ—Ä–∏–∞–ª - ${baseMaterialData.name} (${sizeInfo} = ${baseAreaM2.toFixed(3)} –º¬≤ √ó ${baseMaterialData.price}‚ÇΩ): ${baseCost.toFixed(0)} ‚ÇΩ`);
                    
                    // –†–∞–±–æ—Ç–∞ –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –æ—Å–Ω–æ–≤—ã
                    const baseWork = PRICES_DATA.work['base-assembly'] || { hours_per_m2: 0.3, rate_per_hour: 500 };
                    const baseWorkHours = baseAreaM2 * (baseWork.hours_per_m2 || 0.3);
                    const baseWorkCost = baseWorkHours * (baseWork.rate_per_hour || 500);
                    total += baseWorkCost;
                    workCost += baseWorkCost;
                    breakdownWork.push(`–ò–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ –æ—Å–Ω–æ–≤—ã ${bases.length > 1 ? '#' + (idx + 1) : ''} (${baseWorkHours.toFixed(1)}—á √ó 500‚ÇΩ): ${baseWorkCost.toFixed(0)} ‚ÇΩ`);
                    
                    // –ó–∞–≥–∏–± –∫–æ–º–ø–æ–∑–∏—Ç–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å —Ä–∞–∑–º–µ—Ä –∑–∞–≥–∏–±–∞ > 0)
                    if (base.material.startsWith('composite') && hasBend) {
                        // –ü–µ—Ä–∏–º–µ—Ç—Ä –æ—Å–Ω–æ–≤—ã (–±–∞–∑–æ–≤—ã–π, –±–µ–∑ —É—á—ë—Ç–∞ –∑–∞–≥–∏–±–∞)
                        const basePerimeterForBend = ((base.width + base.height) * 2) / 1000; // –≤ –º–µ—Ç—Ä–∞—Ö
                        
                        // 1. –†–ê–ë–û–¢–ê: 80‚ÇΩ –∑–∞ –ø–æ–≥–æ–Ω–Ω—ã–π –º–µ—Ç—Ä –ø–µ—Ä–∏–º–µ—Ç—Ä–∞
                        const bendWorkCost = basePerimeterForBend * 80;
                        total += bendWorkCost;
                        workCost += bendWorkCost;
                        breakdownWork.push(`–ó–∞–≥–∏–± –∫–æ–º–ø–æ–∑–∏—Ç–∞ ${bases.length > 1 ? '#' + (idx + 1) : ''} ${bendSize}–º–º (${basePerimeterForBend.toFixed(2)}–º √ó 80‚ÇΩ): ${bendWorkCost.toFixed(0)} ‚ÇΩ`);
                        
                        // 2. –ú–ê–¢–ï–†–ò–ê–õ: –ø–ª–æ—â–∞–¥—å –±–æ—Ä—Ç–∏–∫–æ–≤ –∑–∞–≥–∏–±–∞ √ó —Ü–µ–Ω–∞ –∫–æ–º–ø–æ–∑–∏—Ç–∞
                        // –ü–ª–æ—â–∞–¥—å = 2 √ó –∑–∞–≥–∏–± √ó (—à–∏—Ä–∏–Ω–∞ + –≤—ã—Å–æ—Ç–∞)
                        const bendAreaMm2 = 2 * bendSize * (base.width + base.height);
                        const bendAreaM2 = bendAreaMm2 / 1000000;
                        const bendMaterialCost = bendAreaM2 * baseMaterialData.price;
                        total += bendMaterialCost;
                        materialsCost += bendMaterialCost;
                        breakdownBase.push(`–ú–∞—Ç–µ—Ä–∏–∞–ª –∑–∞–≥–∏–±–∞ ${bases.length > 1 ? '#' + (idx + 1) : ''} (${bendAreaM2.toFixed(3)} –º¬≤ √ó ${baseMaterialData.price}‚ÇΩ): ${bendMaterialCost.toFixed(0)} ‚ÇΩ`);
                    }
                    
                    // –£–≥–æ–ª–æ–∫ (–µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω)
                    if (state.baseCorner && state.baseCorner !== 'none') {
                        const cornerData = PRICES_DATA.hardware[state.baseCorner];
                        if (cornerData) {
                            // –ú–∞—Ç–µ—Ä–∏–∞–ª —É–≥–æ–ª–∫–∞
                            const cornerCost = basePerimeterM * cornerData.price;
                            total += cornerCost;
                            materialsCost += cornerCost;
                            breakdownBase.push(`${cornerData.name} ${bases.length > 1 ? '#' + (idx + 1) : ''} (${basePerimeterM.toFixed(2)} –º.–ø. √ó ${cornerData.price}‚ÇΩ): ${cornerCost.toFixed(0)} ‚ÇΩ`);
                            
                            // –†–∞–±–æ—Ç–∞ –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ —É–≥–æ–ª–∫–∞
                            const cornerWork = PRICES_DATA.work['corner-installation'] || { hours_per_m: 0.2, rate_per_hour: 500 };
                            const cornerWorkHours = basePerimeterM * (cornerWork.hours_per_m || 0.2);
                            const cornerWorkCost = cornerWorkHours * (cornerWork.rate_per_hour || 500);
                            total += cornerWorkCost;
                            workCost += cornerWorkCost;
                            breakdownWork.push(`–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —É–≥–æ–ª–∫–∞ ${bases.length > 1 ? '#' + (idx + 1) : ''} (${cornerWorkHours.toFixed(1)}—á √ó 500‚ÇΩ): ${cornerWorkCost.toFixed(0)} ‚ÇΩ`);
                        }
                    }
                    
                    // –ö–∞—Ä–∫–∞—Å –¥–ª—è –æ—Å–Ω–æ–≤—ã (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω)
                    if (base.hasFrame) {
                        // –†–∞–∑–º–µ—Ä –∫–∞—Ä–∫–∞—Å–∞ = –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π —Ä–∞–∑–º–µ—Ä –æ—Å–Ω–æ–≤—ã
                        let frameWidth, frameHeight;
                        if (base.bend > 0) {
                            frameWidth = base.width - (base.thickness * 2);
                            frameHeight = base.height - (base.thickness * 2);
                        } else {
                            frameWidth = base.width - 8;
                            frameHeight = base.height - 8;
                        }
                        const framePerimeterM = ((frameWidth + frameHeight) * 2) / 1000;
                        
                        // –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º—ã—á–∫–∏: 1000-2000–º–º ‚Üí 1, –±–æ–ª—å—à–µ 2000–º–º ‚Üí –∫–∞–∂–¥—ã–µ 1000–º–º
                        const profileSizeMm = parseInt(base.frameProfile.split('x')[0]);
                        let crossbarCount = 0;
                        if (frameWidth >= 1000 && frameWidth <= 2000) {
                            crossbarCount = 1;
                        } else if (frameWidth > 2000) {
                            crossbarCount = Math.floor(frameWidth / 1000);
                        }
                        const crossbarLengthM = crossbarCount * ((frameHeight - profileSizeMm * 2) / 1000);
                        
                        // –û–±—â–∞—è –¥–ª–∏–Ω–∞ –ø—Ä–æ—Ñ–∏–ª—è
                        const totalProfileM = framePerimeterM + crossbarLengthM;
                        
                        // –¶–µ–Ω–∞ –ø—Ä–æ—Ñ–∏–ª—è (–ø–æ —Ä–∞–∑–º–µ—Ä—É)
                        const profilePrices = {
                            '15x15': 80,  // ‚ÇΩ/–º.–ø.
                            '20x20': 100,
                            '30x30': 150,
                            '40x20': 180
                        };
                        const profilePrice = profilePrices[base.frameProfile] || 100;
                        const frameMaterialCost = totalProfileM * profilePrice;
                        total += frameMaterialCost;
                        materialsCost += frameMaterialCost;
                        
                        // –ü–æ–ª—É—á–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ —Ü–≤–µ—Ç–∞ –∫–∞—Ä–∫–∞—Å–∞
                        const frameColorName = getOracalColorName(base.frameColor || '#808080');
                        const frameColorParts = frameColorName.split(' - ');
                        const frameColorNumber = frameColorParts[0] || '';
                        const frameColorNameOnly = frameColorParts[1] || frameColorName;
                        
                        breakdownBase.push(`–ö–∞—Ä–∫–∞—Å ${bases.length > 1 ? '#' + (idx + 1) : ''} - –ø—Ä–æ—Ñ–∏–ª—å ${base.frameProfile}–º–º (${totalProfileM.toFixed(2)}–º √ó ${profilePrice}‚ÇΩ): ${frameMaterialCost.toFixed(0)} ‚ÇΩ`);
                        
                        // –ü–æ–∫—Ä–∞—Å–∫–∞ –∫–∞—Ä–∫–∞—Å–∞ (–≤—Å–µ–≥–¥–∞)
                        const paintData = PRICES_DATA.hardware['paint-spray'];
                        const sprayCansCoverage = paintData.coverage / 1000; // 6 –º–µ—Ç—Ä–æ–≤ –Ω–∞ –±–∞–ª–ª–æ–Ω
                        const sprayNeeded = Math.ceil(totalProfileM / sprayCansCoverage);
                        const framePaintCost = sprayNeeded * paintData.price;
                        total += framePaintCost;
                        materialsCost += framePaintCost;
                        breakdownBase.push(`–ü–æ–∫—Ä–∞—Å–∫–∞ –∫–∞—Ä–∫–∞—Å–∞ ${bases.length > 1 ? '#' + (idx + 1) : ''}: ${sprayNeeded} –±–∞–ª–ª–æ–Ω(–æ–≤) √ó ${paintData.price}‚ÇΩ = ${framePaintCost.toFixed(0)} ‚ÇΩ`);
                        
                        // –†–∞–±–æ—Ç–∞ –ø–æ —Å–≤–∞—Ä–∫–µ –∫–∞—Ä–∫–∞—Å–∞
                        // –§–æ—Ä–º—É–ª–∞: (–º–∞—Ç–µ—Ä–∏–∞–ª + –ø–æ–∫—Ä–∞—Å–∫–∞) * 2 + 20% –º–∞—Ç–µ—Ä–∏–∞–ª–∞
                        const frameWeldingCost = (frameMaterialCost + framePaintCost) * 2 + frameMaterialCost * 0.2;
                        total += frameWeldingCost;
                        workCost += frameWeldingCost;
                        breakdownWork.push(`–°–≤–∞—Ä–∫–∞ –∫–∞—Ä–∫–∞—Å–∞ ${bases.length > 1 ? '#' + (idx + 1) : ''}: ${frameWeldingCost.toFixed(0)} ‚ÇΩ`);
                    }
                });
            }
            
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            // üîü –ë–†–ê–ö (15% –æ—Ç —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤)
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            const wastePercent = 15; // 15% –Ω–∞ –±—Ä–∞–∫
            wasteCost = materialsCost * (wastePercent / 100);
            total += wasteCost;
            breakdown.push(`–ë—Ä–∞–∫ ${wastePercent}% –æ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ (${Math.round(materialsCost).toLocaleString('ru-RU')}‚ÇΩ): ${wasteCost.toFixed(0)} ‚ÇΩ`);
            
                console.log('[üìä] –ú–∞—Ç–µ—Ä–∏–∞–ª—ã:', Math.round(materialsCost), '‚ÇΩ | –†–∞–±–æ—Ç–∞:', Math.round(workCost), '‚ÇΩ | –ë—Ä–∞–∫:', Math.round(wasteCost), '‚ÇΩ | –ò–¢–û–ì–û:', Math.round(total), '‚ÇΩ');
                
                // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ç–∞–∫–∂–µ —Å–ø–∏—Å–æ–∫ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞ (–ë–ï–ó –¶–ï–ù!)
                const materialsList = [];
                let faceMaterialNameKey;
                if (state.faceMaterial.type === 'acrylic' && state.faceMaterial.color) {
                    faceMaterialNameKey = `${state.faceMaterial.type}-${state.faceMaterial.thickness}-${state.faceMaterial.color}`;
                } else {
                    faceMaterialNameKey = `${state.faceMaterial.type}-${state.faceMaterial.thickness}`;
                }
                materialsList.push(PRICES_DATA.materials[faceMaterialNameKey]?.name || '–ú–∞—Ç–µ—Ä–∏–∞–ª –ª–∏—Ü–∞');
                if (state.faceColor !== 'original') {
                    materialsList.push('–ü–ª—ë–Ω–∫–∞ Oracal 641');
                }
                if (state.construction === 'volumetric') {
                    const profileKey = `${state.sideMaterial.type}-${state.sideMaterial.thickness}`;
                    materialsList.push(PRICES_DATA.profiles[profileKey]?.name || '–ü—Ä–æ—Ñ–∏–ª—å');
                }
                if (state.hasBacklight) {
                    const ledType = state.ledType || 'led-1.2w';
                    const ledData = PRICES_DATA.lighting[ledType];
                    const ledName = ledData?.name || 'LED –¥–∏–æ–¥—ã';
                    materialsList.push(`LED –ø–æ–¥—Å–≤–µ—Ç–∫–∞ (${ledName})`);
                    // –î–æ–±–∞–≤–ª—è–µ–º –±–ª–æ–∫ –ø–∏—Ç–∞–Ω–∏—è (–æ–ø—Ä–µ–¥–µ–ª—è–µ–º –µ–≥–æ —Ç—É—Ç –∂–µ)
                    const spacing = ledData?.spacing_mm || 65;
                    const densityByArea = Math.ceil(areaM2 * 100);
                    const densityByPerimeter = Math.ceil((perimeterM * 1000) / spacing);
                    const ledCount = Math.ceil((densityByArea + densityByPerimeter) / 2);
                    const totalPower = ledCount * (ledData?.power_w || 0.72);
                    const requiredPower = totalPower * 1.3; // +30% –∑–∞–ø–∞—Å–∞
                    
                    // –ü–æ–¥–±–∏—Ä–∞–µ–º –±–ª–∏–∂–∞–π—à–∏–π –±–æ–ª—å—à–∏–π –±–ª–æ–∫
                    let psuKey = 'power-supply-60w';
                    if (requiredPower > 60) psuKey = 'power-supply-100w';
                    if (requiredPower > 100) psuKey = 'power-supply-150w';
                    if (requiredPower > 150) psuKey = 'power-supply-200w';
                    if (requiredPower > 200) psuKey = 'power-supply-400w';
                    
                    const psuName = PRICES_DATA.lighting[psuKey]?.name || '–ë–ª–æ–∫ –ø–∏—Ç–∞–Ω–∏—è';
                    materialsList.push(psuName);
                }
                if (state.hasSpacers) {
                    materialsList.push('–î–∏—Å—Ç–∞–Ω—Ü–∏–æ–Ω–Ω—ã–µ –¥–µ—Ä–∂–∞—Ç–µ–ª–∏');
                }
                
                // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º ledCount –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞
                let finalLedCount = 0;
                if (state.hasBacklight) {
                    const ledData = PRICES_DATA.lighting['led-standard'];
                    const spacing = ledData?.spacing_mm || 65;
                    const densityByArea = Math.ceil(areaM2 * 100);
                    const densityByPerimeter = Math.ceil((perimeterM * 1000) / spacing);
                    finalLedCount = Math.ceil((densityByArea + densityByPerimeter) / 2);
                }
                
                // –í—ã—Å–æ—Ç–∞ –¥–ª—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
                const totalHeightMm = state.construction === 'volumetric' ? state.bortHeight || 60 : 0;
                
                return { 
                    total, 
                    breakdown, 
                    breakdownFace,
                    breakdownSide,
                    breakdownBase,
                    breakdownFrame,
                    breakdownLight,
                    breakdownWork,
                    materialsList,
                    areaM2,
                    perimeterM,
                    ledCount: finalLedCount,
                    heightMm: totalHeightMm,
                    // PRO –º–µ—Ç—Ä–∏–∫–∏
                    materialsCost, // —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
                    workCost, // —Ä–∞–±–æ—Ç–∞
                    wasteCost, // –±—Ä–∞–∫
                    totalWithoutMargin: total // —Å—Ç–æ–∏–º–æ—Å—Ç—å –±–µ–∑ –º–∞—Ä–∂–∏ (—Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å + —Ä–∞–±–æ—Ç–∞ + –±—Ä–∞–∫)
                };
            } catch (error) {
                console.error('[calculateObjectCost] –û—à–∏–±–∫–∞:', error);
                return { total: 0, breakdown: [`‚ùå –û—à–∏–±–∫–∞ —Ä–∞—Å—á—ë—Ç–∞: ${error.message}`], breakdownFace: [], breakdownSide: [], breakdownBase: [], breakdownFrame: [], breakdownLight: [], breakdownWork: [], materialsList: [], areaM2: 0, perimeterM: 0, ledCount: 0, heightMm: 0, materialsCost: 0, workCost: 0, wasteCost: 0, totalWithoutMargin: 0 };
            }
        }
        
        function updateCostCalculator() {
            console.log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');
            console.log('[updateCostCalculator] –í–´–ó–í–ê–ù–ê');
            console.log('[updateCostCalculator] activeSvgIndex:', activeSvgIndex);
            console.log('[updateCostCalculator] svgGroups.length:', svgGroups.length);
            console.log('[updateCostCalculator] PRICES_DATA exists:', typeof PRICES_DATA !== 'undefined');
            
            // –¢–µ–∫—É—â–∏–π –æ–±—ä–µ–∫—Ç
            const currentCostDiv = document.getElementById('current-object-cost');
            if (!currentCostDiv) {
                console.error('[updateCostCalculator] ‚ùå –≠–ª–µ–º–µ–Ω—Ç #current-object-cost –Ω–µ –Ω–∞–π–¥–µ–Ω!');
                return;
            }
            console.log('[updateCostCalculator] ‚úÖ currentCostDiv –Ω–∞–π–¥–µ–Ω');
            
            if (activeSvgIndex !== null && svgGroups[activeSvgIndex]) {
                const svgObj = svgGroups[activeSvgIndex];
                console.log('[updateCostCalculator] –û–±—ä–µ–∫—Ç:', svgObj.name, 'realWidth:', svgObj.realWidth, 'realHeight:', svgObj.realHeight);
                
                try {
                    const cost = calculateObjectCost(svgObj);
                    console.log('[updateCostCalculator] –†–∞—Å—á—ë—Ç:', cost);
                    
                    const widthMm = svgObj.currentWidth || svgObj.realWidth || 0;
                    const heightMm = svgObj.currentHeight || svgObj.realHeight || 0;
                    
                    // ‚ïê‚ïê‚ïê PRO –í–ï–†–°–ò–Ø: –ü–û–õ–ù–ê–Ø –î–ï–¢–ê–õ–ò–ó–ê–¶–ò–Ø ‚ïê‚ïê‚ïê
                    let html = `<div style="color: var(--accent-color); font-weight: 600; margin-bottom: 8px; font-size: 13px;">${svgObj.name}</div>`;
                    html += `<div style="margin-bottom: 10px; font-size: 11px; color: rgba(255,255,255,0.7);">${Math.round(widthMm)}√ó${Math.round(heightMm)} –º–º</div>`;
                    
                    // –ü–ê–†–ê–ú–ï–¢–†–´
                    html += `<div style="margin-bottom: 10px; padding: 8px; background: rgba(255,255,255,0.08); border-radius: 4px; font-size: 10px;">`;
                    html += `<div style="color: rgba(255,255,255,0.5); margin-bottom: 4px; font-weight: 600;">üìê –ü–ê–†–ê–ú–ï–¢–†–´:</div>`;
                    html += `<div style="color: rgba(255,255,255,0.7); line-height: 1.8;">`;
                    html += `‚Ä¢ –ü–ª–æ—â–∞–¥—å: ${cost.areaM2.toFixed(3)} –º¬≤<br>`;
                    html += `‚Ä¢ –ü–µ—Ä–∏–º–µ—Ç—Ä: ${cost.perimeterM.toFixed(2)} –º<br>`;
                    if (state.hasBacklight && cost.ledCount) {
                        html += `‚Ä¢ –î–∏–æ–¥—ã: ${cost.ledCount} —à—Ç<br>`;
                    }
                    if (state.construction === 'volumetric') {
                        html += `‚Ä¢ –¢–æ–ª—â–∏–Ω–∞ –±–æ—Ä—Ç–∞: ${cost.heightMm || state.bortHeight || 60} –º–º<br>`;
                    }
                    html += `</div></div>`;
                    
                    // –î–ï–¢–ê–õ–¨–ù–´–ô –†–ê–°–ß–Å–¢ –ü–û –ö–ê–¢–ï–ì–û–†–ò–Ø–ú
                    html += `<div style="margin-bottom: 10px; padding: 8px; background: rgba(255,255,255,0.05); border-radius: 4px;">`;
                    html += `<div style="font-size: 10px; color: rgba(255,255,255,0.5); margin-bottom: 6px; font-weight: 600;">üí∞ –î–ï–¢–ê–õ–¨–ù–´–ô –†–ê–°–ß–Å–¢:</div>`;
                    
                    // –õ–ò–¶–û
                    if (cost.breakdownFace && cost.breakdownFace.length > 0) {
                        html += `<div style="margin-bottom: 8px;"><strong style="color: rgba(255,255,255,0.9);">–õ–ò–¶–û:</strong>`;
                        cost.breakdownFace.forEach(item => {
                            html += `<div style="color: rgba(255,255,255,0.75); line-height: 1.8; margin-left: 8px; font-size: 10px;">‚Ä¢ ${item}</div>`;
                        });
                        html += `</div>`;
                    }
                    
                    // –ë–û–†–¢
                    if (cost.breakdownSide && cost.breakdownSide.length > 0) {
                        html += `<div style="margin-bottom: 8px;"><strong style="color: rgba(255,255,255,0.9);">–ë–û–†–¢:</strong>`;
                        cost.breakdownSide.forEach(item => {
                            html += `<div style="color: rgba(255,255,255,0.75); line-height: 1.8; margin-left: 8px; font-size: 10px;">‚Ä¢ ${item}</div>`;
                        });
                        html += `</div>`;
                    }
                    
                    // –û–°–ù–û–í–ê
                    if (cost.breakdownBase && cost.breakdownBase.length > 0) {
                        html += `<div style="margin-bottom: 8px;"><strong style="color: rgba(255,255,255,0.9);">–û–°–ù–û–í–ê:</strong>`;
                        cost.breakdownBase.forEach(item => {
                            html += `<div style="color: rgba(255,255,255,0.75); line-height: 1.8; margin-left: 8px; font-size: 10px;">‚Ä¢ ${item}</div>`;
                        });
                        html += `</div>`;
                    }
                    
                    // –ö–ê–†–ö–ê–°
                    if (cost.breakdownFrame && cost.breakdownFrame.length > 0) {
                        html += `<div style="margin-bottom: 8px;"><strong style="color: rgba(255,255,255,0.9);">–ö–ê–†–ö–ê–°:</strong>`;
                        cost.breakdownFrame.forEach(item => {
                            html += `<div style="color: rgba(255,255,255,0.75); line-height: 1.8; margin-left: 8px; font-size: 10px;">‚Ä¢ ${item}</div>`;
                        });
                        html += `</div>`;
                    }
                    
                    // –°–í–ï–¢
                    if (cost.breakdownLight && cost.breakdownLight.length > 0) {
                        html += `<div style="margin-bottom: 8px;"><strong style="color: rgba(255,255,255,0.9);">–°–í–ï–¢:</strong>`;
                        cost.breakdownLight.forEach(item => {
                            html += `<div style="color: rgba(255,255,255,0.75); line-height: 1.8; margin-left: 8px; font-size: 10px;">‚Ä¢ ${item}</div>`;
                        });
                        html += `</div>`;
                    }
                    
                    // –†–ê–ë–û–¢–ê
                    if (cost.breakdownWork && cost.breakdownWork.length > 0) {
                        html += `<div style="margin-bottom: 8px;"><strong style="color: rgba(255,255,255,0.9);">–†–ê–ë–û–¢–ê:</strong>`;
                        cost.breakdownWork.forEach(item => {
                            html += `<div style="color: rgba(255,255,255,0.75); line-height: 1.8; margin-left: 8px; font-size: 10px;">‚Ä¢ ${item}</div>`;
                        });
                        html += `</div>`;
                    }
                    
                    // –ë–†–ê–ö (–æ—Ç–¥–µ–ª—å–Ω–æ –≤–Ω–∏–∑—É)
                    const wastePercent = 15;
                    html += `<div style="margin-top: 8px; padding-top: 8px; border-top: 1px solid rgba(255,255,255,0.1);">`;
                    html += `<div style="color: rgba(255,255,255,0.75); font-size: 10px;"><strong>–ë–†–ê–ö ${wastePercent}%:</strong> ${Math.round(cost.wasteCost).toLocaleString('ru-RU')} ‚ÇΩ</div>`;
                    html += `</div>`;
                    
                    html += `</div>`;
                    
                    // –°–ï–ë–ï–°–¢–û–ò–ú–û–°–¢–¨ –ò –ú–ê–†–ñ–ê
                    html += `<div style="margin-bottom: 10px; padding: 8px; background: rgba(255,255,255,0.08); border-radius: 4px; border-left: 3px solid var(--accent-color);">`;
                    html += `<div style="font-size: 10px; color: rgba(255,255,255,0.5); margin-bottom: 6px; font-weight: 600;">üìä –§–ò–ù–ê–ù–°–û–í–´–ô –ê–ù–ê–õ–ò–ó:</div>`;
                    html += `<div style="color: rgba(255,255,255,0.8); line-height: 2; font-size: 11px;">`;
                    html += `‚Ä¢ –°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤: ${Math.round(cost.materialsCost).toLocaleString('ru-RU')} ‚ÇΩ<br>`;
                    html += `‚Ä¢ –†–∞–±–æ—Ç–∞: ${Math.round(cost.workCost).toLocaleString('ru-RU')} ‚ÇΩ<br>`;
                    html += `‚Ä¢ –ë—Ä–∞–∫: ${Math.round(cost.wasteCost).toLocaleString('ru-RU')} ‚ÇΩ<br>`;
                    html += `</div>`;
                    
                    // –†–ï–î–ê–ö–¢–ò–†–£–ï–ú–ê–Ø –ú–ê–†–ñ–ê
                    const defaultMargin = 100; // 100% –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                    const marginAmount = cost.totalWithoutMargin * (defaultMargin / 100);
                    const totalWithMargin = cost.totalWithoutMargin + marginAmount;
                    
                    html += `<div style="margin-top: 8px; padding: 8px; background: rgba(255,209,0,0.1); border-radius: 3px;">`;
                    
                    // –ú–∞—Ä–∂–∞ –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö
                    html += `<div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">`;
                    html += `<span style="color: rgba(255,255,255,0.7); font-size: 10px;">–ú–∞—Ä–∂–∞:</span>`;
                    html += `<input type="number" id="margin-input-${svgObj.id}" value="${defaultMargin}" min="0" max="1000" 
                             style="width: 50px; padding: 3px 6px; background: rgba(0,0,0,0.3); border: 1px solid rgba(255,209,0,0.3); 
                             border-radius: 3px; color: var(--accent-color); font-size: 11px; font-weight: 600;"
                             onchange="updateMargin(${svgObj.id})">`;
                    html += `<span style="color: rgba(255,255,255,0.7); font-size: 10px;">%</span>`;
                    html += `<span id="margin-amount-${svgObj.id}" style="color: var(--accent-color); font-size: 11px; font-weight: 600; margin-left: auto;">
                             +${Math.round(marginAmount).toLocaleString('ru-RU')} ‚ÇΩ</span>`;
                    html += `</div>`;
                    
                    // –°—Ç–æ–∏–º–æ—Å—Ç—å –∑–∞ 1 —Å–º –≤—ã—Å–æ—Ç—ã (—Å–ø—Ä–∞–≤–æ—á–Ω–æ) - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ–≥–¥–∞ –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º HTML
                    const existingPricePerCmInput = document.getElementById('price-per-cm-global');
                    const savedPricePerCm = existingPricePerCmInput ? parseFloat(existingPricePerCmInput.value) || 0 : 0;
                    
                    // –°—á–∏—Ç–∞–µ–º –û–ë–©–£–Æ –≤—ã—Å–æ—Ç—É –í–°–ï–• –æ–±—ä–µ–∫—Ç–æ–≤ (–≤—ã—Å–æ—Ç–∞ SVG √ó –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±—É–∫–≤)
                    let totalHeightCm = 0;
                    svgGroups.forEach(obj => {
                        if (obj.visible) {
                            // –í—ã—Å–æ—Ç–∞ –æ–¥–Ω–æ–≥–æ SVG √ó –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ë–£–ö–í (–∫–∞–∂–¥–∞—è –±—É–∫–≤–∞ = 2 paths: –∫–æ–Ω—Ç—É—Ä + –æ—Ç–≤–µ—Ä—Å—Ç–∏–µ)
                            const heightMm = obj.realHeight || 0;
                            const pathsCount = obj.pathsCount || 1;
                            const lettersCount = Math.ceil(pathsCount / 2); // –î–µ–ª–∏–º –Ω–∞ 2, —Ç.–∫. –±—É–∫–≤–∞ = –∫–æ–Ω—Ç—É—Ä + –¥—ã—Ä–∫–∞
                            totalHeightCm += (heightMm / 10) * lettersCount;
                        }
                    });
                    
                    const priceByHeight = savedPricePerCm * totalHeightCm; // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞—Å—á—ë—Ç
                    html += `<div style="display: flex; align-items: center; gap: 8px; border-top: 1px solid rgba(255,209,0,0.15); padding-top: 6px;">`;
                    html += `<span style="color: rgba(255,255,255,0.7); font-size: 10px;">–ó–∞ 1 —Å–º –≤—ã—Å–æ—Ç—ã:</span>`;
                    html += `<input type="number" id="price-per-cm-global" value="${savedPricePerCm}" min="0" step="10"
                             style="width: 70px; padding: 3px 6px; background: rgba(0,0,0,0.3); border: 1px solid rgba(255,209,0,0.3); 
                             border-radius: 3px; color: var(--accent-color); font-size: 11px; font-weight: 600;"
                             onchange="updateAllMargins()">`;
                    html += `<span style="color: rgba(255,255,255,0.7); font-size: 10px;">‚ÇΩ</span>`;
                    html += `<span id="price-by-height-global" style="color: var(--accent-color); font-size: 11px; font-weight: 600; margin-left: auto;">
                             ${Math.round(priceByHeight).toLocaleString('ru-RU')} ‚ÇΩ</span>`;
                    html += `<span style="color: rgba(255,255,255,0.5); font-size: 9px; margin-left: 5px;">
                             (–æ–±—â–∞—è: ${totalHeightCm.toFixed(1)} —Å–º)</span>`;
                    html += `</div>`;
                    
                    html += `</div></div>`;
                    
                    // –ò–¢–û–ì–û –° –ú–ê–†–ñ–û–ô
                    html += `<div style="margin-top: 10px; padding-top: 8px; border-top: 2px solid rgba(255,209,0,0.3); font-weight: 700; font-size: 15px; color: var(--accent-color);">
                        –ò–¢–û–ì–û –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞: <span id="total-with-margin-${svgObj.id}">${Math.round(totalWithMargin).toLocaleString('ru-RU')}</span> ‚ÇΩ
                    </div>`;
                    
                    html += `<div style="margin-top: 6px; font-size: 9px; color: rgba(255,255,255,0.4); font-style: italic;">
                        PRO —Ä–∞—Å—á—ë—Ç ‚Ä¢ –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º–∞—è –º–∞—Ä–∂–∞
                    </div>`;
                    
                    // –†–ê–ó–ë–ò–í–ö–ê –ü–û –í–°–ï–ú –û–ë–™–ï–ö–¢–ê–ú –ò –û–°–ù–û–í–ê–ú
                    html += `<div style="margin-top: 15px; padding: 10px; background: rgba(0,0,0,0.2); border-radius: 4px; border-left: 3px solid rgba(255,209,0,0.5);">`;
                    html += `<div style="font-size: 10px; color: rgba(255,255,255,0.5); margin-bottom: 8px; font-weight: 600;">üìã –ü–û–õ–ù–ê–Ø –†–ê–ó–ë–ò–í–ö–ê:</div>`;
                    
                    let totalAllObjects = 0;
                    let totalAllCost = 0;
                    let totalAllMargin = 0;
                    
                    // SVG –æ–±—ä–µ–∫—Ç—ã
                    svgGroups.forEach((obj, idx) => {
                        if (obj.visible) {
                            const objCost = calculateObjectCost(obj);
                            const marginPercent = document.getElementById(`margin-input-${obj.id}`)?.value || 100;
                            const objMargin = objCost.totalWithoutMargin * (parseFloat(marginPercent) / 100);
                            const objTotalWithMargin = objCost.totalWithoutMargin + objMargin;
                            
                            totalAllCost += objCost.totalWithoutMargin;
                            totalAllMargin += objMargin;
                            totalAllObjects += objTotalWithMargin;
                            
                            const isActive = idx === activeSvgIndex;
                            html += `<div style="padding: 5px 0; color: ${isActive ? 'var(--accent-color)' : 'rgba(255,255,255,0.7)'}; font-weight: ${isActive ? '600' : '400'}; font-size: 11px; line-height: 1.6;">`;
                            html += `${idx + 1}. ${obj.name}:<br>`;
                            html += `<span style="font-size: 10px; margin-left: 10px;">—Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å - ${Math.round(objCost.totalWithoutMargin).toLocaleString('ru-RU')} ‚ÇΩ, –º–∞—Ä–∂–∞ - ${Math.round(objMargin).toLocaleString('ru-RU')} ‚ÇΩ</span>`;
                            html += `</div>`;
                        }
                    });
                    
                    // –û—Å–Ω–æ–≤—ã (–ø—Ä–æ–ø—É—Å–∫–∞–µ–º, —Ç–∞–∫ –∫–∞–∫ calculateBaseCost –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞)
                    // –û—Å–Ω–æ–≤—ã —É–∂–µ —É—á—Ç–µ–Ω—ã –≤ total-cost-list –Ω–∏–∂–µ
                    
                    html += `<div style="margin-top: 8px; padding-top: 8px; border-top: 1px solid rgba(255,209,0,0.3); font-weight: 700; font-size: 12px; color: var(--accent-color);">`;
                    html += `–û–ë–©–ê–Ø –°–£–ú–ú–ê: ${Math.round(totalAllObjects).toLocaleString('ru-RU')} ‚ÇΩ`;
                    html += `</div>`;
                    html += `</div>`;
                    
                    
                    currentCostDiv.innerHTML = html;
                    console.log('[updateCostCalculator] ‚úÖ HTML –æ–±–Ω–æ–≤–ª—ë–Ω, –¥–ª–∏–Ω–∞:', html.length);
                    console.log('[updateCostCalculator] materialsList:', cost.materialsList);
                    console.log('[updateCostCalculator] total:', cost.total);
                    
                    // ‚ïê‚ïê‚ïê –°–†–ê–í–ù–ï–ù–ò–ï –°–û –í–°–ï–ú–ò –û–ë–™–ï–ö–¢–ê–ú–ò ‚ïê‚ïê‚ïê
                    console.log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');
                    console.log('üìä –°–†–ê–í–ù–ï–ù–ò–ï –°–¢–û–ò–ú–û–°–¢–ò –ò –í–´–°–û–¢ –í–°–ï–• –û–ë–™–ï–ö–¢–û–í:');
                    svgGroups.forEach((obj, idx) => {
                        if (obj.visible) {
                            const objCost = calculateObjectCost(obj);
                            const h = objCost.heightMm || 0;
                            const perMm = h > 0 ? (objCost.total / h).toFixed(2) : 'N/A';
                            console.log(`  [${idx}] ${obj.name}: ${objCost.total.toFixed(0)}‚ÇΩ | –í—ã—Å–æ—Ç–∞: ${h}–º–º | –ó–∞ 1–º–º: ${perMm}‚ÇΩ`);
                        }
                    });
                    console.log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
                    const calcContent = document.querySelector('.calc-content');
                    const costCalculator = document.getElementById('cost-calculator');
                    console.log('[updateCostCalculator] –†–û–î–ò–¢–ï–õ–ò:');
                    console.log('  .calc-content:', calcContent ? `display:${window.getComputedStyle(calcContent).display} maxHeight:${window.getComputedStyle(calcContent).maxHeight} height:${calcContent.offsetHeight}px` : '–ù–ï –ù–ê–ô–î–ï–ù');
                    console.log('  #cost-calculator:', costCalculator ? `height:${costCalculator.offsetHeight}px` : '–ù–ï –ù–ê–ô–î–ï–ù');
                } catch (error) {
                    console.error('[updateCostCalculator] –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞—Å—á—ë—Ç–µ:', error);
                    currentCostDiv.innerHTML = `<div style="color: #ff4444;">‚ùå –û—à–∏–±–∫–∞ —Ä–∞—Å—á—ë—Ç–∞: ${error.message}</div>`;
                }
            } else {
                console.log('[updateCostCalculator] –ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–≥–æ SVG');
                
                // –ï—Å–ª–∏ –µ—Å—Ç—å –æ—Å–Ω–æ–≤—ã - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–∞—Å—á—ë—Ç –æ—Å–Ω–æ–≤
                if (bases && bases.length > 0) {
                    let html = `<div style="color: var(--accent-color); font-weight: 600; margin-bottom: 8px; font-size: 13px;">–û—Å–Ω–æ–≤–∞</div>`;
                    
                    let totalBaseCost = 0;
                    let breakdownBase = [];
                    let breakdownWork = [];
                    
                    bases.forEach((base, idx) => {
                        const baseMaterialData = PRICES_DATA.materials[base.material];
                        if (!baseMaterialData) return;
                        
                        // –ü–ª–æ—â–∞–¥—å –æ—Å–Ω–æ–≤—ã
                        const baseAreaM2 = (base.width * base.height) / 1000000;
                        const basePerimeterM = ((base.width + base.height) * 2) / 1000;
                        
                        // –°—Ç–æ–∏–º–æ—Å—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª–∞ –æ—Å–Ω–æ–≤—ã
                        const baseCost = baseAreaM2 * baseMaterialData.price;
                        totalBaseCost += baseCost;
                        
                        const hasBend = base.material.startsWith('composite') && base.bend > 0;
                        const bendSize = hasBend ? base.bend : 0;
                        const fullWidth = base.width + (bendSize * 2);
                        const fullHeight = base.height + (bendSize * 2);
                        
                        let sizeInfo = `${base.width}√ó${base.height}–º–º`;
                        if (hasBend) {
                            sizeInfo += ` (—Å –∑–∞–≥–∏–±–æ–º ${bendSize}–º–º = ${fullWidth}√ó${fullHeight}–º–º)`;
                        }
                        
                        breakdownBase.push(`–ú–∞—Ç–µ—Ä–∏–∞–ª - ${baseMaterialData.name} ${bases.length > 1 ? '#' + (idx + 1) : ''} (${sizeInfo} = ${baseAreaM2.toFixed(3)} –º¬≤ √ó ${baseMaterialData.price}‚ÇΩ): ${baseCost.toFixed(0)} ‚ÇΩ`);
                        
                        // –†–∞–±–æ—Ç–∞ –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –æ—Å–Ω–æ–≤—ã
                        const baseWork = PRICES_DATA.work['base-assembly'] || { hours_per_m2: 0.3, rate_per_hour: 500 };
                        const baseWorkHours = baseAreaM2 * (baseWork.hours_per_m2 || 0.3);
                        const baseWorkCost = baseWorkHours * (baseWork.rate_per_hour || 500);
                        totalBaseCost += baseWorkCost;
                        breakdownWork.push(`–ò–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ –æ—Å–Ω–æ–≤—ã ${bases.length > 1 ? '#' + (idx + 1) : ''} (${baseWorkHours.toFixed(1)}—á √ó 500‚ÇΩ): ${baseWorkCost.toFixed(0)} ‚ÇΩ`);
                        
                        // –ó–∞–≥–∏–± –∫–æ–º–ø–æ–∑–∏—Ç–∞
                        if (hasBend) {
                            const basePerimeterForBend = basePerimeterM;
                            
                            // –†–∞–±–æ—Ç–∞: 80‚ÇΩ/–º.–ø.
                            const bendWorkCost = basePerimeterForBend * 80;
                            totalBaseCost += bendWorkCost;
                            breakdownWork.push(`–ó–∞–≥–∏–± –∫–æ–º–ø–æ–∑–∏—Ç–∞ ${bases.length > 1 ? '#' + (idx + 1) : ''} ${bendSize}–º–º (${basePerimeterForBend.toFixed(2)}–º √ó 80‚ÇΩ): ${bendWorkCost.toFixed(0)} ‚ÇΩ`);
                            
                            // –ú–∞—Ç–µ—Ä–∏–∞–ª –±–æ—Ä—Ç–∏–∫–æ–≤
                            const bendAreaMm2 = 2 * bendSize * (base.width + base.height);
                            const bendAreaM2 = bendAreaMm2 / 1000000;
                            const bendMaterialCost = bendAreaM2 * baseMaterialData.price;
                            totalBaseCost += bendMaterialCost;
                            breakdownBase.push(`–ú–∞—Ç–µ—Ä–∏–∞–ª –∑–∞–≥–∏–±–∞ ${bases.length > 1 ? '#' + (idx + 1) : ''} (${bendAreaM2.toFixed(3)} –º¬≤ √ó ${baseMaterialData.price}‚ÇΩ): ${bendMaterialCost.toFixed(0)} ‚ÇΩ`);
                        }
                        
                        // –ö–∞—Ä–∫–∞—Å –¥–ª—è –æ—Å–Ω–æ–≤—ã
                        if (base.hasFrame) {
                            let frameWidth, frameHeight;
                            if (base.bend > 0) {
                                frameWidth = base.width - (base.thickness * 2);
                                frameHeight = base.height - (base.thickness * 2);
                            } else {
                                frameWidth = base.width - 8;
                                frameHeight = base.height - 8;
                            }
                            const framePerimeterM = ((frameWidth + frameHeight) * 2) / 1000;
                            
                            const crossbarStep = 800;
                            const profileSizeMm = parseInt(base.frameProfile.split('x')[0]);
                            const crossbarCount = Math.floor((frameWidth - profileSizeMm * 2) / crossbarStep);
                            const crossbarLengthM = crossbarCount * ((frameHeight - profileSizeMm * 2) / 1000);
                            
                            const totalProfileM = framePerimeterM + crossbarLengthM;
                            
                            const profilePrices = {
                                '15x15': 80,
                                '20x20': 100,
                                '30x30': 150,
                                '40x40': 200
                            };
                            const profilePrice = profilePrices[base.frameProfile] || 100;
                            const frameMaterialCost = totalProfileM * profilePrice;
                            totalBaseCost += frameMaterialCost;
                            
                            const frameColorName = getOracalColorName(base.frameColor || '#808080');
                            breakdownBase.push(`–ö–∞—Ä–∫–∞—Å ${bases.length > 1 ? '#' + (idx + 1) : ''} - –ø—Ä–æ—Ñ–∏–ª—å ${base.frameProfile}–º–º (${totalProfileM.toFixed(2)}–º √ó ${profilePrice}‚ÇΩ): ${frameMaterialCost.toFixed(0)} ‚ÇΩ`);
                            
                            // –ü–æ–∫—Ä–∞—Å–∫–∞
                            if (base.frameColor && base.frameColor !== '#808080') {
                                const paintCost = totalProfileM * 150;
                                totalBaseCost += paintCost;
                                breakdownBase.push(`–ü–æ–∫—Ä–∞—Å–∫–∞ –∫–∞—Ä–∫–∞—Å–∞ ${bases.length > 1 ? '#' + (idx + 1) : ''} Oracal 641 ${frameColorName} (${totalProfileM.toFixed(2)}–º √ó 150‚ÇΩ): ${paintCost.toFixed(0)} ‚ÇΩ`);
                            }
                            
                            // –†–∞–±–æ—Ç–∞
                            const frameWorkHours = totalProfileM * 0.2;
                            const frameWorkCost = frameWorkHours * 500;
                            totalBaseCost += frameWorkCost;
                            breakdownWork.push(`–°–±–æ—Ä–∫–∞ –∫–∞—Ä–∫–∞—Å–∞ ${bases.length > 1 ? '#' + (idx + 1) : ''} (${frameWorkHours.toFixed(1)}—á √ó 500‚ÇΩ): ${frameWorkCost.toFixed(0)} ‚ÇΩ`);
                        }
                    });
                    
                    // –î–ï–¢–ê–õ–¨–ù–´–ô –†–ê–°–ß–Å–¢
                    html += `<div style="margin-bottom: 10px; padding: 8px; background: rgba(255,255,255,0.05); border-radius: 4px;">`;
                    html += `<div style="font-size: 10px; color: rgba(255,255,255,0.5); margin-bottom: 6px; font-weight: 600;">üí∞ –î–ï–¢–ê–õ–¨–ù–´–ô –†–ê–°–ß–Å–¢:</div>`;
                    
                    // –û–°–ù–û–í–ê
                    if (breakdownBase.length > 0) {
                        html += `<div style="font-size: 10px; margin-bottom: 4px;"><div style="color: rgba(255,193,7,0.9); font-weight: 600; margin-bottom: 2px;">–û–°–ù–û–í–ê:</div>`;
                        breakdownBase.forEach(line => {
                            html += `<div style="color: rgba(255,255,255,0.7); padding-left: 8px; margin-bottom: 1px;">‚îú‚îÄ ${line}</div>`;
                        });
                        html += `</div>`;
                    }
                    
                    // –†–ê–ë–û–¢–ê
                    if (breakdownWork.length > 0) {
                        html += `<div style="font-size: 10px; margin-bottom: 4px;"><div style="color: rgba(156,39,176,0.9); font-weight: 600; margin-bottom: 2px;">–†–ê–ë–û–¢–ê:</div>`;
                        breakdownWork.forEach(line => {
                            html += `<div style="color: rgba(255,255,255,0.7); padding-left: 8px; margin-bottom: 1px;">‚îú‚îÄ ${line}</div>`;
                        });
                        html += `</div>`;
                    }
                    html += `</div>`;
                    
                    // –ò–¢–û–ì–û
                    html += `<div style="margin-top: 12px; padding: 10px; background: var(--accent-gradient); border-radius: 6px;">`;
                    html += `<div style="display: flex; justify-content: space-between; align-items: center;">`;
                    html += `<span style="font-weight: 600; font-size: 13px;">–ò–¢–û–ì–û:</span>`;
                    html += `<span style="font-weight: 700; font-size: 16px; color: #fff;">${Math.round(totalBaseCost)} ‚ÇΩ</span>`;
                    html += `</div></div>`;
                    
                    currentCostDiv.innerHTML = html;
                } else {
                    currentCostDiv.innerHTML = '–í—ã–±–µ—Ä–∏—Ç–µ –æ–±—ä–µ–∫—Ç';
                }
            }
            
            // –í—Å–µ –æ–±—ä–µ–∫—Ç—ã
            const totalCostListDiv = document.getElementById('total-cost-list');
            const totalCostSpan = document.getElementById('total-cost');
            
            let grandTotal = 0;
            let html = '';
            
            // –°—á–∏—Ç–∞–µ–º SVG –æ–±—ä–µ–∫—Ç—ã
            if (svgGroups.length > 0) {
                svgGroups.forEach((svgObj, idx) => {
                    const cost = calculateObjectCost(svgObj);
                    const isActive = idx === activeSvgIndex;
                    
                    // –ü–æ–ª—É—á–∞–µ–º –º–∞—Ä–∂—É –∏–∑ input –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ—Ñ–æ–ª—Ç 100%
                    const marginInput = document.getElementById(`margin-input-${svgObj.id}`);
                    const marginPercent = marginInput ? parseFloat(marginInput.value) || 100 : 100;
                    
                    // –°—á–∏—Ç–∞–µ–º –º–∞—Ä–∂—É
                    const marginAmount = cost.totalWithoutMargin * (marginPercent / 100);
                    const totalWithMargin = cost.totalWithoutMargin + marginAmount;
                    
                    // –°—É–º–º–∏—Ä—É–µ–º —Ç–æ—á–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –° –ú–ê–†–ñ–û–ô
                    grandTotal += totalWithMargin;
                    
                    html += `<div style="padding: 5px 0; color: ${isActive ? 'var(--accent-color)' : 'rgba(255,255,255,0.7)'}; font-weight: ${isActive ? '600' : '400'}; font-size: 11px; line-height: 1.4;">`;
                    html += `${idx + 1}. ${svgObj.name}: —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å - ${Math.round(cost.totalWithoutMargin).toLocaleString('ru-RU')} ‚ÇΩ, –º–∞—Ä–∂–∞ - ${Math.round(marginAmount).toLocaleString('ru-RU')} ‚ÇΩ`;
                    html += `</div>`;
                });
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ—Å–Ω–æ–≤—ã –≤ –æ–±—â–∏–π –∏—Ç–æ–≥
            if (bases && bases.length > 0) {
                let totalBaseCost = 0;
                
                bases.forEach((base, idx) => {
                    const baseMaterialData = PRICES_DATA.materials[base.material];
                    if (!baseMaterialData) return;
                    
                    // –ü–ª–æ—â–∞–¥—å –æ—Å–Ω–æ–≤—ã
                    const baseAreaM2 = (base.width * base.height) / 1000000;
                    const basePerimeterM = ((base.width + base.height) * 2) / 1000;
                    
                    // –°—Ç–æ–∏–º–æ—Å—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª–∞ –æ—Å–Ω–æ–≤—ã
                    const baseCost = baseAreaM2 * baseMaterialData.price;
                    totalBaseCost += baseCost;
                    
                    // –†–∞–±–æ—Ç–∞ –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –æ—Å–Ω–æ–≤—ã
                    const baseWork = PRICES_DATA.work['base-assembly'] || { hours_per_m2: 0.3, rate_per_hour: 500 };
                    const baseWorkHours = baseAreaM2 * (baseWork.hours_per_m2 || 0.3);
                    const baseWorkCost = baseWorkHours * (baseWork.rate_per_hour || 500);
                    totalBaseCost += baseWorkCost;
                    
                    // –ó–∞–≥–∏–± –∫–æ–º–ø–æ–∑–∏—Ç–∞
                    const hasBend = base.material.startsWith('composite') && base.bend > 0;
                    if (hasBend) {
                        // –†–∞–±–æ—Ç–∞: 80‚ÇΩ/–º.–ø.
                        const bendWorkCost = basePerimeterM * 80;
                        totalBaseCost += bendWorkCost;
                        
                        // –ú–∞—Ç–µ—Ä–∏–∞–ª –±–æ—Ä—Ç–∏–∫–æ–≤
                        const bendSize = base.bend;
                        const bendAreaMm2 = 2 * bendSize * (base.width + base.height);
                        const bendAreaM2 = bendAreaMm2 / 1000000;
                        const bendMaterialCost = bendAreaM2 * baseMaterialData.price;
                        totalBaseCost += bendMaterialCost;
                    }
                    
                    // –ö–∞—Ä–∫–∞—Å –¥–ª—è –æ—Å–Ω–æ–≤—ã
                    if (base.hasFrame) {
                        const frameWidth = base.width - 8;
                        const frameHeight = base.height - 8;
                        const framePerimeterM = ((frameWidth + frameHeight) * 2) / 1000;
                        
                        const crossbarStep = 800;
                        const profileSizeMm = parseInt(base.frameProfile.split('x')[0]);
                        const crossbarCount = Math.floor((frameWidth - profileSizeMm * 2) / crossbarStep);
                        const crossbarLengthM = crossbarCount * ((frameHeight - profileSizeMm * 2) / 1000);
                        
                        const totalProfileM = framePerimeterM + crossbarLengthM;
                        
                        const profilePrices = {
                            '15x15': 80,
                            '20x20': 100,
                            '30x30': 150,
                            '40x20': 180
                        };
                        const profilePrice = profilePrices[base.frameProfile] || 100;
                        const frameMaterialCost = totalProfileM * profilePrice;
                        totalBaseCost += frameMaterialCost;
                        
                        // –ü–æ–∫—Ä–∞—Å–∫–∞
                        if (base.frameColor && base.frameColor !== '#808080') {
                            const paintCost = totalProfileM * 150;
                            totalBaseCost += paintCost;
                        }
                        
                        // –†–∞–±–æ—Ç–∞
                        const frameWorkCost = totalProfileM * 0.2 * 500;
                        totalBaseCost += frameWorkCost;
                    }
                });
                
                // –î–æ–±–∞–≤–ª—è–µ–º –æ—Å–Ω–æ–≤—ã –≤ —Å–ø–∏—Å–æ–∫ —Å –º–∞—Ä–∂–æ–π 100%
                const baseMarginAmount = totalBaseCost * 1; // 100% –º–∞—Ä–∂–∞
                const baseTotalWithMargin = totalBaseCost + baseMarginAmount;
                grandTotal += baseTotalWithMargin;
                
                html += `<div style="padding: 5px 0; color: rgba(255,193,7,0.9); font-weight: 600; font-size: 11px; line-height: 1.4;">`;
                html += `–û—Å–Ω–æ–≤–∞ ${bases.length > 1 ? '(' + bases.length + ' —à—Ç)' : ''}: —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å - ${Math.round(totalBaseCost).toLocaleString('ru-RU')} ‚ÇΩ, –º–∞—Ä–∂–∞ - ${Math.round(baseMarginAmount).toLocaleString('ru-RU')} ‚ÇΩ`;
                html += `</div>`;
            }
            
            if (svgGroups.length === 0 && (!bases || bases.length === 0)) {
                totalCostListDiv.innerHTML = '‚Äî';
                totalCostSpan.textContent = '0 ‚ÇΩ';
            } else {
                totalCostListDiv.innerHTML = html;
                
                // –ò–¢–û–ì–û = —Ç–æ—á–Ω–∞—è —Å—É–º–º–∞ –° –ú–ê–†–ñ–û–ô
                totalCostSpan.textContent = `${Math.round(grandTotal).toLocaleString('ru-RU')} ‚ÇΩ`;
            }
        }
        
        // –û–±–Ω–æ–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∞–∫—Ç–∏–≤–Ω–æ–≥–æ SVG (–∞–Ω–∞–ª–æ–≥ update3DLetter)
        function updateActiveSVG() {
            if (activeSvgIndex === null) return;
            
            const svgObj = svgGroups[activeSvgIndex];
            const { construction, faceMaterial, faceColor, sideMaterial, sideColor, bortHeight, hasBacklight, svgRealSize } = state;
            
            // –ê–ë–°–û–õ–Æ–¢–ù–ê–Ø –¢–û–õ–©–ò–ù–ê –í –ú–ú ‚Üí –ï–î–ò–ù–ò–¶–´ –°–¶–ï–ù–´
            const SCENE_SCALE = 0.1; // 10–º–º = 1 –µ–¥–∏–Ω–∏—Ü–∞ Three.js
            
            let depth;
            if (construction === 'volumetric') {
                // –ë–æ—Ä—Ç –≤ –º–º ‚Üí –µ–¥–∏–Ω–∏—Ü—ã —Å—Ü–µ–Ω—ã (–∞–±—Å–æ–ª—é—Ç–Ω–æ, –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–∞–∑–º–µ—Ä–∞ SVG!)
                depth = (bortHeight || 80) * SCENE_SCALE;
                log(`–ë–æ—Ä—Ç: ${bortHeight}–º–º * ${SCENE_SCALE} = ${depth.toFixed(2)} –µ–¥`, 'info');
            } else {
                // –¢–æ–ª—â–∏–Ω–∞ –ª–∏—Ü–∞ –≤ –º–º ‚Üí –µ–¥–∏–Ω–∏—Ü—ã —Å—Ü–µ–Ω—ã
                const faceThicknessMm = faceMaterial.thickness || 3;
                depth = faceThicknessMm * SCENE_SCALE;
                log(`–õ–∏—Ü–æ: ${faceThicknessMm}–º–º * ${SCENE_SCALE} = ${depth.toFixed(3)} –µ–¥`, 'info');
            }
            
            // –û–ü–†–ï–î–ï–õ–Ø–ï–ú –¶–í–ï–¢ –ë–û–†–¢–ê (–ë–û–ö–û–í–ò–ù–´)
            let actualSideColor = sideColor;
            
            if (construction === 'flat') {
                if (faceMaterial.type === 'pvc') {
                    actualSideColor = '#FFFFFF'; // –ü–í–• ‚Üí –±–µ–ª—ã–π –±–æ—Ä—Ç
                } else if (faceMaterial.type === 'composite') {
                    actualSideColor = '#000000'; // –ö–æ–º–ø–æ–∑–∏—Ç ‚Üí —á—ë—Ä–Ω—ã–π –±–æ—Ä—Ç
                }
            }
            
            svgObj.group.children.forEach(mesh => {
                if (mesh.geometry) {
                    mesh.scale.z = depth;
                }
                
                if (Array.isArray(mesh.material) && mesh.material.length >= 2) {
                    const faceMat = mesh.material[0];  // –õ–∏—Ü–æ+–∑–∞–¥–Ω–∏–∫
                    const sideMat = mesh.material[1];  // –ë–æ—Ä—Ç
                    
                    // –û–ü–†–ï–î–ï–õ–Ø–ï–ú –¶–í–ï–¢ –õ–ò–¶–ê: –µ—Å–ª–∏ "–æ—Ä–∏–≥–∏–Ω–∞–ª" - –±–µ—Ä—ë–º –∏–∑ userData, –∏–Ω–∞—á–µ –∏–∑ UI
                    let actualFaceColor;
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤—ã–±—Ä–∞–Ω –ª–∏ —Ü–≤–µ—Ç–Ω–æ–π –∞–∫—Ä–∏–ª (—Ü–≤–µ—Ç –≤ –∏–º–µ–Ω–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–∞)
                    const coloredAcrylicColors = {
                        'red': '#E3000F',
                        'yellow': '#FFD100',
                        'blue': '#003893',
                        'green': '#32CD32',
                        'orange': '#FF6B00',
                        'black': '#000000'
                    };
                    
                    // –î–ª—è –¶–í–ï–¢–ù–û–ì–û –∞–∫—Ä–∏–ª–∞ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º faceColor –∏–∑ UI
                    if (faceMaterial.type === 'acrylic' && faceMaterial.color && faceMaterial.color !== 'milk') {
                        // –¶–≤–µ—Ç–Ω–æ–π –∞–∫—Ä–∏–ª - –±–µ—Ä—ë–º —Ü–≤–µ—Ç –∏–∑ –Ω–∞–∑–≤–∞–Ω–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–∞
                        actualFaceColor = coloredAcrylicColors[faceMaterial.color] || '#FFFFFF';
                        log(`–¶–≤–µ—Ç –ª–∏—Ü–∞: —Ü–≤–µ—Ç–Ω–æ–π –∞–∫—Ä–∏–ª ${faceMaterial.color} (${actualFaceColor})`, 'info');
                    } else if (faceColor === 'original' || !faceColor) {
                        actualFaceColor = mesh.userData.originalFaceColor || '#FFFFFF';
                        log(`–¶–≤–µ—Ç –ª–∏—Ü–∞: –æ—Ä–∏–≥–∏–Ω–∞–ª (${actualFaceColor})`, 'info');
                    } else {
                        actualFaceColor = faceColor;
                        log(`–¶–≤–µ—Ç –ª–∏—Ü–∞: –≤—ã–±—Ä–∞–Ω–Ω—ã–π (${actualFaceColor})`, 'info');
                    }
                    
                    faceMat.color.setStyle(actualFaceColor);
                    faceMat.needsUpdate = true;
                    
                    // –°–≤–æ–π—Å—Ç–≤–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–∞ –ª–∏—Ü–∞
                    if (faceMaterial.type === 'acrylic') {
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–∏ –ø–ª–µ–Ω–∫–∞ Oracal 8500 (–º–∞—Ç–æ–≤–∞—è/—Ç—Ä–∞–Ω—Å–ª—é—Ü–µ–Ω—Ç–Ω–∞—è)
                        const faceColorValue = document.getElementById('face-color').value;
                        const selectedCustomOption = document.querySelector(`.custom-option[data-value="${faceColorValue}"]`);
                        const isOracal8500 = selectedCustomOption && 
                                            selectedCustomOption.closest('#oracal-850-group') !== null;
                        
                        if (isOracal8500) {
                            // Oracal 8500 - –º–∞—Ç–æ–≤–∞—è —Ç—Ä–∞–Ω—Å–ª—é—Ü–µ–Ω—Ç–Ω–∞—è –ø–ª–µ–Ω–∫–∞
                            faceMat.roughness = 0.7;
                            faceMat.metalness = 0.05;
                        } else {
                            // –ì–ª—è–Ω—Ü–µ–≤—ã–π —Ü–≤–µ—Ç–Ω–æ–π –∞–∫—Ä–∏–ª
                            faceMat.roughness = 0.2;
                            faceMat.metalness = 0.1;
                        }
                        
                        // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–∫—Ä–∏–ª–∞
                        if (hasBacklight) {
                            faceMat.emissive.setStyle(actualFaceColor);
                            faceMat.emissiveIntensity = 0.5;
                        } else {
                            faceMat.emissive.setHex(0x000000);
                            faceMat.emissiveIntensity = 0;
                        }
                    } else if (faceMaterial.type === 'pvc') {
                        faceMat.roughness = 0.8;
                        faceMat.metalness = 0.05;
                        faceMat.emissive.setHex(0x000000);
                        faceMat.emissiveIntensity = 0;
                    } else if (faceMaterial.type === 'composite') {
                        faceMat.roughness = 0.6;
                        faceMat.metalness = 0.15;
                        faceMat.emissive.setHex(0x000000);
                        faceMat.emissiveIntensity = 0;
                    }
                    
                    // –ë–æ—Ä—Ç (–±–æ–∫–æ–≤–∞—è —á–∞—Å—Ç—å)
                    if (sideMat) {
                        sideMat.color.setStyle(actualSideColor);
                        
                        if (sideMaterial.type === 'pvc') {
                            sideMat.roughness = 0.8;
                            sideMat.metalness = 0.05;
                        } else if (sideMaterial.type === 'composite') {
                            sideMat.roughness = 0.6;
                            sideMat.metalness = 0.15;
                        }
                    }
                }
            });
            
            updateWallAndShadows();
            updateCostCalculator();
            log('–ê–∫—Ç–∏–≤–Ω—ã–π SVG –æ–±–Ω–æ–≤–ª—ë–Ω', 'info');
        }
        
        // –û–±–Ω–æ–≤–∏—Ç—å UI —Å–ø–∏—Å–æ–∫ SVG
        function updateSVGList() {
            console.log('[DEBUG updateSVGList] === –ù–ê–ß–ê–õ–û ===');
            const listContainer = document.getElementById('svg-list');
            console.log('[DEBUG updateSVGList] listContainer:', listContainer);
            console.log('[DEBUG updateSVGList] svgGroups:', svgGroups);
            console.log('[DEBUG updateSVGList] svgGroups.length:', svgGroups.length);
            
            if (!listContainer) {
                console.error('[ERROR] svg-list —ç–ª–µ–º–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω!');
                return;
            }
            
            listContainer.innerHTML = '';
            console.log('[DEBUG updateSVGList] innerHTML –æ—á–∏—â–µ–Ω');
            
            console.log(`[DEBUG updateSVGList] –û–±–Ω–æ–≤–ª—è—é —Å–ø–∏—Å–æ–∫: ${svgGroups.length} –æ–±—ä–µ–∫—Ç–æ–≤`);
            
            svgGroups.forEach((svgObj, index) => {
                console.log(`[DEBUG updateSVGList] –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é –æ–±—ä–µ–∫—Ç ${index}:`, svgObj.name);
                const item = document.createElement('div');
                item.className = 'svg-list-item' + (index === activeSvgIndex ? ' active' : '');
                const isVisible = svgObj.visible !== false; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤–∏–¥–∏–º—ã–π
                const dimensionsVisible = svgObj.dimensionsVisible !== false; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Ä–∞–∑–º–µ—Ä—ã –ø–æ–∫–∞–∑–∞–Ω—ã
                item.innerHTML = `
                    <div class="svg-item-name">${svgObj.name}</div>
                    <div class="svg-item-actions">
                        <button onclick="window.toggleVisibility(${index})" class="btn-small" title="${isVisible ? '–°–∫—Ä—ã—Ç—å –æ–±—ä–µ–∫—Ç' : '–ü–æ–∫–∞–∑–∞—Ç—å –æ–±—ä–µ–∫—Ç'}">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                ${isVisible ? 
                                    '<path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle>' : 
                                    '<path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path><line x1="1" y1="1" x2="23" y2="23"></line>'
                                }
                            </svg>
                        </button>
                        <button onclick="window.toggleDimensions(${index})" class="btn-small" title="${dimensionsVisible ? '–°–∫—Ä—ã—Ç—å —Ä–∞–∑–º–µ—Ä—ã' : '–ü–æ–∫–∞–∑–∞—Ç—å —Ä–∞–∑–º–µ—Ä—ã'}">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                ${dimensionsVisible ? 
                                    '<line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="8" x2="3" y2="16"></line><line x1="21" y1="8" x2="21" y2="16"></line><line x1="8" y1="10" x2="8" y2="14"></line><line x1="12" y1="10" x2="12" y2="14"></line><line x1="16" y1="10" x2="16" y2="14"></line>' : 
                                    '<line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="8" x2="3" y2="16"></line><line x1="21" y1="8" x2="21" y2="16"></line><line x1="8" y1="10" x2="8" y2="14"></line><line x1="12" y1="10" x2="12" y2="14"></line><line x1="16" y1="10" x2="16" y2="14"></line><line x1="1" y1="1" x2="23" y2="23"></line>'
                                }
                            </svg>
                        </button>
                        <button onclick="window.duplicateSVG(${index})" class="btn-small" title="–î—É–±–ª–∏—Ä–æ–≤–∞—Ç—å">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                            </svg>
                        </button>
                        <button onclick="window.removeSVG(${index})" class="btn-small" title="–£–¥–∞–ª–∏—Ç—å">‚úï</button>
                    </div>
                `;
                // –ö–ª–∏–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –≤—ã–±–∏—Ä–∞–µ—Ç –æ–±—ä–µ–∫—Ç
                const nameEl = item.querySelector('.svg-item-name');
                if (nameEl) {
                    nameEl.addEventListener('click', () => window.selectSVG(index));
                    nameEl.style.cursor = 'pointer';
                }
                listContainer.appendChild(item);
                console.log(`[DEBUG updateSVGList] –≠–ª–µ–º–µ–Ω—Ç ${index} –¥–æ–±–∞–≤–ª–µ–Ω –≤ DOM`);
            });
            
            console.log('[DEBUG updateSVGList] === –ö–û–ù–ï–¶ ===');
        }
        
        // === –†–ê–ó–ú–ï–†–ù–´–ï –õ–ò–ù–ò–ò –í 3D ===
        
        function createDimensionLines(width3d, height3d, widthMm, heightMm) {
            // –°–æ–∑–¥–∞—ë–º –ù–û–í–£–Æ –≥—Ä—É–ø–ø—É —Ä–∞–∑–º–µ—Ä–Ω—ã—Ö –ª–∏–Ω–∏–π (–Ω–µ –≥–ª–æ–±–∞–ª—å–Ω—É—é)
            const dimensionGroup = new THREE.Group();
            
            const offsetH = 15.0; // –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π –æ—Ç—Å—Ç—É–ø –¥–ª—è –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–π –ª–∏–Ω–∏–∏
            const offsetV = 25.0; // –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π –æ—Ç—Å—Ç—É–ø –¥–ª—è –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–π –ª–∏–Ω–∏–∏
            const arrowSize = 0.3; // –†–∞–∑–º–µ—Ä —Å—Ç—Ä–µ–ª–æ–∫
            const lineColor = 0xFFD100; // –ñ–µ–ª—Ç—ã–π (Oracal 021) –¥–ª—è –ª–∏–Ω–∏–π
            const textColor = 0xFFFFFF; // –ß–∏—Å—Ç–æ –±–µ–ª—ã–π –¥–ª—è —Ü–∏—Ñ—Ä (—á—Ç–æ–±—ã –Ω–µ —Ç–µ—Ä—è–ª–∏—Å—å –Ω–∞ —Å—Ç–µ–Ω–µ)
            // –†–∞–∑–º–µ—Ä —Ç–µ–∫—Å—Ç–∞: –º–∏–Ω–∏–º—É–º 15, –º–∞–∫—Å–∏–º—É–º 75 –µ–¥–∏–Ω–∏—Ü, –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç 0.5
            const textSize = Math.min(Math.max(width3d * 0.5, 15), 75);
            
            const lineMaterial = new THREE.LineBasicMaterial({ color: lineColor, linewidth: 2 });
            
            // === –ì–û–†–ò–ó–û–ù–¢–ê–õ–¨–ù–ê–Ø –†–ê–ó–ú–ï–†–ù–ê–Ø –õ–ò–ù–ò–Ø (—à–∏—Ä–∏–Ω–∞) ===
            const hY = -(height3d / 2 + offsetH);
            
            // –û—Å–Ω–æ–≤–Ω–∞—è –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è –ª–∏–Ω–∏—è
            const hLineGeo = new THREE.BufferGeometry().setFromPoints([
                new THREE.Vector3(-width3d / 2, hY, 0),
                new THREE.Vector3(width3d / 2, hY, 0)
            ]);
            const hLine = new THREE.Line(hLineGeo, lineMaterial);
            dimensionGroup.add(hLine);
            
            // –°—Ç—Ä–µ–ª–∫–∏ –Ω–∞ –∫–æ–Ω—Ü–∞—Ö
            const hArrowLeft = createArrow(new THREE.Vector3(-width3d / 2, hY, 0), 'right', arrowSize, lineColor);
            const hArrowRight = createArrow(new THREE.Vector3(width3d / 2, hY, 0), 'left', arrowSize, lineColor);
            dimensionGroup.add(hArrowLeft, hArrowRight);
            
            // –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ —à—Ç—Ä–∏—Ö–∏
            const vTickGeo1 = new THREE.BufferGeometry().setFromPoints([
                new THREE.Vector3(-width3d / 2, hY - 0.3, 0),
                new THREE.Vector3(-width3d / 2, hY + 0.3, 0)
            ]);
            const vTickGeo2 = new THREE.BufferGeometry().setFromPoints([
                new THREE.Vector3(width3d / 2, hY - 0.3, 0),
                new THREE.Vector3(width3d / 2, hY + 0.3, 0)
            ]);
            dimensionGroup.add(new THREE.Line(vTickGeo1, lineMaterial));
            dimensionGroup.add(new THREE.Line(vTickGeo2, lineMaterial));
            
            // –¢–µ–∫—Å—Ç —Å —Ä–∞–∑–º–µ—Ä–æ–º (—Å—Ç–æ–∏—Ç –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ, –æ–±—Ä–∞—â—ë–Ω –∫ –∫–∞–º–µ—Ä–µ)
            const hText = createTextSprite(`${widthMm.toFixed(0)} –º–º`, textColor, textSize);
            hText.position.set(0, hY - 20, 0); // –°–º–µ—â–∞–µ–º –≤–Ω–∏–∑ –æ—Ç –ª–∏–Ω–∏–∏
            // –ë–µ–∑ –ø–æ–≤–æ—Ä–æ—Ç–æ–≤ - —Ç–µ–∫—Å—Ç "—Å—Ç–æ–∏—Ç" –∏ –æ–±—Ä–∞—â—ë–Ω –∫ –∫–∞–º–µ—Ä–µ
            dimensionGroup.add(hText);
            
            // === –í–ï–†–¢–ò–ö–ê–õ–¨–ù–ê–Ø –†–ê–ó–ú–ï–†–ù–ê–Ø –õ–ò–ù–ò–Ø (–≤—ã—Å–æ—Ç–∞) ===
            const vX = -(width3d / 2 + offsetV); // –°–ª–µ–≤–∞ –æ—Ç –æ–±—ä–µ–∫—Ç–∞
            
            // –û—Å–Ω–æ–≤–Ω–∞—è –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞—è –ª–∏–Ω–∏—è
            const vLineGeo = new THREE.BufferGeometry().setFromPoints([
                new THREE.Vector3(vX, -height3d / 2, 0),
                new THREE.Vector3(vX, height3d / 2, 0)
            ]);
            const vLine = new THREE.Line(vLineGeo, lineMaterial);
            dimensionGroup.add(vLine);
            
            // –°—Ç—Ä–µ–ª–∫–∏ –Ω–∞ –∫–æ–Ω—Ü–∞—Ö
            const vArrowBottom = createArrow(new THREE.Vector3(vX, -height3d / 2, 0), 'up', arrowSize, lineColor);
            const vArrowTop = createArrow(new THREE.Vector3(vX, height3d / 2, 0), 'down', arrowSize, lineColor);
            dimensionGroup.add(vArrowBottom, vArrowTop);
            
            // –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ —à—Ç—Ä–∏—Ö–∏
            const hTickGeo1 = new THREE.BufferGeometry().setFromPoints([
                new THREE.Vector3(vX - 0.3, -height3d / 2, 0),
                new THREE.Vector3(vX + 0.3, -height3d / 2, 0)
            ]);
            const hTickGeo2 = new THREE.BufferGeometry().setFromPoints([
                new THREE.Vector3(vX - 0.3, height3d / 2, 0),
                new THREE.Vector3(vX + 0.3, height3d / 2, 0)
            ]);
            dimensionGroup.add(new THREE.Line(hTickGeo1, lineMaterial));
            dimensionGroup.add(new THREE.Line(hTickGeo2, lineMaterial));
            
            // –¢–µ–∫—Å—Ç —Å —Ä–∞–∑–º–µ—Ä–æ–º (—Ü–∏—Ñ—Ä—ã —Ä–∞—Å–ø–æ–ª–∞–≥–∞—é—Ç—Å—è –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ, –æ–±—Ä–∞—â—ë–Ω –∫ –∫–∞–º–µ—Ä–µ)
            const vText = createTextSprite(`${heightMm.toFixed(0)} –º–º`, textColor, textSize);
            // –û—Ç–æ–¥–≤–∏–≥–∞–µ–º –õ–ï–í–ï–ï (–Ω–∞ -40), —á—Ç–æ–±—ã –ø–æ–¥–ª–æ–∂–∫–∞ —Ç–µ–∫—Å—Ç–∞ –Ω–µ –Ω–∞–µ–∑–∂–∞–ª–∞ –Ω–∞ –ª–∏–Ω–∏—é
            vText.position.set(vX - 40, 0, 0);
            // –ë–µ–∑ –ø–æ–≤–æ—Ä–æ—Ç–æ–≤ - —Ç–µ–∫—Å—Ç —á–∏—Ç–∞–µ—Ç—Å—è –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ –∏ –æ–±—Ä–∞—â—ë–Ω –∫ –∫–∞–º–µ—Ä–µ
            dimensionGroup.add(vText);
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≤ —Å—Ü–µ–Ω—É –∏ –í–û–ó–í–†–ê–©–ê–ï–ú –≥—Ä—É–ø–ø—É
            scene.add(dimensionGroup);
            return dimensionGroup;
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–Ω—ã—Ö –ª–∏–Ω–∏–π –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞
        function updateDimensionLines() {
            if (activeSvgIndex === null || !svgGroups[activeSvgIndex]) return;
            
            const svgObj = svgGroups[activeSvgIndex];
            
            // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ —Ä–∞–∑–º–µ—Ä–Ω—ã–µ –ª–∏–Ω–∏–∏
            if (svgObj.dimensionGroup) {
                scene.remove(svgObj.dimensionGroup);
                svgObj.dimensionGroup.traverse((child) => {
                    if (child.geometry) child.geometry.dispose();
                    if (child.material) child.material.dispose();
                });
            }
            
            // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–π –º–∞—Å—à—Ç–∞–±
            const scaleX = svgObj.group.scale.x;
            const scaleY = svgObj.group.scale.y;
            
            // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–µ —Ä–∞–∑–º–µ—Ä–Ω—ã–µ –ª–∏–Ω–∏–∏ —Å —É—á–µ—Ç–æ–º –º–∞—Å—à—Ç–∞–±–∞
            const currentWidthMm = svgObj.currentWidth || svgObj.realWidth;
            const currentHeightMm = svgObj.currentHeight || svgObj.realHeight;
            const width3d = svgObj.svgWidth * scaleX;
            const height3d = svgObj.svgHeight * scaleY;
            
            svgObj.dimensionGroup = createDimensionLines(
                width3d,
                height3d,
                currentWidthMm,
                currentHeightMm
            );
            
            // –ü–µ—Ä–µ–Ω–æ—Å–∏–º —Ä–∞–∑–º–µ—Ä–Ω—ã–µ –ª–∏–Ω–∏–∏ –≤ –ø–æ–∑–∏—Ü–∏—é –æ–±—ä–µ–∫—Ç–∞
            if (svgObj.dimensionGroup) {
                svgObj.dimensionGroup.position.copy(svgObj.group.position);
                
                // –£–ø—Ä–∞–≤–ª—è–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å—é
                svgObj.dimensionGroup.visible = svgObj.dimensionsVisible !== false;
            }
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä–µ–ª–∫–∏
        function createArrow(position, direction, size, color) {
            const arrowGeo = new THREE.BufferGeometry();
            const vertices = [];
            
            if (direction === 'right') {
                vertices.push(
                    position.x, position.y, position.z,
                    position.x + size, position.y + size / 2, position.z,
                    position.x, position.y, position.z,
                    position.x + size, position.y - size / 2, position.z
                );
            } else if (direction === 'left') {
                vertices.push(
                    position.x, position.y, position.z,
                    position.x - size, position.y + size / 2, position.z,
                    position.x, position.y, position.z,
                    position.x - size, position.y - size / 2, position.z
                );
            } else if (direction === 'up') {
                vertices.push(
                    position.x, position.y, position.z,
                    position.x + size / 2, position.y + size, position.z,
                    position.x, position.y, position.z,
                    position.x - size / 2, position.y + size, position.z
                );
            } else if (direction === 'down') {
                vertices.push(
                    position.x, position.y, position.z,
                    position.x + size / 2, position.y - size, position.z,
                    position.x, position.y, position.z,
                    position.x - size / 2, position.y - size, position.z
                );
            }
            
            arrowGeo.setAttribute('position', new THREE.Float32BufferAttribute(vertices, 3));
            return new THREE.LineSegments(arrowGeo, new THREE.LineBasicMaterial({ color: color }));
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–æ—Å–∫–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ (–ª–µ–∂–∏—Ç –≤ –ø–ª–æ—Å–∫–æ—Å—Ç–∏, –∫–∞–∫ –Ω–∞–¥–ø–∏—Å—å –Ω–∞ –¥–æ—Ä–æ–≥–µ)
        function createTextSprite(text, color, size) {
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            canvas.width = 1024;
            canvas.height = 256;
            
            // –ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω
            context.clearRect(0, 0, canvas.width, canvas.height);
            
            // --- –†–ò–°–£–ï–ú –ü–û–î–õ–û–ñ–ö–£ ---
            context.font = 'Bold 120px Arial';
            const textMetrics = context.measureText(text);
            const textWidth = textMetrics.width;
            const padding = 40;
            const rectW = textWidth + padding * 2;
            const rectH = 160;
            const rectX = (canvas.width - rectW) / 2;
            const rectY = (canvas.height - rectH) / 2;

            context.fillStyle = 'rgba(0, 0, 0, 0.75)'; // –¢–µ–º–Ω–∞—è –∫–æ–Ω—Ç—Ä–∞—Å—Ç–Ω–∞—è –ø–æ–¥–ª–æ–∂–∫–∞ –¥–ª—è –ª—É—á—à–µ–π —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏
            if (context.roundRect) {
                context.beginPath();
                context.roundRect(rectX, rectY, rectW, rectH, 20);
                context.fill();
            } else {
                context.fillRect(rectX, rectY, rectW, rectH);
            }
            
            // --- –†–ò–°–£–ï–ú –¢–ï–ö–°–¢ ---
            context.fillStyle = typeof color === 'string' ? color : '#' + color.toString(16).padStart(6, '0');
            context.font = 'Bold 120px Arial';
            context.textAlign = 'center';
            context.textBaseline = 'middle';
            context.fillText(text, canvas.width / 2, canvas.height / 2);
            
            const texture = new THREE.CanvasTexture(canvas);
            texture.needsUpdate = true;
            
            // –°–æ–∑–¥–∞—ë–º –ø–ª–æ—Å–∫–∏–π plane –≤–º–µ—Å—Ç–æ sprite (—Ä–∞–∑–º–µ—Ä –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —à–∏—Ä–∏–Ω—ã —Å–ª–æ–≤–∞)
            const planeWidth = size;
            const planeHeight = size * 0.25; // –ü—Ä–æ–ø–æ—Ä—Ü–∏—è 4:1
            const geometry = new THREE.PlaneGeometry(planeWidth, planeHeight);
            const material = new THREE.MeshBasicMaterial({ 
                map: texture, 
                transparent: true,
                opacity: 0.85, // –ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å 85% –¥–ª—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏
                side: THREE.DoubleSide,
                depthWrite: false
            });
            const plane = new THREE.Mesh(geometry, material);
            
            return plane;
        }
        
        // === –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò UI ===
        document.addEventListener('DOMContentLoaded', () => {
            // === –ü–†–û–í–ï–†–ö–ê –ó–ê–ì–†–£–ó–ö–ò –ü–†–ê–ô–°–ê ===
            if (typeof PRICES_DATA === 'undefined') {
                console.error('‚ùå PRICES_DATA –ù–ï –ó–ê–ì–†–£–ñ–ï–ù! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π–ª prices.js –≤ —Ç–æ–π –∂–µ –ø–∞–ø–∫–µ —á—Ç–æ –∏ HTML');
                alert('‚ö†Ô∏è –û–®–ò–ë–ö–ê: –§–∞–π–ª prices.js –Ω–µ –Ω–∞–π–¥–µ–Ω!\n\n–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Ñ–∞–π–ª prices.js –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ç–æ–π –∂–µ –ø–∞–ø–∫–µ —á—Ç–æ –∏ HTML —Ñ–∞–π–ª.');
            } else {
                console.log('‚úÖ PRICES_DATA –∑–∞–≥—Ä—É–∂–µ–Ω —É—Å–ø–µ—à–Ω–æ:', Object.keys(PRICES_DATA));
            }
            
            // SVG Upload
            const uploadZone = document.getElementById('upload-zone');
            const fileInput = document.getElementById('svg-upload');
            
            fileInput.addEventListener('change', (e) => {
                if (e.target.files[0]) handleSVGUpload(e.target.files[0]);
            });
            
            // Drag & Drop
            uploadZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadZone.style.borderColor = '#FFD100';
            });
            uploadZone.addEventListener('dragleave', () => {
                uploadZone.style.borderColor = '';
            });
            uploadZone.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadZone.style.borderColor = '';
                if (e.dataTransfer.files[0]) handleSVGUpload(e.dataTransfer.files[0]);
            });
            
            // –ö–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
            document.querySelectorAll('input[name="construction"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    state.construction = e.target.value;
                    
                    // –°–∫—Ä—ã–≤–∞–µ–º/–ø–æ–∫–∞–∑—ã–≤–∞–µ–º –±–æ—Ä—Ç (–û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø –õ–û–ì–ò–ö–ê)
                    const isVolumetric = state.construction === 'volumetric';
                    const sideToggle = document.querySelector('[data-section="side-content"]');
                    const sideContent = document.getElementById('side-content');
                    if (sideToggle && sideContent) {
                        if (isVolumetric) {
                            sideToggle.style.display = 'block';
                            sideContent.style.display = 'block';
                            if (sideContent.classList.contains('collapsed')) {
                                sideToggle.classList.remove('collapsed');
                                sideContent.classList.remove('collapsed');
                            }
                        } else {
                            sideToggle.style.display = 'none';
                            sideContent.style.display = 'none';
                        }
                    }
                    
                    // –ë–ª–æ–∫–∏—Ä—É–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É –¥–ª—è –ø–ª–æ—Å–∫–∏—Ö
                    const backlightCheckbox = document.getElementById('option-backlight');
                    if (backlightCheckbox) {
                        if (!isVolumetric) {
                            state.hasBacklight = false;
                            backlightCheckbox.checked = false;
                            backlightCheckbox.disabled = true;
                        } else {
                            backlightCheckbox.disabled = false;
                        }
                    }
                    
                    update3DLetter();
                    log(`–ö–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: ${state.construction}`, 'info');
                });
            });
            
            // –ü–æ–¥—Å–≤–µ—Ç–∫–∞
            document.getElementById('option-backlight').addEventListener('change', (e) => {
                state.hasBacklight = e.target.checked;
                
                if (state.hasBacklight && state.construction === 'flat') {
                    alert('–ü–æ–¥—Å–≤–µ—Ç–∫–∞ –≤–æ–∑–º–æ–∂–Ω–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è –æ–±—ä—ë–º–Ω—ã—Ö –±—É–∫–≤!');
                    e.target.checked = false;
                    state.hasBacklight = false;
                    return;
                }
                
                update3DLetter();
                log(`–ü–æ–¥—Å–≤–µ—Ç–∫–∞: ${state.hasBacklight ? '–í–ö–õ' : '–í–´–ö–õ'}`, 'info');
            });
            
            // –ö–æ–Ω—Ç—Ä–∞–∂—É—Ä
            document.getElementById('option-contour').addEventListener('change', (e) => {
                state.hasContour = e.target.checked;
                
                updateWallAndShadows(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–µ–Ω—É –∏ –ø–æ–¥—Å–≤–µ—Ç–∫—É
                log(`–ö–æ–Ω—Ç—Ä–∞–∂—É—Ä: ${state.hasContour ? '–í–ö–õ' : '–í–´–ö–õ'}`, 'info');
            });
            
            // –î–∏—Å—Ç–∞–Ω—Ü–∏–æ–Ω–∫–∏
            document.getElementById('option-spacers').addEventListener('change', (e) => {
                state.hasSpacers = e.target.checked;
                updateWallAndShadows(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–µ–Ω—É –∏ —Ç–µ–Ω–∏
                log(`–î–∏—Å—Ç–∞–Ω—Ü–∏–æ–Ω–∫–∏: ${state.hasSpacers ? '–í–ö–õ' : '–í–´–ö–õ'}`, 'info');
            });
            
            // –ö–∞—Ä–∫–∞—Å
            document.getElementById('frame-type').addEventListener('change', (e) => {
                state.frameType = e.target.value;
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –æ–ø—Ü–∏–∏
                const frame3dGroup = document.getElementById('frame-3d-group');
                
                const isSelected = e.target.value !== 'none';
                frame3dGroup.style.display = isSelected ? 'block' : 'none';
                const frameColorGroup = document.getElementById('frame-color-group');
                if (frameColorGroup) frameColorGroup.style.display = isSelected ? 'block' : 'none';
                
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø—Ä–∏ –≤—ã–±–æ—Ä–µ "–ë–µ–∑ –∫–∞—Ä–∫–∞—Å–∞"
                if (!isSelected) {
                    state.frameColor = '#FFFFFF';
                }
                
                updateCostCalculator();
                log(`–ö–∞—Ä–∫–∞—Å: ${state.frameType}`, 'info');
            });
            
            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ü–≤–µ—Ç–∞ –∫–∞—Ä–∫–∞—Å–∞
            window.setFrameColor = function(color) {
                state.frameColor = color;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Ü–≤–µ—Ç –≤—Å–µ—Ö —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø—Ä–æ—Ñ–∏–ª–µ–π
                const frameColorHex = color.replace('#', '0x');
                const frameColorNum = parseInt(frameColorHex, 16);
                
                frameProfiles.forEach(prof => {
                    if (prof.material) {
                        prof.material.color.setHex(frameColorNum);
                    }
                });
                
                updateCostCalculator();
                log(`–¶–≤–µ—Ç –∫–∞—Ä–∫–∞—Å–∞: ${color}`, 'info');
            };
            
            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ü–≤–µ—Ç–∞ –æ—Å–Ω–æ–≤—ã
            window.setBaseColor = function(color) {
                state.baseColor = color;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Ü–≤–µ—Ç —Ç–æ–ª—å–∫–æ –ê–ö–¢–ò–í–ù–û–ô –æ—Å–Ω–æ–≤—ã
                if (activeBaseIndex !== null && bases[activeBaseIndex]) {
                    const base = bases[activeBaseIndex];
                    const baseColorHex = color.replace('#', '0x');
                    const baseColorNum = parseInt(baseColorHex, 16);
                    
                    if (base.mesh) {
                        if (base.mesh.type === 'Group') {
                            // –î–ª—è Group (—Å –∑–∞–≥–∏–±–∞–º–∏) - –æ–±—Ö–æ–¥–∏–º –≤—Å–µ –¥–æ—á–µ—Ä–Ω–∏–µ mesh'—ã
                            base.mesh.children.forEach(child => {
                                if (child.material) {
                                    child.material.color.setHex(baseColorNum);
                                }
                            });
                        } else if (base.mesh.material) {
                            // –î–ª—è –ø—Ä–æ—Å—Ç–æ–≥–æ Mesh
                            base.mesh.material.color.setHex(baseColorNum);
                        }
                    }
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ü–≤–µ—Ç –≤ –¥–∞–Ω–Ω—ã—Ö –∞–∫—Ç–∏–≤–Ω–æ–π –æ—Å–Ω–æ–≤—ã
                    base.color = color;
                    
                    log(`–¶–≤–µ—Ç –æ—Å–Ω–æ–≤—ã #${activeBaseIndex + 1}: ${color}`, 'info');
                } else {
                    log(`–¶–≤–µ—Ç –æ—Å–Ω–æ–≤—ã (–¥–ª—è –Ω–æ–≤–æ–π): ${color}`, 'info');
                }
                
                updateCostCalculator();
            };
            
            // –§—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–∞—Ä–∫–∞—Å–æ–º –æ—Å–Ω–æ–≤—ã
            window.toggleBaseFrame = function() {
                const checkbox = document.getElementById('base-frame-checkbox');
                const options = document.getElementById('base-frame-options');
                
                state.hasBaseFrame = checkbox.checked;
                options.style.display = checkbox.checked ? 'block' : 'none';
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –æ—Å–Ω–æ–≤—É (–µ—Å–ª–∏ –µ—Å—Ç—å)
                if (activeBaseIndex !== null && bases[activeBaseIndex]) {
                    bases[activeBaseIndex].hasFrame = checkbox.checked;
                    bases[activeBaseIndex].frameProfile = state.baseFrameProfile;
                    bases[activeBaseIndex].frameColor = state.baseFrameColor;
                    updateActiveBaseGeometry();
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é –±—É–∫–≤ –∏ —Ç–µ–Ω–µ–π (–æ–Ω–∏ –∑–∞–≤–∏—Å—è—Ç –æ—Ç –≥–ª—É–±–∏–Ω—ã –∫–∞—Ä–∫–∞—Å–∞!)
                updateWallAndShadows();
                updateCostCalculator();
                
                log(`–ö–∞—Ä–∫–∞—Å –æ—Å–Ω–æ–≤—ã: ${checkbox.checked ? '–í–ö–õ' : '–í–´–ö–õ'}`, 'info');
            };
            
            window.updateBaseFrameProfile = function() {
                const select = document.getElementById('base-frame-profile');
                state.baseFrameProfile = select.value;
                
                if (activeBaseIndex !== null && bases[activeBaseIndex]) {
                    bases[activeBaseIndex].frameProfile = select.value;
                    updateActiveBaseGeometry();
                }
                
                updateWallAndShadows();
                updateCostCalculator();
                
                log(`–ü—Ä–æ—Ñ–∏–ª—å –∫–∞—Ä–∫–∞—Å–∞: ${select.value}`, 'info');
            };
            
            window.setBaseFrameColor = function(color) {
                state.baseFrameColor = color;
                
                if (activeBaseIndex !== null && bases[activeBaseIndex]) {
                    bases[activeBaseIndex].frameColor = color;
                    updateActiveBaseGeometry();
                }
                
                updateCostCalculator();
                log(`–¶–≤–µ—Ç –∫–∞—Ä–∫–∞—Å–∞ –æ—Å–Ω–æ–≤—ã: ${color}`, 'info');
            };
            
            // –û—Å–Ω–æ–≤–∞
            document.getElementById('base-material-type').addEventListener('change', (e) => {
                state.baseMaterial = e.target.value;
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –æ–ø—Ü–∏–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª–∞
                const cornerGroup = document.getElementById('base-corner-group');
                const sizeGroup = document.getElementById('base-size-group');
                const colorGroup = document.getElementById('base-color-group');
                const sizeColorWrapper = document.getElementById('base-size-color-wrapper');
                const frameGroup = document.getElementById('base-frame-group');
                const baseGroup = document.getElementById('base-3d-group');
                
                const isComposite = e.target.value.startsWith('composite');
                const isPvcOrPoly = e.target.value.startsWith('pvc') || e.target.value.startsWith('polycarbonate');
                const hasBase = e.target.value !== 'none';
                
                cornerGroup.style.display = isPvcOrPoly ? 'block' : 'none';
                sizeGroup.style.display = hasBase ? 'block' : 'none';
                colorGroup.style.display = hasBase ? 'block' : 'none';
                if (sizeColorWrapper) sizeColorWrapper.style.display = hasBase ? 'flex' : 'none';
                frameGroup.style.display = hasBase ? 'block' : 'none';
                baseGroup.style.display = hasBase ? 'block' : 'none';
                
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –æ–ø—Ü–∏–∏ –ø—Ä–∏ —Å–º–µ–Ω–µ –º–∞—Ç–µ—Ä–∏–∞–ª–∞
                if (!isComposite) {
                    state.baseBend = 0;
                }
                if (!isPvcOrPoly) state.baseCorner = 'none';
                if (!hasBase) state.baseColor = '#FFFFFF';
                
                updateCostCalculator();
                log(`–û—Å–Ω–æ–≤–∞: ${state.baseMaterial}`, 'info');
            });
            
            window.updateBaseCorner = function(cornerType) {
                state.baseCorner = cornerType;
                updateCostCalculator();
                log(`–£–≥–æ–ª–æ–∫: ${cornerType}`, 'info');
            };
            
            // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏–π –ø–æ–ª–µ–π –≤–≤–æ–¥–∞ —Ä–∞–∑–º–µ—Ä–æ–≤ –æ—Å–Ω–æ–≤—ã
            window.updateBaseSizeInputs = function() {
                const widthInput = document.getElementById('base-width');
                const heightInput = document.getElementById('base-height');
                
                if (widthInput && heightInput) {
                    state.baseWidth = parseFloat(widthInput.value) || 1000;
                    state.baseHeight = parseFloat(heightInput.value) || 1000;
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –æ—Å–Ω–æ–≤—É –µ—Å–ª–∏ –æ–Ω–∞ –≤—ã–±—Ä–∞–Ω–∞
                if (activeBaseIndex !== null && bases[activeBaseIndex]) {
                    updateActiveBaseSize();
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä—ã —Å –∑–∞–≥–∏–±–æ–º
                if (state.baseMaterial && state.baseMaterial.startsWith('composite')) {
                    checkBaseSizeWithBend();
                }
                
                updateCostCalculator();
            };
            
            // –§—É–Ω–∫—Ü–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è —à–∏—Ä–∏–Ω—ã –∫–Ω–æ–ø–∫–∞–º–∏ +/-
            window.changeBaseWidth = function(delta) {
                const input = document.getElementById('base-width');
                if (!input) return;
                
                const currentValue = parseInt(input.value) || 1000;
                const newValue = Math.max(100, Math.min(10000, currentValue + delta));
                input.value = newValue;
                updateBaseSizeInputs();
            };
            
            // –§—É–Ω–∫—Ü–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤—ã—Å–æ—Ç—ã –∫–Ω–æ–ø–∫–∞–º–∏ +/-
            window.changeBaseHeight = function(delta) {
                const input = document.getElementById('base-height');
                if (!input) return;
                
                const currentValue = parseInt(input.value) || 1000;
                const newValue = Math.max(100, Math.min(10000, currentValue + delta));
                input.value = newValue;
                updateBaseSizeInputs();
            };
            
            
            // –ú–∞—Ç–µ—Ä–∏–∞–ª –ª–∏—Ü–∞
            document.getElementById('face-material-type').addEventListener('change', (e) => {
                const value = e.target.value;
                const parts = value.split('-');
                let type, thickness, color;
                
                if (parts[0] === 'acrylic') {
                    // –î–ª—è –∞–∫—Ä–∏–ª–∞: acrylic-3-milk -> type=acrylic, thickness=3, color=milk
                    type = parts[0];
                    thickness = parseInt(parts[1]);
                    color = parts[2];
                } else {
                    // –î–ª—è –ü–í–•/–∫–æ–º–ø–æ–∑–∏—Ç: pvc-4 -> type=pvc, thickness=4
                    type = parts[0];
                    thickness = parseInt(parts[1]);
                }
                
                state.faceMaterial = { type, thickness, color };
                
                // –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω –Ω–µ –∞–∫—Ä–∏–ª –∏ –ø–æ–¥—Å–≤–µ—Ç–∫–∞ –≤–∫–ª—é—á–µ–Ω–∞ - –æ—Ç–∫–ª—é—á–∞–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É
                if (type !== 'acrylic' && state.hasBacklight) {
                    state.hasBacklight = false;
                    document.getElementById('option-backlight').checked = false;
                    const backlightBtn = document.getElementById('btn-backlight');
                    if (backlightBtn) backlightBtn.classList.remove('active');
                    log('–ü–æ–¥—Å–≤–µ—Ç–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∞ (–≤—ã–±—Ä–∞–Ω –Ω–µ –∞–∫—Ä–∏–ª)', 'warning');
                }
                
                // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ –ø–∞–ª–∏—Ç—Ä—ã —Ü–≤–µ—Ç–æ–≤ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª–∞
                updateColorPalette(type, color);
                
                update3DLetter();
                log(`–ú–∞—Ç–µ—Ä–∏–∞–ª –ª–∏—Ü–∞: ${type} ${thickness}–º–º ${color || ''}`, 'info');
            });
            
            // –¶–≤–µ—Ç –ª–∏—Ü–∞
            const faceColorSelect = document.getElementById('face-color');
            faceColorSelect.addEventListener('change', (e) => {
                const newColor = e.target.value;
                state.faceColor = newColor; // –û–±–Ω–æ–≤–ª—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–π state
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Ü–≤–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–≥–æ SVG
                if (activeSvgIndex !== null && svgGroups[activeSvgIndex]) {
                    svgGroups[activeSvgIndex].color = newColor;
                    updateActiveSVG();
                    log(`–¶–≤–µ—Ç "${svgGroups[activeSvgIndex].name}": ${newColor}`, 'info');
                } else {
                    log(`–¶–≤–µ—Ç (–≥–ª–æ–±–∞–ª—å–Ω—ã–π): ${newColor}`, 'info');
                }
            });
            
            // –ú–∞—Ç–µ—Ä–∏–∞–ª –±–æ—Ä—Ç–∞
            document.getElementById('side-material-type').addEventListener('change', (e) => {
                const [type, thickness] = e.target.value.split('-');
                state.sideMaterial = { type, thickness: parseInt(thickness) };
                
                // –î–ª—è –∞–ª—é–º–∏–Ω–∏—è —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã—Å–æ—Ç—É –±–æ—Ä—Ç–∞ –ø–æ —Ä–∞–∑–º–µ—Ä—É –ø—Ä–æ—Ñ–∏–ª—è
                if (type === 'aluminum') {
                    const bortHeight = parseInt(thickness) * 10; // 4 -> 40–º–º, 6 -> 60–º–º, 8 -> 80–º–º, 10 -> 100–º–º
                    state.bortHeight = bortHeight;
                    document.getElementById('bort-height').value = bortHeight;
                    document.getElementById('bort-height-display').value = bortHeight;
                }
                
                // –î–ª—è –∞–ª—é–º–∏–Ω–∏—è —Å–∫—Ä—ã–≤–∞–µ–º –ø–æ–ª–µ "–¢–æ–ª—â–∏–Ω–∞ –±–æ—Ä—Ç–∞" (—Ä–∞–∑–º–µ—Ä —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π)
                const bortHeightGroup = document.querySelector('#side-section .field-group:last-child');
                if (bortHeightGroup) {
                    if (type === 'aluminum') {
                        bortHeightGroup.style.display = 'none';
                    } else {
                        bortHeightGroup.style.display = 'block';
                    }
                }
                
                update3DLetter();
                log(`–ú–∞—Ç–µ—Ä–∏–∞–ª –±–æ—Ä—Ç–∞: ${type} ${thickness}${type === 'aluminum' ? '—Å–º' : '–º–º'}, –≤—ã—Å–æ—Ç–∞ –±–æ—Ä—Ç–∞: ${state.bortHeight}–º–º`, 'info');
            });
            
            // –¶–≤–µ—Ç –±–æ—Ä—Ç–∞ —Ç–µ–ø–µ—Ä—å —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ –∫–∞—Ä—É—Å–µ–ª—å (—Å–º. setSideColor)
            
            // –í—ã—Å–æ—Ç–∞ –±–æ—Ä—Ç–∞ - —Ç–µ–ø–µ—Ä—å —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫–∏ +/-

            // –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Å—Ç–µ–Ω—ã (–ö–ù–û–ü–ö–ê)
            const toggleWallBtn = document.getElementById('toggle-wall');
            toggleWallBtn.addEventListener('click', () => {
                state.showWall = !state.showWall;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –≤–∏–∑—É–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–∫–∏
                if (state.showWall) {
                    toggleWallBtn.classList.add('active');
                } else {
                    toggleWallBtn.classList.remove('active');
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å —Å—Ç–µ–Ω—ã
                if (backWall) {
                    backWall.visible = state.showWall;
                }
                
                // –ï—Å–ª–∏ —É–±–∏—Ä–∞–µ–º —Å—Ç–µ–Ω—É, —Ç–µ–Ω–∏ —Ç–æ–∂–µ –¥–æ–ª–∂–Ω—ã –ø—Ä–æ–ø–∞—Å—Ç—å
                if (shadowClones) {
                    shadowClones.forEach(clone => clone.visible = state.showWall);
                }
                
                log(`–§–æ–Ω: ${state.showWall ? '–í–∫–ª—é—á–µ–Ω' : '–í—ã–∫–ª—é—á–µ–Ω'}`, 'info');
            });
            
            // === –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –°–û–•–†–ê–ù–ï–ù–ò–Ø ===
            const saveSceneBtn = document.getElementById('save-scene');
            const saveModal = document.getElementById('save-modal');
            const saveJpgBtn = document.getElementById('save-jpg');
            const savePdfBtn = document.getElementById('save-pdf');
            const saveSvgBtn = document.getElementById('save-svg');
            
            // –û—Ç–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
            saveSceneBtn.addEventListener('click', () => {
                saveModal.style.display = 'flex';
            });
            
            // –ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –∫–Ω–æ–ø–æ–∫
            document.addEventListener('click', (e) => {
                if (!e.target.closest('#save-scene') && 
                    !e.target.closest('#save-jpg') && 
                    !e.target.closest('#save-pdf') && 
                    !e.target.closest('#save-svg') &&
                    saveModal.style.display === 'flex') {
                    saveModal.style.display = 'none';
                }
            });
            
            // === –°–û–•–†–ê–ù–ï–ù–ò–ï JPG ===
            saveJpgBtn.addEventListener('click', async () => {
                saveModal.style.display = 'none';
                
                try {
                    renderer.render(scene, camera);
                    const timestamp = new Date().toISOString().slice(0, 19).replace(/:/g, '-');
                    const imgData = renderer.domElement.toDataURL('image/jpeg', 0.95);
                    
                    const jpgLink = document.createElement('a');
                    jpgLink.href = imgData;
                    jpgLink.download = `scene_${timestamp}.jpg`;
                    document.body.appendChild(jpgLink);
                    jpgLink.click();
                    document.body.removeChild(jpgLink);
                    
                    log(`üíæ –°—Ü–µ–Ω–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞: JPG`, 'success');
                } catch (error) {
                    log(`–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è JPG: ${error.message}`, 'error');
                }
            });
            
            // === –°–û–•–†–ê–ù–ï–ù–ò–ï PDF ===
            savePdfBtn.addEventListener('click', async () => {
                saveModal.style.display = 'none';
                
                try {
                    renderer.render(scene, camera);
                    const timestamp = new Date().toISOString().slice(0, 19).replace(/:/g, '-');
                    const imgData = renderer.domElement.toDataURL('image/jpeg', 0.95);
                    
                    if (typeof jspdf !== 'undefined') {
                        const { jsPDF } = jspdf;
                        
                        // –°–æ–∑–¥–∞–µ–º PDF –≤ –∞–ª—å–±–æ–º–Ω–æ–π –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏ A4
                        const pdf = new jsPDF('landscape', 'mm', 'a4');
                        const pdfWidth = pdf.internal.pageSize.getWidth();
                        const pdfHeight = pdf.internal.pageSize.getHeight();
                        
                        // –í—ã—á–∏—Å–ª—è–µ–º —Ä–∞–∑–º–µ—Ä—ã —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –ø—Ä–æ–ø–æ—Ä—Ü–∏–π
                        const canvasWidth = renderer.domElement.width;
                        const canvasHeight = renderer.domElement.height;
                        const ratio = canvasWidth / canvasHeight;
                        
                        let imgWidth = pdfWidth - 20; // –û—Ç—Å—Ç—É–ø—ã –ø–æ 10–º–º —Å –∫–∞–∂–¥–æ–π —Å—Ç–æ—Ä–æ–Ω—ã
                        let imgHeight = imgWidth / ratio;
                        
                        if (imgHeight > pdfHeight - 20) {
                            imgHeight = pdfHeight - 20;
                            imgWidth = imgHeight * ratio;
                        }
                        
                        const x = (pdfWidth - imgWidth) / 2;
                        const y = (pdfHeight - imgHeight) / 2;
                        
                        pdf.addImage(imgData, 'JPEG', x, y, imgWidth, imgHeight);
                        pdf.save(`scene_${timestamp}.pdf`);
                        
                        log(`üíæ –°—Ü–µ–Ω–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞: PDF`, 'success');
                    } else {
                        log(`‚ùå PDF –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞`, 'error');
                    }
                } catch (error) {
                    log(`–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è PDF: ${error.message}`, 'error');
                }
            });
            
            // === –°–û–•–†–ê–ù–ï–ù–ò–ï SVG (–í–°–Ø –ö–û–ú–ü–û–ó–ò–¶–ò–Ø) ===
            saveSvgBtn.addEventListener('click', async () => {
                saveModal.style.display = 'none';
                
                try {
                    if (svgGroups.length === 0) {
                        log('–ù–µ—Ç –æ–±—ä–µ–∫—Ç–æ–≤ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è', 'warning');
                        return;
                    }
                    
                    // –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º –≤—Å—é –∫–æ–º–ø–æ–∑–∏—Ü–∏—é
                    const svgContent = exportSceneToSVG();
                    
                    // –°–æ–∑–¥–∞—ë–º –∏ —Å–∫–∞—á–∏–≤–∞–µ–º —Ñ–∞–π–ª
                    const timestamp = new Date().toISOString().slice(0, 19).replace(/:/g, '-');
                    const blob = new Blob([svgContent], { type: 'image/svg+xml' });
                    const link = document.createElement('a');
                    link.href = URL.createObjectURL(blob);
                    link.download = `scene_${timestamp}.svg`;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    URL.revokeObjectURL(link.href);
                    
                    log(`üíæ –ö–æ–º–ø–æ–∑–∏—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞: SVG (${svgGroups.length} –æ–±—ä–µ–∫—Ç–æ–≤)`, 'success');
                } catch (error) {
                    log(`–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è SVG: ${error.message}`, 'error');
                }
            });
            
            // === –ö–ù–û–ü–ö–ê –ü–û–î–ï–õ–ò–¢–¨–°–Ø ===
            const shareSceneBtn = document.getElementById('share-scene');
            const shareModal = document.getElementById('share-modal');
            
            // –û—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            shareSceneBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                shareModal.style.display = 'flex';
            });
            
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –ø—Ä–∏ –∫–ª–∏–∫–µ –≤ –õ–Æ–ë–û–ú –º–µ—Å—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–≤–∫–ª—é—á–∞—è 3D —Å—Ü–µ–Ω—É)
            document.addEventListener('click', (e) => {
                // –ï—Å–ª–∏ –æ–∫–Ω–æ –Ω–µ –æ—Ç–∫—Ä—ã—Ç–æ - –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º
                if (shareModal.style.display === 'none') return;
                
                // –ï—Å–ª–∏ –∫–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ –æ—Ç–∫—Ä—ã—Ç–∏—è - –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–µ–º (–æ–Ω–∞ —Ç–æ–ª—å–∫–æ —á—Ç–æ –æ—Ç–∫—Ä—ã–ª–∞)
                if (e.target.closest('#share-scene')) return;
                
                // –ï—Å–ª–∏ –∫–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–∞–º –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–æ–≤ - –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–µ–º (–æ–Ω–∏ —Å–∞–º–∏ –∑–∞–∫—Ä–æ—é—Ç –ø–æ—Å–ª–µ –¥–µ–π—Å—Ç–≤–∏—è)
                if (e.target.closest('#share-max') || 
                    e.target.closest('#share-whatsapp') || 
                    e.target.closest('#share-telegram')) {
                    return;
                }
                
                // –í –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Å–ª—É—á–∞—è—Ö - –∑–∞–∫—Ä—ã–≤–∞–µ–º
                shareModal.style.display = 'none';
            });
            
            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ü–µ–Ω—ã
            async function getSceneImage() {
                renderer.render(scene, camera);
                const imgData = renderer.domElement.toDataURL('image/png');
                
                // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º base64 –≤ Blob
                const response = await fetch(imgData);
                const blob = await response.blob();
                return new File([blob], 'scene.png', { type: 'image/png' });
            }
            
            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ —Ç–æ—Å—Ç-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
            function showToast(message) {
                // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Ç–æ—Å—Ç –µ—Å–ª–∏ –µ—Å—Ç—å
                const existingToast = document.getElementById('share-toast');
                if (existingToast) {
                    existingToast.remove();
                }
                
                const toast = document.createElement('div');
                toast.id = 'share-toast';
                toast.textContent = message;
                toast.style.cssText = `
                    position: fixed !important;
                    bottom: 40px !important;
                    left: 50% !important;
                    transform: translateX(-50%) !important;
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
                    color: white !important;
                    padding: 20px 32px !important;
                    border-radius: 14px !important;
                    font-size: 17px !important;
                    font-weight: 700 !important;
                    z-index: 99999 !important;
                    box-shadow: 0 10px 40px rgba(0,0,0,0.6) !important;
                    pointer-events: none !important;
                    white-space: nowrap !important;
                    opacity: 0 !important;
                    transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55) !important;
                `;
                document.body.appendChild(toast);
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏
                setTimeout(() => {
                    toast.style.opacity = '1';
                    toast.style.bottom = '60px';
                }, 50);
                
                // –°–∫—Ä—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ 4 —Å–µ–∫—É–Ω–¥—ã
                setTimeout(() => {
                    toast.style.opacity = '0';
                    toast.style.bottom = '20px';
                    setTimeout(() => toast.remove(), 400);
                }, 4000);
            }
            
            // MAX(!) - –∏—Å–ø–æ–ª—å–∑—É–µ–º —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —à–∞—Ä–∏–Ω–≥
            document.getElementById('share-max').addEventListener('click', async () => {
                try {
                    const file = await getSceneImage();
                    
                    if (navigator.share && navigator.canShare && navigator.canShare({ files: [file] })) {
                        // –ú–æ–±–∏–ª—å–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ - —Å–∏—Å—Ç–µ–º–Ω—ã–π —à–∞—Ä–∏–Ω–≥
                        await navigator.share({
                            title: '–î–∏–∑–∞–π–Ω –≤—ã–≤–µ—Å–∫–∏',
                            text: '–ü–æ—Å–º–æ—Ç—Ä–∏ –Ω–∞ –º–æ–π –¥–∏–∑–∞–π–Ω!',
                            files: [file]
                        });
                        log('‚úÖ –ü–æ–¥–µ–ª–∏–ª–∏—Å—å —á–µ—Ä–µ–∑ MAX(!)', 'success');
                    } else {
                        // –î–µ—Å–∫—Ç–æ–ø - –∫–æ–ø–∏—Ä—É–µ–º –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
                        if (navigator.clipboard && window.ClipboardItem) {
                            await navigator.clipboard.write([
                                new ClipboardItem({
                                    'image/png': file
                                })
                            ]);
                            
                            shareModal.style.display = 'none';
                            
                            // –û—Ç–∫—Ä—ã–≤–∞–µ–º –≤–µ–±-–≤–µ—Ä—Å–∏—é MAX
                            window.open('https://web.max.ru/', '_blank');
                            setTimeout(() => showToast('üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ! –ù–∞–∂–º–∏—Ç–µ Ctrl+V –≤ —á–∞—Ç–µ MAX'), 100);
                            log('üìã –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ! –û—Ç–∫—Ä–æ–π—Ç–µ —á–∞—Ç –≤ MAX Web –∏ –Ω–∞–∂–º–∏—Ç–µ Ctrl+V', 'success');
                        } else {
                            shareModal.style.display = 'none';
                            
                            // –°—Ç–∞—Ä—ã–π –±—Ä–∞—É–∑–µ—Ä - –ø—Ä–æ—Å—Ç–æ —Å–∫–∞—á–∏–≤–∞–µ–º
                            const imgData = renderer.domElement.toDataURL('image/png');
                            const link = document.createElement('a');
                            link.href = imgData;
                            link.download = 'scene_max.png';
                            link.click();
                            window.open('https://web.max.ru/', '_blank');
                            log('üíæ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–∫–∞—á–∞–Ω–æ. –û—Ç–∫—Ä–æ–π—Ç–µ MAX Web –∏ –ø—Ä–∏–∫—Ä–µ–ø–∏—Ç–µ —Ñ–∞–π–ª', 'info');
                        }
                    }
                } catch (error) {
                    log(`–û—à–∏–±–∫–∞: ${error.message}`, 'error');
                }
            });
            
            // WhatsApp
            document.getElementById('share-whatsapp').addEventListener('click', async () => {
                try {
                    const file = await getSceneImage();
                    
                    if (navigator.share && navigator.canShare && navigator.canShare({ files: [file] })) {
                        // –ú–æ–±–∏–ª—å–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ - —Å–∏—Å—Ç–µ–º–Ω—ã–π —à–∞—Ä–∏–Ω–≥
                        await navigator.share({
                            title: '–î–∏–∑–∞–π–Ω –≤—ã–≤–µ—Å–∫–∏',
                            text: '–ü–æ—Å–º–æ—Ç—Ä–∏ –Ω–∞ –º–æ–π –¥–∏–∑–∞–π–Ω!',
                            files: [file]
                        });
                        log('‚úÖ –ü–æ–¥–µ–ª–∏–ª–∏—Å—å —á–µ—Ä–µ–∑ WhatsApp', 'success');
                    } else {
                        // –î–µ—Å–∫—Ç–æ–ø - –∫–æ–ø–∏—Ä—É–µ–º –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
                        if (navigator.clipboard && window.ClipboardItem) {
                            await navigator.clipboard.write([
                                new ClipboardItem({
                                    'image/png': file
                                })
                            ]);
                            
                            shareModal.style.display = 'none';
                            
                            window.open('https://web.whatsapp.com/', '_blank');
                            setTimeout(() => showToast('üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ! –ù–∞–∂–º–∏—Ç–µ Ctrl+V –≤ —á–∞—Ç–µ WhatsApp'), 100);
                            log('üìã –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ! –û—Ç–∫—Ä–æ–π—Ç–µ —á–∞—Ç –≤ WhatsApp Web –∏ –Ω–∞–∂–º–∏—Ç–µ Ctrl+V', 'success');
                        } else {
                            shareModal.style.display = 'none';
                            
                            // –°—Ç–∞—Ä—ã–π –±—Ä–∞—É–∑–µ—Ä - –ø—Ä–æ—Å—Ç–æ —Å–∫–∞—á–∏–≤–∞–µ–º
                            const imgData = renderer.domElement.toDataURL('image/png');
                            const link = document.createElement('a');
                            link.href = imgData;
                            link.download = 'scene_whatsapp.png';
                            link.click();
                            window.open('https://web.whatsapp.com/', '_blank');
                            log('üíæ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–∫–∞—á–∞–Ω–æ. –û—Ç–∫—Ä–æ–π—Ç–µ WhatsApp Web –∏ –ø—Ä–∏–∫—Ä–µ–ø–∏—Ç–µ —Ñ–∞–π–ª', 'info');
                        }
                    }
                } catch (error) {
                    log(`–û—à–∏–±–∫–∞: ${error.message}`, 'error');
                }
            });
            
            // Telegram
            document.getElementById('share-telegram').addEventListener('click', async () => {
                try {
                    const file = await getSceneImage();
                    
                    if (navigator.share && navigator.canShare && navigator.canShare({ files: [file] })) {
                        // –ú–æ–±–∏–ª—å–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ - —Å–∏—Å—Ç–µ–º–Ω—ã–π —à–∞—Ä–∏–Ω–≥
                        await navigator.share({
                            title: '–î–∏–∑–∞–π–Ω –≤—ã–≤–µ—Å–∫–∏',
                            text: '–ü–æ—Å–º–æ—Ç—Ä–∏ –Ω–∞ –º–æ–π –¥–∏–∑–∞–π–Ω!',
                            files: [file]
                        });
                        log('‚úÖ –ü–æ–¥–µ–ª–∏–ª–∏—Å—å —á–µ—Ä–µ–∑ Telegram', 'success');
                    } else {
                        // –î–µ—Å–∫—Ç–æ–ø - –∫–æ–ø–∏—Ä—É–µ–º –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
                        if (navigator.clipboard && window.ClipboardItem) {
                            await navigator.clipboard.write([
                                new ClipboardItem({
                                    'image/png': file
                                })
                            ]);
                            
                            shareModal.style.display = 'none';
                            
                            window.open('https://web.telegram.org/', '_blank');
                            setTimeout(() => showToast('üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ! –ù–∞–∂–º–∏—Ç–µ Ctrl+V –≤ —á–∞—Ç–µ Telegram'), 100);
                            log('üìã –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ! –û—Ç–∫—Ä–æ–π—Ç–µ —á–∞—Ç –≤ Telegram Web –∏ –Ω–∞–∂–º–∏—Ç–µ Ctrl+V', 'success');
                        } else {
                            shareModal.style.display = 'none';
                            
                            // –°—Ç–∞—Ä—ã–π –±—Ä–∞—É–∑–µ—Ä - –ø—Ä–æ—Å—Ç–æ —Å–∫–∞—á–∏–≤–∞–µ–º
                            const imgData = renderer.domElement.toDataURL('image/png');
                            const link = document.createElement('a');
                            link.href = imgData;
                            link.download = 'scene_telegram.png';
                            link.click();
                            window.open('https://web.telegram.org/', '_blank');
                            log('üíæ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–∫–∞—á–∞–Ω–æ. –û—Ç–∫—Ä–æ–π—Ç–µ Telegram Web –∏ –ø—Ä–∏–∫—Ä–µ–ø–∏—Ç–µ —Ñ–∞–π–ª', 'info');
                        }
                    }
                } catch (error) {
                    log(`–û—à–∏–±–∫–∞: ${error.message}`, 'error');
                }
            });
            
            // –ü—Ä—è—á–µ–º —Å–µ–∫—Ü–∏—é –±–æ—Ä—Ç–∞ –¥–ª—è –ø–ª–æ—Å–∫–∏—Ö –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            const sideToggle = document.querySelector('[data-section="side-content"]');
            const sideContent = document.getElementById('side-content');
            if (sideToggle && sideContent) {
                sideToggle.style.display = 'none';
                sideContent.style.display = 'none';
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–∏–ø –±–æ—Ä—Ç–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ (–¥–ª—è –∞–ª—é–º–∏–Ω–∏—è —Å–∫—Ä—ã–≤–∞–µ–º –ø–æ–ª–µ —Ç–æ–ª—â–∏–Ω—ã)
            const sideMaterialSelect = document.getElementById('side-material-type');
            if (sideMaterialSelect) {
                const [type] = sideMaterialSelect.value.split('-');
                const bortHeightGroup = document.querySelector('#side-section .field-group:last-child');
                if (bortHeightGroup && type === 'aluminum') {
                    bortHeightGroup.style.display = 'none';
                }
            }
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –ø–æ–ª—è –≤–≤–æ–¥–∞ –≤—ã—Å–æ—Ç—ã –±–æ—Ä—Ç–∞
            const bortHeightDisplay = document.getElementById('bort-height-display');
            if (bortHeightDisplay) {
                bortHeightDisplay.addEventListener('blur', window.onBortHeightInput);
                bortHeightDisplay.addEventListener('keydown', window.onBortHeightKeypress);
            }
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –ø–∞–ª–∏—Ç—Ä—É —Ü–≤–µ—Ç–æ–≤ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
            const initialMaterialValue = document.getElementById('face-material-type').value;
            const initialParts = initialMaterialValue.split('-');
            const initialMaterialType = initialParts[0];
            const initialAcrylicColor = initialParts[0] === 'acrylic' ? initialParts[2] : null;
            updateColorPalette(initialMaterialType, initialAcrylicColor);
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–∞—Å—Ç–æ–º–Ω—ã–π dropdown —Å —Ü–≤–µ—Ç–Ω—ã–º–∏ –∫–≤–∞–¥—Ä–∞—Ç–∏–∫–∞–º–∏
            initCustomColorSelect();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º dropdown —Ü–≤–µ—Ç–∞ –ø—Ä–æ—Ñ–∏–ª—è
            initSideColorSelect();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–∞—Ä—É—Å–µ–ª—å —Ü–≤–µ—Ç–æ–≤ —Å—Ç–µ–Ω—ã
            renderWallColors();
            
            // –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–≤—ë—Ä–Ω—É—Ç (–Ω–µ —Ä–∞—Å–∫—Ä—ã–≤–∞–µ–º –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ)
            console.log('[INIT] –í—Å–µ —Å–µ–∫—Ü–∏–∏ —Å–≤—ë—Ä–Ω—É—Ç—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é');
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ —Å–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏—è –ø–∞–Ω–µ–ª–∏
            const panelToggle = document.getElementById('panel-toggle');
            const overlayRight = document.querySelector('.overlay-right');
            const sectionIndicator = document.getElementById('section-indicator');
            if (panelToggle && overlayRight) {
                panelToggle.addEventListener('click', () => {
                    overlayRight.classList.toggle('collapsed');
                    panelToggle.classList.toggle('collapsed');
                    
                    // –°–∫—Ä—ã–≤–∞–µ–º/–ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä
                    if (sectionIndicator) {
                        if (overlayRight.classList.contains('collapsed')) {
                            sectionIndicator.style.opacity = '0';
                            sectionIndicator.style.right = '-100px';
                        } else {
                            sectionIndicator.style.opacity = '1';
                            sectionIndicator.style.right = '364px';
                            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞
                            setTimeout(() => {
                                const firstSection = document.querySelector('.section-title');
                                if (firstSection) updateSectionIndicator(firstSection);
                            }, 350);
                        }
                    }
                });
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–ª–∏–∫–∞ –Ω–∞ –≤—Å–µ —Å–µ–∫—Ü–∏–∏
            document.querySelectorAll('.section-title').forEach(section => {
                section.addEventListener('click', () => {
                    updateSectionIndicator(section);
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é —Å–µ–∫—Ü–∏—é
                    const indicator = document.getElementById('section-indicator');
                    if (indicator) {
                        indicator.dataset.activeSection = `.section-title:nth-child(${Array.from(section.parentNode.children).indexOf(section) + 1})`;
                    }
                });
            });
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –Ω–∞ –ø–µ—Ä–≤–æ–π —Å–µ–∫—Ü–∏–∏
            setTimeout(() => {
                const firstSection = document.querySelector('.section-title');
                if (firstSection) updateSectionIndicator(firstSection);
            }, 100);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ –ø–∞–Ω–µ–ª–∏
            if (overlayRight) {
                overlayRight.addEventListener('scroll', () => {
                    // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Å–∫—Ä–æ–ª–ª–∞
                    const indicator = document.getElementById('section-indicator');
                    if (indicator && indicator.dataset.activeSection) {
                        const activeSection = document.querySelector(indicator.dataset.activeSection);
                        if (activeSection) updateSectionIndicator(activeSection);
                    }
                });
            }
            
            log('UI –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã', 'success');
        });
        
        // === –¢–ï–°–¢–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –î–ï–ú–û–ù–°–¢–†–ê–¶–ò–ò ===
        function testLoadSVG() {
            const testSVG = `<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" width="500mm" height="500mm" viewBox="0 0 500 500">
  <rect x="50" y="50" width="400" height="400" fill="#e74c3c"/>
</svg>`;
            
            // –≠–º—É–ª–∏—Ä—É–µ–º –∑–∞–≥—Ä—É–∑–∫—É —Ñ–∞–π–ª–∞
            const container = document.getElementById('svg-preview-container');
            container.innerHTML = testSVG;
            container.style.display = 'flex';
            
            const uploadZone = document.getElementById('upload-zone');
            uploadZone.classList.add('has-file');
            uploadZone.innerHTML = `
                <div style="font-size: 32px; margin-bottom: 10px;">‚úÖ</div>
                <div style="font-size: 16px;">–ö–≤–∞–¥—Ä–∞—Ç –∑–∞–≥—Ä—É–∂–µ–Ω!</div>
                <div style="font-size: 12px; opacity: 0.7; margin-top: 5px;">–ù–∞–∂–º–∏—Ç–µ —Å–Ω–æ–≤–∞ —á—Ç–æ–±—ã –∑–∞–º–µ–Ω–∏—Ç—å</div>
            `;
            
            
            state.svgLoaded = true;
            log('–¢–ï–°–¢: SVG –∑–∞–≥—Ä—É–∂–µ–Ω (–∫–≤–∞–¥—Ä–∞—Ç)', 'success');
            
            // –ó–∞–º–µ–Ω—è–µ–º 3D –º–æ–¥–µ–ª—å
            replaceLetterWithSVG(testSVG);
        }
        
        // === –¢–ï–°–¢ –°–ú–ï–ù–´ –¶–í–ï–¢–ê –ë–û–†–¢–ê ===
        function testChangeBortColor(color) {
            state.sideColor = color;
            update3DLetter();
            log(`–¢–µ—Å—Ç: —Ü–≤–µ—Ç –±–æ—Ä—Ç–∞ –∏–∑–º–µ–Ω—ë–Ω –Ω–∞ ${color}`, 'info');
        }
        
        // === –¢–ï–°–¢ –ó–ê–ì–†–£–ó–ö–ò –°–û–õ–¨ ===
        async function testLoadSOL() {
            try {
                const response = await fetch('SOL-test.svg');
                const svgText = await response.text();
                
                const container = document.getElementById('svg-preview-container');
                container.innerHTML = svgText;
                container.style.display = 'flex';
                
                const uploadZone = document.getElementById('upload-zone');
                uploadZone.classList.add('has-file');
                uploadZone.innerHTML = `
                    <div style="font-size: 32px; margin-bottom: 10px;">‚úÖ</div>
                    <div style="font-size: 16px;">–°–û–õ–¨ –∑–∞–≥—Ä—É–∂–µ–Ω–æ!</div>
                    <div style="font-size: 12px; opacity: 0.7; margin-top: 5px;">–ù–∞–∂–º–∏—Ç–µ —Å–Ω–æ–≤–∞ —á—Ç–æ–±—ã –∑–∞–º–µ–Ω–∏—Ç—å</div>
                `;
                
                
                state.svgLoaded = true;
                log('‚úÖ –¢–ï–°–¢: SVG –∑–∞–≥—Ä—É–∂–µ–Ω (–°–û–õ–¨)', 'success');
                replaceLetterWithSVG(svgText);
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –°–û–õ–¨.svg: ${error.message}`, 'error');
            }
        }
        
        // === –ó–ê–ü–£–°–ö ===
        if (document.readyState === 'complete') {
            setTimeout(tryInit3D, 100);
        } else {
            window.addEventListener('load', () => setTimeout(tryInit3D, 100));
        }
    </script>
</body>
</html>
